var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;import{c as r,a,b as l,l as s,q as c,d,e as u,f as p,p as m,i as h,w as g,g as v,h as y,t as f,j as w,n as x,k as b,m as C,o as S,u as E,r as I,s as A,v as M,x as R,K as P,y as T,z,A as B,B as D}from"./vendor.ad595088.js";const O="auto",L=Float32Array.BYTES_PER_ELEMENT,k=["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"],_={color:[0,0,0,0],depth:1},N=["panZoom","lasso","rotate"],$="panZoom",W={cubicIn:a,cubicInOut:r,cubicOut:l,linear:s,quadIn:c,quadInOut:d,quadOut:u},F=r,Z=["deselect","lassoEnd"],j=[0,.666666667,1,1],V=2,q=!1,G=10,H=3,K="lassoEnd",X=["lasso","rotate","merge"],Y=["alt","cmd","ctrl","meta","shift"],U={alt:"rotate",shift:"lasso",cmd:"merge"},J=O,Q=O,ee=1,te=6,ne=2,oe=2,ie=null,re=2,ae=2,le=null,se=null,ce=null,de=.66,ue=null,pe=.15,me=25,he=null,ge=[.66,.66,.66,1],ve=[0,.55,1,1],ye=[1,1,1,1],fe=[0,0,0,1],we=null,xe=[.66,.66,.66,.2],be=[0,.55,1,1],Ce=[1,1,1,1],Se=[0,0],Ee=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ie=null,Ae=!1,Me=[1,1,1,.5],Re=!0,Pe=!0,Te=!1,ze=100,Be=.002,De="auto",Oe=!1,Le=new Set(["z","valueZ","valueA","value1","category"]),ke=new Set(["w","valueW","valueB","value2","value"]),_e=(e,t,n,o)=>Math.sqrt((e-n)**2+(t-o)**2),Ne=(e,t=!1)=>e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,o)=>`#${t}${t}${n}${n}${o}${o}`)).substring(1).match(/.{2}/g).map((e=>parseInt(e,16)/255**t)),$e=(e,t,{minLength:n=0}={})=>Array.isArray(e)&&e.length>=n&&e.every(t),We=e=>!Number.isNaN(+e)&&+e>=0,Fe=e=>!Number.isNaN(+e)&&+e>0,Ze=(e,t)=>n=>e.indexOf(n)>=0?n:t,je=(e,t)=>new Promise(((n,o)=>{((e,t=!1)=>new Promise(((n,o)=>{const i=new Image;t&&(i.crossOrigin="anonymous"),i.src=e,i.onload=()=>{n(i)},i.onerror=e=>{o(e)}})))(t,0!==t.indexOf(window.location.origin)&&-1===t.indexOf("base64")).then((t=>{n(e.texture(t))})).catch((e=>{o(e)}))})),Ve=e=>e>=0&&e<=1,qe=e=>Array.isArray(e)&&e.every(Ve),Ge=e=>"string"==typeof e||e instanceof String,He=e=>Number.isInteger(e)&&e>=0&&e<=255,Ke=e=>Array.isArray(e)&&e.every(He),Xe=e=>Array.isArray(e)&&e.length&&(Array.isArray(e[0])||Ge(e[0])),Ye=(e,t)=>e>t?e:t,Ue=(e,t)=>e<t?e:t,Je=(e,t)=>{if(4===(n=e).length&&(qe(n)||Ke(n))){const n=qe(e);return t&&n||!t&&!n?e:t&&!n?e.map((e=>e/255)):e.map((e=>255*e))}var n,o;if(3===(o=e).length&&(qe(o)||Ke(o))){const n=255**!t,o=qe(e);return t&&o||!t&&!o?[...e,n]:t&&!o?[...e.map((e=>e/255)),n]:[...e.map((e=>255*e)),n]}return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?((e,t=!1)=>[...Ne(e,t),255**!t])(e,t):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),t?[1,1,1,1]:[255,255,255,255])},Qe=e=>Object.entries(e).reduce(((e,[t,n])=>(e[n]?e[n]=[...e[n],t]:e[n]=t,e)),{}),et=e=>.21*e[0]+.72*e[1]+.07*e[2],tt=(e={})=>{let{regl:t,canvas:n=document.createElement("canvas"),gamma:o=ee}=e;(e=>{!!e&&k.reduce(((t,n)=>e.hasExtension(n)?t:(console.warn(`WebGL: ${n} extension not supported. Scatterplot might not render properly`),!1)),!0)})(t),t||(t=(e=>{const t=e.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}),n=[];return k.forEach((e=>{t.getExtension(e)?n.push(e):console.warn(`WebGL: ${e} extension not supported. Scatterplot might not render properly`)})),p({gl:t,extensions:n})})(n));const i=[n.width,n.height],r=t.framebuffer({width:i[0],height:i[1],colorFormat:"rgba",colorType:"float"}),a=t({vert:"\n      precision highp float;\n      attribute vec2 xy;\n      void main () {\n        gl_Position = vec4(xy, 0, 1);\n      }",frag:"\n      precision highp float;\n      uniform vec2 srcRes;\n      uniform sampler2D src;\n      uniform float gamma;\n\n      vec3 approxLinearToSRGB (vec3 rgb, float gamma) {\n        return pow(clamp(rgb, vec3(0), vec3(1)), vec3(1.0 / gamma));\n      }\n\n      void main () {\n        vec4 color = texture2D(src, gl_FragCoord.xy / srcRes);\n        gl_FragColor = vec4(approxLinearToSRGB(color.rgb, gamma), color.a);\n      }",attributes:{xy:[-4,-4,4,-4,0,4]},uniforms:{src:()=>r,srcRes:()=>i,gamma:()=>o},count:3,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}}),l=new Set,s=t.frame((()=>{const e=l.values();let t=e.next();for(;!t.done;)t.value(),t=e.next()})),c=()=>{n.width=window.innerWidth*window.devicePixelRatio,n.height=window.innerHeight*window.devicePixelRatio,i[0]=n.width,i[1]=n.height,r.resize(...i)};e.canvas||(window.addEventListener("resize",c),window.addEventListener("orientationchange",c),c());return{get canvas(){return n},get regl(){return t},get gamma(){return o},set gamma(e){o=+e},render:(e,o)=>{t.clear(_),r.use((()=>{t.clear(_),e(o.width/n.width,o.height/n.height)})),a(),(e=>{const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(n,(n.width-e.width)/2,(n.height-e.height)/2,e.width,e.height,0,0,e.width,e.height)})(o)},onFrame:e=>(l.add(e),()=>{l.delete(e)}),refresh:()=>{t.poll()},destroy:()=>{s.cancel(),n=void 0,t=void 0,window.removeEventListener("resize",c),window.removeEventListener("orientationchange",c)}}},nt=(e,t=null)=>null===e?t:e,ot=document.createElement("style");document.head.appendChild(ot);const it=ot.sheet,rt=e=>{const t=it.rules.length;return it.insertRule(e,t),t},at=e=>{it.deleteRule(e)};let lt=null;let st=null;const ct=(e,{onDraw:t=h,onStart:n=h,onEnd:o=h,enableInitiator:i=true,initiatorParentElement:r=document.body,minDelay:a=8,minDist:l=2,pointNorm:s=h}={})=>{let c=i,d=r,u=t,p=n,C=o,S=s;const E=document.createElement("div"),I=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);E.id=`lasso-initiator-${I}`,E.style.position="fixed",E.style.display="flex",E.style.justifyContent="center",E.style.alignItems="center",E.style.zIndex=99,E.style.width="4rem",E.style.height="4rem",E.style.borderRadius="4rem",E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)";let A,M=!1,R=!1,P=[],T=[];const z=()=>{M=!1};window.addEventListener("mouseup",z);const B=()=>{E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)"},D=()=>{const e=getComputedStyle(E),t=+e.opacity,n=e.transform.match(/([0-9.-]+)+/g),o=+n[0],i=+n[1];return{opacity:t,scale:Math.sqrt(o*o+i*i),rotate:Math.atan2(i,o)*(180/Math.PI)}},O=e=>{c&&w(0).then((()=>{const t=e.clientX,n=e.clientY;if(M)return;let o=.5,i=0,r=0;const a=D();o=a.opacity,i=a.scale,r=a.rotate,E.style.opacity=o,E.style.transform=`translate(-50%,-50%) scale(${i}) rotate(${r}deg)`,E.style.animation="none",x(2).then((()=>{E.style.top=`${n}px`,E.style.left=`${t}px`,null!==lt&&at(lt),lt=rt(((e,t,n)=>`\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1) rotate(${n+20}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9) rotate(${n+60}deg);\n  }\n}\n`)(o,i,r)),E.style.animation="2500ms ease scaleInFadeOut 0s 1 normal backwards",x().then((()=>{B()}))}))}))},L=()=>{const{opacity:e,scale:t,rotate:n}=D();E.style.opacity=e,E.style.transform=`translate(-50%,-50%) scale(${t}) rotate(${n}deg)`,E.style.animation="none",x(2).then((()=>{null!==st&&at(st),st=rt(((e,t,n)=>`\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0) rotate(${n}deg);\n  }\n}\n`)(e,t,n)),E.style.animation="250ms ease fadeScaleOut 0s 1 normal backwards",x().then((()=>{B()}))}))},k=()=>{u(P,T)},_=e=>{if(A){if(b(e[0],e[1],A[0],A[1])>2){A=e;const t=S(e);P.push(t),T.push(t[0],t[1]),P.length>1&&k()}}else{R||(R=!0,p()),A=e;const t=S(e);P=[t],T=[t[0],t[1]]}},N=f(_,8,8),$=(t,n)=>{const o=(t=>{const{left:n,top:o}=e.getBoundingClientRect();return[t.clientX-n,t.clientY-o]})(t);return n?N(o):_(o)},W=()=>{P=[],T=[],A=void 0,k()},F=e=>{O(e)},Z=()=>{M=!0,R=!0,W(),p()},j=()=>{L()},V=({merge:e=!1}={})=>{R=!1;const t=[...P],n=[...T];return N.cancel(),W(),t.length&&C(t,n,{merge:e}),t},q=({onDraw:e=null,onStart:t=null,onEnd:n=null,enableInitiator:o=null,initiatorParentElement:i=null,minDelay:r=null,minDist:a=null,pointNorm:l=null}={})=>{u=nt(e,u),p=nt(t,p),C=nt(n,C),c=nt(o,c),S=nt(l,S),null!==i&&i!==d&&(d.removeChild(E),i.appendChild(E),d=i),c?(E.addEventListener("click",F),E.addEventListener("mousedown",Z),E.addEventListener("mouseleave",j)):(E.removeEventListener("mousedown",Z),E.removeEventListener("mouseleave",j))},G=()=>{d.removeChild(E),window.removeEventListener("mouseup",z),E.removeEventListener("click",F),E.removeEventListener("mousedown",Z),E.removeEventListener("mouseleave",j)};return d.appendChild(E),q({onDraw:u,onStart:p,onEnd:C,enableInitiator:c,initiatorParentElement:d}),m(y("initiator",E),(e=>v(e,{clear:W,destroy:G,end:V,extend:$,set:q,showInitiator:O,hideInitiator:L})),g(ct))({})},dt=e=>`\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float stateTexEps;\nuniform float devicePixelRatio;\nuniform sampler2D encodingTex;\nuniform float encodingTexRes;\nuniform float encodingTexEps;\nuniform float pointSizeExtra;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByZ;\nuniform float isColoredByW;\nuniform float isOpacityByZ;\nuniform float isOpacityByW;\nuniform float isOpacityByDensity;\nuniform float isSizedByZ;\nuniform float isSizedByW;\nuniform float colorMultiplicator;\nuniform float opacityMultiplicator;\nuniform float opacityDensity;\nuniform float sizeMultiplicator;\nuniform float numColorStates;\nuniform float pointScale;\nuniform mat4 modelViewProjection;\n\nattribute vec2 stateIndex;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nvoid main() {\n  vec4 state = texture2D(stateTex, stateIndex);\n\n  gl_Position = modelViewProjection * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexZ =  isColoredByZ * floor(state.z * colorMultiplicator);\n  float colorIndexW =  isColoredByW * floor(state.w * colorMultiplicator);\n\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  float colorIndex = (colorIndexZ + colorIndexW) * numColorStates;\n\n  // Half a "pixel" or "texel" in texture coordinates\n  float colorLinearIndex = colorIndex + globalState;\n\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + colorTexEps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // Retrieve point size\n  float pointSizeIndexZ = isSizedByZ * floor(state.z * sizeMultiplicator);\n  float pointSizeIndexW = isSizedByW * floor(state.w * sizeMultiplicator);\n  float pointSizeIndex = pointSizeIndexZ + pointSizeIndexW;\n\n  float pointSizeRowIndex = floor((pointSizeIndex + encodingTexEps) / encodingTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / encodingTexRes) - pointSizeRowIndex + encodingTexEps,\n    pointSizeRowIndex / encodingTexRes + encodingTexEps\n  );\n  float pointSize = texture2D(encodingTex, pointSizeTexIndex).x;\n\n  // Retrieve opacity\n  ${3===e?"":`\n        if (isOpacityByDensity < 0.5) {\n          float opacityIndexZ = isOpacityByZ * floor(state.z * opacityMultiplicator);\n          float opacityIndexW = isOpacityByW * floor(state.w * opacityMultiplicator);\n          float opacityIndex = opacityIndexZ + opacityIndexW;\n\n          float opacityRowIndex = floor((opacityIndex + encodingTexEps) / encodingTexRes);\n          vec2 opacityTexIndex = vec2(\n            (opacityIndex / encodingTexRes) - opacityRowIndex + encodingTexEps,\n            opacityRowIndex / encodingTexRes + encodingTexEps\n          );\n          color.a = texture2D(encodingTex, opacityTexIndex)[${1+e}];\n        } else {\n          color.a = min(1.0, opacityDensity + globalState);\n        }\n      `}\n\n  finalPointSize = (pointSize * pointScale) + pointSizeExtra;\n  gl_PointSize = finalPointSize;\n}\n`,ut=function(){const e=(e,t,n,o,i)=>{const r=.5*(o-t),a=.5*(i-n);return(2*n-2*o+r+a)*e*e*e+(-3*n+3*o-2*r-a)*e*e+r*e+n},t=(t,n,o)=>{const i=o*t,r=Math.floor(i),a=i-r,l=n[Math.max(0,r-1)],s=n[r],c=n[Math.min(o,r+1)],d=n[Math.min(o,r+2)];return[e(a,l[0],s[0],c[0],d[0]),e(a,l[1],s[1],c[1],d[1])]},n=(e,t,n)=>{let o=t[0],i=t[1],r=n[0]-o,a=n[1]-i;if(0!==r||0!==a){const t=((e[0]-o)*r+(e[1]-i)*a)/(r*r+a*a);t>1?(o=n[0],i=n[1]):t>0&&(o+=r*t,i+=a*t)}return r=e[0]-o,a=e[1]-i,r*r+a*a},o=(e,t,i,r,a)=>{let l,s=r;for(let o=t+1;o<i;o++){const r=n(e[o],e[t],e[i]);r>s&&(l=o,s=r)}s>r&&(l-t>1&&o(e,t,l,r,a),a.push(e[l]),i-l>1&&o(e,l,i,r,a))},i=(e,t)=>{const n=e.length-1,i=[e[0]];return o(e,0,n,t,i),i.push(e[n]),i};self.onmessage=function(e){(e.data.points?+e.data.points.length:0)||self.postMessage({error:new Error("No points provided")}),e.data.points;const n=(e=>{const t={},n=!Number.isNaN(+e[0][5]);return e.forEach((e=>{const o=e[4];t[o]||(t[o]=[]),n?t[o][e[5]]=e:t[o].push(e)})),Object.entries(t).forEach((e=>{t[e[0]]=e[1].filter((e=>e)),t[e[0]].reference=e[1][0]})),t})(e.data.points);self.postMessage({points:Object.entries(n).reduce(((n,o)=>(n[o[0]]=((e,{maxIntPointsPerSegment:n=100,tolerance:o=.002}={})=>{const r=e.length,a=r-1,l=a*n+1,s=o**2;let c,d=[];for(let m=0;m<r-1;m++){let o=[e[m].slice(0,2)];c=e[m];for(let i=1;i<n;i++){const r=t((m*n+i)/l,e,a);u=c[0],p=c[1],(u-r[0])**2+(p-r[1])**2>s&&(o.push(r),c=r)}o.push(e[m+1]),o=i(o,s),d=d.concat(o.slice(0,o.length-1))}var u,p;
/**
   * Douglas Peucker square segment distance
   * Implementation from https://github.com/mourner/simplify-js
   * @author Vladimir Agafonkin
   * @copyright Vladimir Agafonkin 2013
   * @license BSD
   * @param {array} p - Point
   * @param {array} p1 - First boundary point
   * @param {array} p2 - Second boundary point
   * @return {number} Distance
   */return d.push(e[e.length-1].slice(0,2)),d.flat()})(o[1],e.data.options),n[o[0]].reference=o[1].reference,n)),{})})}},pt={showRecticle:"showReticle",recticleColor:"reticleColor"},mt=e=>{Object.keys(e).filter((e=>pt[e])).forEach((t=>{console.warn(`regl-scatterplot: the "${t}" property is deprecated. Please use "${pt[t]}" instead.`),e[pt[t]]=e[t],delete e[t]}))},ht=(e,t,{allowSegment:n=!1,allowDensity:o=!1}={})=>Le.has(e)?"valueZ":ke.has(e)?"valueW":"segment"===e?n?"segment":t:"density"===e&&o?"density":t,gt=e=>{switch(e){case"valueZ":return 2;case"valueW":return 3;default:return null}},vt=(e={})=>{const r=S({async:!e.syncEvents,caseInsensitive:!0}),a=new Float32Array(16),l=new Float32Array(16),s=[0,0];mt(e);let{renderer:c,backgroundColor:d=fe,backgroundImage:u=Ie,canvas:p=document.createElement("canvas"),colorBy:m=he,deselectOnDblClick:g=Re,deselectOnEscape:v=Pe,lassoColor:y=j,lassoLineWidth:w=V,lassoMinDelay:x=G,lassoMinDist:b=H,lassoClearEvent:k=K,lassoInitiator:_=q,lassoInitiatorParentElement:ee=document.body,keyMap:Ne=U,mouseMode:Ve=$,showReticle:qe=Ae,reticleColor:He=Me,pointColor:Ke=ge,pointColorActive:nt=ve,pointColorHover:ot=ye,showPointConnections:it=Te,pointConnectionColor:rt=xe,pointConnectionColorActive:at=be,pointConnectionColorHover:lt=Ce,pointConnectionColorBy:st=we,pointConnectionOpacity:pt=se,pointConnectionOpacityBy:vt=ce,pointConnectionOpacityActive:yt=de,pointConnectionSize:ft=re,pointConnectionSizeActive:wt=ae,pointConnectionSizeBy:xt=le,pointConnectionMaxIntPointsPerSegment:bt=ze,pointConnectionTolerance:Ct=Be,pointSize:St=te,pointSizeSelected:Et=ne,pointSizeMouseDetection:It=De,pointOutlineWidth:At=oe,opacity:Mt=O,opacityBy:Rt=ue,opacityByDensityFill:Pt=pe,sizeBy:Tt=ie,height:zt=Q,width:Bt=J}=e,Dt=Bt===O?1:Bt,Ot=zt===O?1:zt;const{performanceMode:Lt=Oe,opacityByDensityDebounceTime:kt=me}=e;c||(c=tt({regl:e.regl,gamma:e.gamma})),d=Je(d,!0),y=Je(y,!0),He=Je(He,!0);let _t,Nt,$t=et(d),Wt=!1,Ft=[];const Zt=new Set,jt=new Set;let Vt,qt,Gt,Ht,Kt,Xt,Yt,Ut,Jt,Qt,en,tn,nn,on,rn,an=null,ln=[0,0],sn=0,cn=0,dn=!1,un=[],pn=1,mn=Qe(Ne),hn=!1,gn=!0,vn=!1;Ke=Xe(Ke)?[...Ke]:[Ke],nt=Xe(nt)?[...nt]:[nt],ot=Xe(ot)?[...ot]:[ot],Ke=Ke.map((e=>Je(e,!0))),nt=nt.map((e=>Je(e,!0))),ot=ot.map((e=>Je(e,!0))),Mt=!Array.isArray(Mt)&&Number.isNaN(+Mt)?Ke[0][3]:Mt,Mt=$e(Mt,We,{minLength:1})?[...Mt]:[Mt],St=$e(St,We,{minLength:1})?[...St]:[St];let yn,fn,wn,xn,bn=1/St[0];"inherit"===rt?rt=[...Ke]:(rt=Xe(rt)?[...rt]:[rt],rt=rt.map((e=>Je(e,!0)))),"inherit"===at?at=[...nt]:(at=Xe(at)?[...at]:[at],at=at.map((e=>Je(e,!0)))),"inherit"===lt?lt=[...ot]:(lt=Xe(lt)?[...lt]:[lt],lt=lt.map((e=>Je(e,!0)))),pt="inherit"===pt?[...Mt]:$e(pt,We,{minLength:1})?[...pt]:[pt],ft="inherit"===ft?[...St]:$e(ft,We,{minLength:1})?[...ft]:[ft],m=ht(m,he),Rt=ht(Rt,ue,{allowDensity:!0}),Tt=ht(Tt,ie),st=ht(st,we,{allowSegment:!0}),vt=ht(vt,ce,{allowSegment:!0}),xt=ht(xt,le,{allowSegment:!0});let Cn,Sn,En,In,An,Mn,Rn,Pn,Tn=0,zn=0,Bn=!1,Dn=null,On=qe,Ln=0,kn=0,_n=!1,Nn=!1,$n=0,Wn=0,Fn=!1,Zn=e.xScale||null,jn=e.yScale||null,Vn=0,qn=0,Gn=0,Hn=0;Zn&&(Vn=Zn.domain()[0],qn=Zn.domain()[1]-Zn.domain()[0],Zn.range([0,Dt])),jn&&(Gn=jn.domain()[0],Hn=jn.domain()[1]-jn.domain()[0],jn.range([Ot,0]));const Kn=e=>e/Dt*2-1,Xn=e=>1+e/Ot*-2,Yn=(e,t)=>{const n=[e,t,1,1],o=I(a,A(a,Gt,A(a,_t.view,Kt)));return M(n,n,o),n.slice(0,2)},Un=()=>{const[e,t]=[Kn(s[0]),Xn(s[1])],[n,o]=Yn(e,t),i=qo(),r=nn[1]-on[1],a=en*i*(r/Ot)*.66,l=Vt.range(n-a,o-a,n+a,o+a);let c,d=a;return l.forEach((e=>{const[t,i]=Vt.points[e],r=_e(t,i,n,o);r<d&&(d=r,c=e)})),d<en/Dt*2?c:-1},Jn=()=>{un=[],Nt&&Nt.clear()},Qn=e=>e&&e.length>4,eo=(e,t)=>{if(Ut||!it||!Qn(Vt.points[e[0]]))return;const n=0===t,o=1===t?e=>jt.add(e):h,i=Object.keys(e.reduce(((e,t)=>{const n=Vt.points[t];return e[Array.isArray(n[4])?n[4][0]:n[4]]=!0,e}),{})),r=Xt.getData().opacities;i.filter((e=>!jt.has(+e))).forEach((e=>{const t=Yt[e][0],i=Yt[e][2],a=4*t+2*Yt[e][3],l=a+2*i+4;void 0===r.__original__&&(r.__original__=r.slice());for(let o=a;o<l;o++)r[o]=n?r.__original__[o]:yt;o(e)})),Xt.getBuffer().opacities.subdata(r,0)},to=e=>[e%Tn/Tn+zn,Math.floor(e/Tn)/Tn+zn],no=({preventEvent:e=!1}={})=>{"deselect"===k&&Jn(),Ft.length&&(e||r.publish("deselect"),jt.clear(),eo(Ft,0),Ft=[],Zt.clear(),gn=!0)},oo=(e,{merge:t=!1,preventEvent:n=!1}={})=>{const o=Array.isArray(e)?e:[e];t?Ft=E(Ft,o):(Ft&&Ft.length&&eo(Ft,0),Ft=o);const i=[];Zt.clear(),jt.clear();for(let r=Ft.length-1;r>=0;r--){const e=Ft[r];if(e<0||e>=sn)Ft.splice(r,1);else{Zt.add(e);const t=to(e);i.push(t[0]),i.push(t[1])}}Sn({usage:"dynamic",type:"float",data:i}),eo(Ft,1),n||r.publish("select",{points:Ft}),gn=!0},io=e=>{const t=p.getBoundingClientRect();return s[0]=e.clientX-t.left,s[1]=e.clientY-t.top,[...s]},ro=ct(p,{onStart:()=>{_t.config({isFixed:!0}),Wt=!0,dn=!0,Jn(),r.publish("lassoStart")},onDraw:(e,t)=>{un=e,Nt.setPoints(t),r.publish("lassoExtend",{coordinates:e})},onEnd:(e,t,{merge:n=!1}={})=>{_t.config({isFixed:!1}),un=[...e];const o=(e=>{const t=(e=>{let t=1/0,n=-1/0,o=1/0,i=-1/0;for(let r=0;r<e.length;r+=2)t=e[r]<t?e[r]:t,n=e[r]>n?e[r]:n,o=e[r+1]<o?e[r+1]:o,i=e[r+1]>i?e[r+1]:i;return[t,o,n,i]})(e),n=Vt.range(...t),o=[];return n.forEach((t=>{(([e,t]=[],n)=>{let o,i,r,a,l=!1;for(let s=0,c=n.length-2;s<n.length;s+=2)o=n[s],i=n[s+1],r=n[c],a=n[c+1],i>t!=a>t&&e<(r-o)*(t-i)/(a-i)+o&&(l=!l),c=s;return l})(Vt.points[t],e)&&o.push(t)})),o})(t);oo(o,{merge:n}),r.publish("lassoEnd",{coordinates:un}),"lassoEnd"===k&&Jn()},enableInitiator:_,initiatorParentElement:ee,pointNorm:([e,t])=>Yn(Kn(e),Xn(t))}),ao=(e,t)=>{switch(mn[t]){case"alt":return e.altKey;case"cmd":return e.metaKey;case"ctrl":return e.ctrlKey;case"meta":return e.metaKey;case"shift":return e.shiftKey;default:return!1}},lo=e=>{Nn&&(Wt=!0,an=performance.now(),ln=io(e),dn="lasso"===Ve||ao(e,"lasso"))},so=e=>{Nn&&(Wt=!1,dn&&(e.preventDefault(),dn=!1,ro.end({merge:ao(e,"merge")})))},co=e=>{if(!Nn)return;e.preventDefault();const t=io(e);if(_e(...t,...ln)>=b)return;const n=performance.now()-an;if(_&&n>500)ro.showInitiator(e);else{const t=Un();t>=0?(Ft.length&&"deselect"===k&&Jn(),oo([t],{merge:ao(e,"merge")})):tn||(tn=setTimeout((()=>{tn=null,ro.showInitiator(e)}),200))}},uo=e=>{ro.hideInitiator(),tn&&(clearTimeout(tn),tn=null),g&&(e.preventDefault(),no())},po=e=>{Nn&&(Fn||Wt)&&(io(e),Fn&&!dn&&Bi(Un()),dn&&(e.preventDefault(),ro.extend(e,!0)),Wt&&(gn=!0))},mo=()=>{Nn&&(+Pn>=0&&!Zt.has(Pn)&&eo([Pn],0),Pn=void 0,Fn=!1,so(),gn=!0)},ho=()=>{const e=Math.max(St.length,Mt.length);kn=Math.max(2,Math.ceil(Math.sqrt(e)));const t=new Float32Array(kn**2*4);for(let n=0;n<e;n++){t[4*n]=St[n]||0,t[4*n+1]=Math.min(1,Mt[n]||0);const e=Number((nt[n]||nt[0])[3]);t[4*n+2]=Math.min(1,Number.isNaN(e)?1:e);const o=Number((ot[n]||ot[0])[3]);t[4*n+3]=Math.min(1,Number.isNaN(o)?1:o)}return c.regl.texture({data:t,shape:[kn,kn,4],type:"float"})},go=(e=Ke,t=nt,n=ot)=>{const o=e.length,i=t.length,r=n.length,a=[];if(o===i&&i===r)for(let l=0;l<o;l++)a.push(e[l],t[l],n[l],d);else for(let l=0;l<o;l++){const o=[e[l][0],e[l][1],e[l][2],1],i=m===he?t[0]:o,r=m===he?n[0]:o;a.push(e[l],i,r,d)}return a},vo=()=>{const e=go(),t=e.length;Ln=Math.max(2,Math.ceil(Math.sqrt(t)));const n=new Float32Array(Ln**2*4);return e.forEach(((e,t)=>{n[4*t]=e[0],n[4*t+1]=e[1],n[4*t+2]=e[2],n[4*t+3]=e[3]})),c.regl.texture({data:n,shape:[Ln,Ln,4],type:"float"})},yo=()=>{qt=Dt/Ot,Gt=R([],[1/qt,1,1]),Ht=R([],[1/qt,1,1]),Kt=R([],[pn,1,1])},fo=(e,t)=>n=>{if(!n||!n.length)return;const o=[...e()];let i=Xe(n)?n:[n];i=i.map((e=>Je(e,!0))),Mn&&Mn.destroy();try{t(i),Mn=vo()}catch(r){console.error("Invalid colors. Switching back to default colors."),t(o),Mn=vo()}},wo=fo((()=>Ke),(e=>{Ke=e})),xo=fo((()=>nt),(e=>{nt=e})),bo=fo((()=>ot),(e=>{ot=e})),Co=()=>{if(!Zn&&!jn)return;const[e,t]=(()=>{const e=Yn(-1,-1),t=Yn(1,1),n=(e[0]+1)/2,o=(t[0]+1)/2,i=(e[1]+1)/2,r=(t[1]+1)/2;return[[Vn+n*qn,Vn+o*qn],[Gn+i*Hn,Gn+r*Hn]]})();Zn&&Zn.domain(e),jn&&jn.domain(t)},So=e=>{Ot=e,p.height=Math.floor(Ot*window.devicePixelRatio),jn&&(jn.range([Ot,0]),Co())},Eo=()=>{en=It,It===O&&(en=Array.isArray(St)?St[Math.floor(St.length/2)]:St)},Io=e=>{Dt=e,p.width=Math.floor(Dt*window.devicePixelRatio),Zn&&(Zn.range([0,Dt]),Co())},Ao=e=>{switch(e){case"valueZ":return $n>1?"categorical":"continuous";case"valueW":return Wn>1?"categorical":"continuous";default:return null}},Mo=(e,t)=>{switch(e){default:case"categorical":return h;case"continuous":return e=>Math.round(e*(t.length-1))}},Ro=()=>[p.width,p.height],Po=()=>Mn,To=()=>Ln,zo=()=>.5/Ln,Bo=()=>window.devicePixelRatio,Do=()=>Sn,Oo=()=>Rn,Lo=()=>kn,ko=()=>.5/kn,_o=()=>0,No=()=>wn||yn,$o=()=>Tn,Wo=()=>.5/Tn,Fo=()=>Ht,Zo=()=>_t.view,jo=()=>Kt,Vo=()=>A(l,Ht,A(l,_t.view,Kt)),qo=()=>_t.scaling[0]>1?Math.asinh(Ye(1,_t.scaling[0]))/Math.asinh(1)*window.devicePixelRatio:Ye(bn,_t.scaling[0])*window.devicePixelRatio,Go=()=>Ft.length,Ho=()=>+("valueZ"===m),Ko=()=>+("valueW"===m),Xo=()=>+("valueZ"===Rt),Yo=()=>+("valueW"===Rt),Uo=()=>+("density"===Rt),Jo=()=>+("valueZ"===Tt),Qo=()=>+("valueW"===Tt),ei=()=>"valueZ"===m?$n<=1?Ke.length-1:1:Wn<=1?Ke.length-1:1,ti=()=>"valueZ"===Rt?$n<=1?Mt.length-1:1:Wn<=1?Mt.length-1:1,ni=()=>"valueZ"===Tt?$n<=1?St.length-1:1:Wn<=1?St.length-1:1,oi=e=>{if("density"!==Rt)return 1;const t=qo(),n=St[0]*t,o=2/(2/_t.view[0])*(2/(2/_t.view[5])),i=e.viewportHeight,r=e.viewportWidth;let a=Pt*r*i/(cn*n*n)*Ue(1,o);a*=Lt?1:1/(.25*Math.PI);const l=Ye(1,n)+.5;return a*=Math.pow(n/l,2),Ue(1,Ye(0,a))},ii=c.regl({framebuffer:()=>xn,vert:"precision highp float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}",frag:"precision highp float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:()=>fn,endStateTex:()=>yn,t:(e,t)=>t.t},count:3}),ri=(e,t,n,o=0)=>c.regl({frag:Lt?"precision highp float;\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n":"\nprecision highp float;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nfloat linearstep(float edge0, float edge1, float x) {\n  return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\nvoid main() {\n  vec2 c = gl_PointCoord * 2.0 - 1.0;\n  float sdf = length(c) * finalPointSize;\n  float alpha = linearstep(finalPointSize + 0.5, finalPointSize - 0.5, sdf);\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",vert:dt(o),blend:{enable:!Lt,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:n,size:2}},uniforms:{resolution:Ro,modelViewProjection:Vo,devicePixelRatio:Bo,pointScale:qo,encodingTex:Oo,encodingTexRes:Lo,encodingTexEps:ko,pointSizeExtra:e,globalState:o,colorTex:Po,colorTexRes:To,colorTexEps:zo,stateTex:No,stateTexRes:$o,stateTexEps:Wo,isColoredByZ:Ho,isColoredByW:Ko,isOpacityByZ:Xo,isOpacityByW:Yo,isOpacityByDensity:Uo,isSizedByZ:Jo,isSizedByW:Qo,colorMultiplicator:ei,opacityMultiplicator:ti,opacityDensity:oi,sizeMultiplicator:ni,numColorStates:4},count:t,primitive:"points"}),ai=ri(_o,(()=>sn),(()=>Cn)),li=ri(_o,(()=>1),(()=>En),2),si=ri((()=>(Et+2*At)*window.devicePixelRatio),Go,Do,1),ci=ri((()=>(Et+At)*window.devicePixelRatio),Go,Do,3),di=ri((()=>Et*window.devicePixelRatio),Go,Do,1),ui=c.regl({frag:"\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",vert:"\nprecision mediump float;\n\nuniform mat4 modelViewProjection;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = modelViewProjection * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{modelViewProjection:Vo,texture:()=>u},count:6}),pi=c.regl({vert:"\n      precision mediump float;\n      uniform mat4 modelViewProjection;\n      attribute vec2 position;\n      void main () {\n        gl_Position = modelViewProjection * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:()=>un},uniforms:{modelViewProjection:Vo,color:()=>y},elements:()=>Array.from({length:un.length-2},((e,t)=>[0,t+1,t+2]))}),mi=e=>{const t=new Float32Array(2*e);let n=0;for(let o=0;o<e;++o){const e=to(o);t[n]=e[0],t[n+1]=e[1],n+=2}return t},hi=e=>{const t=e.length;Tn=Math.max(2,Math.ceil(Math.sqrt(t))),zn=.5/Tn;const n=new Float32Array(Tn**2*4);$n=0,Wn=0;for(let o=0;o<t;++o)n[4*o]=e[o][0],n[4*o+1]=e[o][1],n[4*o+2]=e[o][2]||0,n[4*o+3]=e[o][3]||0,$n=Math.max($n,n[4*o+2]),Wn=Math.max(Wn,n[4*o+3]);return c.regl.texture({data:n,shape:[Tn,Tn,4],type:"float"})},gi=e=>{Nn=!1,sn=e.length,cn=sn,yn&&yn.destroy(),yn=hi(e),Cn({usage:"static",type:"float",data:mi(sn)}),Vt=new P(e,(e=>e[0]),(e=>e[1]),16),Nn=!0},vi=e=>{const t="inherit"===st?m:st;if("segment"===t){const t=rt.length-1;return t<1?[]:e.reduce(((e,n,o)=>{let i=0;const r=[];for(let t=2;t<n.length;t+=2){const e=Math.sqrt((n[t-2]-n[t])**2+(n[t-1]-n[t+1])**2);r.push(e),i+=e}e[o]=[0];let a=0;for(let l=0;l<n.length/2-1;l++)a+=r[l],e[o].push(4*Math.floor(a/i*t));return e}),[])}if(t){const e=gt(t),n=Mo(Ao(t),"inherit"===st?Ke:rt);return Yt.reduce(((t,[o,i])=>(t[o]=4*n(i[e]),t)),[])}return Array(Yt.length).fill(0)},yi=()=>{const e="inherit"===vt?Rt:vt;if("segment"===e){const e=pt.length-1;return e<1?[]:Yt.reduce(((t,[n,o,i])=>(t[n]=T(i,(t=>pt[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=gt(e),n="inherit"===vt?Mt:pt,o=Mo(Ao(e),n);return Yt.reduce(((e,[i,r])=>(e[i]=n[o(r[t])],e)),[])}},fi=()=>{const e="inherit"===xt?Tt:xt;if("segment"===e){const e=ft.length-1;return e<1?[]:Yt.reduce(((t,[n,o,i])=>(t[n]=T(i,(t=>ft[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=gt(e),n="inherit"===xt?St:ft,o=Mo(Ao(e),n);return Yt.reduce(((e,[i,r])=>(e[i]=n[o(r[t])],e)),[])}},wi=e=>new Promise((t=>{Xt.setPoints([]),e&&e.length?(Ut=!0,((e,t={tolerance:.002,maxIntPointsPerSegment:100})=>new Promise(((n,o)=>{const i=C(ut);i.onmessage=e=>{e.data.error?o(e.data.error):n(e.data.points),i.terminate()},i.postMessage({points:e,options:t})})))(e,{maxIntPointsPerSegment:bt,tolerance:Ct}).then((e=>{(e=>{Yt=[];let t=0;Object.keys(e).forEach(((n,o)=>{Yt[n]=[o,e[n].reference,e[n].length/2,t],t+=e[n].length/2}))})(e);const n=Object.values(e);Xt.setPoints(n,{colorIndices:vi(n),opacities:yi(),widths:fi()}),Ut=!1,t()}))):t()})),xi=()=>Vt.range(on[0],on[1],nn[0],nn[1]),bi=f((()=>{cn=xi().length}),kt),Ci=()=>{Bn=!1,Dn=null,In=void 0,An=void 0,qe=On,fn&&(fn.destroy(),fn=void 0),wn&&(wn.destroy(),wn=void 0),r.publish("transitionEnd")},Si=e=>(...t)=>{const n=e(...t);return gn=!0,n},Ei=()=>{Xt.setStyle({color:go(rt,at,lt),opacity:null===pt?null:pt[0],width:ft[0]})},Ii=()=>{const e=Math.round($t)>0?0:255;ro.initiator.style.border=`1px dashed rgba(${e}, ${e}, ${e}, 0.33)`,ro.initiator.style.background=`rgba(${e}, ${e}, ${e}, 0.1)`},Ai=e=>{e&&_t.setView(e)},Mi=(e,t)=>n=>{if("inherit"===n)e([...t()]);else{const t=Xe(n)?n:[n];e(t.map((e=>Je(e,!0))))}Ei()},Ri=Mi((e=>{rt=e}),(()=>Ke)),Pi=Mi((e=>{at=e}),(()=>nt)),Ti=Mi((e=>{lt=e}),(()=>ot)),zi=(e={})=>{var t,n,o,i,a,l,s,h,f,C,S,E,I,A,M,R,P,T,z,B,D,L,$,W,F,j,V,q,G,H,K,U,J,Q;return mt(e),void 0===e.backgroundColor&&void 0===e.background||(t=e.backgroundColor||e.background)&&(d=Je(t,!0),$t=et(d),Ii()),void 0!==e.backgroundImage&&((n=e.backgroundImage)?Ge(n)?je(c.regl,n).then((e=>{u=e,gn=!0,r.publish("backgroundImageReady")})):u="texture2d"===n._reglType?n:null:u=null),void 0!==e.cameraTarget&&(o=e.cameraTarget)&&_t.lookAt(o,_t.distance[0],_t.rotation),void 0!==e.cameraDistance&&(i=e.cameraDistance)>0&&_t.lookAt(_t.target,i,_t.rotation),void 0!==e.cameraRotation&&null!==(a=e.cameraRotation)&&_t.lookAt(_t.target,_t.distance[0],a),void 0!==e.cameraView&&Ai(e.cameraView),void 0!==e.colorBy&&(l=e.colorBy,m=ht(l,he)),void 0!==e.pointColor&&wo(e.pointColor),void 0!==e.pointColorActive&&xo(e.pointColorActive),void 0!==e.pointColorHover&&bo(e.pointColorHover),void 0!==e.pointSize&&(s=e.pointSize,$e(s,We,{minLength:1})&&(St=[...s]),Fe(+s)&&(St=[+s]),bn=1/St[0],Rn=ho(),Eo()),void 0!==e.pointSizeSelected&&(!+(h=e.pointSizeSelected)||+h<0||(Et=+h)),void 0!==e.pointSizeMouseDetection&&(f=e.pointSizeMouseDetection,It=f,Eo()),void 0!==e.sizeBy&&(e=>{Tt=ht(e,ie)})(e.sizeBy),void 0!==e.opacity&&(C=e.opacity,$e(C,We,{minLength:1})&&(Mt=[...C]),Fe(+C)&&(Mt=[+C]),Rn=ho()),void 0!==e.showPointConnections&&(S=e.showPointConnections,it=!!S,it?Qn(Vt.points[0])&&wi(Vt.points).then((()=>{r.publish("pointConnectionsDraw"),gn=!0})):wi()),void 0!==e.pointConnectionColor&&Ri(e.pointConnectionColor),void 0!==e.pointConnectionColorActive&&Pi(e.pointConnectionColorActive),void 0!==e.pointConnectionColorHover&&Ti(e.pointConnectionColorHover),void 0!==e.pointConnectionColorBy&&(e=>{st=ht(e,we,{allowSegment:!0})})(e.pointConnectionColorBy),void 0!==e.pointConnectionOpacityBy&&(e=>{vt=ht(e,ce,{allowSegment:!0})})(e.pointConnectionOpacityBy),void 0!==e.pointConnectionOpacity&&(e=>{$e(e,We,{minLength:1})&&(pt=[...e]),Fe(+e)&&(pt=[+e]),rt=rt.map((e=>(e[3]=Number.isNaN(+pt[0])?e[3]:+pt[0],e))),Ei()})(e.pointConnectionOpacity),void 0!==e.pointConnectionOpacityActive&&(e=>{!Number.isNaN(+e)&&+e&&(yt=+e)})(e.pointConnectionOpacityActive),void 0!==e.pointConnectionSize&&(E=e.pointConnectionSize,$e(E,We,{minLength:1})&&(ft=[...E]),Fe(+E)&&(ft=[+E]),Ei()),void 0!==e.pointConnectionSizeActive&&(I=e.pointConnectionSizeActive,!Number.isNaN(+I)&&+I&&(wt=Math.max(0,I))),void 0!==e.pointConnectionSizeBy&&(e=>{xt=ht(e,le,{allowSegment:!0})})(e.pointConnectionSizeBy),void 0!==e.pointConnectionMaxIntPointsPerSegment&&(A=e.pointConnectionMaxIntPointsPerSegment,bt=Math.max(0,A)),void 0!==e.pointConnectionTolerance&&(M=e.pointConnectionTolerance,Ct=Math.max(0,M)),void 0!==e.opacityBy&&(e=>{Rt=ht(e,ue,{allowDensity:!0})})(e.opacityBy),void 0!==e.lassoColor&&(R=e.lassoColor)&&(y=Je(R,!0),Nt.setStyle({color:y})),void 0!==e.lassoLineWidth&&(P=e.lassoLineWidth,Number.isNaN(+P)||+P<1||(w=+P,Nt.setStyle({width:w}))),void 0!==e.lassoMinDelay&&+(T=e.lassoMinDelay)&&(x=+T,ro.set({minDelay:x})),void 0!==e.lassoMinDist&&+(z=e.lassoMinDist)&&(b=+z,ro.set({minDist:b})),void 0!==e.lassoClearEvent&&(B=e.lassoClearEvent,k=Ze(Z,k)(B)),void 0!==e.lassoInitiator&&(D=e.lassoInitiator,_=Boolean(D),ro.set({enableInitiator:_})),void 0!==e.lassoInitiatorParentElement&&(L=e.lassoInitiatorParentElement,ee=L,ro.set({startInitiatorParentElement:ee})),void 0!==e.keyMap&&($=e.keyMap,Ne=Object.entries($).reduce(((e,[t,n])=>(Y.includes(t)&&X.includes(n)&&(e[t]=n),e)),{}),mn=Qe(Ne),mn.rotate?_t.config({isRotate:!0,mouseDownMoveModKey:mn.rotate}):_t.config({isRotate:!1})),void 0!==e.mouseMode&&(W=e.mouseMode,Ve=Ze(N,"panZoom")(W),_t.config({defaultMouseDownMoveAction:"rotate"===Ve?"rotate":"pan"})),void 0!==e.showReticle&&null!==(F=e.showReticle)&&(qe=F),void 0!==e.reticleColor&&(j=e.reticleColor)&&(He=Je(j,!0),Jt.setStyle({color:He}),Qt.setStyle({color:He})),void 0!==e.pointOutlineWidth&&(!+(V=e.pointOutlineWidth)||+V<0||(At=+V)),void 0!==e.height&&(e=>{if(e===O)return zt=e,p.style.height="100%",void window.requestAnimationFrame((()=>{p&&So(p.getBoundingClientRect().height)}));!+e||+e<=0||(zt=+e,So(zt),p.style.height=`${zt}px`)})(e.height),void 0!==e.width&&(e=>{if(e===O)return Bt=e,p.style.width="100%",void window.requestAnimationFrame((()=>{p&&Io(p.getBoundingClientRect().width)}));!+e||+e<=0||(Bt=+e,Io(Bt),p.style.width=`${Dt}px`)})(e.width),void 0!==e.aspectRatio&&(+(q=e.aspectRatio)<=0||(pn=q)),void 0!==e.xScale&&(G=e.xScale)&&(Zn=G,Vn=G.domain()[0],qn=G?G.domain()[1]-G.domain()[0]:0),void 0!==e.yScale&&(H=e.yScale)&&(jn=H,Gn=jn.domain()[0],Hn=jn?jn.domain()[1]-jn.domain()[0]:0),void 0!==e.deselectOnDblClick&&(K=e.deselectOnDblClick,g=!!K),void 0!==e.deselectOnEscape&&(U=e.deselectOnEscape,v=!!U),void 0!==e.opacityByDensityFill&&(J=e.opacityByDensityFill,Pt=+J),void 0!==e.gamma&&(Q=e.gamma,c.gamma=Q),new Promise((e=>window.requestAnimationFrame((()=>{p&&(yo(),_t.refresh(),c.refresh(),gn=!0,e())}))))},Bi=(e,{showReticleOnce:t=!1,preventEvent:n=!1}={})=>{let o=!1;if(e>=0&&e<sn){o=!0;const t=Pn,i=e!==Pn;+t>=0&&i&&!Zt.has(t)&&eo([t],0),Pn=e,En.subdata(to(e)),Zt.has(e)||eo([e],2),i&&!n&&r.publish("pointover",Pn)}else o=+Pn>=0,o&&(Zt.has(Pn)||eo([Pn],0),n||r.publish("pointout",Pn)),Pn=void 0;o&&(gn=!0,vn=t)},Di=()=>{_t||(_t=z(p,{isPanInverted:[!1,!0]})),e.cameraView?_t.setView(B(e.cameraView)):e.cameraTarget||e.cameraDistance||e.cameraRotation?_t.lookAt([...e.cameraTarget||Se],e.cameraDistance||1,e.cameraRotation||0):_t.setView(B(Ee)),nn=Yn(1,1),on=Yn(-1,-1)},Oi=({key:e})=>{switch(e){case"Escape":v&&no()}},Li=()=>{Fn=!0},ki=()=>{Bi(),Fn=!1,gn=!0},_i=()=>{gn=!0},Ni=()=>{_t.refresh();const e=Bt===O,t=zt===O;if(e||t){const{width:n,height:o}=p.getBoundingClientRect();e&&Io(n),t&&So(o),yo(),gn=!0}},$i=c.onFrame((()=>{_n=_t.tick(),Nn&&(gn||Bn)&&(Bn&&!((e,t)=>{Dn||(Dn=performance.now());const n=performance.now()-Dn;return ii({t:Math.min(1,Math.max(0,t(n/e)))}),n<e})(In,An)&&Ci(),_n&&(nn=Yn(1,1),on=Yn(-1,-1),"density"===Rt&&bi()),c.render(((e,t)=>{((e,t)=>{Ht[0]=e/qt,Ht[5]=t})(e,t),u&&u._reglType&&ui(),un.length>2&&pi(),Bn||Xt.draw({projection:Fo(),model:jo(),view:Zo()}),ai(),Wt||!qe&&!vn||(()=>{if(!(Pn>=0))return;const[e,t]=Vt.points[Pn].slice(0,2),n=[e,t,0,1];A(a,Ht,A(a,_t.view,Kt)),M(n,n,a),Jt.setPoints([-1,n[1],1,n[1]]),Qt.setPoints([n[0],1,n[0],-1]),Jt.draw(),Qt.draw(),ri((()=>(Et+2*At)*window.devicePixelRatio),(()=>1),En,1)(),ri((()=>(Et+At)*window.devicePixelRatio),(()=>1),En,3)()})(),Pn>=0&&li(),Ft.length&&(si(),ci(),di()),Nt.draw({projection:Fo(),model:jo(),view:Zo()})}),p),_n&&(Co(),hn?hn=!1:r.publish("view",{view:_t.view,camera:_t,xScale:Zn,yScale:jn})),gn=!1,vn=!1,r.publish("draw"))}));return(()=>{yo(),Di(),Co(),Nt=D(c.regl,{color:y,width:w,is2d:!0}),Xt=D(c.regl,{color:rt,colorHover:lt,colorActive:at,opacity:null===pt?null:pt[0],width:ft[0],widthActive:wt,is2d:!0}),Jt=D(c.regl,{color:He,width:1,is2d:!0}),Qt=D(c.regl,{color:He,width:1,is2d:!0}),Eo(),p.addEventListener("wheel",_i),Cn=c.regl.buffer(),Sn=c.regl.buffer(),En=c.regl.buffer({usage:"dynamic",type:"float",length:2*L}),Mn=vo(),Rn=ho();const e=zi({backgroundImage:u,width:Bt,height:zt,keyMap:Ne});Ii(),window.addEventListener("keyup",Oi,!1),window.addEventListener("blur",mo,!1),window.addEventListener("mouseup",so,!1),window.addEventListener("mousemove",po,!1),p.addEventListener("mousedown",lo,!1),p.addEventListener("mouseenter",Li,!1),p.addEventListener("mouseleave",ki,!1),p.addEventListener("click",co,!1),p.addEventListener("dblclick",uo,!1),"ResizeObserver"in window?(rn=new ResizeObserver(Ni),rn.observe(p)):(window.addEventListener("resize",Ni),window.addEventListener("orientationchange",Ni)),e.then((()=>{r.publish("init")}))})(),{clear:Si((()=>{gi([]),Xt.clear()})),createTextureFromUrl:e=>je(c.regl,e),deselect:no,destroy:()=>{$i(),window.removeEventListener("keyup",Oi,!1),window.removeEventListener("blur",mo,!1),window.removeEventListener("mouseup",so,!1),window.removeEventListener("mousemove",po,!1),p.removeEventListener("mousedown",lo,!1),p.removeEventListener("mouseenter",Li,!1),p.removeEventListener("mouseleave",ki,!1),p.removeEventListener("click",co,!1),p.removeEventListener("dblclick",uo,!1),rn?rn.observe(p):(window.removeEventListener("resize",Ni),window.removeEventListener("orientationchange",Ni)),p=void 0,_t.dispose(),_t=void 0,Nt.destroy(),Xt.destroy(),Jt.destroy(),Qt.destroy(),r.publish("destroy"),r.clear(),e.renderer||c.destroy()},draw:(e,t={})=>{return(n=e,new Promise(((e,t)=>{if(!n||Array.isArray(n))e(n);else{const o=Array.isArray(n.x)||ArrayBuffer.isView(n.x)?n.x.length:0,i=(Array.isArray(n.x)||ArrayBuffer.isView(n.x))&&(e=>n.x[e]),r=(Array.isArray(n.y)||ArrayBuffer.isView(n.y))&&(e=>n.y[e]),a=(Array.isArray(n.line)||ArrayBuffer.isView(n.line))&&(e=>n.line[e]),l=(Array.isArray(n.lineOrder)||ArrayBuffer.isView(n.lineOrder))&&(e=>n.lineOrder[e]),s=Object.keys(n),c=(()=>{const e=s.find((e=>Le.has(e)));return e&&(Array.isArray(n[e])||ArrayBuffer.isView(n[e]))&&(t=>n[e][t])})(),d=(()=>{const e=s.find((e=>ke.has(e)));return e&&(Array.isArray(n[e])||ArrayBuffer.isView(n[e]))&&(t=>n[e][t])})();i&&r&&c&&d&&a&&l?e(n.x.map(((e,t)=>[e,r(t),c(t),d(t),a(t),l(t)]))):i&&r&&c&&d&&a?e(Array.from({length:o},((e,t)=>[i(t),r(t),c(t),d(t),a(t)]))):i&&r&&c&&d?e(Array.from({length:o},((e,t)=>[i(t),r(t),c(t),d(t)]))):i&&r&&c?e(Array.from({length:o},((e,t)=>[i(t),r(t),c(t)]))):i&&r?e(Array.from({length:o},((e,t)=>[i(t),r(t)]))):t(new Error("You need to specify at least x and y"))}}))).then((e=>new Promise((n=>{let o=!1;e&&(t.transition&&(e.length===sn?o=(e=>{if(!yn)return!1;if(Bn){const e=fn;fn=wn,e.destroy()}else fn=yn;return wn=hi(e),xn=c.regl.framebuffer({color:wn,depth:!1,stencil:!1}),yn=void 0,!0})(e):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),gi(e),(it||t.showPointConnectionsOnce&&Qn(e[0]))&&wi(e).then((()=>{r.publish("pointConnectionsDraw"),gn=!0,vn=t.showReticleOnce}))),t.transition&&o?(r.subscribe("transitionEnd",(()=>{gn=!0,vn=t.showReticleOnce,n()}),1),(({duration:e=500,easing:t=F})=>{Bn&&r.publish("transitionEnd"),Bn=!0,Dn=null,In=e,An=Ge(t)?W[t]||F:t,On=qe,qe=!1,r.publish("transitionStart")})({duration:t.transitionDuration,easing:t.transitionEasing})):(r.subscribe("draw",n,1),gn=!0,vn=t.showReticleOnce)}))));var n},get:e=>(mt({property:!0}),"aspectRatio"===e?pn:"background"===e||"backgroundColor"===e?d:"backgroundImage"===e?u:"camera"===e?_t:"cameraTarget"===e?_t.target:"cameraDistance"===e?_t.distance[0]:"cameraRotation"===e?_t.rotation:"cameraView"===e?_t.view:"canvas"===e?p:"colorBy"===e?m:"sizeBy"===e?Tt:"deselectOnDblClick"===e?g:"deselectOnEscape"===e?v:"height"===e?zt:"lassoColor"===e?y:"lassoLineWidth"===e?w:"lassoMinDelay"===e?x:"lassoMinDist"===e?b:"lassoClearEvent"===e?k:"lassoInitiator"===e?_:"lassoInitiatorElement"===e?ro.initiator:"lassoInitiatorParentElement"===e?ee:"keyMap"===e?((e,r)=>{for(var a in r||(r={}))n.call(r,a)&&i(e,a,r[a]);if(t)for(var a of t(r))o.call(r,a)&&i(e,a,r[a]);return e})({},Ne):"mouseMode"===e?Ve:"opacity"===e?1===Mt.length?Mt[0]:Mt:"opacityBy"===e?Rt:"opacityByDensityFill"===e?Pt:"opacityByDensityDebounceTime"===e?kt:"points"===e?Vt.points:"pointsInView"===e?xi():"pointColor"===e?1===Ke.length?Ke[0]:Ke:"pointColorActive"===e?1===nt.length?nt[0]:nt:"pointColorHover"===e?1===ot.length?ot[0]:ot:"pointOutlineWidth"===e?At:"pointSize"===e?1===St.length?St[0]:St:"pointSizeSelected"===e?Et:"pointSizeMouseDetection"===e?It:"showPointConnections"===e?it:"pointConnectionColor"===e?1===rt.length?rt[0]:rt:"pointConnectionColorActive"===e?1===at.length?at[0]:at:"pointConnectionColorHover"===e?1===lt.length?lt[0]:lt:"pointConnectionColorBy"===e?st:"pointConnectionOpacity"===e?1===pt.length?pt[0]:pt:"pointConnectionOpacityBy"===e?vt:"pointConnectionOpacityActive"===e?yt:"pointConnectionSize"===e?1===ft.length?ft[0]:ft:"pointConnectionSizeActive"===e?wt:"pointConnectionSizeBy"===e?xt:"pointConnectionMaxIntPointsPerSegment"===e?bt:"pointConnectionTolerance"===e?Ct:"reticleColor"===e?He:"regl"===e?c.regl:"showReticle"===e?qe:"version"===e?"1.2.1":"width"===e?Bt:"xScale"===e?Zn:"yScale"===e?jn:"performanceMode"===e?Lt:"gamma"===e?c.gamma:"renderer"===e?c:void 0),hover:Bi,redraw:()=>{gn=!0},refresh:c.refresh,reset:Si((({preventEvent:e=!1}={})=>{Di(),Co(),e||r.publish("view",{view:_t.view,camera:_t,xScale:Zn,yScale:jn})})),select:oo,set:zi,export:()=>p.getContext("2d").getImageData(0,0,p.width,p.height),subscribe:r.subscribe,unsubscribe:r.unsubscribe,view:(e,{preventEvent:t=!1}={})=>{Ai(e),gn=!0,hn=t}}};export{tt as a,vt as c};
