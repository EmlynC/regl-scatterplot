var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o;import{p as a,i as r,w as l,a as s,b as c,t as d,c as u,n as p,l as m,d as h,e as g,f as v,g as y,h as f,q as w,j as x,k as b,m as C,o as S,u as E,r as I,s as M,v as R,x as T,K as z,y as P,z as A,A as D,B}from"./vendor.943e55ed.js";const O=(e,t=null)=>null===e?t:e,L=document.createElement("style");document.head.appendChild(L);const k=L.sheet,_=e=>{const t=k.rules.length;return k.insertRule(e,t),t},$=e=>{k.deleteRule(e)};let W=null;let N=null;const F=(e,{onDraw:t=r,onStart:n=r,onEnd:o=r,enableInitiator:i=true,initiatorParentElement:h=document.body,minDelay:g=8,minDist:v=2,pointNorm:y=r}={})=>{let f=i,w=h,x=t,b=n,C=o,S=y;const E=document.createElement("div"),I=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);E.id=`lasso-initiator-${I}`,E.style.position="fixed",E.style.display="flex",E.style.justifyContent="center",E.style.alignItems="center",E.style.zIndex=99,E.style.width="4rem",E.style.height="4rem",E.style.borderRadius="4rem",E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)";let M,R=!1,T=!1,z=[],P=[];const A=()=>{R=!1};window.addEventListener("mouseup",A);const D=()=>{E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)"},B=()=>{const e=getComputedStyle(E),t=+e.opacity,n=e.transform.match(/([0-9.-]+)+/g),o=+n[0],i=+n[1];return{opacity:t,scale:Math.sqrt(o*o+i*i),rotate:Math.atan2(i,o)*(180/Math.PI)}},L=e=>{f&&u(0).then((()=>{const t=e.clientX,n=e.clientY;if(R)return;let o=.5,i=0,a=0;const r=B();o=r.opacity,i=r.scale,a=r.rotate,E.style.opacity=o,E.style.transform=`translate(-50%,-50%) scale(${i}) rotate(${a}deg)`,E.style.animation="none",p(2).then((()=>{E.style.top=`${n}px`,E.style.left=`${t}px`,null!==W&&$(W),W=_(((e,t,n)=>`\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1) rotate(${n+20}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9) rotate(${n+60}deg);\n  }\n}\n`)(o,i,a)),E.style.animation="2500ms ease scaleInFadeOut 0s 1 normal backwards",p().then((()=>{D()}))}))}))},k=()=>{const{opacity:e,scale:t,rotate:n}=B();E.style.opacity=e,E.style.transform=`translate(-50%,-50%) scale(${t}) rotate(${n}deg)`,E.style.animation="none",p(2).then((()=>{null!==N&&$(N),N=_(((e,t,n)=>`\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0) rotate(${n}deg);\n  }\n}\n`)(e,t,n)),E.style.animation="250ms ease fadeScaleOut 0s 1 normal backwards",p().then((()=>{D()}))}))},Z=()=>{x(z,P)},j=e=>{if(M){if(m(e[0],e[1],M[0],M[1])>2){M=e;const t=S(e);z.push(t),P.push(t[0],t[1]),z.length>1&&Z()}}else{T||(T=!0,b()),M=e;const t=S(e);z=[t],P=[t[0],t[1]]}},V=d(j,8,8),q=(t,n)=>{const o=(t=>{const{left:n,top:o}=e.getBoundingClientRect();return[t.clientX-n,t.clientY-o]})(t);return n?V(o):j(o)},G=()=>{z=[],P=[],M=void 0,Z()},H=e=>{L(e)},K=()=>{R=!0,T=!0,G(),b()},X=()=>{k()},Y=({merge:e=!1}={})=>{T=!1;const t=[...z],n=[...P];return V.cancel(),G(),t.length&&C(t,n,{merge:e}),t},U=({onDraw:e=null,onStart:t=null,onEnd:n=null,enableInitiator:o=null,initiatorParentElement:i=null,minDelay:a=null,minDist:r=null,pointNorm:l=null}={})=>{x=O(e,x),b=O(t,b),C=O(n,C),f=O(o,f),S=O(l,S),null!==i&&i!==w&&(w.removeChild(E),i.appendChild(E),w=i),f?(E.addEventListener("click",H),E.addEventListener("mousedown",K),E.addEventListener("mouseleave",X)):(E.removeEventListener("mousedown",K),E.removeEventListener("mouseleave",X))},J=()=>{w.removeChild(E),window.removeEventListener("mouseup",A),E.removeEventListener("click",H),E.removeEventListener("mousedown",K),E.removeEventListener("mouseleave",X)};return w.appendChild(E),U({onDraw:x,onStart:b,onEnd:C,enableInitiator:f,initiatorParentElement:w}),a(c("initiator",E),(e=>s(e,{clear:G,destroy:J,end:Y,extend:q,set:U,showInitiator:L,hideInitiator:k})),l(F))({})},Z=function(){const e=(e,t,n,o,i)=>{const a=.5*(o-t),r=.5*(i-n);return(2*n-2*o+a+r)*e*e*e+(-3*n+3*o-2*a-r)*e*e+a*e+n},t=(t,n,o)=>{const i=o*t,a=Math.floor(i),r=i-a,l=n[Math.max(0,a-1)],s=n[a],c=n[Math.min(o,a+1)],d=n[Math.min(o,a+2)];return[e(r,l[0],s[0],c[0],d[0]),e(r,l[1],s[1],c[1],d[1])]},n=(e,t,n)=>{let o=t[0],i=t[1],a=n[0]-o,r=n[1]-i;if(0!==a||0!==r){const t=((e[0]-o)*a+(e[1]-i)*r)/(a*a+r*r);t>1?(o=n[0],i=n[1]):t>0&&(o+=a*t,i+=r*t)}return a=e[0]-o,r=e[1]-i,a*a+r*r},o=(e,t,i,a,r)=>{let l,s=a;for(let o=t+1;o<i;o++){const a=n(e[o],e[t],e[i]);a>s&&(l=o,s=a)}s>a&&(l-t>1&&o(e,t,l,a,r),r.push(e[l]),i-l>1&&o(e,l,i,a,r))},i=(e,t)=>{const n=e.length-1,i=[e[0]];return o(e,0,n,t,i),i.push(e[n]),i};self.onmessage=function(e){(e.data.points?+e.data.points.length:0)||self.postMessage({error:new Error("No points provided")}),e.data.points;const n=(e=>{const t={},n=!Number.isNaN(+e[0][5]);return e.forEach((e=>{const o=e[4];t[o]||(t[o]=[]),n?t[o][e[5]]=e:t[o].push(e)})),Object.entries(t).forEach((e=>{t[e[0]]=e[1].filter((e=>e)),t[e[0]].reference=e[1][0]})),t})(e.data.points);self.postMessage({points:Object.entries(n).reduce(((n,o)=>(n[o[0]]=((e,{maxIntPointsPerSegment:n=100,tolerance:o=.002}={})=>{const a=e.length,r=a-1,l=r*n+1,s=o**2;let c,d=[];for(let m=0;m<a-1;m++){let o=[e[m].slice(0,2)];c=e[m];for(let i=1;i<n;i++){const a=t((m*n+i)/l,e,r);u=c[0],p=c[1],(u-a[0])**2+(p-a[1])**2>s&&(o.push(a),c=a)}o.push(e[m+1]),o=i(o,s),d=d.concat(o.slice(0,o.length-1))}var u,p;
/**
   * Douglas Peucker square segment distance
   * Implementation from https://github.com/mourner/simplify-js
   * @author Vladimir Agafonkin
   * @copyright Vladimir Agafonkin 2013
   * @license BSD
   * @param {array} p - Point
   * @param {array} p1 - First boundary point
   * @param {array} p2 - Second boundary point
   * @return {number} Distance
   */return d.push(e[e.length-1].slice(0,2)),d.flat()})(o[1],e.data.options),n[o[0]].reference=o[1].reference,n)),{})})}},j=Float32Array.BYTES_PER_ELEMENT,V=["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"],q=["panZoom","lasso","rotate"],G="panZoom",H={cubicIn:v,cubicInOut:g,cubicOut:y,linear:f,quadIn:w,quadInOut:x,quadOut:b},K=g,X=["deselect","lassoEnd"],Y=[0,.666666667,1,1],U=2,J=!1,Q=10,ee=3,te="lassoEnd",ne=["lasso","rotate","merge"],oe=["alt","cmd","ctrl","meta","shift"],ie={alt:"rotate",shift:"lasso",cmd:"merge"},ae="auto",re="auto",le=1,se=6,ce=2,de=2,ue=null,pe=2,me=2,he=null,ge=null,ve=null,ye=.66,fe=1,we=null,xe=.15,be=25,Ce=null,Se=[.66,.66,.66,1],Ee=[0,.55,1,1],Ie=[1,1,1,1],Me=[0,0,0,1],Re=null,Te=[.66,.66,.66,.2],ze=[0,.55,1,1],Pe=[1,1,1,1],Ae=[0,0],De=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Be=null,Oe=!1,Le=[1,1,1,.5],ke=!0,_e=!0,$e=!1,We=100,Ne=.002,Fe="auto",Ze=!1,je=new Set(["z","valueZ","valueA","value1","category"]),Ve=new Set(["w","valueW","valueB","value2","value"]),qe=(e,t,n,o)=>Math.sqrt((e-n)**2+(t-o)**2),Ge=(e,t=!1)=>e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,o)=>`#${t}${t}${n}${n}${o}${o}`)).substring(1).match(/.{2}/g).map((e=>parseInt(e,16)/255**t)),He=(e,t,{minLength:n=0}={})=>Array.isArray(e)&&e.length>=n&&e.every(t),Ke=e=>!Number.isNaN(+e)&&+e>=0,Xe=e=>!Number.isNaN(+e)&&+e>0,Ye=(e,t)=>n=>e.indexOf(n)>=0?n:t,Ue=(e,t)=>new Promise(((n,o)=>{((e,t=!1)=>new Promise(((n,o)=>{const i=new Image;t&&(i.crossOrigin="anonymous"),i.src=e,i.onload=()=>{n(i)},i.onerror=e=>{o(e)}})))(t,0!==t.indexOf(window.location.origin)&&-1===t.indexOf("base64")).then((t=>{n(e.texture(t))})).catch((e=>{o(e)}))})),Je=e=>e>=0&&e<=1,Qe=e=>Array.isArray(e)&&e.every(Je),et=e=>"string"==typeof e||e instanceof String,tt=e=>Number.isInteger(e)&&e>=0&&e<=255,nt=e=>Array.isArray(e)&&e.every(tt),ot=e=>Array.isArray(e)&&e.length&&(Array.isArray(e[0])||et(e[0])),it=(e,t)=>e>t?e:t,at=(e,t)=>e<t?e:t,rt=(e,t)=>{if(4===(n=e).length&&(Qe(n)||nt(n))){const n=Qe(e);return t&&n||!t&&!n?e:t&&!n?e.map((e=>e/255)):e.map((e=>255*e))}var n,o;if(3===(o=e).length&&(Qe(o)||nt(o))){const n=255**!t,o=Qe(e);return t&&o||!t&&!o?[...e,n]:t&&!o?[...e.map((e=>e/255)),n]:[...e.map((e=>255*e)),n]}return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?((e,t=!1)=>[...Ge(e,t),255**!t])(e,t):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),t?[1,1,1,1]:[255,255,255,255])},lt=e=>Object.entries(e).reduce(((e,[t,n])=>(e[n]?e[n]=[...e[n],t]:e[n]=t,e)),{}),st=e=>.21*e[0]+.72*e[1]+.07*e[2],ct={showRecticle:"showReticle",recticleColor:"reticleColor"},dt=e=>{Object.keys(e).filter((e=>ct[e])).forEach((t=>{console.warn(`regl-scatterplot: the "${t}" property is deprecated. Please use "${ct[t]}" instead.`),e[ct[t]]=e[t],delete e[t]}))},ut=(e,t,{allowSegment:n=!1,allowDensity:o=!1}={})=>je.has(e)?"valueZ":Ve.has(e)?"valueW":"segment"===e?n?"segment":t:"density"===e&&o?"density":t,pt=e=>{switch(e){case"valueZ":return 2;case"valueW":return 3;default:return null}},mt=(e={})=>{const a=S({async:!e.syncEvents,caseInsensitive:!0}),l=new Float32Array(16),s=new Float32Array(16),c=[0,0];dt(e);let{regl:u,backgroundColor:p=Me,backgroundImage:m=Be,canvas:g=document.createElement("canvas"),colorBy:v=Ce,deselectOnDblClick:y=ke,deselectOnEscape:f=_e,lassoColor:w=Y,lassoLineWidth:x=U,lassoMinDelay:b=Q,lassoMinDist:O=ee,lassoClearEvent:L=te,lassoInitiator:k=J,lassoInitiatorParentElement:_=document.body,keyMap:$=ie,mouseMode:W=G,showReticle:N=Oe,reticleColor:Ge=Le,pointColor:Je=Se,pointColorActive:Qe=Ee,pointColorHover:tt=Ie,showPointConnections:nt=$e,pointConnectionColor:ct=Te,pointConnectionColorActive:mt=ze,pointConnectionColorHover:ht=Pe,pointConnectionColorBy:gt=Re,pointConnectionOpacity:vt=ge,pointConnectionOpacityBy:yt=ve,pointConnectionOpacityActive:ft=ye,pointConnectionSize:wt=pe,pointConnectionSizeActive:xt=me,pointConnectionSizeBy:bt=he,pointConnectionMaxIntPointsPerSegment:Ct=We,pointConnectionTolerance:St=Ne,pointSize:Et=se,pointSizeSelected:It=ce,pointSizeMouseDetection:Mt=Fe,pointOutlineWidth:Rt=de,opacity:Tt=fe,opacityBy:zt=we,opacityByDensityFill:Pt=xe,sizeBy:At=ue,height:Dt=re,width:Bt=ae,gamma:Ot=le}=e,Lt="auto"===Bt?1:Bt,kt="auto"===Dt?1:Dt;const{performanceMode:_t=Ze,opacityByDensityDebounceTime:$t=be}=e;(e=>{!!e&&V.reduce(((t,n)=>e.hasExtension(n)?t:(console.warn(`WebGL: ${n} extension not supported. Scatterplot might not render properly`),!1)),!0)})(u),u||(u=(e=>{const t=e.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}),n=[];return V.forEach((e=>{t.getExtension(e)?n.push(e):console.warn(`WebGL: ${e} extension not supported. Scatterplot might not render properly`)})),C({gl:t,extensions:n})})(g)),p=rt(p,!0),w=rt(w,!0),Ge=rt(Ge,!0);const Wt=[512,512],Nt=u.framebuffer({width:Wt[0],height:Wt[1],colorFormat:"rgba",colorType:"float"});let Ft,Zt,jt=st(p),Vt=!1,qt=[];const Gt=new Set,Ht=new Set;let Kt,Xt,Yt,Ut,Jt,Qt,en,tn,nn,on,an,rn,ln,sn=null,cn=[0,0],dn=0,un=0,pn=!1,mn=[],hn=1,gn=lt($),vn=!0,yn=!1;Je=ot(Je)?[...Je]:[Je],Qe=ot(Qe)?[...Qe]:[Qe],tt=ot(tt)?[...tt]:[tt],Je=Je.map((e=>rt(e,!0))),Qe=Qe.map((e=>rt(e,!0))),tt=tt.map((e=>rt(e,!0))),Tt=!Array.isArray(Tt)&&Number.isNaN(+Tt)?Je[0][3]:Tt,Tt=He(Tt,Ke,{minLength:1})?[...Tt]:[Tt],Et=He(Et,Ke,{minLength:1})?[...Et]:[Et];let fn,wn,xn,bn,Cn=1/Et[0];"inherit"===ct?ct=[...Je]:(ct=ot(ct)?[...ct]:[ct],ct=ct.map((e=>rt(e,!0)))),"inherit"===mt?mt=[...Qe]:(mt=ot(mt)?[...mt]:[mt],mt=mt.map((e=>rt(e,!0)))),"inherit"===ht?ht=[...tt]:(ht=ot(ht)?[...ht]:[ht],ht=ht.map((e=>rt(e,!0)))),vt="inherit"===vt?[...Tt]:He(vt,Ke,{minLength:1})?[...vt]:[vt],wt="inherit"===wt?[...Et]:He(wt,Ke,{minLength:1})?[...wt]:[wt],v=ut(v,Ce),zt=ut(zt,we,{allowDensity:!0}),At=ut(At,ue),gt=ut(gt,Re,{allowSegment:!0}),yt=ut(yt,ve,{allowSegment:!0}),bt=ut(bt,he,{allowSegment:!0});let Sn,En,In,Mn,Rn,Tn,zn,Pn,An=0,Dn=0,Bn=!1,On=null,Ln=N,kn=0,_n=0,$n=!1,Wn=!1,Nn=0,Fn=0,Zn=!1,jn=e.xScale||null,Vn=e.yScale||null,qn=0,Gn=0,Hn=0,Kn=0;jn&&(qn=jn.domain()[0],Gn=jn.domain()[1]-jn.domain()[0],jn.range([0,Lt])),Vn&&(Hn=Vn.domain()[0],Kn=Vn.domain()[1]-Vn.domain()[0],Vn.range([kt,0]));const Xn=e=>e/Lt*2-1,Yn=e=>1+e/kt*-2,Un=(e,t)=>{const n=[e,t,1,1],o=I(l,M(l,Yt,M(l,Ft.view,Ut)));return R(n,n,o),n.slice(0,2)},Jn=()=>{const[e,t]=[Xn(c[0]),Yn(c[1])],[n,o]=Un(e,t),i=qo(),a=rn[1]-ln[1],r=on*i*(a/kt)*.66,l=Kt.range(n-r,o-r,n+r,o+r);let s,d=r;return l.forEach((e=>{const[t,i]=Kt.points[e],a=qe(t,i,n,o);a<d&&(d=a,s=e)})),d<on/Lt*2?s:-1},Qn=()=>{mn=[],Zt&&Zt.clear()},eo=e=>e&&e.length>4,to=(e,t)=>{if(en||!nt||!eo(Kt.points[e[0]]))return;const n=0===t,o=1===t?e=>Ht.add(e):r,i=Object.keys(e.reduce(((e,t)=>{const n=Kt.points[t];return e[Array.isArray(n[4])?n[4][0]:n[4]]=!0,e}),{})),a=Jt.getData().opacities;i.filter((e=>!Ht.has(+e))).forEach((e=>{const t=Qt[e][0],i=Qt[e][2],r=4*t+2*Qt[e][3],l=r+2*i+4;void 0===a.__original__&&(a.__original__=a.slice());for(let o=r;o<l;o++)a[o]=n?a.__original__[o]:ft;o(e)})),Jt.getBuffer().opacities.subdata(a,0)},no=e=>[e%An/An+Dn,Math.floor(e/An)/An+Dn],oo=({preventEvent:e=!1}={})=>{"deselect"===L&&Qn(),qt.length&&(e||a.publish("deselect"),Ht.clear(),to(qt,0),qt=[],Gt.clear(),vn=!0)},io=(e,{merge:t=!1,preventEvent:n=!1}={})=>{const o=Array.isArray(e)?e:[e];t?qt=E(qt,o):(qt&&qt.length&&to(qt,0),qt=o);const i=[];Gt.clear(),Ht.clear();for(let a=qt.length-1;a>=0;a--){const e=qt[a];if(e<0||e>=dn)qt.splice(a,1);else{Gt.add(e);const t=no(e);i.push(t[0]),i.push(t[1])}}En({usage:"dynamic",type:"float",data:i}),to(qt,1),n||a.publish("select",{points:qt}),vn=!0},ao=e=>{const t=g.getBoundingClientRect();return c[0]=e.clientX-t.left,c[1]=e.clientY-t.top,[...c]},ro=F(g,{onStart:()=>{Ft.config({isFixed:!0}),Vt=!0,pn=!0,Qn(),a.publish("lassoStart")},onDraw:(e,t)=>{mn=e,Zt.setPoints(t),a.publish("lassoExtend",{coordinates:e})},onEnd:(e,t,{merge:n=!1}={})=>{Ft.config({isFixed:!1}),mn=[...e];const o=(e=>{const t=(e=>{let t=1/0,n=-1/0,o=1/0,i=-1/0;for(let a=0;a<e.length;a+=2)t=e[a]<t?e[a]:t,n=e[a]>n?e[a]:n,o=e[a+1]<o?e[a+1]:o,i=e[a+1]>i?e[a+1]:i;return[t,o,n,i]})(e),n=Kt.range(...t),o=[];return n.forEach((t=>{(([e,t]=[],n)=>{let o,i,a,r,l=!1;for(let s=0,c=n.length-2;s<n.length;s+=2)o=n[s],i=n[s+1],a=n[c],r=n[c+1],i>t!=r>t&&e<(a-o)*(t-i)/(r-i)+o&&(l=!l),c=s;return l})(Kt.points[t],e)&&o.push(t)})),o})(t);io(o,{merge:n}),a.publish("lassoEnd",{coordinates:mn}),"lassoEnd"===L&&Qn()},enableInitiator:k,initiatorParentElement:_,pointNorm:([e,t])=>Un(Xn(e),Yn(t))}),lo=(e,t)=>{switch(gn[t]){case"alt":return e.altKey;case"cmd":return e.metaKey;case"ctrl":return e.ctrlKey;case"meta":return e.metaKey;case"shift":return e.shiftKey;default:return!1}},so=e=>{Wn&&(Vt=!0,sn=performance.now(),cn=ao(e),pn="lasso"===W||lo(e,"lasso"))},co=e=>{Wn&&(Vt=!1,pn&&(e.preventDefault(),pn=!1,ro.end({merge:lo(e,"merge")})))},uo=e=>{if(!Wn)return;e.preventDefault();const t=ao(e);if(qe(...t,...cn)>=O)return;const n=performance.now()-sn;if(k&&n>500)ro.showInitiator(e);else{const t=Jn();t>=0?(qt.length&&"deselect"===L&&Qn(),io([t],{merge:lo(e,"merge")})):an||(an=setTimeout((()=>{an=null,ro.showInitiator(e)}),200))}},po=e=>{ro.hideInitiator(),an&&(clearTimeout(an),an=null),y&&(e.preventDefault(),oo())},mo=e=>{Wn&&(Zn||Vt)&&(ao(e),Zn&&!pn&&zi(Jn()),pn&&(e.preventDefault(),ro.extend(e,!0)),Vt&&(vn=!0))},ho=()=>{Wn&&(+Pn>=0&&!Gt.has(Pn)&&to([Pn],0),Pn=void 0,Zn=!1,co(),vn=!0)},go=()=>{const e=Math.max(Et.length,Tt.length);_n=Math.max(2,Math.ceil(Math.sqrt(e)));const t=new Float32Array(_n**2*4);for(let n=0;n<e;n++)t[4*n]=Et[n]||0,t[4*n+1]=Tt[n]||0;return u.texture({data:t,shape:[_n,_n,4],type:"float"})},vo=(e=Je,t=Qe,n=tt)=>{const o=e.length,i=t.length,a=n.length,r=[];if(o===i&&i===a)for(let l=0;l<o;l++)r.push(e[l],t[l],n[l],p);else for(let l=0;l<o;l++){const o=[e[l][0],e[l][1],e[l][2],1],i=v===Ce?t[0]:o,a=v===Ce?n[0]:o;r.push(e[l],i,a,p)}return r},yo=()=>{const e=vo(),t=e.length;kn=Math.max(2,Math.ceil(Math.sqrt(t)));const n=new Float32Array(kn**2*4);return e.forEach(((e,t)=>{n[4*t]=e[0],n[4*t+1]=e[1],n[4*t+2]=e[2],n[4*t+3]=e[3]})),u.texture({data:n,shape:[kn,kn,4],type:"float"})},fo=()=>{Xt=Lt/kt,Yt=T([],[1/Xt,1,1]),Ut=T([],[hn,1,1]),Wt[0]=Math.floor(Lt*window.devicePixelRatio),Wt[1]=Math.floor(kt*window.devicePixelRatio),Nt.resize(...Wt)},wo=(e,t)=>n=>{if(!n||!n.length)return;const o=[...e()];let i=ot(n)?n:[n];i=i.map((e=>rt(e,!0))),Tn&&Tn.destroy();try{t(i),Tn=yo()}catch(a){console.error("Invalid colors. Switching back to default colors."),t(o),Tn=yo()}},xo=wo((()=>Je),(e=>{Je=e})),bo=wo((()=>Qe),(e=>{Qe=e})),Co=wo((()=>tt),(e=>{tt=e})),So=()=>{if(!jn&&!Vn)return;const[e,t]=(()=>{const e=Un(-1,-1),t=Un(1,1),n=(e[0]+1)/2,o=(t[0]+1)/2,i=(e[1]+1)/2,a=(t[1]+1)/2;return[[qn+n*Gn,qn+o*Gn],[Hn+i*Kn,Hn+a*Kn]]})();jn&&jn.domain(e),Vn&&Vn.domain(t)},Eo=e=>{kt=e,g.height=Math.floor(kt*window.devicePixelRatio),Vn&&(Vn.range([kt,0]),So())},Io=()=>{on=Mt,"auto"===Mt&&(on=Array.isArray(Et)?Et[Math.floor(Et.length/2)]:Et)},Mo=e=>{Lt=e,g.width=Math.floor(Lt*window.devicePixelRatio),jn&&(jn.range([0,Lt]),So())},Ro=e=>{switch(e){case"valueZ":return Nn>1?"categorical":"continuous";case"valueW":return Fn>1?"categorical":"continuous";default:return null}},To=(e,t)=>{switch(e){default:case"categorical":return r;case"continuous":return e=>Math.round(e*(t.length-1))}},zo=()=>Tn,Po=()=>kn,Ao=()=>.5/kn,Do=()=>window.devicePixelRatio,Bo=()=>En,Oo=()=>zn,Lo=()=>_n,ko=()=>.5/_n,_o=()=>0,$o=()=>xn||fn,Wo=()=>An,No=()=>.5/An,Fo=()=>Yt,Zo=()=>Ft.view,jo=()=>Ut,Vo=()=>M(s,Yt,M(s,Ft.view,Ut)),qo=()=>Ft.scaling>1?Math.asinh(it(1,Ft.scaling))/Math.asinh(1)*window.devicePixelRatio:it(Cn,Ft.scaling)*window.devicePixelRatio,Go=()=>+("valueZ"===v),Ho=()=>+("valueW"===v),Ko=()=>+("valueZ"===zt),Xo=()=>+("valueW"===zt),Yo=()=>+("density"===zt),Uo=()=>+("valueZ"===At),Jo=()=>+("valueW"===At),Qo=()=>"valueZ"===v?Nn<=1?Je.length-1:1:Fn<=1?Je.length-1:1,ei=()=>"valueZ"===zt?Nn<=1?Tt.length-1:1:Fn<=1?Tt.length-1:1,ti=()=>"valueZ"===At?Nn<=1?Et.length-1:1:Fn<=1?Et.length-1:1,ni=e=>{if("density"!==zt)return 1;const t=qo(),n=Et[0]*t,o=2/(2/Ft.view[0])*(2/(2/Ft.view[5])),i=e.viewportHeight,a=e.viewportWidth;let r=Pt*a*i/(un*n*n)*at(1,o);r*=_t?1:1/(.25*Math.PI);const l=it(1,n)+.5;return r*=Math.pow(n/l,2),at(1,it(0,r))},oi=u({framebuffer:()=>bn,vert:"precision highp float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}",frag:"precision highp float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:()=>wn,endStateTex:()=>fn,t:(e,t)=>t.t},count:3}),ii=u({vert:"\n      precision highp float;\n      attribute vec2 xy;\n      void main () {\n        gl_Position = vec4(xy, 0, 1);\n      }",frag:"\n      precision highp float;\n      uniform vec2 srcRes;\n      uniform sampler2D src;\n      uniform float gamma;\n\n      vec3 approxLinearToSRGB (vec3 rgb, float gamma) {\n        return pow(clamp(rgb, vec3(0), vec3(1)), vec3(1.0 / gamma));\n      }\n\n      void main () {\n        vec4 color = texture2D(src, gl_FragCoord.xy / srcRes);\n        gl_FragColor = vec4(approxLinearToSRGB(color.rgb, gamma), color.a);\n      }",attributes:{xy:[-4,-4,4,-4,0,4]},uniforms:{src:()=>Nt,srcRes:()=>Wt,gamma:()=>Ot},count:3,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}}),ai=(e,t,n,o=0)=>u({frag:_t?"precision highp float;\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n":"\nprecision highp float;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nfloat linearstep(float edge0, float edge1, float x) {\n  return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\nvoid main() {\n  vec2 c = gl_PointCoord * 2.0 - 1.0;\n  float sdf = length(c) * finalPointSize;\n  float alpha = linearstep(finalPointSize + 0.5, finalPointSize - 0.5, sdf);\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",vert:'\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float stateTexEps;\nuniform float devicePixelRatio;\nuniform sampler2D encodingTex;\nuniform float encodingTexRes;\nuniform float encodingTexEps;\nuniform float pointSizeExtra;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByZ;\nuniform float isColoredByW;\nuniform float isOpacityByZ;\nuniform float isOpacityByW;\nuniform float isOpacityByDensity;\nuniform float isSizedByZ;\nuniform float isSizedByW;\nuniform float colorMultiplicator;\nuniform float opacityMultiplicator;\nuniform float opacityDensity;\nuniform float sizeMultiplicator;\nuniform float numColorStates;\nuniform float pointScale;\nuniform mat4 projectionViewModel;\n\nattribute vec2 stateIndex;\n\n// variables to send to the fragment shader\nvarying vec4 color;\nvarying float finalPointSize;\n\nvoid main() {\n  vec4 state = texture2D(stateTex, stateIndex);\n\n  gl_Position = projectionViewModel * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexZ =  isColoredByZ * floor(state.z * colorMultiplicator);\n  float colorIndexW =  isColoredByW * floor(state.w * colorMultiplicator);\n\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  float colorIndex = (colorIndexZ + colorIndexW) * numColorStates;\n\n  // Half a "pixel" or "texel" in texture coordinates\n  float colorLinearIndex = colorIndex + globalState;\n\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + colorTexEps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // Retrieve point size\n  float pointSizeIndexZ = isSizedByZ * floor(state.z * sizeMultiplicator);\n  float pointSizeIndexW = isSizedByW * floor(state.w * sizeMultiplicator);\n  float pointSizeIndex = pointSizeIndexZ + pointSizeIndexW;\n\n  float pointSizeRowIndex = floor((pointSizeIndex + encodingTexEps) / encodingTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / encodingTexRes) - pointSizeRowIndex + encodingTexEps,\n    pointSizeRowIndex / encodingTexRes + encodingTexEps\n  );\n  float pointSize = texture2D(encodingTex, pointSizeTexIndex).x;\n\n  // Retrieve opacity\n  if (isOpacityByDensity < 0.5) {\n    float opacityIndexZ = isOpacityByZ * floor(state.z * opacityMultiplicator);\n    float opacityIndexW = isOpacityByW * floor(state.w * opacityMultiplicator);\n    float opacityIndex = opacityIndexZ + opacityIndexW;\n\n    float opacityRowIndex = floor((opacityIndex + encodingTexEps) / encodingTexRes);\n    vec2 opacityTexIndex = vec2(\n      (opacityIndex / encodingTexRes) - opacityRowIndex + encodingTexEps,\n      opacityRowIndex / encodingTexRes + encodingTexEps\n    );\n    color.a = min(1.0, texture2D(encodingTex, opacityTexIndex).y + globalState);\n  } else {\n    color.a = min(1.0, opacityDensity + globalState);\n  }\n\n  finalPointSize = (pointSize * pointScale) + pointSizeExtra;\n  gl_PointSize = finalPointSize;\n}\n',blend:{enable:!_t,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:n,size:2}},uniforms:{projectionViewModel:Vo,devicePixelRatio:Do,pointScale:qo,encodingTex:Oo,encodingTexRes:Lo,encodingTexEps:ko,pointSizeExtra:e,globalState:o,colorTex:zo,colorTexRes:Po,colorTexEps:Ao,stateTex:$o,stateTexRes:Wo,stateTexEps:No,isColoredByZ:Go,isColoredByW:Ho,isOpacityByZ:Ko,isOpacityByW:Xo,isOpacityByDensity:Yo,isSizedByZ:Uo,isSizedByW:Jo,colorMultiplicator:Qo,opacityMultiplicator:ei,opacityDensity:ni,sizeMultiplicator:ti,numColorStates:4},count:t,primitive:"points"}),ri=ai(_o,(()=>dn),(()=>Sn)),li=ai(_o,(()=>1),(()=>In),2),si=u({frag:"\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",vert:"\nprecision mediump float;\n\nuniform mat4 projectionViewModel;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = projectionViewModel * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{projectionViewModel:Vo,texture:()=>m},count:6}),ci=u({vert:"\n      precision mediump float;\n      uniform mat4 projectionViewModel;\n      attribute vec2 position;\n      void main () {\n        gl_Position = projectionViewModel * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:()=>mn},uniforms:{projectionViewModel:Vo,color:()=>w},elements:()=>Array(mn.length-2).fill().map(((e,t)=>[0,t+1,t+2]))}),di=e=>{const t=new Float32Array(2*e);let n=0;for(let o=0;o<e;++o){const e=no(o);t[n]=e[0],t[n+1]=e[1],n+=2}return t},ui=e=>{const t=e.length;An=Math.max(2,Math.ceil(Math.sqrt(t))),Dn=.5/An;const n=new Float32Array(An**2*4);Nn=0,Fn=0;for(let o=0;o<t;++o)n[4*o]=e[o][0],n[4*o+1]=e[o][1],n[4*o+2]=e[o][2]||0,n[4*o+3]=e[o][3]||0,Nn=Math.max(Nn,n[4*o+2]),Fn=Math.max(Fn,n[4*o+3]);return u.texture({data:n,shape:[An,An,4],type:"float"})},pi=e=>{Wn=!1,dn=e.length,un=dn,fn&&fn.destroy(),fn=ui(e),Sn({usage:"static",type:"float",data:di(dn)}),Kt=new z(e,(e=>e[0]),(e=>e[1]),16),Wn=!0},mi=e=>{const t="inherit"===gt?v:gt;if("segment"===t){const t=ct.length-1;return t<1?[]:e.reduce(((e,n,o)=>{let i=0;const a=[];for(let t=2;t<n.length;t+=2){const e=Math.sqrt((n[t-2]-n[t])**2+(n[t-1]-n[t+1])**2);a.push(e),i+=e}e[o]=[0];let r=0;for(let l=0;l<n.length/2-1;l++)r+=a[l],e[o].push(4*Math.floor(r/i*t));return e}),[])}if(t){const e=pt(t),n=To(Ro(t),"inherit"===gt?Je:ct);return Qt.reduce(((t,[o,i])=>(t[o]=4*n(i[e]),t)),[])}return Array(Qt.length).fill(0)},hi=()=>{const e="inherit"===yt?zt:yt;if("segment"===e){const e=vt.length-1;return e<1?[]:Qt.reduce(((t,[n,o,i])=>(t[n]=P(i,(t=>vt[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=pt(e),n="inherit"===yt?Tt:vt,o=To(Ro(e),n);return Qt.reduce(((e,[i,a])=>(e[i]=n[o(a[t])],e)),[])}},gi=()=>{const e="inherit"===bt?At:bt;if("segment"===e){const e=wt.length-1;return e<1?[]:Qt.reduce(((t,[n,o,i])=>(t[n]=P(i,(t=>wt[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=pt(e),n="inherit"===bt?Et:wt,o=To(Ro(e),n);return Qt.reduce(((e,[i,a])=>(e[i]=n[o(a[t])],e)),[])}},vi=e=>new Promise((t=>{Jt.setPoints([]),e&&e.length?(en=!0,((e,t={tolerance:.002,maxIntPointsPerSegment:100})=>new Promise(((n,o)=>{const i=h(Z);i.onmessage=e=>{e.data.error?o(e.data.error):n(e.data.points),i.terminate()},i.postMessage({points:e,options:t})})))(e,{maxIntPointsPerSegment:Ct,tolerance:St}).then((e=>{(e=>{Qt=[];let t=0;Object.keys(e).forEach(((n,o)=>{Qt[n]=[o,e[n].reference,e[n].length/2,t],t+=e[n].length/2}))})(e);const n=Object.values(e);Jt.setPoints(n,{colorIndices:mi(n),opacities:hi(),widths:gi()}),en=!1,t()}))):t()})),yi=()=>Kt.range(ln[0],ln[1],rn[0],rn[1]),fi=d((()=>{un=yi().length}),$t),wi=()=>{Bn=!1,On=null,Mn=void 0,Rn=void 0,N=Ln,wn&&(wn.destroy(),wn=void 0),xn&&(xn.destroy(),xn=void 0),a.publish("transitionEnd")},xi=e=>(...t)=>{const n=e(...t);return vn=!0,n},bi=()=>{Jt.setStyle({color:vo(ct,mt,ht),opacity:null===vt?null:vt[0],width:wt[0]})},Ci=()=>{const e=Math.round(jt)>0?0:255;ro.initiator.style.border=`1px dashed rgba(${e}, ${e}, ${e}, 0.33)`,ro.initiator.style.background=`rgba(${e}, ${e}, ${e}, 0.1)`},Si=(e,t)=>n=>{if("inherit"===n)e([...t()]);else{const t=ot(n)?n:[n];e(t.map((e=>rt(e,!0))))}bi()},Ei=Si((e=>{ct=e}),(()=>Je)),Ii=Si((e=>{mt=e}),(()=>Qe)),Mi=Si((e=>{ht=e}),(()=>tt)),Ri=()=>{u.poll()},Ti=(e={})=>{var t,n,o,i,r,l,s,c,d,h,C,S,E,I,M,R,T,z,P,A,D,B,F,Z,j,V,G,H,K,Y,U,J,Q,ee,te;return dt(e),void 0===e.backgroundColor&&void 0===e.background||(t=e.backgroundColor||e.background)&&(p=rt(t,!0),jt=st(p),Ci()),void 0!==e.backgroundImage&&((n=e.backgroundImage)?et(n)?Ue(u,n).then((e=>{m=e,vn=!0,a.publish("backgroundImageReady")})):m="texture2d"===n._reglType?n:null:m=null),void 0!==e.cameraTarget&&(o=e.cameraTarget)&&Ft.lookAt(o,Ft.distance,Ft.rotation),void 0!==e.cameraDistance&&(i=e.cameraDistance)>0&&Ft.lookAt(Ft.target,i,Ft.rotation),void 0!==e.cameraRotation&&null!==(r=e.cameraRotation)&&Ft.lookAt(Ft.target,Ft.distance,r),void 0!==e.cameraView&&(l=e.cameraView)&&Ft.setView(l),void 0!==e.colorBy&&(s=e.colorBy,v=ut(s,Ce)),void 0!==e.pointColor&&xo(e.pointColor),void 0!==e.pointColorActive&&bo(e.pointColorActive),void 0!==e.pointColorHover&&Co(e.pointColorHover),void 0!==e.pointSize&&(c=e.pointSize,He(c,Ke,{minLength:1})&&(Et=[...c]),Xe(+c)&&(Et=[+c]),Cn=1/Et[0],zn=go(),Io()),void 0!==e.pointSizeSelected&&(!+(d=e.pointSizeSelected)||+d<0||(It=+d)),void 0!==e.pointSizeMouseDetection&&(h=e.pointSizeMouseDetection,Mt=h,Io()),void 0!==e.sizeBy&&(e=>{At=ut(e,ue)})(e.sizeBy),void 0!==e.opacity&&(C=e.opacity,He(C,Ke,{minLength:1})&&(Tt=[...C]),Xe(+C)&&(Tt=[+C]),zn=go()),void 0!==e.showPointConnections&&(S=e.showPointConnections,nt=!!S,nt?eo(Kt.points[0])&&vi(Kt.points).then((()=>{a.publish("pointConnectionsDraw"),vn=!0})):vi()),void 0!==e.pointConnectionColor&&Ei(e.pointConnectionColor),void 0!==e.pointConnectionColorActive&&Ii(e.pointConnectionColorActive),void 0!==e.pointConnectionColorHover&&Mi(e.pointConnectionColorHover),void 0!==e.pointConnectionColorBy&&(e=>{gt=ut(e,Re,{allowSegment:!0})})(e.pointConnectionColorBy),void 0!==e.pointConnectionOpacityBy&&(e=>{yt=ut(e,ve,{allowSegment:!0})})(e.pointConnectionOpacityBy),void 0!==e.pointConnectionOpacity&&(e=>{He(e,Ke,{minLength:1})&&(vt=[...e]),Xe(+e)&&(vt=[+e]),ct=ct.map((e=>(e[3]=Number.isNaN(+vt[0])?e[3]:+vt[0],e))),bi()})(e.pointConnectionOpacity),void 0!==e.pointConnectionOpacityActive&&(e=>{!Number.isNaN(+e)&&+e&&(ft=+e)})(e.pointConnectionOpacityActive),void 0!==e.pointConnectionSize&&(E=e.pointConnectionSize,He(E,Ke,{minLength:1})&&(wt=[...E]),Xe(+E)&&(wt=[+E]),bi()),void 0!==e.pointConnectionSizeActive&&(I=e.pointConnectionSizeActive,!Number.isNaN(+I)&&+I&&(xt=Math.max(0,I))),void 0!==e.pointConnectionSizeBy&&(e=>{bt=ut(e,he,{allowSegment:!0})})(e.pointConnectionSizeBy),void 0!==e.pointConnectionMaxIntPointsPerSegment&&(M=e.pointConnectionMaxIntPointsPerSegment,Ct=Math.max(0,M)),void 0!==e.pointConnectionTolerance&&(R=e.pointConnectionTolerance,St=Math.max(0,R)),void 0!==e.opacityBy&&(e=>{zt=ut(e,we,{allowDensity:!0})})(e.opacityBy),void 0!==e.lassoColor&&(T=e.lassoColor)&&(w=rt(T,!0),Zt.setStyle({color:w})),void 0!==e.lassoLineWidth&&(z=e.lassoLineWidth,Number.isNaN(+z)||+z<1||(x=+z,Zt.setStyle({width:x}))),void 0!==e.lassoMinDelay&&+(P=e.lassoMinDelay)&&(b=+P,ro.set({minDelay:b})),void 0!==e.lassoMinDist&&+(A=e.lassoMinDist)&&(O=+A,ro.set({minDist:O})),void 0!==e.lassoClearEvent&&(D=e.lassoClearEvent,L=Ye(X,L)(D)),void 0!==e.lassoInitiator&&(B=e.lassoInitiator,k=Boolean(B),ro.set({enableInitiator:k})),void 0!==e.lassoInitiatorParentElement&&(F=e.lassoInitiatorParentElement,_=F,ro.set({startInitiatorParentElement:_})),void 0!==e.keyMap&&(Z=e.keyMap,$=Object.entries(Z).reduce(((e,[t,n])=>(oe.includes(t)&&ne.includes(n)&&(e[t]=n),e)),{}),gn=lt($),gn.rotate?Ft.config({isRotate:!0,mouseDownMoveModKey:gn.rotate}):Ft.config({isRotate:!1})),void 0!==e.mouseMode&&(j=e.mouseMode,W=Ye(q,"panZoom")(j),Ft.config({defaultMouseDownMoveAction:"rotate"===W?"rotate":"pan"})),void 0!==e.showReticle&&null!==(V=e.showReticle)&&(N=V),void 0!==e.reticleColor&&(G=e.reticleColor)&&(Ge=rt(G,!0),tn.setStyle({color:Ge}),nn.setStyle({color:Ge})),void 0!==e.pointOutlineWidth&&(!+(H=e.pointOutlineWidth)||+H<0||(Rt=+H)),void 0!==e.height&&(e=>{if("auto"===e)return Dt=e,g.style.height="100%",void window.requestAnimationFrame((()=>{g&&Eo(g.getBoundingClientRect().height)}));!+e||+e<=0||(Dt=+e,Eo(Dt),g.style.height=`${Dt}px`)})(e.height),void 0!==e.width&&(e=>{if("auto"===e)return Bt=e,g.style.width="100%",void window.requestAnimationFrame((()=>{g&&Mo(g.getBoundingClientRect().width)}));!+e||+e<=0||(Bt=+e,Mo(Bt),g.style.width=`${Lt}px`)})(e.width),void 0!==e.aspectRatio&&(+(K=e.aspectRatio)<=0||(hn=K)),void 0!==e.xScale&&(Y=e.xScale)&&(jn=Y,qn=Y.domain()[0],Gn=Y?Y.domain()[1]-Y.domain()[0]:0),void 0!==e.yScale&&(U=e.yScale)&&(Vn=U,Hn=Vn.domain()[0],Kn=Vn?Vn.domain()[1]-Vn.domain()[0]:0),void 0!==e.deselectOnDblClick&&(J=e.deselectOnDblClick,y=!!J),void 0!==e.deselectOnEscape&&(Q=e.deselectOnEscape,f=!!Q),void 0!==e.opacityByDensityFill&&(ee=e.opacityByDensityFill,Pt=+ee),void 0!==e.gamma&&(te=e.gamma,Ot=+te),new Promise((e=>window.requestAnimationFrame((()=>{g&&(fo(),Ri(),vn=!0,e())}))))},zi=(e,{showReticleOnce:t=!1,preventEvent:n=!1}={})=>{let o=!1;if(e>=0&&e<dn){o=!0;const t=Pn,i=e!==Pn;+t>=0&&i&&!Gt.has(t)&&to([t],0),Pn=e,In.subdata(no(e)),Gt.has(e)||to([e],2),i&&!n&&a.publish("pointover",Pn)}else o=+Pn>=0,o&&(Gt.has(Pn)||to([Pn],0),n||a.publish("pointout",Pn)),Pn=void 0;o&&(vn=!0,yn=t)},Pi=()=>{Ft||(Ft=A(g)),e.cameraView?Ft.setView(D(e.cameraView)):e.cameraTarget||e.cameraDistance||e.cameraRotation?Ft.lookAt([...e.cameraTarget||Ae],e.cameraDistance||1,e.cameraRotation||0):Ft.setView(D(De)),rn=Un(1,1),ln=Un(-1,-1)},Ai=({key:e})=>{switch(e){case"Escape":f&&oo()}},Di=()=>{Zn=!0},Bi=()=>{zi(),Zn=!1,vn=!0},Oi=()=>{vn=!0},Li=()=>{const e="auto"===Bt,t="auto"===Dt;if(e||t){const{width:n,height:o}=g.getBoundingClientRect();e&&Mo(n),t&&Eo(o),fo(),vn=!0}},ki=u.frame((()=>{Wn&&(vn||Bn)&&(Bn&&!((e,t)=>{On||(On=performance.now());const n=performance.now()-On;return oi({t:Math.min(1,Math.max(0,t(n/e)))}),n<e})(Mn,Rn)&&wi(),$n=Ft.tick(),$n&&(rn=Un(1,1),ln=Un(-1,-1),fi()),u.clear({color:[0,0,0,0],depth:1}),m&&m._reglType&&si(),mn.length>2&&ci(),Bn||Jt.draw({projection:Fo(),model:jo(),view:Zo()}),Nt.use((()=>{u.clear({color:[0,0,0,0],depth:1}),ri(),Vt||!N&&!yn||(()=>{if(!(Pn>=0))return;const[e,t]=Kt.points[Pn].slice(0,2),n=[e,t,0,1];M(l,Yt,M(l,Ft.view,Ut)),R(n,n,l),tn.setPoints([-1,n[1],1,n[1]]),nn.setPoints([n[0],1,n[0],-1]),tn.draw(),nn.draw(),ai((()=>(It+2*Rt)*window.devicePixelRatio),(()=>1),In,1)(),ai((()=>(It+Rt)*window.devicePixelRatio),(()=>1),In,3)()})(),Pn>=0&&li(),qt.length&&(()=>{const e=qt.length;ai((()=>(It+2*Rt)*window.devicePixelRatio),(()=>e),Bo,1)(),ai((()=>(It+Rt)*window.devicePixelRatio),(()=>e),Bo,3)(),ai((()=>It),(()=>e),Bo,1)()})()})),ii(),Zt.draw({projection:Fo(),model:jo(),view:Zo()}),$n&&(So(),a.publish("view",{view:Ft.view,camera:Ft,xScale:jn,yScale:Vn})),vn=!1,yn=!1,a.publish("draw"))}));return(()=>{fo(),Pi(),So(),Zt=B(u,{color:w,width:x,is2d:!0}),Jt=B(u,{color:ct,colorHover:ht,colorActive:mt,opacity:null===vt?null:vt[0],width:wt[0],widthActive:xt,is2d:!0}),tn=B(u,{color:Ge,width:1,is2d:!0}),nn=B(u,{color:Ge,width:1,is2d:!0}),Io(),g.addEventListener("wheel",Oi),Sn=u.buffer(),En=u.buffer(),In=u.buffer({usage:"dynamic",type:"float",length:2*j}),Tn=yo(),zn=go();const e=Ti({backgroundImage:m,width:Bt,height:Dt,keyMap:$});Ci(),window.addEventListener("keyup",Ai,!1),window.addEventListener("blur",ho,!1),window.addEventListener("mouseup",co,!1),window.addEventListener("mousemove",mo,!1),window.addEventListener("resize",Li),window.addEventListener("orientationchange",Li),g.addEventListener("mousedown",so,!1),g.addEventListener("mouseenter",Di,!1),g.addEventListener("mouseleave",Bi,!1),g.addEventListener("click",uo,!1),g.addEventListener("dblclick",po,!1),e.then((()=>{a.publish("init")}))})(),{clear:xi((()=>{pi([]),Jt.clear()})),createTextureFromUrl:e=>Ue(u,e),deselect:oo,destroy:()=>{ki.cancel(),window.removeEventListener("keyup",Ai,!1),window.removeEventListener("blur",ho,!1),window.removeEventListener("mouseup",co,!1),window.removeEventListener("mousemove",mo,!1),window.removeEventListener("resize",Li),window.removeEventListener("orientationchange",Li),g.removeEventListener("mousedown",so,!1),g.removeEventListener("mouseenter",Di,!1),g.removeEventListener("mouseleave",Bi,!1),g.removeEventListener("click",uo,!1),g.removeEventListener("dblclick",po,!1),g=void 0,Ft.dispose(),Ft=void 0,u=void 0,Zt.destroy(),Jt.destroy(),tn.destroy(),nn.destroy(),a.publish("destroy"),a.clear()},draw:(e,t={})=>{return(n=e,new Promise(((e,t)=>{if(!n||Array.isArray(n))e(n);else{const o=Array.isArray(n.x)&&(e=>n.x[e]),i=Array.isArray(n.y)&&(e=>n.y[e]),a=Array.isArray(n.line)&&(e=>n.line[e]),r=Array.isArray(n.lineOrder)&&(e=>n.lineOrder[e]),l=Object.keys(n),s=(()=>{const e=l.find((e=>je.has(e)));return e&&(t=>n[e][t])})(),c=(()=>{const e=l.find((e=>Ve.has(e)));return e&&(t=>n[e][t])})();o&&i&&s&&c&&a&&r?e(n.x.map(((e,t)=>[e,i(t),s(t),c(t),a(t),r(t)]))):o&&i&&s&&c&&a?e(n.x.map(((e,t)=>[e,i(t),s(t),c(t),a(t)]))):o&&i&&s&&c?e(n.x.map(((e,t)=>[e,i(t),s(t),c(t)]))):o&&i&&s?e(n.x.map(((e,t)=>[e,i(t),s(t)]))):o&&i?e(n.x.map(((e,t)=>[e,i(t)]))):t(new Error("You need to specify at least x and y"))}}))).then((e=>new Promise((n=>{let o=!1;e&&(t.transition&&(e.length===dn?o=(e=>{if(!fn)return!1;if(Bn){const e=wn;wn=xn,e.destroy()}else wn=fn;return xn=ui(e),bn=u.framebuffer({color:xn,depth:!1,stencil:!1}),fn=void 0,!0})(e):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),pi(e),(nt||t.showPointConnectionsOnce&&eo(e[0]))&&vi(e).then((()=>{a.publish("pointConnectionsDraw"),vn=!0,yn=t.showReticleOnce}))),t.transition&&o?(a.subscribe("transitionEnd",(()=>{vn=!0,yn=t.showReticleOnce,n()}),1),(({duration:e=500,easing:t=K})=>{Bn&&a.publish("transitionEnd"),Bn=!0,On=null,Mn=e,Rn=et(t)?H[t]||K:t,Ln=N,N=!1,a.publish("transitionStart")})({duration:t.transitionDuration,easing:t.transitionEasing})):(a.subscribe("draw",n,1),vn=!0,yn=t.showReticleOnce)}))));var n},get:e=>(dt({property:!0}),"aspectRatio"===e?hn:"background"===e||"backgroundColor"===e?p:"backgroundImage"===e?m:"camera"===e?Ft:"cameraTarget"===e?Ft.target:"cameraDistance"===e?Ft.distance:"cameraRotation"===e?Ft.rotation:"cameraView"===e?Ft.view:"canvas"===e?g:"colorBy"===e?v:"sizeBy"===e?At:"deselectOnDblClick"===e?y:"deselectOnEscape"===e?f:"height"===e?Dt:"lassoColor"===e?w:"lassoLineWidth"===e?x:"lassoMinDelay"===e?b:"lassoMinDist"===e?O:"lassoClearEvent"===e?L:"lassoInitiator"===e?k:"lassoInitiatorElement"===e?ro.initiator:"lassoInitiatorParentElement"===e?_:"keyMap"===e?((e,a)=>{for(var r in a||(a={}))n.call(a,r)&&i(e,r,a[r]);if(t)for(var r of t(a))o.call(a,r)&&i(e,r,a[r]);return e})({},$):"mouseMode"===e?W:"opacity"===e?1===Tt.length?Tt[0]:Tt:"opacityBy"===e?zt:"opacityByDensityFill"===e?Pt:"opacityByDensityDebounceTime"===e?$t:"points"===e?Kt.points:"pointsInView"===e?yi():"pointColor"===e?1===Je.length?Je[0]:Je:"pointColorActive"===e?1===Qe.length?Qe[0]:Qe:"pointColorHover"===e?1===tt.length?tt[0]:tt:"pointOutlineWidth"===e?Rt:"pointSize"===e?1===Et.length?Et[0]:Et:"pointSizeSelected"===e?It:"pointSizeMouseDetection"===e?Mt:"showPointConnections"===e?nt:"pointConnectionColor"===e?1===ct.length?ct[0]:ct:"pointConnectionColorActive"===e?1===mt.length?mt[0]:mt:"pointConnectionColorHover"===e?1===ht.length?ht[0]:ht:"pointConnectionColorBy"===e?gt:"pointConnectionOpacity"===e?1===vt.length?vt[0]:vt:"pointConnectionOpacityBy"===e?yt:"pointConnectionOpacityActive"===e?ft:"pointConnectionSize"===e?1===wt.length?wt[0]:wt:"pointConnectionSizeActive"===e?xt:"pointConnectionSizeBy"===e?bt:"pointConnectionMaxIntPointsPerSegment"===e?Ct:"pointConnectionTolerance"===e?St:"reticleColor"===e?Ge:"regl"===e?u:"showReticle"===e?N:"version"===e?"1.1.0":"width"===e?Bt:"xScale"===e?jn:"yScale"===e?Vn:"performanceMode"===e?_t:"gamma"===e?Ot:void 0),hover:zi,refresh:Ri,reset:xi((()=>{Pi(),So(),a.publish("view",{view:Ft.view,camera:Ft,xScale:jn,yScale:Vn})})),select:io,set:Ti,export:(e={})=>({pixels:Uint8ClampedArray.from(u.read(e)),width:Lt*window.devicePixelRatio,height:kt*window.devicePixelRatio}),subscribe:a.subscribe,unsubscribe:a.unsubscribe}};export{mt as c};
