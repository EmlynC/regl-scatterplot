var t,e="undefined"!=typeof Float32Array?Float32Array:Array;function n(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function r(t){var n=new e(16);return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function i(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],c=e[7],l=e[8],f=e[9],d=e[10],h=e[11],p=e[12],m=e[13],y=e[14],b=e[15],g=n*a-r*o,v=n*u-i*o,w=n*c-s*o,_=r*u-i*a,x=r*c-s*a,A=i*c-s*u,S=l*m-f*p,I=l*y-d*p,T=l*b-h*p,O=f*y-d*m,M=f*b-h*m,B=d*b-h*y,D=g*B-v*M+w*O+_*T-x*I+A*S;return D?(D=1/D,t[0]=(a*B-u*M+c*O)*D,t[1]=(i*M-r*B-s*O)*D,t[2]=(m*A-y*x+b*_)*D,t[3]=(d*x-f*A-h*_)*D,t[4]=(u*T-o*B-c*I)*D,t[5]=(n*B-i*T+s*I)*D,t[6]=(y*w-p*A-b*v)*D,t[7]=(l*A-d*w+h*v)*D,t[8]=(o*M-a*T+c*S)*D,t[9]=(r*T-n*M-s*S)*D,t[10]=(p*x-m*w+b*g)*D,t[11]=(f*w-l*x-h*g)*D,t[12]=(a*I-o*O-u*S)*D,t[13]=(n*O-r*I+i*S)*D,t[14]=(m*v-p*_-y*g)*D,t[15]=(l*_-f*v+d*g)*D,t):null}function s(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=e[9],h=e[10],p=e[11],m=e[12],y=e[13],b=e[14],g=e[15],v=n[0],w=n[1],_=n[2],x=n[3];return t[0]=v*r+w*a+_*f+x*m,t[1]=v*i+w*u+_*d+x*y,t[2]=v*s+w*c+_*h+x*b,t[3]=v*o+w*l+_*p+x*g,v=n[4],w=n[5],_=n[6],x=n[7],t[4]=v*r+w*a+_*f+x*m,t[5]=v*i+w*u+_*d+x*y,t[6]=v*s+w*c+_*h+x*b,t[7]=v*o+w*l+_*p+x*g,v=n[8],w=n[9],_=n[10],x=n[11],t[8]=v*r+w*a+_*f+x*m,t[9]=v*i+w*u+_*d+x*y,t[10]=v*s+w*c+_*h+x*b,t[11]=v*o+w*l+_*p+x*g,v=n[12],w=n[13],_=n[14],x=n[15],t[12]=v*r+w*a+_*f+x*m,t[13]=v*i+w*u+_*d+x*y,t[14]=v*s+w*c+_*h+x*b,t[15]=v*o+w*l+_*p+x*g,t}function o(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function a(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),function(){var t=function(){var t=new e(2);return e!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const c=(t=[0,0],e=1,r=0,c=[0,0],l=[[0,1/0],[0,1/0]],f=[[-1/0,1/0],[-1/0,1/0]])=>{const d=new Float32Array(16),h=new Float32Array(16),p=new Float32Array(16);let m=n(),y=[...c.slice(0,2),0,1];const b=Array.isArray(l[0])?[...l[0]]:[...l],g=Array.isArray(l[0])?[...l[1]]:[...l],v=Array.isArray(f[0])?[...f[0]]:[...f],w=Array.isArray(f[0])?[...f[1]]:[...f],_=()=>function(t,e){var n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(s,o,a),t[2]=Math.hypot(u,c,l),t}(d,m).slice(0,2),x=()=>{const t=_();return Math.min(t[0],t[1])},A=()=>{const t=_();return Math.max(t[0],t[1])},S=([t=0,e=0]=[],r=1,i=0)=>{m=n(),I([-t,-e]),O(i),T(1/r)},I=([t=0,e=0]=[])=>{d[0]=t,d[1]=e,d[2]=0;const n=o(h,d);s(m,n,m)},T=(t,e)=>{const n=Array.isArray(t);let r=n?t[0]:t,u=n?t[1]:t;if(r<=0||u<=0||1===r&&1===u)return;const c=_(),l=c[0]*r,f=c[1]*u;if(r=Math.max(b[0],Math.min(l,b[1]))/c[0],u=Math.max(g[0],Math.min(f,g[1]))/c[1],1===r&&1===u)return;d[0]=r,d[1]=u,d[2]=1;const v=a(h,d),w=e?[...e,0]:y,x=o(d,w);s(m,x,s(m,v,s(m,i(p,x),m)))},O=t=>{const e=n();!function(t,e,n){var r,i,s,o=n[0],a=n[1],u=n[2],c=Math.hypot(o,a,u);c<1e-6||(o*=c=1/c,a*=c,u*=c,r=Math.sin(e),s=1-(i=Math.cos(e)),t[0]=o*o*s+i,t[1]=a*o*s+u*r,t[2]=u*o*s-a*r,t[3]=0,t[4]=o*a*s-u*r,t[5]=a*a*s+i,t[6]=u*a*s+o*r,t[7]=0,t[8]=o*u*s+a*r,t[9]=a*u*s-o*r,t[10]=u*u*s+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1)}(e,t,[0,0,1]),s(m,e,m)},M=t=>{!t||t.length<16||(m=t)};return S(t,e,r),{get translation(){return function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}(d,m).slice(0,2)},get target(){return u(d,y,i(p,m)).slice(0,2)},get scaling(){return _()},get minScaling(){return x()},get maxScaling(){return A()},get scaleBounds(){return[[...b],[...g]]},get translationBounds(){return[[...v],[...w]]},get distance(){return(()=>{const t=_();return[1/t[0],1/t[1]]})()},get minDistance(){return 1/x()},get maxDistance(){return 1/A()},get rotation(){return Math.acos(m[0]/A())},get view(){return m},get viewCenter(){return y.slice(0,2)},lookAt:S,translate:I,pan:I,rotate:O,scale:T,zoom:T,reset:()=>{S(t,e,r)},set:(...t)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),M(...t)),setScaleBounds:t=>{const e=Array.isArray(t[0]);b[0]=e?t[0][0]:t[0],b[1]=e?t[0][1]:t[1],g[0]=e?t[1][0]:t[0],g[1]=e?t[1][1]:t[1]},setTranslationBounds:t=>{const e=Array.isArray(t[0]);v[0]=e?t[0][0]:t[0],v[1]=e?t[0][1]:t[1],w[0]=e?t[1][0]:t[0],w[1]=e?t[1][1]:t[1]},setView:M,setViewCenter:t=>{y=[...t.slice(0,2),0,1]}}},l=["pan","rotate"],f={alt:"altKey",cmd:"metaKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},d=(t,{distance:e=1,target:n=[0,0],rotation:r=0,isNdc:i=!0,isFixed:s=!1,isPan:o=!0,isPanInverted:a=[!1,!0],panSpeed:u=1,isRotate:d=!0,rotateSpeed:h=1,defaultMouseDownMoveAction:p="pan",mouseDownMoveModKey:m="alt",isZoom:y=!0,zoomSpeed:b=1,viewCenter:g,scaleBounds:v,translationBounds:w,onKeyDown:_=(()=>{}),onKeyUp:x=(()=>{}),onMouseDown:A=(()=>{}),onMouseUp:S=(()=>{}),onMouseMove:I=(()=>{}),onWheel:T=(()=>{})}={})=>{let O=c(n,e,r,g,v,w),M=0,B=0,D=0,E=0,F=0,k=0,N=!1,C=0,L=1,U=1,j=1,z=!1,V=!1,R=!1,P="pan"===p,$=o,W=o,Y=a,H=a,q=y,G=y;const K=()=>{$=Array.isArray(o)?Boolean(o[0]):o,W=Array.isArray(o)?Boolean(o[1]):o,Y=Array.isArray(a)?Boolean(a[0]):a,H=Array.isArray(a)?Boolean(a[1]):a,q=Array.isArray(y)?Boolean(y[0]):y,G=Array.isArray(y)?Boolean(y[1]):y};K();const Q=i?t=>t/L*2*j:t=>t,J=i?t=>t/U*2:t=>-t,X=i?t=>(t/L*2-1)*j:t=>t,Z=i?t=>1-t/U*2:t=>t,tt=()=>{const e=t.getBoundingClientRect();L=e.width,U=e.height,j=L/U},et=t=>{R=!1,x(t)},nt=t=>{R=t[f[m]],_(t)},rt=t=>{N=!1,S(t)},it=t=>{N=1===t.buttons,A(t)},st=void 0!==document.createEvent("MouseEvent").offsetX?t=>{D=t.offsetX,E=t.offsetY}:e=>{const n=t.getBoundingClientRect();D=e.clientX-n.left,E=e.clientY-n.top},ot=t=>{M=t.clientX,B=t.clientY},at=t=>{ot(t),I(t)},ut=t=>{t.preventDefault(),ot(t),st(t);const e=1===t.deltaMode?12:1;C+=e*(t.deltaY||0),T(t)};window.addEventListener("keydown",nt,{passive:!0}),window.addEventListener("keyup",et,{passive:!0}),t.addEventListener("mousedown",it,{passive:!0}),window.addEventListener("mouseup",rt,{passive:!0}),window.addEventListener("mousemove",at,{passive:!0}),t.addEventListener("wheel",ut,{passive:!1}),O.config=({defaultMouseDownMoveAction:t=null,isFixed:e=null,isPan:n=null,isPanInverted:r=null,isRotate:i=null,isZoom:c=null,panSpeed:g=null,rotateSpeed:v=null,zoomSpeed:w=null,mouseDownMoveModKey:_=null}={})=>{p=null!==t&&l.includes(t)?t:p,P="pan"===p,s=null!==e?e:s,o=null!==n?n:o,a=null!==r?r:a,d=null!==i?i:d,y=null!==c?c:y,u=+g>0?g:u,h=+v>0?v:h,b=+w>0?w:b,K(),m=null!==_&&Object.keys(f).includes(_)?_:m},O.dispose=()=>{O=void 0,window.removeEventListener("keydown",nt),window.removeEventListener("keyup",et),t.removeEventListener("mousedown",it),window.removeEventListener("mouseup",rt),window.removeEventListener("mousemove",at),t.removeEventListener("wheel",ut)},O.refresh=tt,O.tick=()=>{if(s)return!1;z=!1;const t=M,e=B;if(($||W)&&N&&(P&&!R||!P&&R)){const n=Y?F-t:t-F,r=$?Q(u*n):0,i=H?k-e:e-k,s=W?J(u*i):0;0===r&&0===s||(O.pan([r,s]),z=!0)}if(y&&C){const t=b*Math.exp(C/U),e=X(D),n=Z(E);O.scale([q?1/t:1,G?1/t:1],[e,n]),z=!0}if(d&&N&&(P&&R||!P&&!R)&&Math.abs(F-t)+Math.abs(k-e)>0){const n=L/2,r=U/2,i=F-n,s=r-k,o=t-n,a=r-e,u=function(t,e){var n=t[0],r=t[1],i=e[0],s=e[1],o=Math.sqrt(n*n+r*r)*Math.sqrt(i*i+s*s),a=o&&(n*i+r*s)/o;return Math.acos(Math.min(Math.max(a,-1),1))}([i,s],[o,a]),c=i*a-o*s;O.rotate(h*u*Math.sign(c)),z=!0}C=0,F=t,k=e;const n=z||V;return V=!1,n};const ct=t=>function(){t.apply(null,arguments),V=!0};return O.lookAt=ct(O.lookAt),O.translate=ct(O.translate),O.pan=ct(O.pan),O.rotate=ct(O.rotate),O.scale=ct(O.scale),O.zoom=ct(O.zoom),O.reset=ct(O.reset),O.set=ct(O.set),O.setScaleBounds=ct(O.setScaleBounds),O.setTranslationBounds=ct(O.setTranslationBounds),O.setView=ct(O.setView),O.setViewCenter=ct(O.setViewCenter),tt(),O};function h(t,e,n,r,i,s){if(i-r<=n)return;const o=r+i>>1;p(t,e,o,r,i,s%2),h(t,e,n,r,o-1,s+1),h(t,e,n,o+1,i,s+1)}function p(t,e,n,r,i,s){for(;i>r;){if(i-r>600){const o=i-r+1,a=n-r+1,u=Math.log(o),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(o-c)/o)*(a-o/2<0?-1:1);p(t,e,n,Math.max(r,Math.floor(n-a*c/o+l)),Math.min(i,Math.floor(n+(o-a)*c/o+l)),s)}const o=e[2*n+s];let a=r,u=i;for(m(t,e,r,n),e[2*i+s]>o&&m(t,e,r,i);a<u;){for(m(t,e,a,u),a++,u--;e[2*a+s]<o;)a++;for(;e[2*u+s]>o;)u--}e[2*r+s]===o?m(t,e,r,u):(u++,m(t,e,u,i)),u<=n&&(r=u+1),n<=u&&(i=u-1)}}function m(t,e,n,r){y(t,n,r),y(e,2*n,2*r),y(e,2*n+1,2*r+1)}function y(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function b(t,e,n,r){const i=t-n,s=e-r;return i*i+s*s}const g=t=>t[0],v=t=>t[1];class w{constructor(t,e=g,n=v,r=64,i=Float64Array){this.nodeSize=r,this.points=t;const s=t.length<65536?Uint16Array:Uint32Array,o=this.ids=new s(t.length),a=this.coords=new i(2*t.length);for(let u=0;u<t.length;u++)o[u]=u,a[2*u]=e(t[u]),a[2*u+1]=n(t[u]);h(o,a,r,0,o.length-1,0)}range(t,e,n,r){return function(t,e,n,r,i,s,o){const a=[0,t.length-1,0],u=[];let c,l;for(;a.length;){const f=a.pop(),d=a.pop(),h=a.pop();if(d-h<=o){for(let o=h;o<=d;o++)c=e[2*o],l=e[2*o+1],c>=n&&c<=i&&l>=r&&l<=s&&u.push(t[o]);continue}const p=Math.floor((h+d)/2);c=e[2*p],l=e[2*p+1],c>=n&&c<=i&&l>=r&&l<=s&&u.push(t[p]);const m=(f+1)%2;(0===f?n<=c:r<=l)&&(a.push(h),a.push(p-1),a.push(m)),(0===f?i>=c:s>=l)&&(a.push(p+1),a.push(d),a.push(m))}return u}(this.ids,this.coords,t,e,n,r,this.nodeSize)}within(t,e,n){return function(t,e,n,r,i,s){const o=[0,t.length-1,0],a=[],u=i*i;for(;o.length;){const c=o.pop(),l=o.pop(),f=o.pop();if(l-f<=s){for(let i=f;i<=l;i++)b(e[2*i],e[2*i+1],n,r)<=u&&a.push(t[i]);continue}const d=Math.floor((f+l)/2),h=e[2*d],p=e[2*d+1];b(h,p,n,r)<=u&&a.push(t[d]);const m=(c+1)%2;(0===c?n-i<=h:r-i<=p)&&(o.push(f),o.push(d-1),o.push(m)),(0===c?n+i>=h:r+i>=p)&&(o.push(d+1),o.push(l),o.push(m))}return a}(this.ids,this.coords,t,e,n,this.nodeSize)}}const _=(()=>{try{return new window.BroadcastChannel("pub-sub-es")}catch(t){return{postMessage:()=>{}}}})(),x=(t,e)=>e?t.toLowerCase():t,A=(t,{caseInsensitive:e}={})=>(n,r,i=1/0)=>{const s=x(n,e);return t[s]||(t[s]=[],t.__times__[s]=[]),t[s].push(r),t.__times__[s].push(+i||1/0),{event:s,handler:r}},S=(t,{caseInsensitive:e}={})=>(n,r)=>{"object"==typeof n&&(r=n.handler,n=n.event);const i=x(n,e);if(!t[i])return;const s=t[i].indexOf(r);-1===s||s>=t[i].length||(t[i].splice(s,1),t.__times__[i].splice(s,1))},I=(t,e)=>()=>{t.forEach((t=>t(e)))},T=(t,{isGlobal:e,caseInsensitive:n,async:r}={})=>{const i=S(t);return(s,o,a={})=>{const u=x(s,n);if(!t[u])return;const c=[...t[u]];if(c.forEach(((e,n)=>{--t.__times__[u][n]<1&&i(u,e)})),r||a.async?setTimeout(I(c,o),0):I(c,o)(),e&&!a.isNoGlobalBroadcast)try{_.postMessage({event:u,news:o})}catch(l){if(!(l instanceof DOMException))throw l;console.warn(`Could not broadcast '${u}' globally. Payload is not clonable.`)}}},O=t=>()=>{Object.keys(t).filter((t=>"_"!==t[0])).forEach((e=>{t[e]=void 0,t.__times__[e]=void 0,delete t[e],delete t.__times__[e]}))},M=({async:t=!1,caseInsensitive:e=!1,stack:n={__times__:{}}}={})=>(n.__times__||(n.__times__={}),{publish:T(n,{async:t,caseInsensitive:e}),subscribe:A(n,{caseInsensitive:e}),unsubscribe:S(n,{caseInsensitive:e}),clear:O(n),stack:n}),B={__times__:{}},D={publish:T(B,{isGlobal:!0}),subscribe:A(B),unsubscribe:S(B),stack:B};_.onmessage=({data:{event:t,news:e}})=>D.publish(t,e,!0);const{push:E,splice:F}=Array.prototype,k=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),N=Float32Array.BYTES_PER_ELEMENT,C={duplicate(t,e=1,n=1){const r=[],i=new Array(2*e);for(let s=0,o=t.length/e;s<o;s++){const o=s*e;for(let r=0;r<e;r++){const s=t[o+r];i[r]=s,i[r+e]=s*n}E.apply(r,i)}return r},mapElement(t,e,n,r){for(let i=0,s=t.length/n;i<s;i++){const s=e+i*n;t[s]=r(t[s],s,i)}return t},copyElement(t,e,n,r){const i=new Array(r),s=e*r;for(let o=0;o<r;o++)i[o]=t[s+o];return F.call(t,n*r,0,...i),t},increaseStride(t,e,n,r=0){const i=[],s=new Array(n).fill(r);for(let o=0,a=t.length/e;o<a;o++){const n=o*e;for(let r=0;r<e;r++)s[r]=t[n+r];E.apply(i,s)}return i}},L=(t,{projection:e=k,model:n=k,view:r=k,points:i=[],colorIndices:o=[],color:a=[.8,.5,0,1],opacity:u=null,opacities:c=[],width:l=1,widths:f=[],miter:d=1,is2d:h=!1,zPos2d:p=0}={})=>{if(!t)return void console.error("Regl instance is undefined.");const m=new Float32Array(16);let y,b,g,v,w,_,x,A,S,I,T,O,M,B,D,E,F,L,U=h?2:3;const j=()=>+(c.length===b||null!==u),z=()=>{I=t.buffer(),T=t.buffer(),O=t.buffer(),D=t.buffer(),E={prevPosition:{buffer:()=>I,offset:0,stride:3*N},currPosition:{buffer:()=>I,offset:3*N*2,stride:3*N},nextPosition:{buffer:()=>I,offset:3*N*4,stride:3*N},opacity:{buffer:()=>T,offset:2*N,stride:N},offsetScale:{buffer:()=>O,offset:2*N,stride:N},colorIndex:{buffer:()=>D,offset:2*N,stride:N}},F=t.elements(),L=t({attributes:E,depth:{enable:!h},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projectionViewModel:(t,e)=>{const n=t.projection||e.projection,r=t.model||e.model,i=t.view||e.view;return s(m,n,s(m,i,r))},aspectRatio:({viewportWidth:t,viewportHeight:e})=>t/e,colorTex:()=>M,colorTexRes:()=>B,colorTexEps:()=>.5/B,pixelRatio:({pixelRatio:t})=>t,width:({pixelRatio:t,viewportHeight:e})=>l/e*t,useOpacity:j,useColorOpacity:()=>+!j(),miter:d},elements:()=>F,vert:"\nuniform mat4 projectionViewModel;\nuniform float aspectRatio;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform float width;\nuniform float useOpacity;\nuniform float useColorOpacity;\nuniform int miter;\n\nattribute vec3 prevPosition;\nattribute vec3 currPosition;\nattribute vec3 nextPosition;\nattribute float opacity;\nattribute float offsetScale;\nattribute float colorIndex;\n\nvarying vec4 color;\n\nvoid main() {\n  vec2 aspectVec = vec2(aspectRatio, 1.0);\n  vec4 prevProjected = projectionViewModel * vec4(prevPosition, 1.0);\n  vec4 currProjected = projectionViewModel * vec4(currPosition, 1.0);\n  vec4 nextProjected = projectionViewModel * vec4(nextPosition, 1.0);\n\n  // get 2D screen space with W divide and aspect correction\n  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;\n  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  // starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  if (currScreen == prevScreen) {\n    dir = normalize(nextScreen - currScreen);\n  }\n  // ending point uses (current - previous)\n  else if (currScreen == nextScreen) {\n    dir = normalize(currScreen - prevScreen);\n  }\n  // somewhere in middle, needs a join\n  else {\n    // get directions from (C - B) and (B - A)\n    vec2 dirA = normalize((currScreen - prevScreen));\n    if (miter == 1) {\n      vec2 dirB = normalize((nextScreen - currScreen));\n      // now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      dir = tangent;\n    } else {\n      dir = dirA;\n    }\n  }\n\n  vec2 normal = vec2(-dir.y, dir.x) * width;\n  normal.x /= aspectRatio;\n  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);\n  gl_Position = currProjected + offset;\n\n  // Get color from texture\n  float colorRowIndex = floor((colorIndex + colorTexEps) / colorTexRes);\n  vec2 colorTexIndex = vec2(\n    (colorIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n  color.a = useColorOpacity * color.a + useOpacity * opacity;\n}",frag:"\nprecision mediump float;\nvarying vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"})},V=()=>{R(),z()},R=()=>{i=null,v=null,w=null,A=null,S=null,I.destroy(),O.destroy(),F.destroy()},P=(t,e)=>{const n=e.flat(2);return n.length===b?n:n.length===y?g.map(((t,e)=>Array(t).fill(n[e]))).flat():t},$=(t=[],{colorIndices:e=o,opacities:n=c,widths:r=f,is2d:s=h}={})=>{i=t,U=(h=s)?2:3,y=Array.isArray(i[0])?i.length:1,g=y>1?i.map((t=>Math.floor(t.length/U))):[Math.floor(i.length/U)],b=g.reduce(((t,e)=>t+e),0),o=P(o,e),c=P(c,n),f=P(f,r),i&&b>1?(()=>{1===y&&i.length%U>0&&console.warn(`The length of points (${b}) does not match the dimensions (${U}). Incomplete points are ignored.`),v=i.flat().slice(0,b*U),h&&(v=C.increaseStride(v,2,3,p)),o.length!==b&&(o=new Array(b).fill(0)),f.length!==b&&(f=new Array(b).fill(1));let t=o.slice(),e=c.length===b?c.slice():new Array(b).fill(+u),n=f.slice(),r=0;g.forEach((i=>{const s=r+i-1;C.copyElement(v,s,s,3),C.copyElement(v,r,r,3),C.copyElement(t,s,s,1),C.copyElement(t,r,r,1),C.copyElement(e,s,s,1),C.copyElement(e,r,r,1),C.copyElement(n,s,s,1),C.copyElement(n,r,r,1),r+=i+2})),w=new Float32Array(C.duplicate(v,3)),_=C.duplicate(t),x=C.duplicate(e),A=C.duplicate(n,1,-1),S=((t,e=[])=>{let n=0;return t.forEach((t=>{for(let r=0;r<t-1;r++){const t=n+2*r,i=t+1,s=t+2,o=t+3;e.push(t,i,s,s,i,o)}n+=2*(t+2)})),e})(g),I({usage:"dynamic",type:"float",length:w.length*N,data:w}),T({usage:"dynamic",type:"float",length:x.length*N,data:x}),O({usage:"dynamic",type:"float",length:A.length*N,data:A}),D({usage:"dynamic",type:"float",length:_.length*N,data:_}),F({primitive:"triangles",usage:"dynamic",type:S.length>65536?"uint32":"uint16",data:S})})():V()},W=(t,e=-1)=>Array.isArray(t)?t.length&&!Array.isArray(t[0])?e+1:W(t[0],++e):e,Y=()=>{const e=0===W(a)?[a]:a;B=Math.max(2,Math.ceil(Math.sqrt(e.length)));const n=new Uint8Array(B**2*4);e.forEach(((t,e)=>{n[4*e]=Math.min(255,Math.max(0,Math.round(255*t[0]))),n[4*e+1]=Math.min(255,Math.max(0,Math.round(255*t[1]))),n[4*e+2]=Math.min(255,Math.max(0,Math.round(255*t[2]))),n[4*e+3]=Number.isNaN(+t[3])?255:Math.min(255,Math.max(0,Math.round(255*t[3])))})),M=t.texture({data:n,shape:[B,B,4]})};return z(),Y(),i&&i.length>1&&$(i),{clear:V,destroy:R,draw:({projection:t,model:s,view:o}={})=>{t&&(e=t),s&&(n=s),o&&(r=o),i&&i.length>1&&L({projection:e,model:n,view:r})},getPoints:()=>i,setPoints:$,getData:()=>({points:w,widths:A,opacities:x,colorIndices:_}),getBuffer:()=>({points:I,widths:O,opacities:T,colorIndices:D}),getStyle:()=>({color:a,miter:d,width:l}),setStyle:({color:t,opacity:e,miter:n,width:r}={})=>{t&&((t,e=u)=>{a=t,u=e,M&&M.destroy(),Y()})(t,e),n&&(d=n),+r>0&&(l=r)}}},U=t=>t*t*t,j=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,z=t=>--t*t*t+1,V=t=>t,R=t=>t*t,P=t=>t<.5?2*t*t:(4-2*t)*t-1,$=t=>t*(2-t),W=t=>t,Y=(t,e=(t=>t))=>{const n=[];for(let r=0;r<t;r++)n.push(e(r,t));return n},H=(t,e)=>{const n=[];return t.forEach((t=>{n[t]=!0})),e.forEach((t=>{n[t]=!0})),n.reduce(((t,e,n)=>(e&&t.push(n),t)),[])},q=(t,...e)=>(e.forEach((e=>{const n=Object.keys(e).reduce(((t,n)=>(t[n]=Object.getOwnPropertyDescriptor(e,n),t)),{});Object.getOwnPropertySymbols(e).forEach((t=>{const r=Object.getOwnPropertyDescriptor(e,t);r.enumerable&&(n[t]=r)})),Object.defineProperties(t,n)})),t),G=(...t)=>e=>t.reduce(((t,e)=>e(t)),e),K=t=>e=>q({__proto__:{constructor:t}},e),Q=(t,e)=>n=>q(n,{get[t](){return e}}),J=(t,e,n,r)=>Math.sqrt((t-n)**2+(e-r)**2),X=t=>new Worker(window.URL.createObjectURL(new Blob([`(${t.toString()})()`],{type:"text/javascript"}))),Z=(t=1)=>new Promise((e=>{let n=0;const r=()=>requestAnimationFrame((()=>{n++,n<t?r():e()}));r()})),tt=(t,e,n=null)=>{let r,i=0;n=null===n?e:n;const s=(...e)=>{clearTimeout(r),r=setTimeout((()=>{i>0&&(t(...e),i=0)}),n)};let o=!1;const a=(...n)=>{o?(i++,s(...n)):(t(...n),s(...n),o=!0,i=0,setTimeout((()=>{o=!1}),e))};return a.reset=()=>{o=!1},a.cancel=()=>{clearTimeout(r)},a.now=(...e)=>t(...e),a},et=t=>new Promise((e=>setTimeout(e,t)));"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var nt={exports:{}},rt=nt.exports=function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},e=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},n="\n";function r(t){return"undefined"!=typeof atob?atob(t):"base64:"+t}function i(t){var e=new Error("(regl) "+t);throw console.error(e),e}function s(t,e){t||i(e)}function o(t){return t?": "+t:""}function a(t,e,n){t in e||i("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join())}function u(e,n){t(e)||i("invalid parameter type"+o(n)+". must be a typed array")}function c(t,e){switch(e){case"number":return"number"==typeof t;case"object":return"object"==typeof t;case"string":return"string"==typeof t;case"boolean":return"boolean"==typeof t;case"function":return"function"==typeof t;case"undefined":return void 0===t;case"symbol":return"symbol"==typeof t}}function l(t,e,n){c(t,e)||i("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t)}function f(t,e){t>=0&&(0|t)===t||i("invalid parameter type, ("+t+")"+o(e)+". must be a nonnegative integer")}function d(t,e,n){e.indexOf(t)<0&&i("invalid value"+o(n)+". must be one of: "+e)}var h=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function p(t){Object.keys(t).forEach((function(t){h.indexOf(t)<0&&i('invalid regl constructor argument "'+t+'". must be one of '+h)}))}function m(t,e){for(t+="";t.length<e;)t=" "+t;return t}function y(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(t,e){this.number=t,this.line=e,this.errors=[]}function g(t,e,n){this.file=t,this.line=e,this.message=n}function v(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function w(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function _(t,e){var n=t.split("\n"),i=1,s=0,o={unknown:new y,0:new y};o.unknown.name=o[0].name=e||v(),o.unknown.lines.push(new b(0,""));for(var a=0;a<n.length;++a){var u=n[a],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(c[2]);l&&(i=0|l[1],l[2]&&((s=0|l[2])in o||(o[s]=new y)));break;case"define":var f=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);f&&(o[s].name=f[1]?r(f[2]):f[2])}o[s].lines.push(new b(i++,u))}return Object.keys(o).forEach((function(t){var e=o[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),o}function x(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new g(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new g("unknown",0,t))}})),e}function A(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function S(t,e,r,i,o){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var a=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";E(r,"string",u+" shader source must be a string",o);var c=_(r,o),l=x(a);A(c,l),Object.keys(c).forEach((function(t){var e=c[t];if(e.hasErrors){var r=[""],i=[""];s("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){s(m(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),s(t.line+n,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(r){var i=r.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(o){var a=o[1];switch(i=o[2],a){case"assign":a="="}e=Math.max(t.line.indexOf(a,e),0)}else e=0;s(m("| ",6)),s(m("^^^",e+3)+n,"font-weight:bold"),s(m("| ",6)),s(i+n,"font-weight:bold")})),s(m("| ",6)+n)}else s(m(t.number,4)+"|  "),s(t.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function s(t,e){r.push(t),i.push(e||"")}})),s.raise("Error compiling "+u+" shader, "+c[0].name)}}function I(t,e,r,i,o){if(!t.getProgramParameter(e,t.LINK_STATUS)){var a=t.getProgramInfoLog(e),u=_(r,o),c='Error linking program with vertex shader, "'+_(i,o)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+c+n+"%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+n+a),s.raise(c)}}function T(t){t._commandRef=v()}function O(t,e,n,r){function i(t){return t?r.id(t):0}function s(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}T(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var o=t._uniformSet={};s(o,e.static),s(o,e.dynamic);var a=t._attributeSet={};s(a,n.static),s(a,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function M(t,e){var n=w();i(t+" in command "+(e||v())+("unknown"===n?"":" called from "+n))}function B(t,e,n){t||M(e,n||v())}function D(t,e,n,r){t in e||M("unknown parameter ("+t+")"+o(n)+". possible values: "+Object.keys(e).join(),r||v())}function E(t,e,n,r){c(t,e)||M("invalid parameter type"+o(n)+". expected "+e+", got "+typeof t,r||v())}function F(t){t()}function k(t,e,n){t.texture?d(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):d(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var N=33071,C=9728,L=9984,U=9985,j=9986,z=9987,V=5121,R=5122,P=5123,$=5124,W=5125,Y=5126,H=32819,q=32820,G=33635,K=34042,Q=36193,J={};function X(t,e){return t===q||t===H||t===G?2:t===K?4:J[t]*e}function Z(t){return!(t&t-1||!t)}function tt(t,e,n){var r,i=e.width,o=e.height,a=e.channels;s(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),t.wrapS===N&&t.wrapT===N||s(Z(i)&&Z(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==o&&s(t.minFilter!==L&&t.minFilter!==j&&t.minFilter!==U&&t.minFilter!==z,"min filter requires mipmap"):(s(Z(i)&&Z(o),"texture must be a square power of 2 to support mipmapping"),s(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===Y&&(n.extensions.indexOf("oes_texture_float_linear")<0&&s(t.minFilter===C&&t.magFilter===C,"filter not supported, must enable oes_texture_float_linear"),s(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var c=i>>r,l=o>>r;s(e.mipmask&1<<r,"missing mipmap data");var f=u[r];if(s(f.width===c&&f.height===l,"invalid shape for mip images"),s(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed);else if(f.data){var d=Math.ceil(X(f.type,a)*c/f.unpackAlignment)*f.unpackAlignment;s(f.data.byteLength===d*l,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else t.genMipmaps||s(0==(e.mipmask&1<<r),"extra mipmap data");e.compressed&&s(!t.genMipmaps,"mipmap generation for compressed images not supported")}function et(t,e,n,r){var i=t.width,o=t.height,a=t.channels;s(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),s(i===o,"cube map must be square"),s(e.wrapS===N&&e.wrapT===N,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];s(c.width===i&&c.height===o,"inconsistent cube map face shape"),e.genMipmaps&&(s(!c.compressed,"can not generate mipmap for compressed textures"),s(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,f=0;f<16;++f){var d=l[f];if(d){var h=i>>f,p=o>>f;s(c.mipmask&1<<f,"missing mipmap data"),s(d.width===h&&d.height===p,"invalid shape for mip images"),s(d.format===t.format&&d.internalformat===t.internalformat&&d.type===t.type,"incompatible type for mip image"),d.compressed||(d.data?s(d.data.byteLength===h*p*Math.max(X(d.type,a),d.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):d.element||d.copy)}}}}J[5120]=J[V]=1,J[R]=J[P]=J[Q]=J[G]=J[H]=J[q]=2,J[$]=J[W]=J[Y]=J[K]=4;var nt=e(s,{optional:F,raise:i,commandRaise:M,command:B,parameter:a,commandParameter:D,constructor:p,type:l,commandType:E,isTypedArray:u,nni:f,oneOf:d,shaderError:S,linkError:I,callSite:w,saveCommandRef:T,saveDrawInfo:O,framebufferFormat:k,guessCommand:v,texture2D:tt,textureCube:et}),rt=0,it=0,st=5,ot=6;function at(t,e){this.id=rt++,this.type=t,this.data=e}function ut(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ct(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+ut(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return ct(t.substr(0,r.index)).concat(ct(r[1])).concat(ct(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+ut(t)+'"'];for(var s=[],o=0;o<i.length;++o)s=s.concat(ct(i[o]));return s}function lt(t){return"["+ct(t).join("][")+"]"}function ft(t,e){return new at(t,lt(e+""))}function dt(t){return"function"==typeof t&&!t._reglType||t instanceof at}function ht(t,e){return"function"==typeof t?new at(it,t):"number"==typeof t||"boolean"==typeof t?new at(st,t):Array.isArray(t)?new at(ot,t.map((function(t,n){return ht(t,e+"["+n+"]")}))):t instanceof at?t:void nt(!1,"invalid option type in uniform "+e)}var pt={DynamicVariable:at,define:ft,isDynamic:dt,unbox:ht,accessor:lt},mt={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},yt="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function bt(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function gt(t,n,r){var i,s=document.createElement("canvas");function o(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=s.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}s.width=r*e,s.height=r*n}function a(){i?i.disconnect():window.removeEventListener("resize",o),t.removeChild(s)}return e(s.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(s),t===document.body&&(s.style.position="absolute",e(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(o)}))).observe(t):window.addEventListener("resize",o,!1),o(),{canvas:s,onDestroy:a}}function vt(t,e){function n(n){try{return t.getContext(n,e)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function wt(t){return"string"==typeof t.nodeName&&"function"==typeof t.appendChild&&"function"==typeof t.getBoundingClientRect}function _t(t){return"function"==typeof t.drawArrays||"function"==typeof t.drawElements}function xt(t){return"string"==typeof t?t.split():(nt(Array.isArray(t),"invalid extension array"),t)}function At(t){return"string"==typeof t?(nt("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function St(t){var e,n,r,i,s=t||{},o={},a=[],u=[],c="undefined"==typeof window?1:window.devicePixelRatio,l=!1,f=function(t){t&&nt.raise(t)},d=function(){};if("string"==typeof s?(nt("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),e=document.querySelector(s),nt(e,"invalid query string for element")):"object"==typeof s?wt(s)?e=s:_t(s)?r=(i=s).canvas:(nt.constructor(s),"gl"in s?i=s.gl:"canvas"in s?r=At(s.canvas):"container"in s&&(n=At(s.container)),"attributes"in s&&(o=s.attributes,nt.type(o,"object","invalid context attributes")),"extensions"in s&&(a=xt(s.extensions)),"optionalExtensions"in s&&(u=xt(s.optionalExtensions)),"onDone"in s&&(nt.type(s.onDone,"function","invalid or missing onDone callback"),f=s.onDone),"profile"in s&&(l=!!s.profile),"pixelRatio"in s&&(c=+s.pixelRatio,nt(c>0,"invalid pixel ratio"))):nt.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){nt("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var h=gt(n||document.body,f,c);if(!h)return null;r=h.canvas,d=h.onDestroy}void 0===o.premultipliedAlpha&&(o.premultipliedAlpha=!0),i=vt(r,o)}return i?{gl:i,canvas:r,container:n,extensions:a,optionalExtensions:u,pixelRatio:c,profile:l,onDone:f,onDestroy:d}:(d(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function It(t,e){var n={};function r(e){nt.type(e,"string","extension name must be string");var r,i=e.toLowerCase();try{r=n[i]=t.getExtension(i)}catch(s){}return!!r}for(var i=0;i<e.extensions.length;++i){var s=e.extensions[i];if(!r(s))return e.onDestroy(),e.onDone('"'+s+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function Tt(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var Ot=5120,Mt=5121,Bt=5122,Dt=5123,Et=5124,Ft=5125,kt=5126;function Nt(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Ct(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function Lt(){var t=Tt(8,(function(){return[]}));function e(e){var n=Nt(e),r=t[Ct(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[Ct(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case Ot:r=new Int8Array(e(n),0,n);break;case Mt:r=new Uint8Array(e(n),0,n);break;case Bt:r=new Int16Array(e(2*n),0,n);break;case Dt:r=new Uint16Array(e(2*n),0,n);break;case Et:r=new Int32Array(e(4*n),0,n);break;case Ft:r=new Uint32Array(e(4*n),0,n);break;case kt:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var Ut=Lt();Ut.zero=Lt();var jt=3408,zt=3410,Vt=3411,Rt=3412,Pt=3413,$t=3414,Wt=3415,Yt=33901,Ht=33902,qt=3379,Gt=3386,Kt=34921,Qt=36347,Jt=36348,Xt=35661,Zt=35660,te=34930,ee=36349,ne=34076,re=34024,ie=7936,se=7937,oe=7938,ae=35724,ue=34047,ce=36063,le=34852,fe=3553,de=34067,he=34069,pe=33984,me=6408,ye=5126,be=5121,ge=36160,ve=36053,we=36064,_e=16384,xe=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(ue));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(le),i=t.getParameter(ce));var s=!!e.oes_texture_float;if(s){var o=t.createTexture();t.bindTexture(fe,o),t.texImage2D(fe,0,me,1,1,0,me,ye,null);var a=t.createFramebuffer();if(t.bindFramebuffer(ge,a),t.framebufferTexture2D(ge,we,fe,o,0),t.bindTexture(fe,null),t.checkFramebufferStatus(ge)!==ve)s=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(_e);var u=Ut.allocType(ye,4);t.readPixels(0,0,1,1,me,ye,u),t.getError()?s=!1:(t.deleteFramebuffer(a),t.deleteTexture(o),s=1===u[0]),Ut.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=t.createTexture(),f=Ut.allocType(be,36);t.activeTexture(pe),t.bindTexture(de,l),t.texImage2D(he,0,me,3,3,0,me,be,f),Ut.freeType(f),t.bindTexture(de,null),t.deleteTexture(l),c=!t.getError()}return{colorBits:[t.getParameter(zt),t.getParameter(Vt),t.getParameter(Rt),t.getParameter(Pt)],depthBits:t.getParameter($t),stencilBits:t.getParameter(Wt),subpixelBits:t.getParameter(jt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(Yt),lineWidthDims:t.getParameter(Ht),maxViewportDims:t.getParameter(Gt),maxCombinedTextureUnits:t.getParameter(Xt),maxCubeMapSize:t.getParameter(ne),maxRenderbufferSize:t.getParameter(re),maxTextureUnits:t.getParameter(te),maxTextureSize:t.getParameter(qt),maxAttributes:t.getParameter(Kt),maxVertexUniforms:t.getParameter(Qt),maxVertexTextureUnits:t.getParameter(Zt),maxVaryingVectors:t.getParameter(Jt),maxFragmentUniforms:t.getParameter(ee),glsl:t.getParameter(ae),renderer:t.getParameter(se),vendor:t.getParameter(ie),version:t.getParameter(oe),readFloat:s,npotTextureCube:c}};function Ae(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||t(e.data))}var Se=function(t){return Object.keys(t).map((function(e){return t[e]}))},Ie={shape:Ee,flatten:De};function Te(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function Oe(t,e,n,r){for(var i=0,s=0;s<e;++s)for(var o=t[s],a=0;a<n;++a)r[i++]=o[a]}function Me(t,e,n,r,i,s){for(var o=s,a=0;a<e;++a)for(var u=t[a],c=0;c<n;++c)for(var l=u[c],f=0;f<r;++f)i[o++]=l[f]}function Be(t,e,n,r,i){for(var s=1,o=n+1;o<e.length;++o)s*=e[o];var a=e[n];if(e.length-n==4){var u=e[n+1],c=e[n+2],l=e[n+3];for(o=0;o<a;++o)Me(t[o],u,c,l,r,i),i+=s}else for(o=0;o<a;++o)Be(t[o],e,n+1,r,i),i+=s}function De(t,e,n,r){var i=1;if(e.length)for(var s=0;s<e.length;++s)i*=e[s];else i=0;var o=r||Ut.allocType(n,i);switch(e.length){case 0:break;case 1:Te(t,e[0],o);break;case 2:Oe(t,e[0],e[1],o);break;case 3:Me(t,e[0],e[1],e[2],o,0);break;default:Be(t,e,0,o,0)}return o}function Ee(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var Fe={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ke={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Ne={dynamic:35048,stream:35040,static:35044},Ce=Ie.flatten,Le=Ie.shape,Ue=35044,je=35040,ze=5121,Ve=5126,Re=[];function Pe(t){return 0|Fe[Object.prototype.toString.call(t)]}function $e(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function We(t,e,n,r,i,s,o){for(var a=0,u=0;u<n;++u)for(var c=0;c<r;++c)t[a++]=e[i*u+s*c+o]}function Ye(e,n,r,i){var s=0,o={};function a(t){this.id=s++,this.buffer=e.createBuffer(),this.type=t,this.usage=Ue,this.byteLength=0,this.dimension=1,this.dtype=ze,this.persistentData=null,r.profile&&(this.stats={size:0})}a.prototype.bind=function(){e.bindBuffer(this.type,this.buffer)},a.prototype.destroy=function(){h(this)};var u=[];function c(t,e){var n=u.pop();return n||(n=new a(t)),n.bind(),d(n,e,je,0,1,!1),n}function l(t){u.push(t)}function f(t,n,r){t.byteLength=n.byteLength,e.bufferData(t.type,n,r)}function d(e,n,r,i,s,o){var a,u;if(e.usage=r,Array.isArray(n)){if(e.dtype=i||Ve,n.length>0)if(Array.isArray(n[0])){a=Le(n);for(var c=1,l=1;l<a.length;++l)c*=a[l];e.dimension=c,f(e,u=Ce(n,a,e.dtype),r),o?e.persistentData=u:Ut.freeType(u)}else if("number"==typeof n[0]){e.dimension=s;var d=Ut.allocType(e.dtype,n.length);$e(d,n),f(e,d,r),o?e.persistentData=d:Ut.freeType(d)}else t(n[0])?(e.dimension=n[0].length,e.dtype=i||Pe(n[0])||Ve,f(e,u=Ce(n,[n.length,n[0].length],e.dtype),r),o?e.persistentData=u:Ut.freeType(u)):nt.raise("invalid buffer data")}else if(t(n))e.dtype=i||Pe(n),e.dimension=s,f(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Ae(n)){a=n.shape;var h=n.stride,p=n.offset,m=0,y=0,b=0,g=0;1===a.length?(m=a[0],y=1,b=h[0],g=0):2===a.length?(m=a[0],y=a[1],b=h[0],g=h[1]):nt.raise("invalid shape"),e.dtype=i||Pe(n.data)||Ve,e.dimension=y;var v=Ut.allocType(e.dtype,m*y);We(v,n.data,m,y,b,g,p),f(e,v,r),o?e.persistentData=v:Ut.freeType(v)}else n instanceof ArrayBuffer?(e.dtype=ze,e.dimension=s,f(e,n,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(n)))):nt.raise("invalid buffer data")}function h(t){n.bufferCount--,i(t);var r=t.buffer;nt(r,"buffer must not be deleted already"),e.deleteBuffer(r),t.buffer=null,delete o[t.id]}function p(i,s,u,c){n.bufferCount++;var l=new a(s);function f(n){var i=Ue,s=null,o=0,a=0,u=1;return Array.isArray(n)||t(n)||Ae(n)||n instanceof ArrayBuffer?s=n:"number"==typeof n?o=0|n:n&&(nt.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(nt(null===s||Array.isArray(s)||t(s)||Ae(s),"invalid data for buffer"),s=n.data),"usage"in n&&(nt.parameter(n.usage,Ne,"invalid buffer usage"),i=Ne[n.usage]),"type"in n&&(nt.parameter(n.type,ke,"invalid buffer type"),a=ke[n.type]),"dimension"in n&&(nt.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(nt.nni(o,"buffer length must be a nonnegative integer"),o=0|n.length)),l.bind(),s?d(l,s,i,a,u,c):(o&&e.bufferData(l.type,o,i),l.dtype=a||ze,l.usage=i,l.dimension=u,l.byteLength=o),r.profile&&(l.stats.size=l.byteLength*Re[l.dtype]),f}function p(t,n){nt(n+t.byteLength<=l.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+t.byteLength+" starting from offset "+n+" to a buffer of size "+l.byteLength),e.bufferSubData(l.type,n,t)}function m(e,n){var r,i=0|(n||0);if(l.bind(),t(e)||e instanceof ArrayBuffer)p(e,i);else if(Array.isArray(e)){if(e.length>0)if("number"==typeof e[0]){var s=Ut.allocType(l.dtype,e.length);$e(s,e),p(s,i),Ut.freeType(s)}else if(Array.isArray(e[0])||t(e[0])){r=Le(e);var o=Ce(e,r,l.dtype);p(o,i),Ut.freeType(o)}else nt.raise("invalid buffer data")}else if(Ae(e)){r=e.shape;var a=e.stride,u=0,c=0,d=0,h=0;1===r.length?(u=r[0],c=1,d=a[0],h=0):2===r.length?(u=r[0],c=r[1],d=a[0],h=a[1]):nt.raise("invalid shape");var m=Array.isArray(e.data)?l.dtype:Pe(e.data),y=Ut.allocType(m,u*c);We(y,e.data,u,c,d,h,e.offset),p(y,i),Ut.freeType(y)}else nt.raise("invalid data for buffer subdata");return f}return o[l.id]=l,u||f(i),f._reglType="buffer",f._buffer=l,f.subdata=m,r.profile&&(f.stats=l.stats),f.destroy=function(){h(l)},f}function m(){Se(o).forEach((function(t){t.buffer=e.createBuffer(),e.bindBuffer(t.type,t.buffer),e.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(o).forEach((function(e){t+=o[e].stats.size})),t}),{create:p,createStream:c,destroyStream:l,clear:function(){Se(o).forEach(h),u.forEach(h)},getBuffer:function(t){return t&&t._buffer instanceof a?t._buffer:null},restore:m,_initBuffer:d}}Re[5120]=1,Re[5122]=2,Re[5124]=4,Re[5121]=1,Re[5123]=2,Re[5125]=4,Re[5126]=4;var He={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},qe=0,Ge=1,Ke=4,Qe=5120,Je=5121,Xe=5122,Ze=5123,tn=5124,en=5125,nn=34963,rn=35040,sn=35044;function on(e,n,r,i){var s={},o=0,a={uint8:Je,uint16:Ze};function u(t){this.id=o++,s[this.id]=this,this.buffer=t,this.primType=Ke,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(a.uint32=en),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(t){var e=c.pop();return e||(e=new u(r.create(null,nn,!0,!1)._buffer)),d(e,t,rn,-1,-1,0,0),e}function f(t){c.push(t)}function d(i,s,o,a,u,c,l){var f;if(i.buffer.bind(),s){var d=l;l||t(s)&&(!Ae(s)||t(s.data))||(d=n.oes_element_index_uint?en:Ze),r._initBuffer(i.buffer,s,o,d,3)}else e.bufferData(nn,c,o),i.buffer.dtype=f||Je,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=c;if(f=l,!l){switch(i.buffer.dtype){case Je:case Qe:f=Je;break;case Ze:case Xe:f=Ze;break;case en:case tn:f=en;break;default:nt.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,nt(f!==en||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var h=u;h<0&&(h=i.buffer.byteLength,f===Ze?h>>=1:f===en&&(h>>=2)),i.vertCount=h;var p=a;if(a<0){p=Ke;var m=i.buffer.dimension;1===m&&(p=qe),2===m&&(p=Ge),3===m&&(p=Ke)}i.primType=p}function h(t){i.elementsCount--,nt(null!==t.buffer,"must not double destroy elements"),delete s[t.id],t.buffer.destroy(),t.buffer=null}function p(e,n){var s=r.create(null,nn,!0),o=new u(s._buffer);function c(e){if(e)if("number"==typeof e)s(e),o.primType=Ke,o.vertCount=0|e,o.type=Je;else{var n=null,r=sn,i=-1,u=-1,l=0,f=0;Array.isArray(e)||t(e)||Ae(e)?n=e:(nt.type(e,"object","invalid arguments for elements"),"data"in e&&(n=e.data,nt(Array.isArray(n)||t(n)||Ae(n),"invalid data for element buffer")),"usage"in e&&(nt.parameter(e.usage,Ne,"invalid element buffer usage"),r=Ne[e.usage]),"primitive"in e&&(nt.parameter(e.primitive,He,"invalid element buffer primitive"),i=He[e.primitive]),"count"in e&&(nt("number"==typeof e.count&&e.count>=0,"invalid vertex count for elements"),u=0|e.count),"type"in e&&(nt.parameter(e.type,a,"invalid buffer type"),f=a[e.type]),"length"in e?l=0|e.length:(l=u,f===Ze||f===Xe?l*=2:f!==en&&f!==tn||(l*=4))),d(o,n,r,i,u,l,f)}else s(),o.primType=Ke,o.vertCount=0,o.type=Je;return c}return i.elementsCount++,c(e),c._reglType="elements",c._elements=o,c.subdata=function(t,e){return s.subdata(t,e),c},c.destroy=function(){h(o)},c}return{create:p,createStream:l,destroyStream:f,getElements:function(t){return"function"==typeof t&&t._elements instanceof u?t._elements:null},clear:function(){Se(s).forEach(h)}}}var an=new Float32Array(1),un=new Uint32Array(an.buffer),cn=5123;function ln(t){for(var e=Ut.allocType(cn,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{an[0]=t[n];var r=un[0],i=r>>>31<<15,s=(r<<1>>>24)-127,o=r>>13&1023;if(s<-24)e[n]=i;else if(s<-14){var a=-14-s;e[n]=i+(o+1024>>a)}else e[n]=s>15?i+31744:i+(s+15<<10)+o}return e}function fn(e){return Array.isArray(e)||t(e)}var dn=function(t){return!(t&t-1||!t)},hn=34467,pn=3553,mn=34067,yn=34069,bn=6408,gn=6406,vn=6407,wn=6409,_n=6410,xn=32854,An=32855,Sn=36194,In=32819,Tn=32820,On=33635,Mn=34042,Bn=6402,Dn=34041,En=35904,Fn=35906,kn=36193,Nn=33776,Cn=33777,Ln=33778,Un=33779,jn=35986,zn=35987,Vn=34798,Rn=35840,Pn=35841,$n=35842,Wn=35843,Yn=36196,Hn=5121,qn=5123,Gn=5125,Kn=5126,Qn=10242,Jn=10243,Xn=10497,Zn=33071,tr=33648,er=10240,nr=10241,rr=9728,ir=9729,sr=9984,or=9985,ar=9986,ur=9987,cr=33170,lr=4352,fr=4353,dr=4354,hr=34046,pr=3317,mr=37440,yr=37441,br=37443,gr=37444,vr=33984,wr=[sr,ar,or,ur],_r=[0,wn,_n,vn,bn],xr={};function Ar(t){return"[object "+t+"]"}xr[wn]=xr[gn]=xr[Bn]=1,xr[Dn]=xr[_n]=2,xr[vn]=xr[En]=3,xr[bn]=xr[Fn]=4;var Sr=Ar("HTMLCanvasElement"),Ir=Ar("OffscreenCanvas"),Tr=Ar("CanvasRenderingContext2D"),Or=Ar("ImageBitmap"),Mr=Ar("HTMLImageElement"),Br=Ar("HTMLVideoElement"),Dr=Object.keys(Fe).concat([Sr,Ir,Tr,Or,Mr,Br]),Er=[];Er[Hn]=1,Er[Kn]=4,Er[kn]=2,Er[qn]=2,Er[Gn]=4;var Fr=[];function kr(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function Nr(t){return!!Array.isArray(t)&&!(0===t.length||!fn(t[0]))}function Cr(t){return Object.prototype.toString.call(t)}function Lr(t){return Cr(t)===Sr}function Ur(t){return Cr(t)===Ir}function jr(t){return Cr(t)===Tr}function zr(t){return Cr(t)===Or}function Vr(t){return Cr(t)===Mr}function Rr(t){return Cr(t)===Br}function Pr(t){if(!t)return!1;var e=Cr(t);return Dr.indexOf(e)>=0||kr(t)||Nr(t)||Ae(t)}function $r(t){return 0|Fe[Object.prototype.toString.call(t)]}function Wr(t,e){var n=e.length;switch(t.type){case Hn:case qn:case Gn:case Kn:var r=Ut.allocType(t.type,n);r.set(e),t.data=r;break;case kn:t.data=ln(e);break;default:nt.raise("unsupported texture type, must specify a typed array")}}function Yr(t,e){return Ut.allocType(t.type===kn?Kn:t.type,e)}function Hr(t,e){t.type===kn?(t.data=ln(e),Ut.freeType(e)):t.data=e}function qr(t,e,n,r,i,s){for(var o=t.width,a=t.height,u=t.channels,c=Yr(t,o*a*u),l=0,f=0;f<a;++f)for(var d=0;d<o;++d)for(var h=0;h<u;++h)c[l++]=e[n*d+r*f+i*h+s];Hr(t,c)}function Gr(t,e,n,r,i,s){var o;if(o=void 0!==Fr[t]?Fr[t]:xr[t]*Er[e],s&&(o*=6),i){for(var a=0,u=n;u>=1;)a+=o*u*u,u/=2;return a}return o*n*r}function Kr(n,r,i,s,o,a,u){var c={"don't care":lr,"dont care":lr,nice:dr,fast:fr},l={repeat:Xn,clamp:Zn,mirror:tr},f={nearest:rr,linear:ir},d=e({mipmap:ur,"nearest mipmap nearest":sr,"linear mipmap nearest":or,"nearest mipmap linear":ar,"linear mipmap linear":ur},f),h={none:0,browser:gr},p={uint8:Hn,rgba4:In,rgb565:On,"rgb5 a1":Tn},m={alpha:gn,luminance:wn,"luminance alpha":_n,rgb:vn,rgba:bn,rgba4:xn,"rgb5 a1":An,rgb565:Sn},y={};r.ext_srgb&&(m.srgb=En,m.srgba=Fn),r.oes_texture_float&&(p.float32=p.float=Kn),r.oes_texture_half_float&&(p.float16=p["half float"]=kn),r.webgl_depth_texture&&(e(m,{depth:Bn,"depth stencil":Dn}),e(p,{uint16:qn,uint32:Gn,"depth stencil":Mn})),r.webgl_compressed_texture_s3tc&&e(y,{"rgb s3tc dxt1":Nn,"rgba s3tc dxt1":Cn,"rgba s3tc dxt3":Ln,"rgba s3tc dxt5":Un}),r.webgl_compressed_texture_atc&&e(y,{"rgb atc":jn,"rgba atc explicit alpha":zn,"rgba atc interpolated alpha":Vn}),r.webgl_compressed_texture_pvrtc&&e(y,{"rgb pvrtc 4bppv1":Rn,"rgb pvrtc 2bppv1":Pn,"rgba pvrtc 4bppv1":$n,"rgba pvrtc 2bppv1":Wn}),r.webgl_compressed_texture_etc1&&(y["rgb etc1"]=Yn);var b=Array.prototype.slice.call(n.getParameter(hn));Object.keys(y).forEach((function(t){var e=y[t];b.indexOf(e)>=0&&(m[t]=e)}));var g=Object.keys(m);i.textureFormats=g;var v=[];Object.keys(m).forEach((function(t){var e=m[t];v[e]=t}));var w=[];Object.keys(p).forEach((function(t){var e=p[t];w[e]=t}));var _=[];Object.keys(f).forEach((function(t){var e=f[t];_[e]=t}));var x=[];Object.keys(d).forEach((function(t){var e=d[t];x[e]=t}));var A=[];Object.keys(l).forEach((function(t){var e=l[t];A[e]=t}));var S=g.reduce((function(t,e){var n=m[e];return n===wn||n===gn||n===wn||n===_n||n===Bn||n===Dn||r.ext_srgb&&(n===En||n===Fn)?t[n]=n:n===An||e.indexOf("rgba")>=0?t[n]=bn:t[n]=vn,t}),{});function I(){this.internalformat=bn,this.format=bn,this.type=Hn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=gr,this.width=0,this.height=0,this.channels=0}function T(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function O(t,e){if("object"==typeof e&&e){if("premultiplyAlpha"in e&&(nt.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(nt.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(nt.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(nt.parameter(e.colorSpace,h,"invalid colorSpace"),t.colorSpace=h[e.colorSpace]),"type"in e){var n=e.type;nt(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),nt(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),nt(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(n,p,"invalid texture type"),t.type=p[n]}var s=t.width,o=t.height,a=t.channels,u=!1;"shape"in e?(nt(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),s=e.shape[0],o=e.shape[1],3===e.shape.length&&(a=e.shape[2],nt(a>0&&a<=4,"invalid number of channels"),u=!0),nt(s>=0&&s<=i.maxTextureSize,"invalid width"),nt(o>=0&&o<=i.maxTextureSize,"invalid height")):("radius"in e&&(s=o=e.radius,nt(s>=0&&s<=i.maxTextureSize,"invalid radius")),"width"in e&&(s=e.width,nt(s>=0&&s<=i.maxTextureSize,"invalid width")),"height"in e&&(o=e.height,nt(o>=0&&o<=i.maxTextureSize,"invalid height")),"channels"in e&&(a=e.channels,nt(a>0&&a<=4,"invalid number of channels"),u=!0)),t.width=0|s,t.height=0|o,t.channels=0|a;var c=!1;if("format"in e){var l=e.format;nt(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),nt.parameter(l,m,"invalid texture format");var f=t.internalformat=m[l];t.format=S[f],l in p&&("type"in e||(t.type=p[l])),l in y&&(t.compressed=!0),c=!0}!u&&c?t.channels=xr[t.format]:u&&!c?t.channels!==_r[t.format]&&(t.format=t.internalformat=_r[t.channels]):c&&u&&nt(t.channels===xr[t.format],"number of channels inconsistent with specified format")}}function M(t){n.pixelStorei(mr,t.flipY),n.pixelStorei(yr,t.premultiplyAlpha),n.pixelStorei(br,t.colorSpace),n.pixelStorei(pr,t.unpackAlignment)}function B(){I.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function D(e,n){var r=null;if(Pr(n)?r=n:n&&(nt.type(n,"object","invalid pixel data type"),O(e,n),"x"in n&&(e.xOffset=0|n.x),"y"in n&&(e.yOffset=0|n.y),Pr(n.data)&&(r=n.data)),nt(!e.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){nt(!r,"can not specify copy and data field for the same texture");var s=o.viewportWidth,a=o.viewportHeight;e.width=e.width||s-e.xOffset,e.height=e.height||a-e.yOffset,e.needsCopy=!0,nt(e.xOffset>=0&&e.xOffset<s&&e.yOffset>=0&&e.yOffset<a&&e.width>0&&e.width<=s&&e.height>0&&e.height<=a,"copy texture read out of bounds")}else if(r){if(t(r))e.channels=e.channels||4,e.data=r,"type"in n||e.type!==Hn||(e.type=$r(r));else if(kr(r))e.channels=e.channels||4,Wr(e,r),e.alignment=1,e.needsFree=!0;else if(Ae(r)){var u=r.data;Array.isArray(u)||e.type!==Hn||(e.type=$r(u));var c,l,f,d,h,p,m=r.shape,y=r.stride;3===m.length?(f=m[2],p=y[2]):(nt(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,p=1),c=m[0],l=m[1],d=y[0],h=y[1],e.alignment=1,e.width=c,e.height=l,e.channels=f,e.format=e.internalformat=_r[f],e.needsFree=!0,qr(e,u,d,h,p,r.offset)}else if(Lr(r)||Ur(r)||jr(r))Lr(r)||Ur(r)?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(zr(r))e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(Vr(r))e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(Rr(r))e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(Nr(r)){var b=e.width||r[0].length,g=e.height||r.length,v=e.channels;v=fn(r[0][0])?v||r[0][0].length:v||1;for(var w=Ie.shape(r),_=1,x=0;x<w.length;++x)_*=w[x];var A=Yr(e,_);Ie.flatten(r,w,"",A),Hr(e,A),e.alignment=1,e.width=b,e.height=g,e.channels=v,e.format=e.internalformat=_r[v],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4;e.type===Kn?nt(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):e.type===kn&&nt(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function E(t,e,r){var i=t.element,o=t.data,a=t.internalformat,u=t.format,c=t.type,l=t.width,f=t.height;M(t),i?n.texImage2D(e,r,u,u,c,i):t.compressed?n.compressedTexImage2D(e,r,a,l,f,0,o):t.needsCopy?(s(),n.copyTexImage2D(e,r,u,t.xOffset,t.yOffset,l,f,0)):n.texImage2D(e,r,u,l,f,0,u,c,o||null)}function F(t,e,r,i,o){var a=t.element,u=t.data,c=t.internalformat,l=t.format,f=t.type,d=t.width,h=t.height;M(t),a?n.texSubImage2D(e,o,r,i,l,f,a):t.compressed?n.compressedTexSubImage2D(e,o,r,i,c,d,h,u):t.needsCopy?(s(),n.copyTexSubImage2D(e,o,r,i,t.xOffset,t.yOffset,d,h)):n.texSubImage2D(e,o,r,i,d,h,l,f,u)}var k=[];function N(){return k.pop()||new B}function C(t){t.needsFree&&Ut.freeType(t.data),B.call(t),k.push(t)}function L(){I.call(this),this.genMipmaps=!1,this.mipmapHint=lr,this.mipmask=0,this.images=Array(16)}function U(t,e,n){var r=t.images[0]=N();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function j(t,e){var n=null;if(Pr(e))T(n=t.images[0]=N(),t),D(n,e),t.mipmask=1;else if(O(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)T(n=t.images[i]=N(),t),n.width>>=i,n.height>>=i,D(n,r[i]),t.mipmask|=1<<i;else T(n=t.images[0]=N(),t),D(n,e),t.mipmask=1;T(t,t.images[0]),!t.compressed||t.internalformat!==Nn&&t.internalformat!==Cn&&t.internalformat!==Ln&&t.internalformat!==Un||nt(t.width%4==0&&t.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function z(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;E(n[r],e,r)}}var V=[];function R(){var t=V.pop()||new L;I.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function P(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&C(e[n]),e[n]=null;V.push(t)}function $(){this.minFilter=rr,this.magFilter=rr,this.wrapS=Zn,this.wrapT=Zn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=lr}function W(t,e){if("min"in e){var n=e.min;nt.parameter(n,d),t.minFilter=d[n],wr.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;nt.parameter(r,f),t.magFilter=f[r]}var s=t.wrapS,o=t.wrapT;if("wrap"in e){var a=e.wrap;"string"==typeof a?(nt.parameter(a,l),s=o=l[a]):Array.isArray(a)&&(nt.parameter(a[0],l),nt.parameter(a[1],l),s=l[a[0]],o=l[a[1]])}else{if("wrapS"in e){var u=e.wrapS;nt.parameter(u,l),s=l[u]}if("wrapT"in e){var h=e.wrapT;nt.parameter(h,l),o=l[h]}}if(t.wrapS=s,t.wrapT=o,"anisotropic"in e){var p=e.anisotropic;nt("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var m=!1;switch(typeof e.mipmap){case"string":nt.parameter(e.mipmap,c,"invalid mipmap hint"),t.mipmapHint=c[e.mipmap],t.genMipmaps=!0,m=!0;break;case"boolean":m=t.genMipmaps=e.mipmap;break;case"object":nt(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,m=!0;break;default:nt.raise("invalid mipmap type")}m&&!("min"in e)&&(t.minFilter=sr)}}function Y(t,e){n.texParameteri(e,nr,t.minFilter),n.texParameteri(e,er,t.magFilter),n.texParameteri(e,Qn,t.wrapS),n.texParameteri(e,Jn,t.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(e,hr,t.anisotropic),t.genMipmaps&&(n.hint(cr,t.mipmapHint),n.generateMipmap(e))}var H=0,q={},G=i.maxTextureUnits,K=Array(G).map((function(){return null}));function Q(t){I.call(this),this.mipmask=0,this.internalformat=bn,this.id=H++,this.refCount=1,this.target=t,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new $,u.profile&&(this.stats={size:0})}function J(t){n.activeTexture(vr),n.bindTexture(t.target,t.texture)}function X(){var t=K[0];t?n.bindTexture(t.target,t.texture):n.bindTexture(pn,null)}function Z(t){var e=t.texture;nt(e,"must not double destroy texture");var r=t.unit,i=t.target;r>=0&&(n.activeTexture(vr+r),n.bindTexture(i,null),K[r]=null),n.deleteTexture(e),t.texture=null,t.params=null,t.pixels=null,t.refCount=0,delete q[t.id],a.textureCount--}function tt(t,e){var r=new Q(pn);function s(t,e){var n=r.texInfo;$.call(n);var o=R();return"number"==typeof t?U(o,0|t,"number"==typeof e?0|e:0|t):t?(nt.type(t,"object","invalid arguments to regl.texture"),W(n,t),j(o,t)):U(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,T(r,o),nt.texture2D(n,o,i),r.internalformat=o.internalformat,s.width=o.width,s.height=o.height,J(r),z(o,pn),Y(n,pn),X(),P(o),u.profile&&(r.stats.size=Gr(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),s.format=v[r.internalformat],s.type=w[r.type],s.mag=_[n.magFilter],s.min=x[n.minFilter],s.wrapS=A[n.wrapS],s.wrapT=A[n.wrapT],s}function o(t,e,n,i){nt(!!t,"must specify image data");var o=0|e,a=0|n,u=0|i,c=N();return T(c,r),c.width=0,c.height=0,D(c,t),c.width=c.width||(r.width>>u)-o,c.height=c.height||(r.height>>u)-a,nt(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),nt(o>=0&&a>=0&&o+c.width<=r.width&&a+c.height<=r.height,"texture.subimage write out of bounds"),nt(r.mipmask&1<<u,"missing mipmap data"),nt(c.data||c.element||c.needsCopy,"missing image data"),J(r),F(c,pn,o,a,u),X(),C(c),s}function c(t,e){var i=0|t,o=0|e||i;if(i===r.width&&o===r.height)return s;s.width=r.width=i,s.height=r.height=o,J(r);for(var a=0;r.mipmask>>a;++a){var c=i>>a,l=o>>a;if(!c||!l)break;n.texImage2D(pn,a,r.format,c,l,0,r.format,r.type,null)}return X(),u.profile&&(r.stats.size=Gr(r.internalformat,r.type,i,o,!1,!1)),s}return q[r.id]=r,a.textureCount++,s(t,e),s.subimage=o,s.resize=c,s._reglType="texture2d",s._texture=r,u.profile&&(s.stats=r.stats),s.destroy=function(){r.decRef()},s}function et(t,e,r,s,o,c){var l=new Q(mn);q[l.id]=l,a.cubeCount++;var f=new Array(6);function d(t,e,n,r,s,o){var a,c=l.texInfo;for($.call(c),a=0;a<6;++a)f[a]=R();if("number"!=typeof t&&t)if("object"==typeof t)if(e)j(f[0],t),j(f[1],e),j(f[2],n),j(f[3],r),j(f[4],s),j(f[5],o);else if(W(c,t),O(l,t),"faces"in t){var h=t.faces;for(nt(Array.isArray(h)&&6===h.length,"cube faces must be a length 6 array"),a=0;a<6;++a)nt("object"==typeof h[a]&&!!h[a],"invalid input for cube map face"),T(f[a],l),j(f[a],h[a])}else for(a=0;a<6;++a)j(f[a],t);else nt.raise("invalid arguments to cube map");else{var p=0|t||1;for(a=0;a<6;++a)U(f[a],p,p)}for(T(l,f[0]),nt.optional((function(){i.npotTextureCube||nt(dn(l.width)&&dn(l.height),"your browser does not support non power or two texture dimensions")})),c.genMipmaps?l.mipmask=(f[0].width<<1)-1:l.mipmask=f[0].mipmask,nt.textureCube(l,c,f,i),l.internalformat=f[0].internalformat,d.width=f[0].width,d.height=f[0].height,J(l),a=0;a<6;++a)z(f[a],yn+a);for(Y(c,mn),X(),u.profile&&(l.stats.size=Gr(l.internalformat,l.type,d.width,d.height,c.genMipmaps,!0)),d.format=v[l.internalformat],d.type=w[l.type],d.mag=_[c.magFilter],d.min=x[c.minFilter],d.wrapS=A[c.wrapS],d.wrapT=A[c.wrapT],a=0;a<6;++a)P(f[a]);return d}function h(t,e,n,r,i){nt(!!e,"must specify image data"),nt("number"==typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var s=0|n,o=0|r,a=0|i,u=N();return T(u,l),u.width=0,u.height=0,D(u,e),u.width=u.width||(l.width>>a)-s,u.height=u.height||(l.height>>a)-o,nt(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),nt(s>=0&&o>=0&&s+u.width<=l.width&&o+u.height<=l.height,"texture.subimage write out of bounds"),nt(l.mipmask&1<<a,"missing mipmap data"),nt(u.data||u.element||u.needsCopy,"missing image data"),J(l),F(u,yn+t,s,o,a),X(),C(u),d}function p(t){var e=0|t;if(e!==l.width){d.width=l.width=e,d.height=l.height=e,J(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(yn+r,i,l.format,e>>i,e>>i,0,l.format,l.type,null);return X(),u.profile&&(l.stats.size=Gr(l.internalformat,l.type,d.width,d.height,!1,!0)),d}}return d(t,e,r,s,o,c),d.subimage=h,d.resize=p,d._reglType="textureCube",d._texture=l,u.profile&&(d.stats=l.stats),d.destroy=function(){l.decRef()},d}function rt(){for(var t=0;t<G;++t)n.activeTexture(vr+t),n.bindTexture(pn,null),K[t]=null;Se(q).forEach(Z),a.cubeCount=0,a.textureCount=0}function it(){for(var t=0;t<G;++t){var e=K[t];e&&(e.bindCount=0,e.unit=-1,K[t]=null)}Se(q).forEach((function(t){t.texture=n.createTexture(),n.bindTexture(t.target,t.texture);for(var e=0;e<32;++e)if(0!=(t.mipmask&1<<e))if(t.target===pn)n.texImage2D(pn,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);else for(var r=0;r<6;++r)n.texImage2D(yn+r,e,t.internalformat,t.width>>e,t.height>>e,0,t.internalformat,t.type,null);Y(t.texInfo,t.target)}))}function st(){for(var t=0;t<G;++t){var e=K[t];e&&(e.bindCount=0,e.unit=-1,K[t]=null),n.activeTexture(vr+t),n.bindTexture(pn,null),n.bindTexture(mn,null)}}return e(Q.prototype,{bind:function(){var t=this;t.bindCount+=1;var e=t.unit;if(e<0){for(var r=0;r<G;++r){var i=K[r];if(i){if(i.bindCount>0)continue;i.unit=-1}K[r]=t,e=r;break}e>=G&&nt.raise("insufficient number of texture units"),u.profile&&a.maxTextureUnits<e+1&&(a.maxTextureUnits=e+1),t.unit=e,n.activeTexture(vr+e),n.bindTexture(t.target,t.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Z(this)}}),u.profile&&(a.getTotalTextureSize=function(){var t=0;return Object.keys(q).forEach((function(e){t+=q[e].stats.size})),t}),{create2D:tt,createCube:et,clear:rt,getTexture:function(t){return null},restore:it,refresh:st}}Fr[xn]=2,Fr[An]=2,Fr[Sn]=2,Fr[Dn]=4,Fr[Nn]=.5,Fr[Cn]=.5,Fr[Ln]=1,Fr[Un]=1,Fr[jn]=.5,Fr[zn]=1,Fr[Vn]=1,Fr[Rn]=.5,Fr[Pn]=.25,Fr[$n]=.5,Fr[Wn]=.25,Fr[Yn]=.5;var Qr=36161,Jr=32854,Xr=32855,Zr=36194,ti=33189,ei=36168,ni=34041,ri=35907,ii=34836,si=34842,oi=34843,ai=[];function ui(t,e,n){return ai[t]*e*n}ai[Jr]=2,ai[Xr]=2,ai[Zr]=2,ai[ti]=2,ai[ei]=1,ai[ni]=4,ai[ri]=4,ai[ii]=16,ai[si]=8,ai[oi]=6;var ci=function(t,e,n,r,i){var s={rgba4:Jr,rgb565:Zr,"rgb5 a1":Xr,depth:ti,stencil:ei,"depth stencil":ni};e.ext_srgb&&(s.srgba=ri),e.ext_color_buffer_half_float&&(s.rgba16f=si,s.rgb16f=oi),e.webgl_color_buffer_float&&(s.rgba32f=ii);var o=[];Object.keys(s).forEach((function(t){var e=s[t];o[e]=t}));var a=0,u={};function c(t){this.id=a++,this.refCount=1,this.renderbuffer=t,this.format=Jr,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(e){var n=e.renderbuffer;nt(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(Qr,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],r.renderbufferCount--}function f(e,a){var l=new c(t.createRenderbuffer());function f(e,r){var a=0,u=0,c=Jr;if("object"==typeof e&&e){var d=e;if("shape"in d){var h=d.shape;nt(Array.isArray(h)&&h.length>=2,"invalid renderbuffer shape"),a=0|h[0],u=0|h[1]}else"radius"in d&&(a=u=0|d.radius),"width"in d&&(a=0|d.width),"height"in d&&(u=0|d.height);"format"in d&&(nt.parameter(d.format,s,"invalid renderbuffer format"),c=s[d.format])}else"number"==typeof e?(a=0|e,u="number"==typeof r?0|r:a):e?nt.raise("invalid arguments to renderbuffer constructor"):a=u=1;if(nt(a>0&&u>0&&a<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),a!==l.width||u!==l.height||c!==l.format)return f.width=l.width=a,f.height=l.height=u,l.format=c,t.bindRenderbuffer(Qr,l.renderbuffer),t.renderbufferStorage(Qr,c,a,u),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=ui(l.format,l.width,l.height)),f.format=o[l.format],f}function d(e,r){var s=0|e,o=0|r||s;return s===l.width&&o===l.height||(nt(s>0&&o>0&&s<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=l.width=s,f.height=l.height=o,t.bindRenderbuffer(Qr,l.renderbuffer),t.renderbufferStorage(Qr,l.format,s,o),nt(0===t.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=ui(l.format,l.width,l.height))),f}return u[l.id]=l,r.renderbufferCount++,f(e,a),f.resize=d,f._reglType="renderbuffer",f._renderbuffer=l,i.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f}function d(){Se(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(Qr,e.renderbuffer),t.renderbufferStorage(Qr,e.format,e.width,e.height)})),t.bindRenderbuffer(Qr,null)}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:f,clear:function(){Se(u).forEach(l)},restore:d}},li=36160,fi=36161,di=3553,hi=34069,pi=36064,mi=36096,yi=36128,bi=33306,gi=36053,vi=36054,wi=36055,_i=36057,xi=36061,Ai=36193,Si=5121,Ii=5126,Ti=6407,Oi=6408,Mi=6402,Bi=[Ti,Oi],Di=[];Di[Oi]=4,Di[Ti]=3;var Ei=[];Ei[Si]=1,Ei[Ii]=4,Ei[Ai]=2;var Fi=33189,ki=36168,Ni=34041,Ci=[32854,32855,36194,35907,34842,34843,34836],Li={};function Ui(t,n,r,i,s,o){var a={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function f(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function d(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function h(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),s=Math.max(1,r.height);nt(i===e&&s===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var o=t.renderbuffer._renderbuffer;nt(o.width===e&&o.height===n,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function p(e,n){n&&(n.texture?t.framebufferTexture2D(li,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(li,e,fi,n.renderbuffer._renderbuffer.renderbuffer))}function m(t){var e=di,n=null,r=null,i=t;"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),nt.type(i,"function","invalid attachment data");var s=i._reglType;return"texture2d"===s?(n=i,nt(e===di)):"textureCube"===s?(n=i,nt(e>=hi&&e<hi+6,"invalid cube map target")):"renderbuffer"===s?(r=i,e=fi):nt.raise("invalid regl object for attachment"),new f(e,n,r)}function y(t,e,n,r,o){if(n){var a=i.create2D({width:t,height:e,format:r,type:o});return a._texture.refCount=0,new f(di,a,null)}var u=s.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new f(fi,null,u)}function b(t){return t&&(t.texture||t.renderbuffer)}function g(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var v=0,w={};function _(){this.id=v++,w[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function x(t){t.colorAttachments.forEach(d),d(t.depthAttachment),d(t.stencilAttachment),d(t.depthStencilAttachment)}function A(e){var n=e.framebuffer;nt(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,o.framebufferCount--,delete w[e.id]}function S(e){var n;t.bindFramebuffer(li,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)p(pi+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(li,pi+n,di,null,0);t.framebufferTexture2D(li,bi,di,null,0),t.framebufferTexture2D(li,mi,di,null,0),t.framebufferTexture2D(li,yi,di,null,0),p(mi,e.depthAttachment),p(yi,e.stencilAttachment),p(bi,e.depthStencilAttachment);var s=t.checkFramebufferStatus(li);t.isContextLost()||s===gi||nt.raise("framebuffer configuration not supported, status = "+Li[s]),t.bindFramebuffer(li,a.next?a.next.framebuffer:null),a.cur=a.next,t.getError()}function I(t,i){var s=new _;function f(t,e){var i;nt(a.next!==s,"can not update framebuffer which is currently in use");var o=0,d=0,p=!0,g=!0,v=null,w=!0,_="rgba",A="uint8",I=1,T=null,O=null,M=null,B=!1;if("number"==typeof t)o=0|t,d=0|e||o;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var D=t;if("shape"in D){var E=D.shape;nt(Array.isArray(E)&&E.length>=2,"invalid shape for framebuffer"),o=E[0],d=E[1]}else"radius"in D&&(o=d=D.radius),"width"in D&&(o=D.width),"height"in D&&(d=D.height);("color"in D||"colors"in D)&&(v=D.color||D.colors,Array.isArray(v)&&nt(1===v.length||n.webgl_draw_buffers,"multiple render targets not supported")),v||("colorCount"in D&&(I=0|D.colorCount,nt(I>0,"invalid color buffer count")),"colorTexture"in D&&(w=!!D.colorTexture,_="rgba4"),"colorType"in D&&(A=D.colorType,w?(nt(n.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),nt(n.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(nt(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==A&&"float32"!==A||(nt(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),nt.oneOf(A,l,"invalid color type")),"colorFormat"in D&&(_=D.colorFormat,u.indexOf(_)>=0?w=!0:c.indexOf(_)>=0?w=!1:nt.optional((function(){w?nt.oneOf(D.colorFormat,u,"invalid color format for texture"):nt.oneOf(D.colorFormat,c,"invalid color format for renderbuffer")})))),("depthTexture"in D||"depthStencilTexture"in D)&&(B=!(!D.depthTexture&&!D.depthStencilTexture),nt(!B||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in D&&("boolean"==typeof D.depth?p=D.depth:(T=D.depth,g=!1)),"stencil"in D&&("boolean"==typeof D.stencil?g=D.stencil:(O=D.stencil,p=!1)),"depthStencil"in D&&("boolean"==typeof D.depthStencil?p=g=D.depthStencil:(M=D.depthStencil,p=!1,g=!1))}else o=d=1;var F=null,k=null,N=null,C=null;if(Array.isArray(v))F=v.map(m);else if(v)F=[m(v)];else for(F=new Array(I),i=0;i<I;++i)F[i]=y(o,d,w,_,A);nt(n.webgl_draw_buffers||F.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),nt(F.length<=r.maxColorAttachments,"too many color attachments, not supported"),o=o||F[0].width,d=d||F[0].height,T?k=m(T):p&&!g&&(k=y(o,d,B,"depth","uint32")),O?N=m(O):g&&!p&&(N=y(o,d,!1,"stencil","uint8")),M?C=m(M):!T&&!O&&g&&p&&(C=y(o,d,B,"depth stencil","depth stencil")),nt(!!T+!!O+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var L=null;for(i=0;i<F.length;++i)if(h(F[i],o,d),nt(!F[i]||F[i].texture&&Bi.indexOf(F[i].texture._texture.format)>=0||F[i].renderbuffer&&Ci.indexOf(F[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),F[i]&&F[i].texture){var U=Di[F[i].texture._texture.format]*Ei[F[i].texture._texture.type];null===L?L=U:nt(L===U,"all color attachments much have the same number of bits per pixel.")}return h(k,o,d),nt(!k||k.texture&&k.texture._texture.format===Mi||k.renderbuffer&&k.renderbuffer._renderbuffer.format===Fi,"invalid depth attachment for framebuffer object"),h(N,o,d),nt(!N||N.renderbuffer&&N.renderbuffer._renderbuffer.format===ki,"invalid stencil attachment for framebuffer object"),h(C,o,d),nt(!C||C.texture&&C.texture._texture.format===Ni||C.renderbuffer&&C.renderbuffer._renderbuffer.format===Ni,"invalid depth-stencil attachment for framebuffer object"),x(s),s.width=o,s.height=d,s.colorAttachments=F,s.depthAttachment=k,s.stencilAttachment=N,s.depthStencilAttachment=C,f.color=F.map(b),f.depth=b(k),f.stencil=b(N),f.depthStencil=b(C),f.width=s.width,f.height=s.height,S(s),f}function d(t,e){nt(a.next!==s,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===s.width&&r===s.height)return f;for(var i=s.colorAttachments,o=0;o<i.length;++o)g(i[o],n,r);return g(s.depthAttachment,n,r),g(s.stencilAttachment,n,r),g(s.depthStencilAttachment,n,r),s.width=f.width=n,s.height=f.height=r,S(s),f}return o.framebufferCount++,f(t,i),e(f,{resize:d,_reglType:"framebuffer",_framebuffer:s,destroy:function(){A(s),x(s)},use:function(t){a.setFBO({framebuffer:f},t)}})}function T(t){var s=Array(6);function o(t){var r;nt(s.indexOf(a.next)<0,"can not update framebuffer which is currently in use");var c,f={color:null},d=0,h=null,p="rgba",m="uint8",y=1;if("number"==typeof t)d=0|t;else if(t){nt.type(t,"object","invalid arguments for framebuffer");var b=t;if("shape"in b){var g=b.shape;nt(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),nt(g[0]===g[1],"cube framebuffer must be square"),d=g[0]}else"radius"in b&&(d=0|b.radius),"width"in b?(d=0|b.width,"height"in b&&nt(b.height===d,"must be square")):"height"in b&&(d=0|b.height);("color"in b||"colors"in b)&&(h=b.color||b.colors,Array.isArray(h)&&nt(1===h.length||n.webgl_draw_buffers,"multiple render targets not supported")),h||("colorCount"in b&&(y=0|b.colorCount,nt(y>0,"invalid color buffer count")),"colorType"in b&&(nt.oneOf(b.colorType,l,"invalid color type"),m=b.colorType),"colorFormat"in b&&(p=b.colorFormat,nt.oneOf(b.colorFormat,u,"invalid color format for texture"))),"depth"in b&&(f.depth=b.depth),"stencil"in b&&(f.stencil=b.stencil),"depthStencil"in b&&(f.depthStencil=b.depthStencil)}else d=1;if(h)if(Array.isArray(h))for(c=[],r=0;r<h.length;++r)c[r]=h[r];else c=[h];else{c=Array(y);var v={radius:d,format:p,type:m};for(r=0;r<y;++r)c[r]=i.createCube(v)}for(f.color=Array(c.length),r=0;r<c.length;++r){var w=c[r];nt("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),d=d||w.width,nt(w.width===d&&w.height===d,"invalid cube map shape"),f.color[r]={target:hi,data:c[r]}}for(r=0;r<6;++r){for(var _=0;_<c.length;++_)f.color[_].target=hi+r;r>0&&(f.depth=s[0].depth,f.stencil=s[0].stencil,f.depthStencil=s[0].depthStencil),s[r]?s[r](f):s[r]=I(f)}return e(o,{width:d,height:d,color:c})}function c(t){var e,n=0|t;if(nt(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===o.width)return o;var i=o.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)s[e].resize(n);return o.width=o.height=n,o}return o(t),e(o,{faces:s,resize:c,_reglType:"framebufferCube",destroy:function(){s.forEach((function(t){t.destroy()}))}})}function O(){a.cur=null,a.next=null,a.dirty=!0,Se(w).forEach((function(e){e.framebuffer=t.createFramebuffer(),S(e)}))}return e(a,{getFramebuffer:function(t){if("function"==typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof _)return e}return null},create:I,createCube:T,clear:function(){Se(w).forEach(A)},restore:O})}Li[gi]="complete",Li[vi]="incomplete attachment",Li[_i]="incomplete dimensions",Li[wi]="incomplete, missing attachment",Li[xi]="unsupported";var ji=5126,zi=34962,Vi=34963,Ri=["attributes","elements","offset","count","primitive","instances"];function Pi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ji,this.offset=0,this.stride=0,this.divisor=0}function $i(e,n,r,i,s,o,a){for(var u=r.maxAttributes,c=new Array(u),l=0;l<u;++l)c[l]=new Pi;var f=0,d={},h={Record:Pi,scope:{},state:c,currentVAO:null,targetVAO:null,restore:m()?x:function(){},createVAO:A,getVAO:b,destroyBuffer:p,setVAO:m()?g:v,clear:m()?w:function(){}};function p(t){for(var n=0;n<c.length;++n){var r=c[n];r.buffer===t&&(e.disableVertexAttribArray(n),r.buffer=null)}}function m(){return n.oes_vertex_array_object}function y(){return n.angle_instanced_arrays}function b(t){return"function"==typeof t&&t._vao?t._vao:null}function g(t){if(t!==h.currentVAO){var e=m();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),h.currentVAO=t}}function v(t){if(t!==h.currentVAO){if(t)t.bindAttrs();else{for(var n=y(),r=0;r<c.length;++r){var i=c[r];i.buffer?(e.enableVertexAttribArray(r),i.buffer.bind(),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}a.elements?e.bindBuffer(Vi,a.elements.buffer.buffer):e.bindBuffer(Vi,null)}h.currentVAO=t}}function w(){Se(d).forEach((function(t){t.destroy()}))}function _(){this.id=++f,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=m();this.vao=t?t.createVertexArrayOES():null,d[this.id]=this,this.buffers=[]}function x(){m()&&Se(d).forEach((function(t){t.refresh()}))}function A(e){var r=new _;function a(e){var i;if(Array.isArray(e))i=e,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(nt("object"==typeof e,"invalid arguments for create vao"),nt("attributes"in e,"must specify attributes for vao"),e.elements){var c=e.elements;r.ownsElements?"function"==typeof c&&"elements"===c._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(c),r.ownsElements=!1):o.getElements(e.elements)?(r.elements=e.elements,r.ownsElements=!1):(r.elements=o.create(e.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=e.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in e&&(r.offset=0|e.offset),"count"in e&&(r.count=0|e.count),"instances"in e&&(r.instances=0|e.instances),"primitive"in e&&(nt(e.primitive in He,"bad primitive type: "+e.primitive),r.primitive=He[e.primitive]),nt.optional((()=>{for(var t=Object.keys(e),n=0;n<t.length;++n)nt(Ri.indexOf(t[n])>=0,'invalid option for vao: "'+t[n]+'" valid options are '+Ri)})),nt(Array.isArray(i),"attributes must be an array")}nt(i.length<u,"too many attributes"),nt(i.length>0,"must specify at least one attribute");var l={},f=r.attributes;f.length=i.length;for(var d=0;d<i.length;++d){var h,p=i[d],m=f[d]=new Pi,y=p.data||p;Array.isArray(y)||t(y)||Ae(y)?(r.buffers[d]&&(h=r.buffers[d],t(y)&&h._buffer.byteLength>=y.byteLength?h.subdata(y):(h.destroy(),r.buffers[d]=null)),r.buffers[d]||(h=r.buffers[d]=s.create(p,zi,!1,!0)),m.buffer=s.getBuffer(h),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1,l[d]=1):s.getBuffer(p)?(m.buffer=s.getBuffer(p),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1):s.getBuffer(p.buffer)?(m.buffer=s.getBuffer(p.buffer),m.size=0|(+p.size||m.buffer.dimension),m.normalized=!!p.normalized||!1,"type"in p?(nt.parameter(p.type,ke,"invalid buffer type"),m.type=ke[p.type]):m.type=m.buffer.dtype,m.offset=0|(p.offset||0),m.stride=0|(p.stride||0),m.divisor=0|(p.divisor||0),m.state=1,nt(m.size>=1&&m.size<=4,"size must be between 1 and 4"),nt(m.offset>=0,"invalid offset"),nt(m.stride>=0&&m.stride<=255,"stride must be between 0 and 255"),nt(m.divisor>=0,"divisor must be positive"),nt(!m.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in p?(nt(d>0,"first attribute must not be a constant"),m.x=+p.x||0,m.y=+p.y||0,m.z=+p.z||0,m.w=+p.w||0,m.state=2):nt(!1,"invalid attribute spec for location "+d)}for(var b=0;b<r.buffers.length;++b)!l[b]&&r.buffers[b]&&(r.buffers[b].destroy(),r.buffers[b]=null);return r.refresh(),a}return i.vaoCount+=1,a.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},a._vao=r,a._reglType="vao",a(e)}return _.prototype.bindAttrs=function(){for(var t=y(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(e.enableVertexAttribArray(r),e.bindBuffer(zi,i.buffer.buffer),e.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),t&&i.divisor&&t.vertexAttribDivisorANGLE(r,i.divisor)):(e.disableVertexAttribArray(r),e.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var s=n.length;s<u;++s)e.disableVertexAttribArray(s);var a=o.getElements(this.elements);a?e.bindBuffer(Vi,a.buffer.buffer):e.bindBuffer(Vi,null)},_.prototype.refresh=function(){var t=m();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=null,t.bindVertexArrayOES(null))},_.prototype.destroy=function(){if(this.vao){var t=m();this===h.currentVAO&&(h.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),d[this.id]&&(delete d[this.id],i.vaoCount-=1)},h}var Wi=35632,Yi=35633,Hi=35718,qi=35721;function Gi(t,n,r,i){var s={},o={};function a(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function c(e,r,i){var a=e===Wi?s:o,u=a[r];if(!u){var c=n.str(r);u=t.createShader(e),t.shaderSource(u,c),t.compileShader(u),nt.shaderError(t,u,c,e,i),a[r]=u}return u}var l={},f=[],d=0;function h(t,e){this.id=d++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(e,r,s){var o,l,f=c(Wi,e.fragId),d=c(Yi,e.vertId),h=e.program=t.createProgram();if(t.attachShader(h,f),t.attachShader(h,d),s)for(o=0;o<s.length;++o){var p=s[o];t.bindAttribLocation(h,p[0],p[1])}t.linkProgram(h),nt.linkError(t,h,n.str(e.fragId),n.str(e.vertId),r);var m=t.getProgramParameter(h,Hi);i.profile&&(e.stats.uniformsCount=m);var y=e.uniforms;for(o=0;o<m;++o)if(l=t.getActiveUniform(h,o)){if(l.size>1)for(var b=0;b<l.size;++b){var g=l.name.replace("[0]","["+b+"]");u(y,new a(g,n.id(g),t.getUniformLocation(h,g),l))}var v=l.name;l.size>1&&(v=v.replace("[0]","")),u(y,new a(v,n.id(v),t.getUniformLocation(h,v),l))}var w=t.getProgramParameter(h,qi);i.profile&&(e.stats.attributesCount=w);var _=e.attributes;for(o=0;o<w;++o)(l=t.getActiveAttrib(h,o))&&u(_,new a(l.name,n.id(l.name),t.getAttribLocation(h,l.name),l))}function m(){s={},o={};for(var t=0;t<f.length;++t)p(f[t],null,f[t].attributes.map((function(t){return[t.location,t.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return f.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return f.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);Se(s).forEach(e),s={},Se(o).forEach(e),o={},f.forEach((function(e){t.deleteProgram(e.program)})),f.length=0,l={},r.shaderCount=0},program:function(n,i,a,u){nt.command(n>=0,"missing vertex shader",a),nt.command(i>=0,"missing fragment shader",a);var c=l[i];c||(c=l[i]={});var d=c[n];if(d&&(d.refCount++,!u))return d;var m=new h(i,n);return r.shaderCount++,p(m,a,u),d||(c[n]=m),f.push(m),e(m,{destroy:function(){if(m.refCount--,m.refCount<=0){t.deleteProgram(m.program);var e=f.indexOf(m);f.splice(e,1),r.shaderCount--}c[m.vertId].refCount<=0&&(t.deleteShader(o[m.vertId]),delete o[m.vertId],delete l[m.fragId][m.vertId]),Object.keys(l[m.fragId]).length||(t.deleteShader(s[m.fragId]),delete s[m.fragId],delete l[m.fragId])}})},restore:m,shader:c,frag:-1,vert:-1}}var Ki=6408,Qi=5121,Ji=3333,Xi=5126;function Zi(e,n,r,i,s,o,a){function u(u){var c;null===n.next?(nt(s.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=Qi):(nt(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,nt.optional((function(){o.oes_texture_float?(nt(c===Qi||c===Xi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),c===Xi&&nt(a.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):nt(c===Qi,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var l=0,f=0,d=i.framebufferWidth,h=i.framebufferHeight,p=null;t(u)?p=u:u&&(nt.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,f=0|u.y,nt(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),nt(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),d=0|(u.width||i.framebufferWidth-l),h=0|(u.height||i.framebufferHeight-f),p=u.data||null),p&&(c===Qi?nt(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):c===Xi&&nt(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),nt(d>0&&d+l<=i.framebufferWidth,"invalid width for read pixels"),nt(h>0&&h+f<=i.framebufferHeight,"invalid height for read pixels"),r();var m=d*h*4;return p||(c===Qi?p=new Uint8Array(m):c===Xi&&(p=p||new Float32Array(m))),nt.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),nt(p.byteLength>=m,"data buffer for regl.read() too small"),e.pixelStorei(Ji,4),e.readPixels(l,f,d,h,Ki,c,p),p}function c(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}function l(t){return t&&"framebuffer"in t?c(t):u(t)}return l}function ts(t){return Array.prototype.slice.call(t)}function es(t){return ts(t).join("")}function ns(){var t=0,n=[],r=[];function i(e){for(var i=0;i<r.length;++i)if(r[i]===e)return n[i];var s="g"+t++;return n.push(s),r.push(e),s}function s(){var n=[];function r(){n.push.apply(n,ts(arguments))}var i=[];function s(){var e="v"+t++;return i.push(e),arguments.length>0&&(n.push(e,"="),n.push.apply(n,ts(arguments)),n.push(";")),e}return e(r,{def:s,toString:function(){return es([i.length>0?"var "+i.join(",")+";":"",es(n)])}})}function o(){var t=s(),n=s(),r=t.toString,i=n.toString;function o(e,r){n(e,r,"=",t.def(e,r),";")}return e((function(){t.apply(t,ts(arguments))}),{def:t.def,entry:t,exit:n,save:o,set:function(e,n,r){o(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function a(){var t=es(arguments),n=o(),r=o(),i=n.toString,s=r.toString;return e(n,{then:function(){return n.apply(n,ts(arguments)),this},else:function(){return r.apply(r,ts(arguments)),this},toString:function(){var e=s();return e&&(e="else{"+e+"}"),es(["if(",t,"){",i(),"}",e])}})}var u=s(),c={};function l(t,n){var r=[];function i(){var t="a"+r.length;return r.push(t),t}n=n||0;for(var s=0;s<n;++s)i();var a=o(),u=a.toString;return c[t]=e(a,{arg:i,toString:function(){return es(["function(",r.join(),"){",u(),"}"])}})}function f(){var t=['"use strict";',u,"return {"];Object.keys(c).forEach((function(e){t.push('"',e,'":',c[e].toString(),",")})),t.push("}");var e=es(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,r)}return{global:u,link:i,block:s,proc:l,scope:o,cond:a,compile:f}}var rs="xyzw".split(""),is=5121,ss=1,os=2,as=0,us=1,cs=2,ls=3,fs=4,ds=5,hs=6,ps="dither",ms="blend.enable",ys="blend.color",bs="blend.equation",gs="blend.func",vs="depth.enable",ws="depth.func",_s="depth.range",xs="depth.mask",As="colorMask",Ss="cull.enable",Is="cull.face",Ts="frontFace",Os="lineWidth",Ms="polygonOffset.enable",Bs="polygonOffset.offset",Ds="sample.alpha",Es="sample.enable",Fs="sample.coverage",ks="stencil.enable",Ns="stencil.mask",Cs="stencil.func",Ls="stencil.opFront",Us="stencil.opBack",js="scissor.enable",zs="scissor.box",Vs="viewport",Rs="profile",Ps="framebuffer",$s="vert",Ws="frag",Ys="elements",Hs="primitive",qs="count",Gs="offset",Ks="instances",Qs="vao",Js="Width",Xs="Height",Zs=Ps+Js,to=Ps+Xs,eo=Vs+Js,no=Vs+Xs,ro="drawingBuffer",io=ro+Js,so=ro+Xs,oo=[gs,bs,Cs,Ls,Us,Fs,Vs,zs,Bs],ao=34962,uo=34963,co=3553,lo=34067,fo=2884,ho=3042,po=3024,mo=2960,yo=2929,bo=3089,go=32823,vo=32926,wo=32928,_o=5126,xo=35664,Ao=35665,So=35666,Io=5124,To=35667,Oo=35668,Mo=35669,Bo=35670,Do=35671,Eo=35672,Fo=35673,ko=35674,No=35675,Co=35676,Lo=35678,Uo=35680,jo=4,zo=1028,Vo=1029,Ro=2304,Po=2305,$o=32775,Wo=32776,Yo=519,Ho=7680,qo=0,Go=1,Ko=32774,Qo=513,Jo=36160,Xo=36064,Zo={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},ta=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ea={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},na={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ra={frag:35632,vert:35633},ia={cw:Ro,ccw:Po};function sa(e){return Array.isArray(e)||t(e)||Ae(e)}function oa(t){return t.sort((function(t,e){return t===Vs?-1:e===Vs?1:t<e?-1:1}))}function aa(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function ua(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function ca(t){return new aa(!1,!1,!1,t)}function la(t,e){var n=t.type;if(n===as){var r=t.data.length;return new aa(!0,r>=1,r>=2,e)}if(n===fs){var i=t.data;return new aa(i.thisDep,i.contextDep,i.propDep,e)}if(n===ds)return new aa(!1,!1,!1,e);if(n===hs){for(var s=!1,o=!1,a=!1,u=0;u<t.data.length;++u){var c=t.data[u];if(c.type===us)a=!0;else if(c.type===cs)o=!0;else if(c.type===ls)s=!0;else if(c.type===as){s=!0;var l=c.data;l>=1&&(o=!0),l>=2&&(a=!0)}else c.type===fs&&(s=s||c.data.thisDep,o=o||c.data.contextDep,a=a||c.data.propDep)}return new aa(s,o,a,e)}return new aa(n===ls,n===cs,n===us,e)}var fa=new aa(!1,!1,!1,(function(){}));function da(t,n,r,i,s,o,a,u,c,l,f,d,h,p,m){var y=l.Record,b={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(b.min=$o,b.max=Wo);var g=r.angle_instanced_arrays,v=r.webgl_draw_buffers,w=r.oes_vertex_array_object,_={dirty:!0,profile:m.profile},x={},A=[],S={},I={};function T(t){return t.replace(".","_")}function O(t,e,n){var r=T(t);A.push(t),x[r]=_[r]=!!n,S[r]=e}function M(t,e,n){var r=T(t);A.push(t),Array.isArray(n)?(_[r]=n.slice(),x[r]=n.slice()):_[r]=x[r]=n,I[r]=e}O(ps,po),O(ms,ho),M(ys,"blendColor",[0,0,0,0]),M(bs,"blendEquationSeparate",[Ko,Ko]),M(gs,"blendFuncSeparate",[Go,qo,Go,qo]),O(vs,yo,!0),M(ws,"depthFunc",Qo),M(_s,"depthRange",[0,1]),M(xs,"depthMask",!0),M(As,As,[!0,!0,!0,!0]),O(Ss,fo),M(Is,"cullFace",Vo),M(Ts,Ts,Po),M(Os,Os,1),O(Ms,go),M(Bs,"polygonOffset",[0,0]),O(Ds,vo),O(Es,wo),M(Fs,"sampleCoverage",[1,!1]),O(ks,mo),M(Ns,"stencilMask",-1),M(Cs,"stencilFunc",[Yo,0,-1]),M(Ls,"stencilOpSeparate",[zo,Ho,Ho,Ho]),M(Us,"stencilOpSeparate",[Vo,Ho,Ho,Ho]),O(js,bo),M(zs,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),M(Vs,Vs,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var B={gl:t,context:h,strings:n,next:x,current:_,draw:d,elements:o,buffer:s,shader:f,attributes:l.state,vao:l,uniforms:c,framebuffer:u,extensions:r,timer:p,isBufferArgs:sa},D={primTypes:He,compareFuncs:ea,blendFuncs:Zo,blendEquations:b,stencilOps:na,glTypes:ke,orientationType:ia};nt.optional((function(){B.isArrayLike=fn})),v&&(D.backBuffer=[Vo],D.drawBuffer=Tt(i.maxDrawbuffers,(function(t){return 0===t?[0]:Tt(t,(function(t){return Xo+t}))})));var E=0;function F(){var t=ns(),e=t.link,r=t.global;t.id=E++,t.batchId="0";var i=e(B),s=t.shared={props:"a0"};Object.keys(B).forEach((function(t){s[t]=r.def(i,".",t)})),nt.optional((function(){t.CHECK=e(nt),t.commandStr=nt.guessCommand(),t.command=e(t.commandStr),t.assert=function(t,n,r){t("if(!(",n,"))",this.CHECK,".commandRaise(",e(r),",",this.command,");")},D.invalidBlendCombinations=ta}));var o=t.next={},a=t.current={};Object.keys(I).forEach((function(t){Array.isArray(_[t])&&(o[t]=r.def(s.next,".",t),a[t]=r.def(s.current,".",t))}));var u=t.constants={};Object.keys(D).forEach((function(t){u[t]=r.def(JSON.stringify(D[t]))})),t.invoke=function(n,r){switch(r.type){case as:var i=["this",s.context,s.props,t.batchId];return n.def(e(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case us:return n.def(s.props,r.data);case cs:return n.def(s.context,r.data);case ls:return n.def("this",r.data);case fs:return r.data.append(t,n),r.data.ref;case ds:return r.data.toString();case hs:return r.data.map((function(e){return t.invoke(n,e)}))}},t.attribCache={};var c={};return t.scopeAttrib=function(t){var r=n.id(t);if(r in c)return c[r];var i=l.scope[r];return i||(i=l.scope[r]=new y),c[r]=e(i)},t}function k(t){var e,n=t.static,r=t.dynamic;if(Rs in n){var i=!!n[Rs];(e=ca((function(t,e){return i}))).enable=i}else if(Rs in r){var s=r[Rs];e=la(s,(function(t,e){return t.invoke(e,s)}))}return e}function N(t,e){var n=t.static,r=t.dynamic;if(Ps in n){var i=n[Ps];return i?(i=u.getFramebuffer(i),nt.command(i,"invalid framebuffer object"),ca((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var s=r.context;return e.set(s,"."+Zs,n+".width"),e.set(s,"."+to,n+".height"),n}))):ca((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+Zs,r+"."+io),e.set(r,"."+to,r+"."+so),"null"}))}if(Ps in r){var s=r[Ps];return la(s,(function(t,e){var n=t.invoke(e,s),r=t.shared,i=r.framebuffer,o=e.def(i,".getFramebuffer(",n,")");nt.optional((function(){t.assert(e,"!"+n+"||"+o,"invalid framebuffer object")})),e.set(i,".next",o);var a=r.context;return e.set(a,"."+Zs,o+"?"+o+".width:"+a+"."+io),e.set(a,"."+to,o+"?"+o+".height:"+a+"."+so),o}))}return null}function C(t,e,n){var r=t.static,i=t.dynamic;function s(t){if(t in r){var s=r[t];nt.commandType(s,"object","invalid "+t,n.commandStr);var o,a,u=!0,c=0|s.x,l=0|s.y;return"width"in s?(o=0|s.width,nt.command(o>=0,"invalid "+t,n.commandStr)):u=!1,"height"in s?(a=0|s.height,nt.command(a>=0,"invalid "+t,n.commandStr)):u=!1,new aa(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=o;"width"in s||(r=e.def(n,".",Zs,"-",c));var i=a;return"height"in s||(i=e.def(n,".",to,"-",l)),[c,l,r,i]}))}if(t in i){var f=i[t],d=la(f,(function(e,n){var r=e.invoke(n,f);nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,s=n.def(r,".x|0"),o=n.def(r,".y|0"),a=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Zs,"-",s,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",to,"-",o,")");return nt.optional((function(){e.assert(n,a+">=0&&"+u+">=0","invalid "+t)})),[s,o,a,u]}));return e&&(d.thisDep=d.thisDep||e.thisDep,d.contextDep=d.contextDep||e.contextDep,d.propDep=d.propDep||e.propDep),d}return e?new aa(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Zs),e.def(n,".",to)]})):null}var o=s(Vs);if(o){var a=o;o=new aa(o.thisDep,o.contextDep,o.propDep,(function(t,e){var n=a.append(t,e),r=t.shared.context;return e.set(r,"."+eo,n[2]),e.set(r,"."+no,n[3]),n}))}return{viewport:o,scissor_box:s(zs)}}function L(t,e){var n=t.static;if("string"==typeof n[Ws]&&"string"==typeof n[$s]){if(Object.keys(e.dynamic).length>0)return null;var r=e.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var s=[],o=0;o<i.length;++o)nt("number"==typeof r[i[o]],"must specify all vertex attribute locations when using vaos"),s.push([0|r[i[o]],i[o]]);return s}}return null}function U(t,e,r){var i=t.static,s=t.dynamic;function o(t){if(t in i){var e=n.id(i[t]);nt.optional((function(){f.shader(ra[t],e,nt.guessCommand())}));var r=ca((function(){return e}));return r.id=e,r}if(t in s){var o=s[t];return la(o,(function(e,n){var r=e.invoke(n,o),i=n.def(e.shared.strings,".id(",r,")");return nt.optional((function(){n(e.shared.shader,".shader(",ra[t],",",i,",",e.command,");")})),i}))}return null}var a,u=o(Ws),c=o($s),l=null;return ua(u)&&ua(c)?(l=f.program(c.id,u.id,null,r),a=ca((function(t,e){return t.link(l)}))):a=new aa(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(t,e){var n,r=t.shared.shader;n=u?u.append(t,e):e.def(r,".",Ws);var i=r+".program("+(c?c.append(t,e):e.def(r,".",$s))+","+n;return nt.optional((function(){i+=","+t.command})),e.def(i+")")})),{frag:u,vert:c,progVar:a,program:l}}function j(t,e){var n=t.static,r=t.dynamic,i={},s=!1;function a(){if(Qs in n){var t=n[Qs];return null!==t&&null===l.getVAO(t)&&(t=l.createVAO(t)),s=!0,i.vao=t,ca((function(e){var n=l.getVAO(t);return n?e.link(n):"null"}))}if(Qs in r){s=!0;var e=r[Qs];return la(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}var u=a(),c=!1;function f(){if(Ys in n){var t=n[Ys];if(i.elements=t,sa(t)){var a=i.elements=o.create(t,!0);t=o.getElements(a),c=!0}else t&&(t=o.getElements(t),c=!0,nt.command(t,"invalid elements",e.commandStr));var l=ca((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return l.value=t,l}if(Ys in r){c=!0;var f=r[Ys];return la(f,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,s=t.invoke(e,f),o=e.def("null"),a=e.def(r,"(",s,")"),u=t.cond(a).then(o,"=",i,".createStream(",s,");").else(o,"=",i,".getElements(",s,");");return nt.optional((function(){t.assert(u.else,"!"+s+"||"+o,"invalid elements")})),e.entry(u),e.exit(t.cond(a).then(i,".destroyStream(",o,");")),t.ELEMENTS=o,o}))}return s?new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}var d=f();function h(){if(Hs in n){var t=n[Hs];return i.primitive=t,nt.commandParameter(t,He,"invalid primitve",e.commandStr),ca((function(e,n){return He[t]}))}if(Hs in r){var o=r[Hs];return la(o,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,o);return nt.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(He))})),e.def(n,"[",r,"]")}))}return c?ua(d)?d.value?ca((function(t,e){return e.def(t.ELEMENTS,".primType")})):ca((function(){return jo})):new aa(d.thisDep,d.contextDep,d.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",jo)})):s?new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:"+jo)})):null}function p(t,o){if(t in n){var a=0|n[t];return o?i.offset=a:i.instances=a,nt.command(!o||a>=0,"invalid "+t,e.commandStr),ca((function(t,e){return o&&(t.OFFSET=a),a}))}if(t in r){var l=r[t];return la(l,(function(e,n){var r=e.invoke(n,l);return o&&(e.OFFSET=r,nt.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(o){if(c)return ca((function(t,e){return t.OFFSET=0,0}));if(s)return new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(s)return new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var m=p(Gs,!0);function y(){if(qs in n){var t=0|n[qs];return i.count=t,nt.command("number"==typeof t&&t>=0,"invalid vertex count",e.commandStr),ca((function(){return t}))}if(qs in r){var o=r[qs];return la(o,(function(t,e){var n=t.invoke(e,o);return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(c){if(ua(d)){if(d)return m?new aa(m.thisDep,m.contextDep,m.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return nt.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):ca((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var a=ca((function(){return-1}));return nt.optional((function(){a.MISSING=!0})),a}var l=new aa(d.thisDep||m.thisDep,d.contextDep||m.contextDep,d.propDep||m.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return nt.optional((function(){l.DYNAMIC=!0})),l}return s?new aa(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")})):null}var b=h(),g=y(),v=p(Ks,!1);return{elements:d,primitive:b,count:g,instances:v,offset:m,vao:u,vaoActive:s,elementsActive:c,static:i}}function z(t,e){var n=t.static,r=t.dynamic,s={};return A.forEach((function(t){var o=T(t);function a(e,i){if(t in n){var a=e(n[t]);s[o]=ca((function(){return a}))}else if(t in r){var u=r[t];s[o]=la(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case Ss:case ms:case ps:case ks:case vs:case js:case Ms:case Ds:case Es:case xs:return a((function(n){return nt.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return nt.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case ws:return a((function(n){return nt.commandParameter(n,ea,"invalid "+t,e.commandStr),ea[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return nt.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(ea))})),n.def(i,"[",r,"]")}));case _s:return a((function(t){return nt.command(fn(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[e.def("+",n,"[0]"),e.def("+",n,"[1]")]}));case gs:return a((function(t){nt.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,s="dstAlpha"in t?t.dstAlpha:t.dst;return nt.commandParameter(n,Zo,o+".srcRGB",e.commandStr),nt.commandParameter(r,Zo,o+".srcAlpha",e.commandStr),nt.commandParameter(i,Zo,o+".dstRGB",e.commandStr),nt.commandParameter(s,Zo,o+".dstAlpha",e.commandStr),nt.command(-1===ta.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[Zo[n],Zo[i],Zo[r],Zo[s]]}),(function(e,n,r){var i=e.constants.blendFuncs;function s(s,o){var a=n.def('"',s,o,'" in ',r,"?",r,".",s,o,":",r,".",s);return nt.optional((function(){e.assert(n,a+" in "+i,"invalid "+t+"."+s+o+", must be one of "+Object.keys(Zo))})),a}nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var o=s("src","RGB"),a=s("dst","RGB");nt.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+o+'+", "+'+a+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",o,"]"),c=n.def(i,"[",s("src","Alpha"),"]");return[u,n.def(i,"[",a,"]"),c,n.def(i,"[",s("dst","Alpha"),"]")]}));case bs:return a((function(n){return"string"==typeof n?(nt.commandParameter(n,b,"invalid "+t,e.commandStr),[b[n],b[n]]):"object"==typeof n?(nt.commandParameter(n.rgb,b,t+".rgb",e.commandStr),nt.commandParameter(n.alpha,b,t+".alpha",e.commandStr),[b[n.rgb],b[n.alpha]]):void nt.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,s=n.def(),o=n.def(),a=e.cond("typeof ",r,'==="string"');return nt.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(b))}n(a.then,t,r),e.assert(a.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(a.else,t+".rgb",r+".rgb"),n(a.else,t+".alpha",r+".alpha")})),a.then(s,"=",o,"=",i,"[",r,"];"),a.else(s,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(a),[s,o]}));case ys:return a((function(t){return nt.command(fn(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),Tt(4,(function(e){return+t[e]}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Tt(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case Ns:return a((function(t){return nt.commandType(t,"number",o,e.commandStr),0|t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case Cs:return a((function(n){nt.commandType(n,"object",o,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,s="mask"in n?n.mask:-1;return nt.commandParameter(r,ea,t+".cmp",e.commandStr),nt.commandType(i,"number",t+".ref",e.commandStr),nt.commandType(s,"number",t+".mask",e.commandStr),[ea[r],i,s]}),(function(t,e,n){var r=t.constants.compareFuncs;return nt.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Ho),e.def(n,".ref|0"),e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Ls:case Us:return a((function(n){nt.commandType(n,"object",o,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",s=n.zpass||"keep";return nt.commandParameter(r,na,t+".fail",e.commandStr),nt.commandParameter(i,na,t+".zfail",e.commandStr),nt.commandParameter(s,na,t+".zpass",e.commandStr),[t===Us?Vo:zo,na[r],na[i],na[s]]}),(function(e,n,r){var i=e.constants.stencilOps;function s(s){return nt.optional((function(){e.assert(n,'!("'+s+'" in '+r+")||("+r+"."+s+" in "+i+")","invalid "+t+"."+s+", must be one of "+Object.keys(na))})),n.def('"',s,'" in ',r,"?",i,"[",r,".",s,"]:",Ho)}return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===Us?Vo:zo,s("fail"),s("zfail"),s("zpass")]}));case Bs:return a((function(t){nt.commandType(t,"object",o,e.commandStr);var n=0|t.factor,r=0|t.units;return nt.commandType(n,"number",o+".factor",e.commandStr),nt.commandType(r,"number",o+".units",e.commandStr),[n,r]}),(function(e,n,r){return nt.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Is:return a((function(t){var n=0;return"front"===t?n=zo:"back"===t&&(n=Vo),nt.command(!!n,o,e.commandStr),n}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',zo,":",Vo)}));case Os:return a((function(t){return nt.command("number"==typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return nt.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Ts:return a((function(t){return nt.commandParameter(t,ia,o,e.commandStr),ia[t]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+Ro+":"+Po)}));case As:return a((function(t){return nt.command(fn(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return nt.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Tt(4,(function(t){return"!!"+n+"["+t+"]"}))}));case Fs:return a((function(t){nt.command("object"==typeof t&&t,o,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return nt.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){return nt.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[e.def('"value" in ',n,"?+",n,".value:1"),e.def("!!",n,".invert")]}))}})),s}function V(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,s=n[t];if("number"==typeof s||"boolean"==typeof s)r=ca((function(){return s}));else if("function"==typeof s){var o=s._reglType;"texture2d"===o||"textureCube"===o?r=ca((function(t){return t.link(s)})):"framebuffer"===o||"framebufferCube"===o?(nt.command(s.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=ca((function(t){return t.link(s.color[0])}))):nt.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else fn(s)?r=ca((function(e){return e.global.def("[",Tt(s.length,(function(n){return nt.command("number"==typeof s[n]||"boolean"==typeof s[n],"invalid uniform "+t,e.commandStr),s[n]})),"]")})):nt.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=s,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=la(e,(function(t,n){return t.invoke(n,e)}))})),i}function R(t,e){var r=t.static,i=t.dynamic,o={};return Object.keys(r).forEach((function(t){var i=r[t],a=n.id(t),u=new y;if(sa(i))u.state=ss,u.buffer=s.getBuffer(s.create(i,ao,!1,!0)),u.type=0;else{var c=s.getBuffer(i);if(c)u.state=ss,u.buffer=c,u.type=0;else if(nt.command("object"==typeof i&&i,"invalid data for attribute "+t,e.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=os,"number"==typeof l?u.x=l:(nt.command(fn(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+t,e.commandStr),rs.forEach((function(t,e){e<l.length&&(u[t]=l[e])})))}else{c=sa(i.buffer)?s.getBuffer(s.create(i.buffer,ao,!1,!0)):s.getBuffer(i.buffer),nt.command(!!c,'missing buffer for attribute "'+t+'"',e.commandStr);var f=0|i.offset;nt.command(f>=0,'invalid offset for attribute "'+t+'"',e.commandStr);var d=0|i.stride;nt.command(d>=0&&d<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',e.commandStr);var h=0|i.size;nt.command(!("size"in i)||h>0&&h<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',e.commandStr);var p=!!i.normalized,m=0;"type"in i&&(nt.commandParameter(i.type,ke,"invalid type for attribute "+t,e.commandStr),m=ke[i.type]);var b=0|i.divisor;nt.optional((function(){"divisor"in i&&(nt.command(0===b||g,'cannot specify divisor for attribute "'+t+'", instancing not supported',e.commandStr),nt.command(b>=0,'invalid divisor for attribute "'+t+'"',e.commandStr));var n=e.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(e){nt.command(r.indexOf(e)>=0,'unknown parameter "'+e+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=ss,u.size=h,u.normalized=p,u.type=m||c.dtype,u.offset=f,u.stride=d,u.divisor=b}}o[t]=ca((function(t,e){var n=t.attribCache;if(a in n)return n[a];var r={isStream:!1};return Object.keys(u).forEach((function(t){r[t]=u[t]})),u.buffer&&(r.buffer=t.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[a]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,r){var i=n.invoke(r,e),s=n.shared,o=n.constants,a=s.isBufferArgs,u=s.buffer;nt.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+a+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+a+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+s.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var c={isStream:r.def(!1)},l=new y;l.state=ss,Object.keys(l).forEach((function(t){c[t]=r.def(""+l[t])}));var f=c.buffer,d=c.type;function h(t){r(c[t],"=",i,".",t,"|0;")}return r("if(",a,"(",i,")){",c.isStream,"=true;",f,"=",u,".createStream(",ao,",",i,");",d,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",d,"=",f,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",os,";","if(typeof "+i+'.constant === "number"){',c[rs[0]],"=",i,".constant;",rs.slice(1).map((function(t){return c[t]})).join("="),"=0;","}else{",rs.map((function(t,e){return c[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",a,"(",i,".buffer)){",f,"=",u,".createStream(",ao,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",d,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",f,".dtype;",c.normalized,"=!!",i,".normalized;"),h("size"),h("offset"),h("stride"),h("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",f,");","}"),c}o[t]=la(e,n)})),o}function P(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=ca((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=la(e,(function(t,n){return t.invoke(n,e)}))})),r}function $(t,e,n,i,s){var o=t.static,a=t.dynamic;nt.optional((function(){var t=[Ps,$s,Ws,Ys,Hs,Gs,qs,Ks,Rs,Qs].concat(A);function e(e){Object.keys(e).forEach((function(e){nt.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',s.commandStr)}))}e(o),e(a)}));var u=L(t,e),c=N(t),f=C(t,c,s),d=j(t,s),h=z(t,s),p=U(t,s,u);function m(t){var e=f[t];e&&(h[t]=e)}m(Vs),m(T(zs));var y=Object.keys(h).length>0,b={framebuffer:c,draw:d,shader:p,state:h,dirty:y,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(b.profile=k(t),b.uniforms=V(n,s),b.drawVAO=b.scopeVAO=d.vao,!b.drawVAO&&p.program&&!u&&r.angle_instanced_arrays&&d.static.elements){var g=!0,v=p.program.attributes.map((function(t){var n=e.static[t];return g=g&&!!n,n}));if(g&&v.length>0){var w=l.getVAO(l.createVAO({attributes:v,elements:d.static.elements}));b.drawVAO=new aa(null,null,null,(function(t,e){return t.link(w)})),b.useVAO=!0}}return u?b.useVAO=!0:b.attributes=R(e,s),b.context=P(i),b}function W(t,e,n){var r=t.shared.context,i=t.scope();Object.keys(n).forEach((function(s){e.save(r,"."+s);var o=n[s].append(t,e);Array.isArray(o)?i(r,".",s,"=[",o.join(),"];"):i(r,".",s,"=",o,";")})),e(i)}function Y(t,e,n,r){var i,s=t.shared,o=s.gl,a=s.framebuffer;v&&(i=e.def(s.extensions,".webgl_draw_buffers"));var u,c=t.constants,l=c.drawBuffer,f=c.backBuffer;u=n?n.append(t,e):e.def(a,".next"),r||e("if(",u,"!==",a,".cur){"),e("if(",u,"){",o,".bindFramebuffer(",Jo,",",u,".framebuffer);"),v&&e(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),e("}else{",o,".bindFramebuffer(",Jo,",null);"),v&&e(i,".drawBuffersWEBGL(",f,");"),e("}",a,".cur=",u,";"),r||e("}")}function H(t,e,n){var r=t.shared,i=r.gl,s=t.current,o=t.next,a=r.current,u=r.next,c=t.cond(a,".dirty");A.forEach((function(e){var r,l,f=T(e);if(!(f in n.state))if(f in o){r=o[f],l=s[f];var d=Tt(_[f].length,(function(t){return c.def(r,"[",t,"]")}));c(t.cond(d.map((function(t,e){return t+"!=="+l+"["+e+"]"})).join("||")).then(i,".",I[f],"(",d,");",d.map((function(t,e){return l+"["+e+"]="+t})).join(";"),";"))}else{r=c.def(u,".",f);var h=t.cond(r,"!==",a,".",f);c(h),f in S?h(t.cond(r).then(i,".enable(",S[f],");").else(i,".disable(",S[f],");"),a,".",f,"=",r,";"):h(i,".",I[f],"(",r,");",a,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&c(a,".dirty=false;"),e(c)}function q(t,e,n,r){var i=t.shared,s=t.current,o=i.current,a=i.gl;oa(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(t,e);if(S[i]){var l=S[i];ua(u)?e(a,c?".enable(":".disable(",l,");"):e(t.cond(c).then(a,".enable(",l,");").else(a,".disable(",l,");")),e(o,".",i,"=",c,";")}else if(fn(c)){var f=s[i];e(a,".",I[i],"(",c,");",c.map((function(t,e){return f+"["+e+"]="+t})).join(";"),";")}else e(a,".",I[i],"(",c,");",o,".",i,"=",c,";")}}))}function G(t,e){g&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function K(t,e,n,r,i){var s,o,a,u=t.shared,c=t.stats,l=u.current,f=u.timer,d=n.profile;function h(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(t){t(s=e.def(),"=",h(),";"),"string"==typeof i?t(c,".count+=",i,";"):t(c,".count++;"),p&&(r?t(o=e.def(),"=",f,".getNumPendingQueries();"):t(f,".beginQuery(",c,");"))}function y(t){t(c,".cpuTime+=",h(),"-",s,";"),p&&(r?t(f,".pushScopeStats(",o,",",f,".getNumPendingQueries(),",c,");"):t(f,".endQuery();"))}function b(t){var n=e.def(l,".profile");e(l,".profile=",t,";"),e.exit(l,".profile=",n,";")}if(d){if(ua(d))return void(d.enable?(m(e),y(e.exit),b("true")):b("false"));b(a=d.append(t,e))}else a=e.def(l,".profile");var g=t.block();m(g),e("if(",a,"){",g,"}");var v=t.block();y(v),e.exit("if(",a,"){",v,"}")}function Q(t,e,n,r,i){var s=t.shared;function o(t){switch(t){case xo:case To:case Do:return 2;case Ao:case Oo:case Eo:return 3;case So:case Mo:case Fo:return 4;default:return 1}}function a(n,r,i){var o=s.gl,a=e.def(n,".location"),u=e.def(s.attributes,"[",a,"]"),c=i.state,l=i.buffer,f=[i.x,i.y,i.z,i.w],d=["buffer","normalized","offset","stride"];function h(){e("if(!",u,".buffer){",o,".enableVertexAttribArray(",a,");}");var n,s=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",s,"||",u,".size!==",n,"||",d.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",o,".bindBuffer(",ao,",",l,".buffer);",o,".vertexAttribPointer(",[a,n,s,i.normalized,i.stride,i.offset],");",u,".type=",s,";",u,".size=",n,";",d.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),g){var c=i.divisor;e("if(",u,".divisor!==",c,"){",t.instancing,".vertexAttribDivisorANGLE(",[a,c],");",u,".divisor=",c,";}")}}function p(){e("if(",u,".buffer){",o,".disableVertexAttribArray(",a,");",u,".buffer=null;","}if(",rs.map((function(t,e){return u+"."+t+"!=="+f[e]})).join("||"),"){",o,".vertexAttrib4f(",a,",",f,");",rs.map((function(t,e){return u+"."+t+"="+f[e]+";"})).join(""),"}")}c===ss?h():c===os?p():(e("if(",c,"===",ss,"){"),h(),e("}else{"),p(),e("}"))}r.forEach((function(r){var s,u=r.name,c=n.attributes[u];if(c){if(!i(c))return;s=c.append(t,e)}else{if(!i(fa))return;var l=t.scopeAttrib(u);nt.optional((function(){t.assert(e,l+".state","missing attribute "+u)})),s={},Object.keys(new y).forEach((function(t){s[t]=e.def(l,".",t)}))}a(t.link(r),o(r.info.type),s)}))}function J(t,e,r,i,s,o){for(var a,u=t.shared,c=u.gl,l={},f=0;f<i.length;++f){var d=i[f],h=d.name,p=d.info.type,m=d.info.size,y=r.uniforms[h];if(m>1){if(!y)continue;var b=h.replace("[0]","");if(l[b])continue;l[b]=1}var g,v=t.link(d)+".location";if(y){if(!s(y))continue;if(ua(y)){var w=y.value;if(nt.command(null!=w,'missing uniform "'+h+'"',t.commandStr),p===Lo||p===Uo){nt.command("function"==typeof w&&(p===Lo&&("texture2d"===w._reglType||"framebuffer"===w._reglType)||p===Uo&&("textureCube"===w._reglType||"framebufferCube"===w._reglType)),"invalid texture for uniform "+h,t.commandStr);var _=t.link(w._texture||w.color[0]._texture);e(c,".uniform1i(",v,",",_+".bind());"),e.exit(_,".unbind();")}else if(p===ko||p===No||p===Co){nt.optional((function(){nt.command(fn(w),"invalid matrix for uniform "+h,t.commandStr),nt.command(p===ko&&4===w.length||p===No&&9===w.length||p===Co&&16===w.length,"invalid length for matrix uniform "+h,t.commandStr)}));var x=t.global.def("new Float32Array(["+Array.prototype.slice.call(w)+"])"),A=2;p===No?A=3:p===Co&&(A=4),e(c,".uniformMatrix",A,"fv(",v,",false,",x,");")}else{switch(p){case _o:1===m?nt.commandType(w,"number","uniform "+h,t.commandStr):nt.command(fn(w)&&w.length===m,"uniform "+h,t.commandStr),a="1f";break;case xo:nt.command(fn(w)&&w.length&&w.length%2==0&&w.length<=2*m,"uniform "+h,t.commandStr),a="2f";break;case Ao:nt.command(fn(w)&&w.length&&w.length%3==0&&w.length<=3*m,"uniform "+h,t.commandStr),a="3f";break;case So:nt.command(fn(w)&&w.length&&w.length%4==0&&w.length<=4*m,"uniform "+h,t.commandStr),a="4f";break;case Bo:1===m?nt.commandType(w,"boolean","uniform "+h,t.commandStr):nt.command(fn(w)&&w.length===m,"uniform "+h,t.commandStr),a="1i";break;case Io:1===m?nt.commandType(w,"number","uniform "+h,t.commandStr):nt.command(fn(w)&&w.length===m,"uniform "+h,t.commandStr),a="1i";break;case Do:case To:nt.command(fn(w)&&w.length&&w.length%2==0&&w.length<=2*m,"uniform "+h,t.commandStr),a="2i";break;case Eo:case Oo:nt.command(fn(w)&&w.length&&w.length%3==0&&w.length<=3*m,"uniform "+h,t.commandStr),a="3i";break;case Fo:case Mo:nt.command(fn(w)&&w.length&&w.length%4==0&&w.length<=4*m,"uniform "+h,t.commandStr),a="4i"}m>1?(a+="v",w=t.global.def("["+Array.prototype.slice.call(w)+"]")):w=fn(w)?Array.prototype.slice.call(w):w,e(c,".uniform",a,"(",v,",",w,");")}continue}g=y.append(t,e)}else{if(!s(fa))continue;g=e.def(u.uniforms,"[",n.id(h),"]")}p===Lo?(nt(!Array.isArray(g),"must specify a scalar prop for textures"),e("if(",g,"&&",g,'._reglType==="framebuffer"){',g,"=",g,".color[0];","}")):p===Uo&&(nt(!Array.isArray(g),"must specify a scalar prop for cube maps"),e("if(",g,"&&",g,'._reglType==="framebufferCube"){',g,"=",g,".color[0];","}")),nt.optional((function(){function n(n,r){t.assert(e,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(t,e){1===e&&nt(!Array.isArray(g),"must not specify an array type for uniform"),n("Array.isArray("+g+") && typeof "+g+'[0]===" '+t+'" || typeof '+g+'==="'+t+'"',"invalid type, expected "+t)}function i(e,r,i){Array.isArray(g)?nt(g.length&&g.length%e==0&&g.length<=e*i,"must have length of "+(1===i?"":"n * ")+e):n(u.isArrayLike+"("+g+")&&"+g+".length && "+g+".length % "+e+" === 0 && "+g+".length<="+e*i,"invalid vector, should have length of "+(1===i?"":"n * ")+e,t.commandStr)}function s(e){nt(!Array.isArray(g),"must not specify a value type"),n("typeof "+g+'==="function"&&'+g+'._reglType==="texture'+(e===co?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(p){case Io:r("number",m);break;case To:i(2,"number",m);break;case Oo:i(3,"number",m);break;case Mo:i(4,"number",m);break;case _o:r("number",m);break;case xo:i(2,"number",m);break;case Ao:i(3,"number",m);break;case So:i(4,"number",m);break;case Bo:r("boolean",m);break;case Do:i(2,"boolean",m);break;case Eo:i(3,"boolean",m);break;case Fo:i(4,"boolean",m);break;case ko:i(4,"number",m);break;case No:i(9,"number",m);break;case Co:i(16,"number",m);break;case Lo:s(co);break;case Uo:s(lo)}}));var S=1;switch(p){case Lo:case Uo:var I=e.def(g,"._texture");e(c,".uniform1i(",v,",",I,".bind());"),e.exit(I,".unbind();");continue;case Io:case Bo:a="1i";break;case To:case Do:a="2i",S=2;break;case Oo:case Eo:a="3i",S=3;break;case Mo:case Fo:a="4i",S=4;break;case _o:a="1f";break;case xo:a="2f",S=2;break;case Ao:a="3f",S=3;break;case So:a="4f",S=4;break;case ko:a="Matrix2fv";break;case No:a="Matrix3fv";break;case Co:a="Matrix4fv"}if(-1===a.indexOf("Matrix")&&m>1&&(a+="v",S=1),"M"===a.charAt(0)){e(c,".uniform",a,"(",v,",");var T=Math.pow(p-ko+2,2),O=t.global.def("new Float32Array(",T,")");Array.isArray(g)?e("false,(",Tt(T,(function(t){return O+"["+t+"]="+g[t]})),",",O,")"):e("false,(Array.isArray(",g,")||",g," instanceof Float32Array)?",g,":(",Tt(T,(function(t){return O+"["+t+"]="+g+"["+t+"]"})),",",O,")"),e(");")}else if(S>1){for(var M=[],B=[],D=0;D<S;++D)Array.isArray(g)?B.push(g[D]):B.push(e.def(g+"["+D+"]")),o&&M.push(e.def());o&&e("if(!",t.batchId,"||",M.map((function(t,e){return t+"!=="+B[e]})).join("||"),"){",M.map((function(t,e){return t+"="+B[e]+";"})).join("")),e(c,".uniform",a,"(",v,",",B.join(","),");"),o&&e("}")}else{if(nt(!Array.isArray(g),"uniform value must not be an array"),o){var E=e.def();e("if(!",t.batchId,"||",E,"!==",g,"){",E,"=",g,";")}e(c,".uniform",a,"(",v,",",g,");"),o&&e("}")}}}function X(t,e,n,r){var i=t.shared,s=i.gl,o=i.draw,a=r.draw;function u(){var u,c=a.elements,l=e;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(l=n),u=c.append(t,l),a.elementsActive&&l("if("+u+")"+s+".bindBuffer("+uo+","+u+".buffer.buffer);")):(u=l.def(),l(u,"=",o,".",Ys,";","if(",u,"){",s,".bindBuffer(",uo,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",w?"":"if("+u+")"+s+".bindBuffer("+uo+","+u+".buffer.buffer);","}")),u}function c(){var i,s=a.count,u=e;return s?((s.contextDep&&r.contextDynamic||s.propDep)&&(u=n),i=s.append(t,u),nt.optional((function(){s.MISSING&&t.assert(e,"false","missing vertex count"),s.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(o,".",qs),nt.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}var l=u();function f(i){var s=a[i];return s?s.contextDep&&r.contextDynamic||s.propDep?s.append(t,n):s.append(t,e):e.def(o,".",i)}var d,h,p=f(Hs),m=f(Gs),y=c();if("number"==typeof y){if(0===y)return}else n("if(",y,"){"),n.exit("}");g&&(d=f(Ks),h=t.instancing);var b=l+".type",v=a.elements&&ua(a.elements)&&!a.vaoActive;function _(){function t(){n(h,".drawElementsInstancedANGLE(",[p,y,b,m+"<<(("+b+"-"+is+")>>1)",d],");")}function e(){n(h,".drawArraysInstancedANGLE(",[p,m,y,d],");")}l&&"null"!==l?v?t():(n("if(",l,"){"),t(),n("}else{"),e(),n("}")):e()}function x(){function t(){n(s+".drawElements("+[p,y,b,m+"<<(("+b+"-"+is+")>>1)"]+");")}function e(){n(s+".drawArrays("+[p,m,y]+");")}l&&"null"!==l?v?t():(n("if(",l,"){"),t(),n("}else{"),e(),n("}")):e()}g&&("number"!=typeof d||d>=0)?"string"==typeof d?(n("if(",d,">0){"),_(),n("}else if(",d,"<0){"),x(),n("}")):_():x()}function Z(t,e,n,r,i){var s=F(),o=s.proc("body",i);return nt.optional((function(){s.commandStr=e.commandStr,s.command=s.link(e.commandStr)})),g&&(s.instancing=o.def(s.shared.extensions,".angle_instanced_arrays")),t(s,o,n,r),s.compile().body}function tt(t,e,n,r){G(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),Q(t,e,n,r.attributes,(function(){return!0}))),J(t,e,n,r.uniforms,(function(){return!0}),!1),X(t,e,e,n)}function et(t,e){var n=t.proc("draw",1);G(t,n),W(t,n,e.context),Y(t,n,e.framebuffer),H(t,n,e),q(t,n,e.state),K(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)tt(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),s=n.def(r,".id"),o=n.def(i,"[",s,"]");n(t.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",s,"]=",t.link((function(n){return Z(tt,t,e,n,1)})),"(",r,");",o,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function rt(t,e,n,r){function i(){return!0}t.batchId="a1",G(t,e),Q(t,e,n,r.attributes,i),J(t,e,n,r.uniforms,i,!1),X(t,e,e,n)}function it(t,e,n,r){G(t,e);var i=n.contextDep,s=e.def(),o="a0",a="a1",u=e.def();t.shared.props=u,t.batchId=s;var c=t.scope(),l=t.scope();function f(t){return t.contextDep&&i||t.propDep}function d(t){return!f(t)}if(e(c.entry,"for(",s,"=0;",s,"<",a,";++",s,"){",u,"=",o,"[",s,"];",l,"}",c.exit),n.needsContext&&W(t,l,n.context),n.needsFramebuffer&&Y(t,l,n.framebuffer),q(t,l,n.state,f),n.profile&&f(n.profile)&&K(t,l,n,!1,!0),r)n.useVAO?n.drawVAO?f(n.drawVAO)?l(t.shared.vao,".setVAO(",n.drawVAO.append(t,l),");"):c(t.shared.vao,".setVAO(",n.drawVAO.append(t,c),");"):c(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(c(t.shared.vao,".setVAO(null);"),Q(t,c,n,r.attributes,d),Q(t,l,n,r.attributes,f)),J(t,c,n,r.uniforms,d,!1),J(t,l,n,r.uniforms,f,!0),X(t,c,l,n);else{var h=t.global.def("{}"),p=n.shader.progVar.append(t,l),m=l.def(p,".id"),y=l.def(h,"[",m,"]");l(t.shared.gl,".useProgram(",p,".program);","if(!",y,"){",y,"=",h,"[",m,"]=",t.link((function(e){return Z(rt,t,n,e,2)})),"(",p,");}",y,".call(this,a0[",s,"],",s,");")}}function st(t,e){var n=t.proc("batch",2);t.batchId="0",G(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(W(t,n,e.context),i=!1);var s=e.framebuffer,o=!1;function a(t){return t.contextDep&&r||t.propDep}s?(s.propDep?r=o=!0:s.contextDep&&r&&(o=!0),o||Y(t,n,s)):Y(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),H(t,n,e),q(t,n,e.state,(function(t){return!a(t)})),e.profile&&a(e.profile)||K(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=o;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)it(t,n,e,null);else{var c=u.append(t,n);if(n(t.shared.gl,".useProgram(",c,".program);"),e.shader.program)it(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var l=t.global.def("{}"),f=n.def(c,".id"),d=n.def(l,"[",f,"]");n(t.cond(d).then(d,".call(this,a0,a1);").else(d,"=",l,"[",f,"]=",t.link((function(n){return Z(it,t,e,n,2)})),"(",c,");",d,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function ot(t,e){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,s=i.current;function o(n){var s=e.shader[n];s&&r.set(i.shader,"."+n,s.append(t,r))}W(t,r,e.context),e.framebuffer&&e.framebuffer.append(t,r),oa(Object.keys(e.state)).forEach((function(n){var s=e.state[n].append(t,r);fn(s)?s.forEach((function(e,i){r.set(t.next[n],"["+i+"]",e)})):r.set(i.next,"."+n,s)})),K(t,r,e,!0,!0),[Ys,Gs,qs,Ks,Hs].forEach((function(n){var s=e.draw[n];s&&r.set(i.draw,"."+n,""+s.append(t,r))})),Object.keys(e.uniforms).forEach((function(s){var o=e.uniforms[s].append(t,r);Array.isArray(o)&&(o="["+o.join()+"]"),r.set(i.uniforms,"["+n.id(s)+"]",o)})),Object.keys(e.attributes).forEach((function(n){var i=e.attributes[n].append(t,r),s=t.scopeAttrib(n);Object.keys(new y).forEach((function(t){r.set(s,"."+t,i[t])}))})),e.scopeVAO&&r.set(i.vao,".targetVAO",e.scopeVAO.append(t,r)),o($s),o(Ws),Object.keys(e.state).length>0&&(r(s,".dirty=true;"),r.exit(s,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function at(t){if("object"==typeof t&&!fn(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(pt.isDynamic(t[e[n]]))return!0;return!1}}function ut(t,e,n){var r=e.static[n];if(r&&at(r)){var i=t.global,s=Object.keys(r),o=!1,a=!1,u=!1,c=t.global.def("{}");s.forEach((function(e){var n=r[e];if(pt.isDynamic(n)){"function"==typeof n&&(n=r[e]=pt.unbox(n));var s=la(n,null);o=o||s.thisDep,u=u||s.propDep,a=a||s.contextDep}else{switch(i(c,".",e,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n))}i(";")}})),e.dynamic[n]=new pt.DynamicVariable(fs,{thisDep:o,contextDep:a,propDep:u,ref:c,append:l}),delete e.static[n]}function l(t,e){s.forEach((function(n){var i=r[n];if(pt.isDynamic(i)){var s=t.invoke(e,i);e(c,".",n,"=",s,";")}}))}}function ct(t,n,r,i,s){var o=F();o.stats=o.link(s),Object.keys(n.static).forEach((function(t){ut(o,n,t)})),oo.forEach((function(e){ut(o,t,e)}));var a=$(t,n,r,i,o);return et(o,a),ot(o,a),st(o,a),e(o.compile(),{destroy:function(){a.shader.program.destroy()}})}return{next:x,current:_,procs:function(){var t=F(),e=t.proc("poll"),n=t.proc("refresh"),s=t.block();e(s),n(s);var o,a=t.shared,u=a.gl,c=a.next,l=a.current;s(l,".dirty=false;"),Y(t,e),Y(t,n,null,!0),g&&(o=t.link(g)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var d=n.def(a.attributes,"[",f,"]"),h=t.cond(d,".buffer");h.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",ao,",",d,".buffer.buffer);",u,".vertexAttribPointer(",f,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),n(h),g&&n(o,".vertexAttribDivisorANGLE(",f,",",d,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(S).forEach((function(r){var i=S[r],o=s.def(c,".",r),a=t.block();a("if(",o,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",l,".",r,"=",o,";"),n(a),e("if(",o,"!==",l,".",r,"){",a,"}")})),Object.keys(I).forEach((function(r){var i,o,a=I[r],f=_[r],d=t.block();if(d(u,".",a,"("),fn(f)){var h=f.length;i=t.global.def(c,".",r),o=t.global.def(l,".",r),d(Tt(h,(function(t){return i+"["+t+"]"})),");",Tt(h,(function(t){return o+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",Tt(h,(function(t){return i+"["+t+"]!=="+o+"["+t+"]"})).join("||"),"){",d,"}")}else i=s.def(c,".",r),o=s.def(l,".",r),d(i,");",l,".",r,"=",i,";"),e("if(",i,"!==",o,"){",d,"}");n(d)})),t.compile()}(),compile:ct}}function ha(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var pa=34918,ma=34919,ya=35007,ba=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var s=[];function o(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(ya,n),s.push(n),h(s.length-1,s.length,t)}function a(){e.ext_disjoint_timer_query.endQueryEXT(ya)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var c=[];function l(){return c.pop()||new u}function f(t){c.push(t)}var d=[];function h(t,e,n){var r=l();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,d.push(r)}var p=[],m=[];function y(){var t,n,r=s.length;if(0!==r){m.length=Math.max(m.length,r+1),p.length=Math.max(p.length,r+1),p[0]=0,m[0]=0;var o=0;for(t=0,n=0;n<s.length;++n){var a=s[n];e.ext_disjoint_timer_query.getQueryObjectEXT(a,ma)?(o+=e.ext_disjoint_timer_query.getQueryObjectEXT(a,pa),i(a)):s[t++]=a,p[n+1]=o,m[n+1]=t}for(s.length=t,t=0,n=0;n<d.length;++n){var u=d[n],c=u.startQueryIndex,l=u.endQueryIndex;u.sum+=p[l]-p[c];var h=m[c],y=m[l];y===h?(u.stats.gpuTime+=u.sum/1e6,f(u)):(u.startQueryIndex=h,u.endQueryIndex=y,d[t++]=u)}d.length=t}}return{beginQuery:o,endQuery:a,pushScopeStats:h,update:y,getNumPendingQueries:function(){return s.length},clear:function(){n.push.apply(n,s);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);s.length=0,n.length=0},restore:function(){s.length=0,n.length=0}}},ga=16384,va=256,wa=1024,_a=34962,xa="webglcontextlost",Aa="webglcontextrestored",Sa=1,Ia=2,Ta=3;function Oa(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function Ma(t){var n=St(t);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),s=r.isContextLost(),o=It(r,n);if(!o)return null;var a=bt(),u=ha(),c=o.extensions,l=ba(r,c),f=yt(),d=r.drawingBufferWidth,h=r.drawingBufferHeight,p={tick:0,time:0,viewportWidth:d,viewportHeight:h,framebufferWidth:d,framebufferHeight:h,drawingBufferWidth:d,drawingBufferHeight:h,pixelRatio:n.pixelRatio},m={},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},b=xe(r,c),g=Ye(r,u,n,_),v=on(r,c,g,u),w=$i(r,c,b,u,g,v,y);function _(t){return w.destroyBuffer(t)}var x=Gi(r,a,u,n),A=Kr(r,c,b,(function(){T.procs.poll()}),p,u,n),S=ci(r,c,b,u,n),I=Ui(r,c,b,A,S,u),T=da(r,a,c,b,g,v,A,I,m,w,x,y,p,l,n),O=Zi(r,I,T.procs.poll,p,i,c,b),M=T.next,B=r.canvas,D=[],E=[],F=[],k=[n.onDestroy],N=null;function C(){if(0===D.length)return l&&l.update(),void(N=null);N=mt.next(C),q();for(var t=D.length-1;t>=0;--t){var e=D[t];e&&e(p,null,0)}r.flush(),l&&l.update()}function L(){!N&&D.length>0&&(N=mt.next(C))}function U(){N&&(mt.cancel(C),N=null)}function j(t){t.preventDefault(),s=!0,U(),E.forEach((function(t){t()}))}function z(t){r.getError(),s=!1,o.restore(),x.restore(),g.restore(),A.restore(),S.restore(),I.restore(),w.restore(),l&&l.restore(),T.procs.refresh(),L(),F.forEach((function(t){t()}))}function V(){D.length=0,U(),B&&(B.removeEventListener(xa,j),B.removeEventListener(Aa,z)),x.clear(),I.clear(),S.clear(),w.clear(),A.clear(),v.clear(),g.clear(),l&&l.clear(),k.forEach((function(t){t()}))}function R(t){function n(t){var n=e({},t);function r(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(r){n[t+"."+r]=e[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(n.vao=t.vao),n}function r(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var s=t[i];if(pt.isDynamic(s))r[i]=pt.unbox(s,i);else{if(e&&Array.isArray(s))for(var o=0;o<s.length;++o)if(pt.isDynamic(s[o]))return void(r[i]=pt.unbox(s,i));n[i]=s}})),{dynamic:r,static:n}}nt(!!t,"invalid args to regl({...})"),nt.type(t,"object","invalid args to regl({...})");var i=r(t.context||{},!0),o=r(t.uniforms||{},!0),a=r(t.attributes||{},!1),u=r(n(t),!1),c={gpuTime:0,cpuTime:0,count:0},l=T.compile(u,a,o,i,c),f=l.draw,d=l.batch,h=l.scope,p=[];function m(t){for(;p.length<t;)p.push(null);return p}function y(t,e){var n;if(s&&nt.raise("context lost"),"function"==typeof t)return h.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(n=0;n<t;++n)h.call(this,null,e,n);else{if(!Array.isArray(t))return h.call(this,t,e,0);for(n=0;n<t.length;++n)h.call(this,t[n],e,n)}else if("number"==typeof t){if(t>0)return d.call(this,m(0|t),0|t)}else{if(!Array.isArray(t))return f.call(this,t);if(t.length)return d.call(this,t,t.length)}}return e(y,{stats:c,destroy:function(){l.destroy()}})}B&&(B.addEventListener(xa,j,!1),B.addEventListener(Aa,z,!1));var P=I.setFBO=R({framebuffer:pt.define.call(null,Sa,"framebuffer")});function $(t,e){var n=0;T.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=ga),"depth"in e&&(r.clearDepth(+e.depth),n|=va),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=wa),nt(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function W(t){if(nt("object"==typeof t&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var n=0;n<6;++n)P(e({framebuffer:t.framebuffer.faces[n]},t),$);else P(t,$);else $(null,t)}function Y(t){function e(){var e=Oa(D,t);function n(){var t=Oa(D,n);D[t]=D[D.length-1],D.length-=1,D.length<=0&&U()}nt(e>=0,"cannot cancel a frame twice"),D[e]=n}return nt.type(t,"function","regl.frame() callback must be a function"),D.push(t),L(),{cancel:e}}function H(){var t=M.viewport,e=M.scissor_box;t[0]=t[1]=e[0]=e[1]=0,p.viewportWidth=p.framebufferWidth=p.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,p.viewportHeight=p.framebufferHeight=p.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function q(){p.tick+=1,p.time=K(),H(),T.procs.poll()}function G(){A.refresh(),H(),T.procs.refresh(),l&&l.update()}function K(){return(yt()-f)/1e3}function Q(t,e){var n;switch(nt.type(e,"function","listener callback must be a function"),t){case"frame":return Y(e);case"lost":n=E;break;case"restore":n=F;break;case"destroy":n=k;break;default:nt.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}G();var J=e(R,{clear:W,prop:pt.define.bind(null,Sa),context:pt.define.bind(null,Ia),this:pt.define.bind(null,Ta),draw:R({}),buffer:function(t){return g.create(t,_a,!1,!1)},elements:function(t){return v.create(t,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:S.create,framebuffer:I.create,framebufferCube:I.createCube,vao:w.createVAO,attributes:i,frame:Y,on:Q,limits:b,hasExtension:function(t){return b.extensions.indexOf(t.toLowerCase())>=0},read:O,destroy:V,_gl:r,_refresh:G,poll:function(){q(),l&&l.update()},now:K,stats:u});return n.onDone(null,J),J}return Ma}();function it(t){return t}function st(t){return"translate("+t+",0)"}function ot(t){return"translate(0,"+t+")"}function at(t){return e=>+t(e)}function ut(t,e){return e=Math.max(0,t.bandwidth()-2*e)/2,t.round()&&(e=Math.round(e)),n=>+t(n)+e}function ct(){return!this.__axis}function lt(t,e){var n=[],r=null,i=null,s=6,o=6,a=3,u="undefined"!=typeof window&&window.devicePixelRatio>1?0:.5,c=1===t||4===t?-1:1,l=4===t||2===t?"x":"y",f=1===t||3===t?st:ot;function d(d){var h=null==r?e.ticks?e.ticks.apply(e,n):e.domain():r,p=null==i?e.tickFormat?e.tickFormat.apply(e,n):it:i,m=Math.max(s,0)+a,y=e.range(),b=+y[0]+u,g=+y[y.length-1]+u,v=(e.bandwidth?ut:at)(e.copy(),u),w=d.selection?d.selection():d,_=w.selectAll(".domain").data([null]),x=w.selectAll(".tick").data(h,e).order(),A=x.exit(),S=x.enter().append("g").attr("class","tick"),I=x.select("line"),T=x.select("text");_=_.merge(_.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),x=x.merge(S),I=I.merge(S.append("line").attr("stroke","currentColor").attr(l+"2",c*s)),T=T.merge(S.append("text").attr("fill","currentColor").attr(l,c*m).attr("dy",1===t?"0em":3===t?"0.71em":"0.32em")),d!==w&&(_=_.transition(d),x=x.transition(d),I=I.transition(d),T=T.transition(d),A=A.transition(d).attr("opacity",1e-6).attr("transform",(function(t){return isFinite(t=v(t))?f(t+u):this.getAttribute("transform")})),S.attr("opacity",1e-6).attr("transform",(function(t){var e=this.parentNode.__axis;return f((e&&isFinite(e=e(t))?e:v(t))+u)}))),A.remove(),_.attr("d",4===t||2===t?o?"M"+c*o+","+b+"H"+u+"V"+g+"H"+c*o:"M"+u+","+b+"V"+g:o?"M"+b+","+c*o+"V"+u+"H"+g+"V"+c*o:"M"+b+","+u+"H"+g),x.attr("opacity",1).attr("transform",(function(t){return f(v(t)+u)})),I.attr(l+"2",c*s),T.attr(l,c*m).text(p),w.filter(ct).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===t?"start":4===t?"end":"middle"),w.each((function(){this.__axis=v}))}return d.scale=function(t){return arguments.length?(e=t,d):e},d.ticks=function(){return n=Array.from(arguments),d},d.tickArguments=function(t){return arguments.length?(n=null==t?[]:Array.from(t),d):n.slice()},d.tickValues=function(t){return arguments.length?(r=null==t?null:Array.from(t),d):r&&r.slice()},d.tickFormat=function(t){return arguments.length?(i=t,d):i},d.tickSize=function(t){return arguments.length?(s=o=+t,d):s},d.tickSizeInner=function(t){return arguments.length?(s=+t,d):s},d.tickSizeOuter=function(t){return arguments.length?(o=+t,d):o},d.tickPadding=function(t){return arguments.length?(a=+t,d):a},d.offset=function(t){return arguments.length?(u=+t,d):u},d}function ft(t){return lt(2,t)}function dt(t){return lt(3,t)}function ht(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function pt(t){let e=t,n=t;function r(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const s=r+i>>>1;n(t[s],e)<0?r=s+1:i=s}return r}return 1===t.length&&(e=(e,n)=>t(e)-n,n=function(t){return(e,n)=>ht(t(e),n)}(t)),{left:r,center:function(t,n,i,s){null==i&&(i=0),null==s&&(s=t.length);const o=r(t,n,i,s-1);return o>i&&e(t[o-1],n)>-e(t[o],n)?o-1:o},right:function(t,e,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){const s=r+i>>>1;n(t[s],e)>0?i=s:r=s+1}return r}}}const mt=pt(ht).right;pt((function(t){return null===t?NaN:+t})).center;var yt=Math.sqrt(50),bt=Math.sqrt(10),gt=Math.sqrt(2);function vt(t,e,n){var r,i,s,o,a=-1;if(n=+n,(t=+t)===(e=+e)&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(o=wt(t,e,n))||!isFinite(o))return[];if(o>0){let n=Math.round(t/o),r=Math.round(e/o);for(n*o<t&&++n,r*o>e&&--r,s=new Array(i=r-n+1);++a<i;)s[a]=(n+a)*o}else{o=-o;let n=Math.round(t*o),r=Math.round(e*o);for(n/o<t&&++n,r/o>e&&--r,s=new Array(i=r-n+1);++a<i;)s[a]=(n+a)/o}return r&&s.reverse(),s}function wt(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,i);return i>=0?(s>=yt?10:s>=bt?5:s>=gt?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(s>=yt?10:s>=bt?5:s>=gt?2:1)}function _t(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}function xt(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function At(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function St(){}var It=1/.7,Tt="\\s*([+-]?\\d+)\\s*",Ot="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Mt="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Bt=/^#([0-9a-f]{3,8})$/,Dt=new RegExp("^rgb\\("+[Tt,Tt,Tt]+"\\)$"),Et=new RegExp("^rgb\\("+[Mt,Mt,Mt]+"\\)$"),Ft=new RegExp("^rgba\\("+[Tt,Tt,Tt,Ot]+"\\)$"),kt=new RegExp("^rgba\\("+[Mt,Mt,Mt,Ot]+"\\)$"),Nt=new RegExp("^hsl\\("+[Ot,Mt,Mt]+"\\)$"),Ct=new RegExp("^hsla\\("+[Ot,Mt,Mt,Ot]+"\\)$"),Lt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ut(){return this.rgb().formatHex()}function jt(){return this.rgb().formatRgb()}function zt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Bt.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Vt(e):3===n?new Wt(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Rt(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Rt(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Dt.exec(t))?new Wt(e[1],e[2],e[3],1):(e=Et.exec(t))?new Wt(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Ft.exec(t))?Rt(e[1],e[2],e[3],e[4]):(e=kt.exec(t))?Rt(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=Nt.exec(t))?Gt(e[1],e[2]/100,e[3]/100,1):(e=Ct.exec(t))?Gt(e[1],e[2]/100,e[3]/100,e[4]):Lt.hasOwnProperty(t)?Vt(Lt[t]):"transparent"===t?new Wt(NaN,NaN,NaN,0):null}function Vt(t){return new Wt(t>>16&255,t>>8&255,255&t,1)}function Rt(t,e,n,r){return r<=0&&(t=e=n=NaN),new Wt(t,e,n,r)}function Pt(t){return t instanceof St||(t=zt(t)),t?new Wt((t=t.rgb()).r,t.g,t.b,t.opacity):new Wt}function $t(t,e,n,r){return 1===arguments.length?Pt(t):new Wt(t,e,n,null==r?1:r)}function Wt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Yt(){return"#"+qt(this.r)+qt(this.g)+qt(this.b)}function Ht(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function qt(t){return((t=Math.max(0,Math.min(255,Math.round(t)||0)))<16?"0":"")+t.toString(16)}function Gt(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Qt(t,e,n,r)}function Kt(t){if(t instanceof Qt)return new Qt(t.h,t.s,t.l,t.opacity);if(t instanceof St||(t=zt(t)),!t)return new Qt;if(t instanceof Qt)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,u=(s+i)/2;return a?(o=e===s?(n-r)/a+6*(n<r):n===s?(r-e)/a+2:(e-n)/a+4,a/=u<.5?s+i:2-s-i,o*=60):a=u>0&&u<1?0:o,new Qt(o,a,u,t.opacity)}function Qt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function Jt(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}xt(St,zt,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Ut,formatHex:Ut,formatHsl:function(){return Kt(this).formatHsl()},formatRgb:jt,toString:jt}),xt(Wt,$t,At(St,{brighter:function(t){return t=null==t?It:Math.pow(It,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Wt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Yt,formatHex:Yt,formatRgb:Ht,toString:Ht})),xt(Qt,(function(t,e,n,r){return 1===arguments.length?Kt(t):new Qt(t,e,n,null==r?1:r)}),At(St,{brighter:function(t){return t=null==t?It:Math.pow(It,t),new Qt(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?.7:Math.pow(.7,t),new Qt(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Wt(Jt(t>=240?t-240:t+120,i,r),Jt(t,i,r),Jt(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return(1===(t=isNaN(t)?1:Math.max(0,Math.min(1,t)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var Xt=t=>()=>t;function Zt(t){return 1==(t=+t)?te:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Xt(isNaN(e)?n:e)}}function te(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):Xt(isNaN(t)?e:t)}var ee=function t(e){var n=Zt(e);function r(t,e){var r=n((t=$t(t)).r,(e=$t(e)).r),i=n(t.g,e.g),s=n(t.b,e.b),o=te(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=s(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function ne(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(s){for(n=0;n<r;++n)i[n]=t[n]*(1-s)+e[n]*s;return i}}function re(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,s=new Array(i),o=new Array(r);for(n=0;n<i;++n)s[n]=le(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<i;++n)o[n]=s[n](t);return o}}function ie(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function se(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function oe(t,e){var n,r={},i={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=le(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var ae=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ue=new RegExp(ae.source,"g");function ce(t,e){var n,r,i,s=ae.lastIndex=ue.lastIndex=0,o=-1,a=[],u=[];for(t+="",e+="";(n=ae.exec(t))&&(r=ue.exec(e));)(i=r.index)>s&&(i=e.slice(s,i),a[o]?a[o]+=i:a[++o]=i),(n=n[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,u.push({i:o,x:se(n,r)})),s=ue.lastIndex;return s<e.length&&(i=e.slice(s),a[o]?a[o]+=i:a[++o]=i),a.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)a[(n=u[r]).i]=n.x(t);return a.join("")})}function le(t,e){var n,r,i=typeof e;return null==e||"boolean"===i?Xt(e):("number"===i?se:"string"===i?(n=zt(e))?(e=n,ee):ce:e instanceof zt?ee:e instanceof Date?ie:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?re:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?oe:se:ne))(t,e)}function fe(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function de(t){return+t}var he=[0,1];function pe(t){return t}function me(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function ye(t,e,n){var r=t[0],i=t[1],s=e[0],o=e[1];return i<r?(r=me(i,r),s=n(o,s)):(r=me(r,i),s=n(s,o)),function(t){return s(r(t))}}function be(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=me(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(e){var n=mt(t,e,1,r)-1;return s[n](i[n](e))}}function ge(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function ve(){var t,e,n,r,i,s,o=he,a=he,u=le,c=pe;function l(){var t,e,n,u=Math.min(o.length,a.length);return c!==pe&&(t=o[0],e=o[u-1],t>e&&(n=t,t=e,e=n),c=function(n){return Math.max(t,Math.min(e,n))}),r=u>2?be:ye,i=s=null,f}function f(e){return null==e||isNaN(e=+e)?n:(i||(i=r(o.map(t),a,u)))(t(c(e)))}return f.invert=function(n){return c(e((s||(s=r(a,o.map(t),se)))(n)))},f.domain=function(t){return arguments.length?(o=Array.from(t,de),l()):o.slice()},f.range=function(t){return arguments.length?(a=Array.from(t),l()):a.slice()},f.rangeRound=function(t){return a=Array.from(t),u=fe,l()},f.clamp=function(t){return arguments.length?(c=!!t||pe,l()):c!==pe},f.interpolate=function(t){return arguments.length?(u=t,l()):u},f.unknown=function(t){return arguments.length?(n=t,f):n},function(n,r){return t=n,e=r,l()}}function we(){return ve()(pe,pe)}function _e(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function xe(t){return(t=_e(Math.abs(t)))?t[1]:NaN}var Ae,Se=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ie(t){if(!(e=Se.exec(t)))throw new Error("invalid format: "+t);var e;return new Te({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Te(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Oe(t,e){var n=_e(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Ie.prototype=Te.prototype,Te.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Me={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Oe(100*t,e),r:Oe,s:function(t,e){var n=_e(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(Ae=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+_e(t,Math.max(0,e+s-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Be(t){return t}var De,Ee,Fe,ke=Array.prototype.map,Ne=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Ce(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Be:(e=ke.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,s=[],o=0,a=e[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(t.substring(i-=a,i+a)),!((u+=a+1)>r));)a=e[o=(o+1)%e.length];return s.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",s=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",a=void 0===t.numerals?Be:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(ke.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",c=void 0===t.minus?"−":t.minus+"",l=void 0===t.nan?"NaN":t.nan+"";function f(t){var e=(t=Ie(t)).fill,n=t.align,f=t.sign,d=t.symbol,h=t.zero,p=t.width,m=t.comma,y=t.precision,b=t.trim,g=t.type;"n"===g?(m=!0,g="g"):Me[g]||(void 0===y&&(y=12),b=!0,g="g"),(h||"0"===e&&"="===n)&&(h=!0,e="0",n="=");var v="$"===d?i:"#"===d&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",w="$"===d?s:/[%p]/.test(g)?u:"",_=Me[g],x=/[defgprs%]/.test(g);function A(t){var i,s,u,d=v,A=w;if("c"===g)A=_(t)+A,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?l:_(Math.abs(t),y),b&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),S&&0==+t&&"+"!==f&&(S=!1),d=(S?"("===f?f:c:"-"===f||"("===f?"":f)+d,A=("s"===g?Ne[8+Ae/3]:"")+A+(S&&"("===f?")":""),x)for(i=-1,s=t.length;++i<s;)if(48>(u=t.charCodeAt(i))||u>57){A=(46===u?o+t.slice(i+1):t.slice(i))+A,t=t.slice(0,i);break}}m&&!h&&(t=r(t,1/0));var I=d.length+t.length+A.length,T=I<p?new Array(p-I+1).join(e):"";switch(m&&h&&(t=r(T+t,T.length?p-A.length:1/0),T=""),n){case"<":t=d+t+A+T;break;case"=":t=d+T+t+A;break;case"^":t=T.slice(0,I=T.length>>1)+d+t+A+T.slice(I);break;default:t=T+d+t+A}return a(t)}return y=void 0===y?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),A.toString=function(){return t+""},A}return{format:f,formatPrefix:function(t,e){var n=f(((t=Ie(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(xe(e)/3))),i=Math.pow(10,-r),s=Ne[8+r/3];return function(t){return n(i*t)+s}}}}function Le(t,e,n,r){var i,s=function(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),s=r/i;return s>=yt?i*=10:s>=bt?i*=5:s>=gt&&(i*=2),e<t?-i:i}(t,e,n);switch((r=Ie(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(xe(e)/3)))-xe(Math.abs(t)))}(s,o))||(r.precision=i),Fe(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,xe(e)-xe(t))+1}(s,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(t){return Math.max(0,-xe(Math.abs(t)))}(s))||(r.precision=i-2*("%"===r.type))}return Ee(r)}function Ue(t){var e=t.domain;return t.ticks=function(t){var n=e();return vt(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return Le(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i,s=e(),o=0,a=s.length-1,u=s[o],c=s[a],l=10;for(c<u&&(i=u,u=c,c=i,i=o,o=a,a=i);l-- >0;){if((i=wt(u,c,n))===r)return s[o]=u,s[a]=c,e(s);if(i>0)u=Math.floor(u/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,c=Math.floor(c*i)/i}r=i}return t},t}function je(){var t=we();return t.copy=function(){return ge(t,je())},_t.apply(t,arguments),Ue(t)}function ze(t){return Math.log(t)}function Ve(t){return Math.exp(t)}function Re(t){return-Math.log(-t)}function Pe(t){return-Math.exp(-t)}function $e(t){return isFinite(t)?+("1e"+t):t<0?0:t}function We(t){return function(e){return-t(-e)}}function Ye(t){var e,n,r=t(ze,Ve),i=r.domain,s=10;function o(){return e=function(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}(s),n=function(t){return 10===t?$e:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}(s),i()[0]<0?(e=We(e),n=We(n),t(Re,Pe)):t(ze,Ve),r}return r.base=function(t){return arguments.length?(s=+t,o()):s},r.domain=function(t){return arguments.length?(i(t),o()):i()},r.ticks=function(t){var r,o=i(),a=o[0],u=o[o.length-1];(r=u<a)&&(d=a,a=u,u=d);var c,l,f,d=e(a),h=e(u),p=null==t?10:+t,m=[];if(!(s%1)&&h-d<p){if(d=Math.floor(d),h=Math.ceil(h),a>0){for(;d<=h;++d)for(l=1,c=n(d);l<s;++l)if(!((f=c*l)<a)){if(f>u)break;m.push(f)}}else for(;d<=h;++d)for(l=s-1,c=n(d);l>=1;--l)if(!((f=c*l)<a)){if(f>u)break;m.push(f)}2*m.length<p&&(m=vt(a,u,p))}else m=vt(d,h,Math.min(h-d,p)).map(n);return r?m.reverse():m},r.tickFormat=function(t,i){if(null==i&&(i=10===s?".0e":","),"function"!=typeof i&&(i=Ee(i)),t===1/0)return i;null==t&&(t=10);var o=Math.max(1,s*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*s<s-.5&&(r*=s),r<=o?i(t):""}},r.nice=function(){return i(function(t,e){var n,r=0,i=(t=t.slice()).length-1,s=t[r],o=t[i];return o<s&&(n=r,r=i,i=n,n=s,s=o,o=n),t[r]=e.floor(s),t[i]=e.ceil(o),t}(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function He(){var t=Ye(ve()).domain([1,10]);return t.copy=function(){return ge(t,He()).base(t.base())},_t.apply(t,arguments),t}De=Ce({thousands:",",grouping:[3],currency:["$",""]}),Ee=De.format,Fe=De.formatPrefix;var qe="http://www.w3.org/1999/xhtml",Ge={svg:"http://www.w3.org/2000/svg",xhtml:qe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ke(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Ge.hasOwnProperty(e)?{space:Ge[e],local:t}:t}function Qe(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===qe&&e.documentElement.namespaceURI===qe?e.createElement(t):e.createElementNS(n,t)}}function Je(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Xe(t){var e=Ke(t);return(e.local?Je:Qe)(e)}function Ze(){}function tn(t){return null==t?Ze:function(){return this.querySelector(t)}}function en(t){return null==t?[]:Array.isArray(t)?t:Array.from(t)}function nn(){return[]}function rn(t){return function(e){return e.matches(t)}}var sn=Array.prototype.find;function on(){return this.firstElementChild}var an=Array.prototype.filter;function un(){return Array.from(this.children)}function cn(t){return new Array(t.length)}function ln(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function fn(t){return function(){return t}}function dn(t,e,n,r,i,s){for(var o,a=0,u=e.length,c=s.length;a<c;++a)(o=e[a])?(o.__data__=s[a],r[a]=o):n[a]=new ln(t,s[a]);for(;a<u;++a)(o=e[a])&&(i[a]=o)}function hn(t,e,n,r,i,s,o){var a,u,c,l=new Map,f=e.length,d=s.length,h=new Array(f);for(a=0;a<f;++a)(u=e[a])&&(h[a]=c=o.call(u,u.__data__,a,e)+"",l.has(c)?i[a]=u:l.set(c,u));for(a=0;a<d;++a)c=o.call(t,s[a],a,s)+"",(u=l.get(c))?(r[a]=u,u.__data__=s[a],l.delete(c)):n[a]=new ln(t,s[a]);for(a=0;a<f;++a)(u=e[a])&&l.get(h[a])===u&&(i[a]=u)}function pn(t){return t.__data__}function mn(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function yn(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function bn(t){return function(){this.removeAttribute(t)}}function gn(t){return function(){this.removeAttributeNS(t.space,t.local)}}function vn(t,e){return function(){this.setAttribute(t,e)}}function wn(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function _n(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function xn(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function An(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Sn(t){return function(){this.style.removeProperty(t)}}function In(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Tn(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function On(t,e){return t.style.getPropertyValue(e)||An(t).getComputedStyle(t,null).getPropertyValue(e)}function Mn(t){return function(){delete this[t]}}function Bn(t,e){return function(){this[t]=e}}function Dn(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function En(t){return t.trim().split(/^|\s+/)}function Fn(t){return t.classList||new kn(t)}function kn(t){this._node=t,this._names=En(t.getAttribute("class")||"")}function Nn(t,e){for(var n=Fn(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Cn(t,e){for(var n=Fn(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Ln(t){return function(){Nn(this,t)}}function Un(t){return function(){Cn(this,t)}}function jn(t,e){return function(){(e.apply(this,arguments)?Nn:Cn)(this,t)}}function zn(){this.textContent=""}function Vn(t){return function(){this.textContent=t}}function Rn(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Pn(){this.innerHTML=""}function $n(t){return function(){this.innerHTML=t}}function Wn(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Yn(){this.nextSibling&&this.parentNode.appendChild(this)}function Hn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qn(){return null}function Gn(){var t=this.parentNode;t&&t.removeChild(this)}function Kn(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Qn(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Jn(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}function Xn(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,s=e.length;r<s;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function Zn(t,e,n){return function(){var r,i=this.__on,s=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),void(r.value=e);this.addEventListener(t.type,s,n),r={type:t.type,name:t.name,value:e,listener:s,options:n},i?i.push(r):this.__on=[r]}}function tr(t,e,n){var r=An(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function er(t,e){return function(){return tr(this,t,e)}}function nr(t,e){return function(){return tr(this,t,e.apply(this,arguments))}}ln.prototype={constructor:ln,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}},kn.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var rr=[null];function ir(t,e){this._groups=t,this._parents=e}function sr(t){return"string"==typeof t?new ir([[document.querySelector(t)]],[document.documentElement]):new ir([[t]],rr)}ir.prototype={constructor:ir,select:function(t){"function"!=typeof t&&(t=tn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var s,o,a=e[i],u=a.length,c=r[i]=new Array(u),l=0;l<u;++l)(s=a[l])&&(o=t.call(s,s.__data__,l,a))&&("__data__"in s&&(o.__data__=s.__data__),c[l]=o);return new ir(r,this._parents)},selectAll:function(t){var e;"function"==typeof t?t=function(t){return function(){return en(t.apply(this,arguments))}}(t):t=null==(e=t)?nn:function(){return this.querySelectorAll(e)};for(var n=this._groups,r=n.length,i=[],s=[],o=0;o<r;++o)for(var a,u=n[o],c=u.length,l=0;l<c;++l)(a=u[l])&&(i.push(t.call(a,a.__data__,l,u)),s.push(a));return new ir(i,s)},selectChild:function(t){return this.select(null==t?on:function(t){return function(){return sn.call(this.children,t)}}("function"==typeof t?t:rn(t)))},selectChildren:function(t){return this.selectAll(null==t?un:function(t){return function(){return an.call(this.children,t)}}("function"==typeof t?t:rn(t)))},filter:function(t){var e;"function"!=typeof t&&(e=t,t=function(){return this.matches(e)});for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s)for(var o,a=n[s],u=a.length,c=i[s]=[],l=0;l<u;++l)(o=a[l])&&t.call(o,o.__data__,l,a)&&c.push(o);return new ir(i,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,pn);var n=e?hn:dn,r=this._parents,i=this._groups;"function"!=typeof t&&(t=fn(t));for(var s=i.length,o=new Array(s),a=new Array(s),u=new Array(s),c=0;c<s;++c){var l=r[c],f=i[c],d=f.length,h=mn(t.call(l,l&&l.__data__,c,r)),p=h.length,m=a[c]=new Array(p),y=o[c]=new Array(p),b=u[c]=new Array(d);n(l,f,m,y,b,h,e);for(var g,v,w=0,_=0;w<p;++w)if(g=m[w]){for(w>=_&&(_=w+1);!(v=y[_])&&++_<p;);g._next=v||null}}return(o=new ir(o,r))._enter=a,o._exit=u,o},enter:function(){return new ir(this._enter||this._groups.map(cn),this._parents)},exit:function(){return new ir(this._exit||this._groups.map(cn),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,s=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?s.remove():n(s),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,s=r.length,o=Math.min(i,s),a=new Array(i),u=0;u<o;++u)for(var c,l=n[u],f=r[u],d=l.length,h=a[u]=new Array(d),p=0;p<d;++p)(c=l[p]||f[p])&&(h[p]=c);for(;u<i;++u)a[u]=n[u];return new ir(a,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],s=i.length-1,o=i[s];--s>=0;)(r=i[s])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=yn);for(var n=this._groups,r=n.length,i=new Array(r),s=0;s<r;++s){for(var o,a=n[s],u=a.length,c=i[s]=new Array(u),l=0;l<u;++l)(o=a[l])&&(c[l]=o);c.sort(e)}return new ir(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,s=r.length;i<s;++i){var o=r[i];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,s=e[n],o=0,a=s.length;o<a;++o)(i=s[o])&&t.call(i,i.__data__,o,s);return this},attr:function(t,e){var n=Ke(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?gn:bn:"function"==typeof e?n.local?xn:_n:n.local?wn:vn)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?Sn:"function"==typeof e?Tn:In)(t,e,null==n?"":n)):On(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?Mn:"function"==typeof e?Dn:Bn)(t,e)):this.node()[t]},classed:function(t,e){var n=En(t+"");if(arguments.length<2){for(var r=Fn(this.node()),i=-1,s=n.length;++i<s;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?jn:e?Ln:Un)(n,e))},text:function(t){return arguments.length?this.each(null==t?zn:("function"==typeof t?Rn:Vn)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Pn:("function"==typeof t?Wn:$n)(t)):this.node().innerHTML},raise:function(){return this.each(Yn)},lower:function(){return this.each(Hn)},append:function(t){var e="function"==typeof t?t:Xe(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:Xe(t),r=null==e?qn:"function"==typeof e?e:tn(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Gn)},clone:function(t){return this.select(t?Qn:Kn)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,s=Jn(t+""),o=s.length;if(!(arguments.length<2)){for(a=e?Zn:Xn,r=0;r<o;++r)this.each(a(s[r],e,n));return this}var a=this.node().__on;if(a)for(var u,c=0,l=a.length;c<l;++c)for(r=0,u=a[c];r<o;++r)if((i=s[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?nr:er)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],s=0,o=i.length;s<o;++s)(r=i[s])&&(yield r)}};var or=function t(e){function n(t){return function(){return-Math.log1p(-e())/t}}return n.source=t,n}(Math.random);
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function ar(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{u(r.next(t))}catch(e){s(e)}}function a(t){try{u(r.throw(t))}catch(e){s(e)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}u((r=r.apply(t,e||[])).next())}))}function ur(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function cr(t){return this instanceof cr?(this.v=t,this):new cr(t)}function lr(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){s.push([t,e,n,r])>1||a(t,e)}))})}function a(t,e){try{(n=i[t](e)).value instanceof cr?Promise.resolve(n.value.v).then(u,c):l(s[0][2],n)}catch(r){l(s[0][3],r)}var n}function u(t){a("next",t)}function c(t){a("throw",t)}function l(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}}function fr(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:cr(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function dr(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=ur(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}const hr=new TextDecoder("utf-8"),pr=t=>hr.decode(t),mr=new TextEncoder,yr=t=>mr.encode(t),[br,gr]=(()=>{const t=()=>{throw new Error("BigInt is not available in this environment")};function e(){throw t()}return e.asIntN=()=>{throw t()},e.asUintN=()=>{throw t()},"undefined"!=typeof BigInt?[BigInt,!0]:[e,!1]})(),[vr,wr]=(()=>{const t=()=>{throw new Error("BigInt64Array is not available in this environment")};return"undefined"!=typeof BigInt64Array?[BigInt64Array,!0]:[class{static get BYTES_PER_ELEMENT(){return 8}static of(){throw t()}static from(){throw t()}constructor(){throw t()}},!1]})(),[_r,xr]=(()=>{const t=()=>{throw new Error("BigUint64Array is not available in this environment")};return"undefined"!=typeof BigUint64Array?[BigUint64Array,!0]:[class{static get BYTES_PER_ELEMENT(){return 8}static of(){throw t()}static from(){throw t()}constructor(){throw t()}},!1]})(),Ar=t=>"function"==typeof t,Sr=t=>null!=t&&Object(t)===t,Ir=t=>Sr(t)&&Ar(t.then),Tr=t=>Sr(t)&&Ar(t[Symbol.iterator]),Or=t=>Sr(t)&&Ar(t[Symbol.asyncIterator]),Mr=t=>Sr(t)&&Sr(t.schema),Br=t=>Sr(t)&&"done"in t&&"value"in t,Dr=t=>Sr(t)&&Ar(t.stat)&&(t=>"number"==typeof t)(t.fd),Er=t=>Sr(t)&&kr(t.body),Fr=t=>"_getDOMStream"in t&&"_getNodeStream"in t,kr=t=>Sr(t)&&Ar(t.cancel)&&Ar(t.getReader)&&!Fr(t),Nr=t=>Sr(t)&&Ar(t.read)&&Ar(t.pipe)&&(t=>"boolean"==typeof t)(t.readable)&&!Fr(t),Cr="undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;function Lr(t,e,n=0,r=e.byteLength){const i=t.byteLength,s=new Uint8Array(t.buffer,t.byteOffset,i),o=new Uint8Array(e.buffer,e.byteOffset,Math.min(r,i));return s.set(o,n),t}function Ur(t,e){const n=function(t){const e=t[0]?[t[0]]:[];let n,r,i,s;for(let o,a,u=0,c=0,l=t.length;++u<l;)o=e[c],a=t[u],!o||!a||o.buffer!==a.buffer||a.byteOffset<o.byteOffset?a&&(e[++c]=a):(({byteOffset:n,byteLength:i}=o),({byteOffset:r,byteLength:s}=a),n+i<r||r+s<n?a&&(e[++c]=a):e[c]=new Uint8Array(o.buffer,n,r-n+s));return e}(t),r=n.reduce(((t,e)=>t+e.byteLength),0);let i,s,o,a=0,u=-1;const c=Math.min(e||Number.POSITIVE_INFINITY,r);for(const l=n.length;++u<l;){if(i=n[u],s=i.subarray(0,Math.min(i.length,c-a)),c<=a+s.length){s.length<i.length?n[u]=i.subarray(s.length):s.length===i.length&&u++,o?Lr(o,s,a):o=s;break}Lr(o||(o=new Uint8Array(c)),s,a),a+=s.length}return[o||new Uint8Array(0),n.slice(u),r-(o?o.byteLength:0)]}function jr(t,e){let n=Br(e)?e.value:e;return n instanceof t?t===Uint8Array?new t(n.buffer,n.byteOffset,n.byteLength):n:n?("string"==typeof n&&(n=yr(n)),n instanceof ArrayBuffer||n instanceof Cr?new t(n):Sr(r=n)&&Ar(r.clear)&&Ar(r.bytes)&&Ar(r.position)&&Ar(r.setPosition)&&Ar(r.capacity)&&Ar(r.getBufferIdentifier)&&Ar(r.createLong)?jr(t,n.bytes()):ArrayBuffer.isView(n)?n.byteLength<=0?new t(0):new t(n.buffer,n.byteOffset,n.byteLength/t.BYTES_PER_ELEMENT):t.from(n)):new t(0);var r}const zr=t=>jr(Int32Array,t),Vr=t=>jr(Uint8Array,t),Rr=t=>(t.next(),t);const Pr=t=>function*(t,e){const n=function*(t){yield t},r="string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Cr?n(e):Tr(e)?e:n(e);return yield*Rr(function*(e){let n=null;do{n=e.next(yield jr(t,n))}while(!n.done)}(r[Symbol.iterator]())),new t}(Uint8Array,t);function $r(t,e){return lr(this,arguments,(function*(){if(Ir(e))return yield cr(yield cr(yield*fr(dr($r(t,yield cr(e))))));const n=function(t){return lr(this,arguments,(function*(){yield yield cr(yield cr(t))}))},r="string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Cr?n(e):Tr(e)?function(t){return lr(this,arguments,(function*(){yield cr(yield*fr(dr(Rr(function*(t){let e=null;do{e=t.next(yield null==e?void 0:e.value)}while(!e.done)}(t[Symbol.iterator]())))))}))}(e):Or(e)?e:n(e);return yield cr(yield*fr(dr(Rr(function(e){return lr(this,arguments,(function*(){let n=null;do{n=yield cr(e.next(yield yield cr(jr(t,n))))}while(!n.done)}))}(r[Symbol.asyncIterator]()))))),yield cr(new t)}))}const Wr=t=>$r(Uint8Array,t);var Yr={fromIterable:t=>Hr(function*(t){let e,n,r,i,s=!1,o=[],a=0;function u(){return"peek"===r?Ur(o,i)[0]:([n,o,a]=Ur(o,i),n)}({cmd:r,size:i}=yield null);const c=Pr(t)[Symbol.iterator]();try{do{if(({done:e,value:n}=Number.isNaN(i-a)?c.next():c.next(i-a)),!e&&n.byteLength>0&&(o.push(n),a+=n.byteLength),e||i<=a)do{({cmd:r,size:i}=yield u())}while(i<a)}while(!e)}catch(l){(s=!0)&&"function"==typeof c.throw&&c.throw(l)}finally{!1===s&&"function"==typeof c.return&&c.return(null)}return null}(t)),fromAsyncIterable:t=>Hr(function(t){return lr(this,arguments,(function*(){let e,n,r,i,s=!1,o=[],a=0;function u(){return"peek"===r?Ur(o,i)[0]:([n,o,a]=Ur(o,i),n)}({cmd:r,size:i}=yield yield cr(null));const c=Wr(t)[Symbol.asyncIterator]();try{do{if(({done:e,value:n}=Number.isNaN(i-a)?yield cr(c.next()):yield cr(c.next(i-a))),!e&&n.byteLength>0&&(o.push(n),a+=n.byteLength),e||i<=a)do{({cmd:r,size:i}=yield yield cr(u()))}while(i<a)}while(!e)}catch(l){(s=!0)&&"function"==typeof c.throw&&(yield cr(c.throw(l)))}finally{!1===s&&"function"==typeof c.return&&(yield cr(c.return(new Uint8Array(0))))}return yield cr(null)}))}(t)),fromDOMStream:t=>Hr(function(t){return lr(this,arguments,(function*(){let e,n,r,i=!1,s=!1,o=[],a=0;function u(){return"peek"===n?Ur(o,r)[0]:([e,o,a]=Ur(o,r),e)}({cmd:n,size:r}=yield yield cr(null));const c=new qr(t);try{do{if(({done:i,value:e}=Number.isNaN(r-a)?yield cr(c.read()):yield cr(c.read(r-a))),!i&&e.byteLength>0&&(o.push(Vr(e)),a+=e.byteLength),i||r<=a)do{({cmd:n,size:r}=yield yield cr(u()))}while(r<a)}while(!i)}catch(l){(s=!0)&&(yield cr(c.cancel(l)))}finally{!1===s?yield cr(c.cancel()):t.locked&&c.releaseLock()}return yield cr(null)}))}(t)),fromNodeStream:t=>Hr(function(t){return lr(this,arguments,(function*(){const e=[];let n,r,i,s="error",o=!1,a=null,u=0,c=[];function l(){return"peek"===n?Ur(c,r)[0]:([i,c,u]=Ur(c,r),i)}if(({cmd:n,size:r}=yield yield cr(null)),t.isTTY)return yield yield cr(new Uint8Array(0)),yield cr(null);try{e[0]=Gr(t,"end"),e[1]=Gr(t,"error");do{if(e[2]=Gr(t,"readable"),[s,a]=yield cr(Promise.race(e.map((t=>t[2])))),"error"===s)break;if((o="end"===s)||(Number.isFinite(r-u)?(i=Vr(t.read(r-u)),i.byteLength<r-u&&(i=Vr(t.read()))):i=Vr(t.read()),i.byteLength>0&&(c.push(i),u+=i.byteLength)),o||r<=u)do{({cmd:n,size:r}=yield yield cr(l()))}while(r<u)}while(!o)}finally{yield cr(f(e,"error"===s?a:null))}return yield cr(null);function f(e,n){return i=c=null,new Promise(((r,i)=>{for(const[n,o]of e)t.off(n,o);try{const e=t.destroy;e&&e.call(t,n),n=void 0}catch(s){n=s||n}finally{null!=n?i(n):r()}}))}}))}(t)),toDOMStream(t,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(t,e){throw new Error('"toNodeStream" not available in this environment')}};const Hr=t=>(t.next(),t);class qr{constructor(t){this.source=t,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch((()=>{}))}get closed(){return this.reader?this.reader.closed.catch((()=>{})):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(t){return ar(this,void 0,void 0,(function*(){const{reader:e,source:n}=this;e&&(yield e.cancel(t).catch((()=>{}))),n&&n.locked&&this.releaseLock()}))}read(t){return ar(this,void 0,void 0,(function*(){if(0===t)return{done:null==this.reader,value:new Uint8Array(0)};const e=yield this.reader.read();return!e.done&&(e.value=Vr(e)),e}))}}const Gr=(t,e)=>{const n=t=>r([e,t]);let r;return[e,n,new Promise((i=>(r=i)&&t.once(e,n)))]};var Kr,Qr,Jr,Xr,Zr,ti,ei,ni,ri,ii,si,oi,ai,ui,ci,li,fi,di;(Qr=Kr||(Kr={}))[Qr.V1=0]="V1",Qr[Qr.V2=1]="V2",Qr[Qr.V3=2]="V3",Qr[Qr.V4=3]="V4",Qr[Qr.V5=4]="V5",(Xr=Jr||(Jr={}))[Xr.Sparse=0]="Sparse",Xr[Xr.Dense=1]="Dense",(ti=Zr||(Zr={}))[ti.HALF=0]="HALF",ti[ti.SINGLE=1]="SINGLE",ti[ti.DOUBLE=2]="DOUBLE",(ni=ei||(ei={}))[ni.DAY=0]="DAY",ni[ni.MILLISECOND=1]="MILLISECOND",(ii=ri||(ri={}))[ii.SECOND=0]="SECOND",ii[ii.MILLISECOND=1]="MILLISECOND",ii[ii.MICROSECOND=2]="MICROSECOND",ii[ii.NANOSECOND=3]="NANOSECOND",(oi=si||(si={}))[oi.YEAR_MONTH=0]="YEAR_MONTH",oi[oi.DAY_TIME=1]="DAY_TIME",oi[oi.MONTH_DAY_NANO=2]="MONTH_DAY_NANO",(ui=ai||(ai={}))[ui.NONE=0]="NONE",ui[ui.Schema=1]="Schema",ui[ui.DictionaryBatch=2]="DictionaryBatch",ui[ui.RecordBatch=3]="RecordBatch",ui[ui.Tensor=4]="Tensor",ui[ui.SparseTensor=5]="SparseTensor",(li=ci||(ci={}))[li.NONE=0]="NONE",li[li.Null=1]="Null",li[li.Int=2]="Int",li[li.Float=3]="Float",li[li.Binary=4]="Binary",li[li.Utf8=5]="Utf8",li[li.Bool=6]="Bool",li[li.Decimal=7]="Decimal",li[li.Date=8]="Date",li[li.Time=9]="Time",li[li.Timestamp=10]="Timestamp",li[li.Interval=11]="Interval",li[li.List=12]="List",li[li.Struct=13]="Struct",li[li.Union=14]="Union",li[li.FixedSizeBinary=15]="FixedSizeBinary",li[li.FixedSizeList=16]="FixedSizeList",li[li.Map=17]="Map",li[li.Dictionary=-1]="Dictionary",li[li.Int8=-2]="Int8",li[li.Int16=-3]="Int16",li[li.Int32=-4]="Int32",li[li.Int64=-5]="Int64",li[li.Uint8=-6]="Uint8",li[li.Uint16=-7]="Uint16",li[li.Uint32=-8]="Uint32",li[li.Uint64=-9]="Uint64",li[li.Float16=-10]="Float16",li[li.Float32=-11]="Float32",li[li.Float64=-12]="Float64",li[li.DateDay=-13]="DateDay",li[li.DateMillisecond=-14]="DateMillisecond",li[li.TimestampSecond=-15]="TimestampSecond",li[li.TimestampMillisecond=-16]="TimestampMillisecond",li[li.TimestampMicrosecond=-17]="TimestampMicrosecond",li[li.TimestampNanosecond=-18]="TimestampNanosecond",li[li.TimeSecond=-19]="TimeSecond",li[li.TimeMillisecond=-20]="TimeMillisecond",li[li.TimeMicrosecond=-21]="TimeMicrosecond",li[li.TimeNanosecond=-22]="TimeNanosecond",li[li.DenseUnion=-23]="DenseUnion",li[li.SparseUnion=-24]="SparseUnion",li[li.IntervalDayTime=-25]="IntervalDayTime",li[li.IntervalYearMonth=-26]="IntervalYearMonth",(di=fi||(fi={}))[di.OFFSET=0]="OFFSET",di[di.DATA=1]="DATA",di[di.VALIDITY=2]="VALIDITY",di[di.TYPE=3]="TYPE";function hi(t){if(null===t)return"null";if(undefined===t)return"undefined";switch(typeof t){case"number":case"bigint":return`${t}`;case"string":return`"${t}"`}return"function"==typeof t[Symbol.toPrimitive]?t[Symbol.toPrimitive]("string"):ArrayBuffer.isView(t)?t instanceof BigInt64Array||t instanceof BigUint64Array?`[${[...t].map((t=>hi(t)))}]`:`[${t}]`:ArrayBuffer.isView(t)?`[${t}]`:JSON.stringify(t,((t,e)=>"bigint"==typeof e?`${e}`:e))}const pi=Symbol.for("isArrowBigNum");function mi(t,...e){return 0===e.length?Object.setPrototypeOf(jr(this.TypedArray,t),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(t,...e),this.constructor.prototype)}function yi(...t){return mi.apply(this,t)}function bi(...t){return mi.apply(this,t)}function gi(...t){return mi.apply(this,t)}function vi(t){const{buffer:e,byteOffset:n,length:r,signed:i}=t,s=new Int32Array(e,n,r);let o=0,a=0;const u=s.length;let c,l;for(;a<u;)l=s[a++],c=s[a++],i||(c>>>=0),o+=(l>>>0)+c*Math.pow(a,32);return o}let wi,_i;function xi(t){let e="";const n=new Uint32Array(2);let r=new Uint16Array(t.buffer,t.byteOffset,t.byteLength/2);const i=new Uint32Array((r=new Uint16Array(r).reverse()).buffer);let s=-1;const o=r.length-1;do{for(n[0]=r[s=0];s<o;)r[s++]=n[1]=n[0]/10,n[0]=(n[0]-10*n[1]<<16)+r[s];r[s]=n[1]=n[0]/10,n[0]=n[0]-10*n[1],e=`${n[0]}${e}`}while(i[0]||i[1]||i[2]||i[3]);return e||"0"}mi.prototype[pi]=!0,mi.prototype.toJSON=function(){return`"${wi(this)}"`},mi.prototype.valueOf=function(){return vi(this)},mi.prototype.toString=function(){return wi(this)},mi.prototype[Symbol.toPrimitive]=function(t="default"){switch(t){case"number":return vi(this);case"string":return wi(this);case"default":return _i(this)}return wi(this)},Object.setPrototypeOf(yi.prototype,Object.create(Int32Array.prototype)),Object.setPrototypeOf(bi.prototype,Object.create(Uint32Array.prototype)),Object.setPrototypeOf(gi.prototype,Object.create(Uint32Array.prototype)),Object.assign(yi.prototype,mi.prototype,{constructor:yi,signed:!0,TypedArray:Int32Array,BigIntArray:vr}),Object.assign(bi.prototype,mi.prototype,{constructor:bi,signed:!1,TypedArray:Uint32Array,BigIntArray:_r}),Object.assign(gi.prototype,mi.prototype,{constructor:gi,signed:!0,TypedArray:Uint32Array,BigIntArray:_r}),gr?(_i=t=>8===t.byteLength?new t.BigIntArray(t.buffer,t.byteOffset,1)[0]:xi(t),wi=t=>8===t.byteLength?`${new t.BigIntArray(t.buffer,t.byteOffset,1)[0]}`:xi(t)):(wi=xi,_i=wi);class Ai{static new(t,e){switch(e){case!0:return new yi(t);case!1:return new bi(t)}switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:case vr:return new yi(t)}return 16===t.byteLength?new gi(t):new bi(t)}static signed(t){return new yi(t)}static unsigned(t){return new bi(t)}static decimal(t){return new gi(t)}constructor(t,e){return Ai.new(t,e)}}var Si,Ii,Ti,Oi,Mi,Bi,Di,Ei,Fi,ki,Ni,Ci,Li,Ui,ji,zi,Vi,Ri,Pi,$i;class Wi{static isNull(t){return(null==t?void 0:t.typeId)===ci.Null}static isInt(t){return(null==t?void 0:t.typeId)===ci.Int}static isFloat(t){return(null==t?void 0:t.typeId)===ci.Float}static isBinary(t){return(null==t?void 0:t.typeId)===ci.Binary}static isUtf8(t){return(null==t?void 0:t.typeId)===ci.Utf8}static isBool(t){return(null==t?void 0:t.typeId)===ci.Bool}static isDecimal(t){return(null==t?void 0:t.typeId)===ci.Decimal}static isDate(t){return(null==t?void 0:t.typeId)===ci.Date}static isTime(t){return(null==t?void 0:t.typeId)===ci.Time}static isTimestamp(t){return(null==t?void 0:t.typeId)===ci.Timestamp}static isInterval(t){return(null==t?void 0:t.typeId)===ci.Interval}static isList(t){return(null==t?void 0:t.typeId)===ci.List}static isStruct(t){return(null==t?void 0:t.typeId)===ci.Struct}static isUnion(t){return(null==t?void 0:t.typeId)===ci.Union}static isFixedSizeBinary(t){return(null==t?void 0:t.typeId)===ci.FixedSizeBinary}static isFixedSizeList(t){return(null==t?void 0:t.typeId)===ci.FixedSizeList}static isMap(t){return(null==t?void 0:t.typeId)===ci.Map}static isDictionary(t){return(null==t?void 0:t.typeId)===ci.Dictionary}static isDenseUnion(t){return Wi.isUnion(t)&&t.mode===Jr.Dense}static isSparseUnion(t){return Wi.isUnion(t)&&t.mode===Jr.Sparse}get typeId(){return ci.NONE}}Si=Symbol.toStringTag,Wi[Si]=(($i=Wi.prototype).children=null,$i.ArrayType=Array,$i[Symbol.toStringTag]="DataType");class Yi extends Wi{toString(){return"Null"}get typeId(){return ci.Null}}Ii=Symbol.toStringTag,Yi[Ii]=Yi.prototype[Symbol.toStringTag]="Null";class Hi extends Wi{constructor(t,e){super(),this.isSigned=t,this.bitWidth=e}get typeId(){return ci.Int}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}Ti=Symbol.toStringTag,Hi[Ti]=(t=>(t.isSigned=null,t.bitWidth=null,t[Symbol.toStringTag]="Int"))(Hi.prototype);class qi extends Hi{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(class extends Hi{constructor(){super(!0,8)}get ArrayType(){return Int8Array}}.prototype,"ArrayType",{value:Int8Array}),Object.defineProperty(class extends Hi{constructor(){super(!0,16)}get ArrayType(){return Int16Array}}.prototype,"ArrayType",{value:Int16Array}),Object.defineProperty(qi.prototype,"ArrayType",{value:Int32Array}),Object.defineProperty(class extends Hi{constructor(){super(!0,64)}get ArrayType(){return BigInt64Array}}.prototype,"ArrayType",{value:BigInt64Array}),Object.defineProperty(class extends Hi{constructor(){super(!1,8)}get ArrayType(){return Uint8Array}}.prototype,"ArrayType",{value:Uint8Array}),Object.defineProperty(class extends Hi{constructor(){super(!1,16)}get ArrayType(){return Uint16Array}}.prototype,"ArrayType",{value:Uint16Array}),Object.defineProperty(class extends Hi{constructor(){super(!1,32)}get ArrayType(){return Uint32Array}}.prototype,"ArrayType",{value:Uint32Array}),Object.defineProperty(class extends Hi{constructor(){super(!1,64)}get ArrayType(){return BigUint64Array}}.prototype,"ArrayType",{value:BigUint64Array});class Gi extends Wi{constructor(t){super(),this.precision=t}get typeId(){return ci.Float}get ArrayType(){switch(this.precision){case Zr.HALF:return Uint16Array;case Zr.SINGLE:return Float32Array;case Zr.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}Oi=Symbol.toStringTag,Gi[Oi]=(t=>(t.precision=null,t[Symbol.toStringTag]="Float"))(Gi.prototype);Object.defineProperty(class extends Gi{constructor(){super(Zr.HALF)}}.prototype,"ArrayType",{value:Uint16Array}),Object.defineProperty(class extends Gi{constructor(){super(Zr.SINGLE)}}.prototype,"ArrayType",{value:Float32Array}),Object.defineProperty(class extends Gi{constructor(){super(Zr.DOUBLE)}}.prototype,"ArrayType",{value:Float64Array});class Ki extends Wi{constructor(){super()}get typeId(){return ci.Binary}toString(){return"Binary"}}Mi=Symbol.toStringTag,Ki[Mi]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Binary"))(Ki.prototype);class Qi extends Wi{constructor(){super()}get typeId(){return ci.Utf8}toString(){return"Utf8"}}Bi=Symbol.toStringTag,Qi[Bi]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Utf8"))(Qi.prototype);class Ji extends Wi{constructor(){super()}get typeId(){return ci.Bool}toString(){return"Bool"}}Di=Symbol.toStringTag,Ji[Di]=(t=>(t.ArrayType=Uint8Array,t[Symbol.toStringTag]="Bool"))(Ji.prototype);class Xi extends Wi{constructor(t,e,n=128){super(),this.scale=t,this.precision=e,this.bitWidth=n}get typeId(){return ci.Decimal}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}}Ei=Symbol.toStringTag,Xi[Ei]=(t=>(t.scale=null,t.precision=null,t.ArrayType=Uint32Array,t[Symbol.toStringTag]="Decimal"))(Xi.prototype);class Zi extends Wi{constructor(t){super(),this.unit=t}get typeId(){return ci.Date}toString(){return`Date${32*(this.unit+1)}<${ei[this.unit]}>`}}Fi=Symbol.toStringTag,Zi[Fi]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Date"))(Zi.prototype);class ts extends Wi{constructor(t,e){super(),this.unit=t,this.bitWidth=e}get typeId(){return ci.Time}toString(){return`Time${this.bitWidth}<${ri[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}ki=Symbol.toStringTag,ts[ki]=(t=>(t.unit=null,t.bitWidth=null,t[Symbol.toStringTag]="Time"))(ts.prototype);class es extends Wi{constructor(t,e){super(),this.unit=t,this.timezone=e}get typeId(){return ci.Timestamp}toString(){return`Timestamp<${ri[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}Ni=Symbol.toStringTag,es[Ni]=(t=>(t.unit=null,t.timezone=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Timestamp"))(es.prototype);class ns extends Wi{constructor(t){super(),this.unit=t}get typeId(){return ci.Interval}toString(){return`Interval<${si[this.unit]}>`}}Ci=Symbol.toStringTag,ns[Ci]=(t=>(t.unit=null,t.ArrayType=Int32Array,t[Symbol.toStringTag]="Interval"))(ns.prototype);class rs extends Wi{constructor(t){super(),this.children=[t]}get typeId(){return ci.List}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}}Li=Symbol.toStringTag,rs[Li]=(t=>(t.children=null,t[Symbol.toStringTag]="List"))(rs.prototype);class is extends Wi{constructor(t){super(),this.children=t}get typeId(){return ci.Struct}toString(){return`Struct<{${this.children.map((t=>`${t.name}:${t.type}`)).join(", ")}}>`}}Ui=Symbol.toStringTag,is[Ui]=(t=>(t.children=null,t[Symbol.toStringTag]="Struct"))(is.prototype);class ss extends Wi{constructor(t,e,n){super(),this.mode=t,this.children=n,this.typeIds=e=Int32Array.from(e),this.typeIdToChildIndex=e.reduce(((t,e,n)=>(t[e]=n)&&t||t),Object.create(null))}get typeId(){return ci.Union}toString(){return`${this[Symbol.toStringTag]}<${this.children.map((t=>`${t.type}`)).join(" | ")}>`}}ji=Symbol.toStringTag,ss[ji]=(t=>(t.mode=null,t.typeIds=null,t.children=null,t.typeIdToChildIndex=null,t.ArrayType=Int8Array,t[Symbol.toStringTag]="Union"))(ss.prototype);class os extends Wi{constructor(t){super(),this.byteWidth=t}get typeId(){return ci.FixedSizeBinary}toString(){return`FixedSizeBinary[${this.byteWidth}]`}}zi=Symbol.toStringTag,os[zi]=(t=>(t.byteWidth=null,t.ArrayType=Uint8Array,t[Symbol.toStringTag]="FixedSizeBinary"))(os.prototype);class as extends Wi{constructor(t,e){super(),this.listSize=t,this.children=[e]}get typeId(){return ci.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}Vi=Symbol.toStringTag,as[Vi]=(t=>(t.children=null,t.listSize=null,t[Symbol.toStringTag]="FixedSizeList"))(as.prototype);class us extends Wi{constructor(t,e=!1){super(),this.children=[t],this.keysSorted=e}get typeId(){return ci.Map}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map((t=>`${t.name}:${t.type}`)).join(", ")}}>`}}Ri=Symbol.toStringTag,us[Ri]=(t=>(t.children=null,t.keysSorted=null,t[Symbol.toStringTag]="Map_"))(us.prototype);const cs=(ls=-1,()=>++ls);var ls;class fs extends Wi{constructor(t,e,n,r){super(),this.indices=e,this.dictionary=t,this.isOrdered=r||!1,this.id=null==n?cs():"number"==typeof n?n:n.low}get typeId(){return ci.Dictionary}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}function ds(t){const e=t;switch(t.typeId){case ci.Decimal:return t.bitWidth/32;case ci.Timestamp:return 2;case ci.Date:case ci.Interval:return 1+e.unit;case ci.FixedSizeList:return e.listSize;case ci.FixedSizeBinary:return e.byteWidth;default:return 1}}Pi=Symbol.toStringTag,fs[Pi]=(t=>(t.id=null,t.indices=null,t.isOrdered=null,t.dictionary=null,t[Symbol.toStringTag]="Dictionary"))(fs.prototype);class hs{visitMany(t,...e){return t.map(((t,n)=>this.visit(t,...e.map((t=>t[n])))))}visit(...t){return this.getVisitFn(t[0],!1).apply(this,t)}getVisitFn(t,e=!0){return function(t,e,n=!0){if("number"==typeof e)return ps(t,e,n);if("string"==typeof e&&e in ci)return ps(t,ci[e],n);if(e&&e instanceof Wi)return ps(t,ms(e),n);if((null==e?void 0:e.type)&&e.type instanceof Wi)return ps(t,ms(e.type),n);return ps(t,ci.NONE,n)}(this,t,e)}getVisitFnByTypeId(t,e=!0){return ps(this,t,e)}visitNull(t,...e){return null}visitBool(t,...e){return null}visitInt(t,...e){return null}visitFloat(t,...e){return null}visitUtf8(t,...e){return null}visitBinary(t,...e){return null}visitFixedSizeBinary(t,...e){return null}visitDate(t,...e){return null}visitTimestamp(t,...e){return null}visitTime(t,...e){return null}visitDecimal(t,...e){return null}visitList(t,...e){return null}visitStruct(t,...e){return null}visitUnion(t,...e){return null}visitDictionary(t,...e){return null}visitInterval(t,...e){return null}visitFixedSizeList(t,...e){return null}visitMap(t,...e){return null}}function ps(t,e,n=!0){let r=null;switch(e){case ci.Null:r=t.visitNull;break;case ci.Bool:r=t.visitBool;break;case ci.Int:r=t.visitInt;break;case ci.Int8:r=t.visitInt8||t.visitInt;break;case ci.Int16:r=t.visitInt16||t.visitInt;break;case ci.Int32:r=t.visitInt32||t.visitInt;break;case ci.Int64:r=t.visitInt64||t.visitInt;break;case ci.Uint8:r=t.visitUint8||t.visitInt;break;case ci.Uint16:r=t.visitUint16||t.visitInt;break;case ci.Uint32:r=t.visitUint32||t.visitInt;break;case ci.Uint64:r=t.visitUint64||t.visitInt;break;case ci.Float:r=t.visitFloat;break;case ci.Float16:r=t.visitFloat16||t.visitFloat;break;case ci.Float32:r=t.visitFloat32||t.visitFloat;break;case ci.Float64:r=t.visitFloat64||t.visitFloat;break;case ci.Utf8:r=t.visitUtf8;break;case ci.Binary:r=t.visitBinary;break;case ci.FixedSizeBinary:r=t.visitFixedSizeBinary;break;case ci.Date:r=t.visitDate;break;case ci.DateDay:r=t.visitDateDay||t.visitDate;break;case ci.DateMillisecond:r=t.visitDateMillisecond||t.visitDate;break;case ci.Timestamp:r=t.visitTimestamp;break;case ci.TimestampSecond:r=t.visitTimestampSecond||t.visitTimestamp;break;case ci.TimestampMillisecond:r=t.visitTimestampMillisecond||t.visitTimestamp;break;case ci.TimestampMicrosecond:r=t.visitTimestampMicrosecond||t.visitTimestamp;break;case ci.TimestampNanosecond:r=t.visitTimestampNanosecond||t.visitTimestamp;break;case ci.Time:r=t.visitTime;break;case ci.TimeSecond:r=t.visitTimeSecond||t.visitTime;break;case ci.TimeMillisecond:r=t.visitTimeMillisecond||t.visitTime;break;case ci.TimeMicrosecond:r=t.visitTimeMicrosecond||t.visitTime;break;case ci.TimeNanosecond:r=t.visitTimeNanosecond||t.visitTime;break;case ci.Decimal:r=t.visitDecimal;break;case ci.List:r=t.visitList;break;case ci.Struct:r=t.visitStruct;break;case ci.Union:r=t.visitUnion;break;case ci.DenseUnion:r=t.visitDenseUnion||t.visitUnion;break;case ci.SparseUnion:r=t.visitSparseUnion||t.visitUnion;break;case ci.Dictionary:r=t.visitDictionary;break;case ci.Interval:r=t.visitInterval;break;case ci.IntervalDayTime:r=t.visitIntervalDayTime||t.visitInterval;break;case ci.IntervalYearMonth:r=t.visitIntervalYearMonth||t.visitInterval;break;case ci.FixedSizeList:r=t.visitFixedSizeList;break;case ci.Map:r=t.visitMap}if("function"==typeof r)return r;if(!n)return()=>null;throw new Error(`Unrecognized type '${ci[e]}'`)}function ms(t){switch(t.typeId){case ci.Null:return ci.Null;case ci.Int:{const{bitWidth:e,isSigned:n}=t;switch(e){case 8:return n?ci.Int8:ci.Uint8;case 16:return n?ci.Int16:ci.Uint16;case 32:return n?ci.Int32:ci.Uint32;case 64:return n?ci.Int64:ci.Uint64}return ci.Int}case ci.Float:switch(t.precision){case Zr.HALF:return ci.Float16;case Zr.SINGLE:return ci.Float32;case Zr.DOUBLE:return ci.Float64}return ci.Float;case ci.Binary:return ci.Binary;case ci.Utf8:return ci.Utf8;case ci.Bool:return ci.Bool;case ci.Decimal:return ci.Decimal;case ci.Time:switch(t.unit){case ri.SECOND:return ci.TimeSecond;case ri.MILLISECOND:return ci.TimeMillisecond;case ri.MICROSECOND:return ci.TimeMicrosecond;case ri.NANOSECOND:return ci.TimeNanosecond}return ci.Time;case ci.Timestamp:switch(t.unit){case ri.SECOND:return ci.TimestampSecond;case ri.MILLISECOND:return ci.TimestampMillisecond;case ri.MICROSECOND:return ci.TimestampMicrosecond;case ri.NANOSECOND:return ci.TimestampNanosecond}return ci.Timestamp;case ci.Date:switch(t.unit){case ei.DAY:return ci.DateDay;case ei.MILLISECOND:return ci.DateMillisecond}return ci.Date;case ci.Interval:switch(t.unit){case si.DAY_TIME:return ci.IntervalDayTime;case si.YEAR_MONTH:return ci.IntervalYearMonth}return ci.Interval;case ci.Map:return ci.Map;case ci.List:return ci.List;case ci.Struct:return ci.Struct;case ci.Union:switch(t.mode){case Jr.Dense:return ci.DenseUnion;case Jr.Sparse:return ci.SparseUnion}return ci.Union;case ci.FixedSizeBinary:return ci.FixedSizeBinary;case ci.FixedSizeList:return ci.FixedSizeList;case ci.Dictionary:return ci.Dictionary}throw new Error(`Unrecognized type '${ci[t.typeId]}'`)}hs.prototype.visitInt8=null,hs.prototype.visitInt16=null,hs.prototype.visitInt32=null,hs.prototype.visitInt64=null,hs.prototype.visitUint8=null,hs.prototype.visitUint16=null,hs.prototype.visitUint32=null,hs.prototype.visitUint64=null,hs.prototype.visitFloat16=null,hs.prototype.visitFloat32=null,hs.prototype.visitFloat64=null,hs.prototype.visitDateDay=null,hs.prototype.visitDateMillisecond=null,hs.prototype.visitTimestampSecond=null,hs.prototype.visitTimestampMillisecond=null,hs.prototype.visitTimestampMicrosecond=null,hs.prototype.visitTimestampNanosecond=null,hs.prototype.visitTimeSecond=null,hs.prototype.visitTimeMillisecond=null,hs.prototype.visitTimeMicrosecond=null,hs.prototype.visitTimeNanosecond=null,hs.prototype.visitDenseUnion=null,hs.prototype.visitSparseUnion=null,hs.prototype.visitIntervalDayTime=null,hs.prototype.visitIntervalYearMonth=null;const ys=new Float64Array(1),bs=new Uint32Array(ys.buffer);function gs(t){const e=(31744&t)>>10,n=(1023&t)/1024,r=Math.pow(-1,(32768&t)>>15);switch(e){case 31:return r*(n?Number.NaN:1/0);case 0:return r*(n?6103515625e-14*n:0)}return r*Math.pow(2,e-15)*(1+n)}class vs extends hs{}function ws(t){return(e,n,r)=>{if(e.setValid(n,null!=r))return t(e,n,r)}}const _s=(t,e,n)=>{t[e]=Math.trunc(n%4294967296),t[e+1]=Math.trunc(n/4294967296)},xs=(t,e,n,r)=>{const{[n]:i,[n+1]:s}=e;null!=i&&null!=s&&t.set(r.subarray(0,s-i),i)},As=({values:t},e,n)=>{t[e]=n},Ss=({values:t},e,n)=>{t[e]=n},Is=({values:t},e,n)=>{t[e]=function(t){if(t!=t)return 32256;ys[0]=t;const e=(2147483648&bs[1])>>16&65535;let n=2146435072&bs[1],r=0;return n>=1089470464?bs[0]>0?n=31744:(n=(2080374784&n)>>16,r=(1048575&bs[1])>>10):n<=1056964608?(r=1048576+(1048575&bs[1]),r=1048576+(r<<(n>>20)-998)>>21,n=0):(n=n-1056964608>>10,r=512+(1048575&bs[1])>>10),e|n|65535&r}(n)},Ts=({values:t},e,n)=>{((t,e,n)=>{t[e]=Math.trunc(n/864e5)})(t,e,n.valueOf())},Os=({values:t},e,n)=>{_s(t,2*e,n.valueOf())},Ms=({values:t},e,n)=>_s(t,2*e,n/1e3),Bs=({values:t},e,n)=>_s(t,2*e,n),Ds=({values:t},e,n)=>((t,e,n)=>{t[e]=Math.trunc(1e3*n%4294967296),t[e+1]=Math.trunc(1e3*n/4294967296)})(t,2*e,n),Es=({values:t},e,n)=>((t,e,n)=>{t[e]=Math.trunc(1e6*n%4294967296),t[e+1]=Math.trunc(1e6*n/4294967296)})(t,2*e,n),Fs=({values:t},e,n)=>{t[e]=n},ks=({values:t},e,n)=>{t[e]=n},Ns=({values:t},e,n)=>{t[e]=n},Cs=({values:t},e,n)=>{t[e]=n},Ls=(t,e,n)=>{const r=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[r];Vs.visit(i,t.valueOffsets[e],n)},Us=(t,e,n)=>{const r=t.type.typeIdToChildIndex[t.typeIds[e]],i=t.children[r];Vs.visit(i,e,n)},js=({values:t},e,n)=>{t.set(n.subarray(0,2),2*e)},zs=({values:t},e,n)=>{t[e]=12*n[0]+n[1]%12};vs.prototype.visitBool=ws((({offset:t,values:e},n,r)=>{const i=t+n;r?e[i>>3]|=1<<i%8:e[i>>3]&=~(1<<i%8)})),vs.prototype.visitInt=ws(As),vs.prototype.visitInt8=ws(As),vs.prototype.visitInt16=ws(As),vs.prototype.visitInt32=ws(As),vs.prototype.visitInt64=ws(As),vs.prototype.visitUint8=ws(As),vs.prototype.visitUint16=ws(As),vs.prototype.visitUint32=ws(As),vs.prototype.visitUint64=ws(As),vs.prototype.visitFloat=ws(((t,e,n)=>{switch(t.type.precision){case Zr.HALF:return Is(t,e,n);case Zr.SINGLE:case Zr.DOUBLE:default:return Ss(t,e,n)}})),vs.prototype.visitFloat16=ws(Is),vs.prototype.visitFloat32=ws(Ss),vs.prototype.visitFloat64=ws(Ss),vs.prototype.visitUtf8=ws((({values:t,valueOffsets:e},n,r)=>{xs(t,e,n,yr(r))})),vs.prototype.visitBinary=ws((({values:t,valueOffsets:e},n,r)=>xs(t,e,n,r))),vs.prototype.visitFixedSizeBinary=ws((({stride:t,values:e},n,r)=>{e.set(r.subarray(0,t),t*n)})),vs.prototype.visitDate=ws(((t,e,n)=>{t.type.unit===ei.DAY?Ts(t,e,n):Os(t,e,n)})),vs.prototype.visitDateDay=ws(Ts),vs.prototype.visitDateMillisecond=ws(Os),vs.prototype.visitTimestamp=ws(((t,e,n)=>{switch(t.type.unit){case ri.SECOND:return Ms(t,e,n);case ri.MILLISECOND:return Bs(t,e,n);case ri.MICROSECOND:return Ds(t,e,n);case ri.NANOSECOND:return Es(t,e,n)}})),vs.prototype.visitTimestampSecond=ws(Ms),vs.prototype.visitTimestampMillisecond=ws(Bs),vs.prototype.visitTimestampMicrosecond=ws(Ds),vs.prototype.visitTimestampNanosecond=ws(Es),vs.prototype.visitTime=ws(((t,e,n)=>{switch(t.type.unit){case ri.SECOND:return Fs(t,e,n);case ri.MILLISECOND:return ks(t,e,n);case ri.MICROSECOND:return Ns(t,e,n);case ri.NANOSECOND:return Cs(t,e,n)}})),vs.prototype.visitTimeSecond=ws(Fs),vs.prototype.visitTimeMillisecond=ws(ks),vs.prototype.visitTimeMicrosecond=ws(Ns),vs.prototype.visitTimeNanosecond=ws(Cs),vs.prototype.visitDecimal=ws((({values:t,stride:e},n,r)=>{t.set(r.subarray(0,e),e*n)})),vs.prototype.visitList=ws(((t,e,n)=>{const r=t.children[0],i=t.valueOffsets,s=Vs.getVisitFn(r);if(Array.isArray(n))for(let o=-1,a=i[e],u=i[e+1];a<u;)s(r,a++,n[++o]);else for(let o=-1,a=i[e],u=i[e+1];a<u;)s(r,a++,n.get(++o))})),vs.prototype.visitStruct=ws(((t,e,n)=>{const r=t.type.children.map((t=>Vs.getVisitFn(t.type))),i=n instanceof Map?(s=e,o=n,(t,e,n,r)=>e&&t(e,s,o.get(n.name))):n instanceof oa?((t,e)=>(n,r,i,s)=>r&&n(r,t,e.get(s)))(e,n):Array.isArray(n)?((t,e)=>(n,r,i,s)=>r&&n(r,t,e[s]))(e,n):((t,e)=>(n,r,i,s)=>r&&n(r,t,e[i.name]))(e,n);var s,o;t.type.children.forEach(((e,n)=>i(r[n],t.children[n],e,n)))})),vs.prototype.visitUnion=ws(((t,e,n)=>{t.type.mode===Jr.Dense?Ls(t,e,n):Us(t,e,n)})),vs.prototype.visitDenseUnion=ws(Ls),vs.prototype.visitSparseUnion=ws(Us),vs.prototype.visitDictionary=ws(((t,e,n)=>{var r;null===(r=t.dictionary)||void 0===r||r.set(t.values[e],n)})),vs.prototype.visitInterval=ws(((t,e,n)=>{t.type.unit===si.DAY_TIME?js(t,e,n):zs(t,e,n)})),vs.prototype.visitIntervalDayTime=ws(js),vs.prototype.visitIntervalYearMonth=ws(zs),vs.prototype.visitFixedSizeList=ws(((t,e,n)=>{const{stride:r}=t,i=t.children[0],s=Vs.getVisitFn(i);if(Array.isArray(n))for(let o=-1,a=e*r;++o<r;)s(i,a+o,n[o]);else for(let o=-1,a=e*r;++o<r;)s(i,a+o,n.get(o))})),vs.prototype.visitMap=ws(((t,e,n)=>{const r=t.children[0],i=t.valueOffsets,s=Vs.getVisitFn(r);let{[e]:o,[e+1]:a}=i;const u=n instanceof Map?n.entries():Object.entries(n);for(const c of u)if(s(r,o,c),++o>=a)break}));const Vs=new vs,Rs=Symbol.for("parent"),Ps=Symbol.for("rowIndex");class $s{constructor(t,e){return this[Rs]=t,this[Ps]=e,new Proxy(this,new Ys)}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[Ps],e=this[Rs],n=e.type.children,r={};for(let i=-1,s=n.length;++i<s;)r[n[i].name]=po.visit(e.children[i],t);return r}toString(){return`{${[...this].map((([t,e])=>`${hi(t)}: ${hi(e)}`)).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new Ws(this[Rs],this[Ps])}}class Ws{constructor(t,e){this.childIndex=0,this.children=t.children,this.rowIndex=e,this.childFields=t.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const t=this.childIndex;return t<this.numChildren?(this.childIndex=t+1,{done:!1,value:[this.childFields[t].name,po.visit(this.children[t],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties($s.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[Rs]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Ps]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class Ys{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[Rs].type.children.map((t=>t.name))}has(t,e){return-1!==t[Rs].type.children.findIndex((t=>t.name===e))}getOwnPropertyDescriptor(t,e){if(-1!==t[Rs].type.children.findIndex((t=>t.name===e)))return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const n=t[Rs].type.children.findIndex((t=>t.name===e));if(-1!==n){const r=po.visit(t[Rs].children[n],t[Ps]);return Reflect.set(t,e,r),r}}set(t,e,n){const r=t[Rs].type.children.findIndex((t=>t.name===e));return-1!==r?(Vs.visit(t[Rs].children[r],t[Ps],n),Reflect.set(t,e,n)):!!Reflect.has(t,e)&&Reflect.set(t,e,n)}}class Hs extends hs{}function qs(t){return(e,n)=>e.getValid(n)?t(e,n):null}const Gs=(t,e)=>4294967296*t[e+1]+(t[e]>>>0),Ks=t=>new Date(t),Qs=(t,e,n)=>{const{[n]:r,[n+1]:i}=e;return null!=r&&null!=i?t.subarray(r,i):null},Js=({values:t},e)=>((t,e)=>Ks(((t,e)=>864e5*t[e])(t,e)))(t,e),Xs=({values:t},e)=>((t,e)=>Ks(Gs(t,e)))(t,2*e),Zs=({stride:t,values:e},n)=>e[t*n],to=({values:t},e)=>t[e],eo=({values:t},e)=>1e3*Gs(t,2*e),no=({values:t},e)=>Gs(t,2*e),ro=({values:t},e)=>((t,e)=>t[e+1]/1e3*4294967296+(t[e]>>>0)/1e3)(t,2*e),io=({values:t},e)=>((t,e)=>t[e+1]/1e6*4294967296+(t[e]>>>0)/1e6)(t,2*e),so=({values:t},e)=>t[e],oo=({values:t},e)=>t[e],ao=({values:t},e)=>t[e],uo=({values:t},e)=>t[e],co=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[n];return po.visit(r,t.valueOffsets[e])},lo=(t,e)=>{const n=t.type.typeIdToChildIndex[t.typeIds[e]],r=t.children[n];return po.visit(r,e)},fo=({values:t},e)=>t.subarray(2*e,2*(e+1)),ho=({values:t},e)=>{const n=t[e],r=new Int32Array(2);return r[0]=Math.trunc(n/12),r[1]=Math.trunc(n%12),r};Hs.prototype.visitNull=qs(((t,e)=>null)),Hs.prototype.visitBool=qs((({offset:t,values:e},n)=>{const r=t+n;return 0!=(e[r>>3]&1<<r%8)})),Hs.prototype.visitInt=qs((({values:t},e)=>t[e])),Hs.prototype.visitInt8=qs(Zs),Hs.prototype.visitInt16=qs(Zs),Hs.prototype.visitInt32=qs(Zs),Hs.prototype.visitInt64=qs(to),Hs.prototype.visitUint8=qs(Zs),Hs.prototype.visitUint16=qs(Zs),Hs.prototype.visitUint32=qs(Zs),Hs.prototype.visitUint64=qs(to),Hs.prototype.visitFloat=qs((({type:t,values:e},n)=>t.precision!==Zr.HALF?e[n]:gs(e[n]))),Hs.prototype.visitFloat16=qs((({stride:t,values:e},n)=>gs(e[t*n]))),Hs.prototype.visitFloat32=qs(Zs),Hs.prototype.visitFloat64=qs(Zs),Hs.prototype.visitUtf8=qs((({values:t,valueOffsets:e},n)=>{const r=Qs(t,e,n);return null!==r?pr(r):null})),Hs.prototype.visitBinary=qs((({values:t,valueOffsets:e},n)=>Qs(t,e,n))),Hs.prototype.visitFixedSizeBinary=qs((({stride:t,values:e},n)=>e.subarray(t*n,t*(n+1)))),Hs.prototype.visitDate=qs(((t,e)=>t.type.unit===ei.DAY?Js(t,e):Xs(t,e))),Hs.prototype.visitDateDay=qs(Js),Hs.prototype.visitDateMillisecond=qs(Xs),Hs.prototype.visitTimestamp=qs(((t,e)=>{switch(t.type.unit){case ri.SECOND:return eo(t,e);case ri.MILLISECOND:return no(t,e);case ri.MICROSECOND:return ro(t,e);case ri.NANOSECOND:return io(t,e)}})),Hs.prototype.visitTimestampSecond=qs(eo),Hs.prototype.visitTimestampMillisecond=qs(no),Hs.prototype.visitTimestampMicrosecond=qs(ro),Hs.prototype.visitTimestampNanosecond=qs(io),Hs.prototype.visitTime=qs(((t,e)=>{switch(t.type.unit){case ri.SECOND:return so(t,e);case ri.MILLISECOND:return oo(t,e);case ri.MICROSECOND:return ao(t,e);case ri.NANOSECOND:return uo(t,e)}})),Hs.prototype.visitTimeSecond=qs(so),Hs.prototype.visitTimeMillisecond=qs(oo),Hs.prototype.visitTimeMicrosecond=qs(ao),Hs.prototype.visitTimeNanosecond=qs(uo),Hs.prototype.visitDecimal=qs((({values:t,stride:e},n)=>Ai.decimal(t.subarray(e*n,e*(n+1))))),Hs.prototype.visitList=qs(((t,e)=>{const{valueOffsets:n,stride:r}=t,{[e*r]:i}=n,{[e*r+1]:s}=n,o=t.children[0].slice(i,s-i);return new oa([o])})),Hs.prototype.visitStruct=qs(((t,e)=>new $s(t,e))),Hs.prototype.visitUnion=qs(((t,e)=>t.type.mode===Jr.Dense?co(t,e):lo(t,e))),Hs.prototype.visitDenseUnion=qs(co),Hs.prototype.visitSparseUnion=qs(lo),Hs.prototype.visitDictionary=qs(((t,e)=>{var n;return null===(n=t.dictionary)||void 0===n?void 0:n.get(t.values[e])})),Hs.prototype.visitInterval=qs(((t,e)=>t.type.unit===si.DAY_TIME?fo(t,e):ho(t,e))),Hs.prototype.visitIntervalDayTime=qs(fo),Hs.prototype.visitIntervalYearMonth=qs(ho),Hs.prototype.visitFixedSizeList=qs(((t,e)=>{const{stride:n}=t,r=t.children[0].slice(e*n,n);return new oa([r])})),Hs.prototype.visitMap=qs(((t,e)=>{const{valueOffsets:n}=t,{[e]:r}=n,{[e+1]:i}=n,s=t.children[0];return new bo(s.slice(r,i-r))}));const po=new Hs,mo=Symbol.for("keys"),yo=Symbol.for("vals");class bo{constructor(t){return this[mo]=new oa([t.children[0]]).memoize(),this[yo]=t.children[1],new Proxy(this,new vo)}[Symbol.iterator](){return new go(this[mo],this[yo])}get size(){return this[mo].length}toArray(){return Object.values(this.toJSON())}toJSON(){const t=this[mo],e=this[yo],n={};for(let r=-1,i=t.length;++r<i;)n[t.get(r)]=po.visit(e,r);return n}toString(){return`{${[...this].map((([t,e])=>`${hi(t)}: ${hi(e)}`)).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class go{constructor(t,e){this.keys=t,this.vals=e,this.keyIndex=0,this.numKeys=t.length}[Symbol.iterator](){return this}next(){const t=this.keyIndex;return t===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(t),po.visit(this.vals,t)]})}}class vo{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(t){return t[mo].toArray().map(String)}has(t,e){return t[mo].includes(e)}getOwnPropertyDescriptor(t,e){if(-1!==t[mo].indexOf(e))return{writable:!0,enumerable:!0,configurable:!0}}get(t,e){if(Reflect.has(t,e))return t[e];const n=t[mo].indexOf(e);if(-1!==n){const r=po.visit(Reflect.get(t,yo),n);return Reflect.set(t,e,r),r}}set(t,e,n){const r=t[mo].indexOf(e);return-1!==r?(Vs.visit(Reflect.get(t,yo),r,n),Reflect.set(t,e,n)):!!Reflect.has(t,e)&&Reflect.set(t,e,n)}}let wo;function _o(t,e,n,r){const{length:i=0}=t;let s="number"!=typeof e?0:e,o="number"!=typeof n?i:n;return s<0&&(s=(s%i+i)%i),o<0&&(o=(o%i+i)%i),o<s&&(wo=s,s=o,o=wo),o>i&&(o=i),r?r(t,s,o):[s,o]}Object.defineProperties(bo.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[mo]:{writable:!0,enumerable:!1,configurable:!1,value:null},[yo]:{writable:!0,enumerable:!1,configurable:!1,value:null}});const xo=t=>t!=t;function Ao(t){if("object"!==typeof t||null===t)return xo(t)?xo:e=>e===t;if(t instanceof Date){const e=t.valueOf();return t=>t instanceof Date&&t.valueOf()===e}return ArrayBuffer.isView(t)?e=>!!e&&function(t,e){let n=0;const r=t.length;if(r!==e.length)return!1;if(r>0)do{if(t[n]!==e[n])return!1}while(++n<r);return!0}(t,e):t instanceof Map?function(t){let e=-1;const n=[];for(const r of t.values())n[++e]=Ao(r);return So(n)}(t):Array.isArray(t)?function(t){const e=[];for(let n=-1,r=t.length;++n<r;)e[n]=Ao(t[n]);return So(e)}(t):t instanceof oa?function(t){const e=[];for(let n=-1,r=t.length;++n<r;)e[n]=Ao(t.get(n));return So(e)}(t):function(t,e=!1){const n=Object.keys(t);if(!e&&0===n.length)return()=>!1;const r=[];for(let i=-1,s=n.length;++i<s;)r[i]=Ao(t[n[i]]);return So(r,n)}(t,!0)}function So(t,e){return n=>{if(!n||"object"!=typeof n)return!1;switch(n.constructor){case Array:return function(t,e){const n=t.length;if(e.length!==n)return!1;for(let r=-1;++r<n;)if(!t[r](e[r]))return!1;return!0}(t,n);case Map:return Io(t,n,n.keys());case bo:case $s:case Object:case void 0:return Io(t,n,e||Object.keys(n))}return n instanceof oa&&function(t,e){const n=t.length;if(e.length!==n)return!1;for(let r=-1;++r<n;)if(!t[r](e.get(r)))return!1;return!0}(t,n)}}function Io(t,e,n){const r=n[Symbol.iterator](),i=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),s=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let o=0;const a=t.length;let u=s.next(),c=r.next(),l=i.next();for(;o<a&&!c.done&&!l.done&&!u.done&&(c.value===l.value&&t[o](u.value));++o,c=r.next(),l=i.next(),u=s.next());return!!(o===a&&c.done&&l.done&&u.done)||(r.return&&r.return(),i.return&&i.return(),s.return&&s.return(),!1)}function To(t,e,n,r){return 0!=(n&1<<r)}function Oo(t,e,n,r){return(n&1<<r)>>r}function Mo(t){const e=[];let n=0,r=0,i=0;for(const o of t)o&&(i|=1<<r),8==++r&&(e[n++]=i,i=r=0);(0===n||r>0)&&(e[n++]=i);const s=new Uint8Array(e.length+7&-8);return s.set(e),s}class Bo{constructor(t,e,n,r,i){this.bytes=t,this.length=n,this.context=r,this.get=i,this.bit=e%8,this.byteIndex=e>>3,this.byte=t[this.byteIndex++],this.index=0}next(){return this.index<this.length?(8===this.bit&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function Do(t,e,n){if(n-e<=0)return 0;if(n-e<8){let r=0;for(const i of new Bo(t,e,n-e,t,Oo))r+=i;return r}const r=n>>3<<3,i=e+(e%8==0?0:8-e%8);return Do(t,e,i)+Do(t,r,n)+function(t,e,n){let r=0,i=Math.trunc(e);const s=new DataView(t.buffer,t.byteOffset,t.byteLength),o=void 0===n?t.byteLength:i+n;for(;o-i>=4;)r+=Eo(s.getUint32(i)),i+=4;for(;o-i>=2;)r+=Eo(s.getUint16(i)),i+=2;for(;o-i>=1;)r+=Eo(s.getUint8(i)),i+=1;return r}(t,i>>3,r-i>>3)}function Eo(t){let e=Math.trunc(t);return e-=e>>>1&1431655765,e=(858993459&e)+(e>>>2&858993459),16843009*(e+(e>>>4)&252645135)>>>24}class Fo{constructor(t,e,n,r,i,s=[],o){let a;this.type=t,this.children=s,this.dictionary=o,this.offset=Math.floor(Math.max(e||0,0)),this.length=Math.floor(Math.max(n||0,0)),this._nullCount=Math.floor(Math.max(r||0,-1)),i instanceof Fo?(this.stride=i.stride,this.values=i.values,this.typeIds=i.typeIds,this.nullBitmap=i.nullBitmap,this.valueOffsets=i.valueOffsets):(this.stride=ds(t),i&&((a=i[0])&&(this.valueOffsets=a),(a=i[1])&&(this.values=a),(a=i[2])&&(this.nullBitmap=a),(a=i[3])&&(this.typeIds=a))),this.nullable=0!==this._nullCount&&this.nullBitmap&&this.nullBitmap.byteLength>0}get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get byteLength(){let t=0;const{valueOffsets:e,values:n,nullBitmap:r,typeIds:i}=this;return e&&(t+=e.byteLength),n&&(t+=n.byteLength),r&&(t+=r.byteLength),i&&(t+=i.byteLength),this.children.reduce(((t,e)=>t+e.byteLength),t)}get nullCount(){let t,e=this._nullCount;return e<=-1&&(t=this.nullBitmap)&&(this._nullCount=e=this.length-Do(t,this.offset,this.offset+this.length)),e}getValid(t){if(this.nullable&&this.nullCount>0){const e=this.offset+t;return 0!=(this.nullBitmap[e>>3]&1<<e%8)}return!0}setValid(t,e){if(!this.nullable)return e;if(!this.nullBitmap||this.nullBitmap.byteLength<=t>>3){const{nullBitmap:t}=this._changeLengthAndBackfillNullBitmap(this.length);Object.assign(this,{nullBitmap:t,_nullCount:0})}const{nullBitmap:n,offset:r}=this,i=r+t>>3,s=(r+t)%8,o=n[i]>>s&1;return e?0===o&&(n[i]|=1<<s,this._nullCount=this.nullCount+1):1===o&&(n[i]&=~(1<<s),this._nullCount=this.nullCount-1),e}clone(t=this.type,e=this.offset,n=this.length,r=this._nullCount,i=this,s=this.children){return new Fo(t,e,n,r,i,s,this.dictionary)}slice(t,e){const{stride:n,typeId:r,children:i}=this,s=+(0===this._nullCount)-1,o=16===r?n:1,a=this._sliceBuffers(t,e,n,r);return this.clone(this.type,this.offset+t,e,s,a,0===i.length||this.valueOffsets?i:this._sliceChildren(i,o*t,o*e))}_changeLengthAndBackfillNullBitmap(t){if(this.typeId===ci.Null)return this.clone(this.type,0,t,0);const{length:e,nullCount:n}=this,r=new Uint8Array((t+63&-64)>>3).fill(255,0,e>>3);r[e>>3]=(1<<e-(-8&e))-1,n>0&&r.set(function(t,e,n){const r=n.byteLength+7&-8;if(t>0||n.byteLength<r){const i=new Uint8Array(r);return i.set(t%8==0?n.subarray(t>>3):Mo(new Bo(n,t,e,null,To)).subarray(0,r)),i}return n}(this.offset,e,this.nullBitmap),0);const i=this.buffers;return i[fi.VALIDITY]=r,this.clone(this.type,0,t,n+(t-e),i)}_sliceBuffers(t,e,n,r){let i;const{buffers:s}=this;return(i=s[fi.TYPE])&&(s[fi.TYPE]=i.subarray(t,t+e)),(i=s[fi.OFFSET])&&(s[fi.OFFSET]=i.subarray(t,t+e+1))||(i=s[fi.DATA])&&(s[fi.DATA]=6===r?i:i.subarray(n*t,n*(t+e))),s}_sliceChildren(t,e,n){return t.map((t=>t.slice(e,n)))}}Fo.prototype.children=Object.freeze([]);class ko extends hs{visit(t){return this.getVisitFn(t.type).call(this,t)}visitNull(t){const{type:e,offset:n=0,length:r=0}=t;return new Fo(e,n,r,0)}visitBool(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length>>3,nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitInt(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length,nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitFloat(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length,nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitUtf8(t){const{type:e,offset:n=0}=t,r=Vr(t.data),i=Vr(t.nullBitmap),s=zr(t.valueOffsets),{length:o=s.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,o,a,[s,r,i])}visitBinary(t){const{type:e,offset:n=0}=t,r=Vr(t.data),i=Vr(t.nullBitmap),s=zr(t.valueOffsets),{length:o=s.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,o,a,[s,r,i])}visitFixedSizeBinary(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length/ds(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitDate(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length/ds(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitTimestamp(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length/ds(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitTime(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length/ds(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitDecimal(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length/ds(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitList(t){const{type:e,offset:n=0,child:r}=t,i=Vr(t.nullBitmap),s=zr(t.valueOffsets),{length:o=s.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,o,a,[s,void 0,i],[r])}visitStruct(t){const{type:e,offset:n=0,children:r=[]}=t,i=Vr(t.nullBitmap),{length:s=r.reduce(((t,{length:e})=>Math.max(t,e)),0),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,void 0,i],r)}visitUnion(t){const{type:e,offset:n=0,children:r=[]}=t,i=Vr(t.nullBitmap),s=jr(e.ArrayType,t.typeIds),{length:o=s.length,nullCount:a=(t.nullBitmap?-1:0)}=t;if(Wi.isSparseUnion(e))return new Fo(e,n,o,a,[void 0,void 0,i,s],r);const u=zr(t.valueOffsets);return new Fo(e,n,o,a,[u,void 0,i,s],r)}visitDictionary(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.indices.ArrayType,t.data),{dictionary:s=new oa([(new ko).visit({type:e.dictionary})])}=t,{length:o=i.length,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,o,a,[void 0,i,r],[],s)}visitInterval(t){const{type:e,offset:n=0}=t,r=Vr(t.nullBitmap),i=jr(e.ArrayType,t.data),{length:s=i.length/ds(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,i,r])}visitFixedSizeList(t){const{type:e,offset:n=0,child:r=(new ko).visit({type:e.valueType})}=t,i=Vr(t.nullBitmap),{length:s=r.length/ds(e),nullCount:o=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,s,o,[void 0,void 0,i],[r])}visitMap(t){const{type:e,offset:n=0,child:r=(new ko).visit({type:e.childType})}=t,i=Vr(t.nullBitmap),s=zr(t.valueOffsets),{length:o=s.length-1,nullCount:a=(t.nullBitmap?-1:0)}=t;return new Fo(e,n,o,a,[s,void 0,i],[r])}}function No(t){return(new ko).visit(t)}class Co{constructor(t=0,e){this.numChunks=t,this.getChunkIterator=e,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const t=this.chunkIterator.next();if(!t.done)return t;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function Lo(t){return t.reduce(((t,e)=>t+e.nullCount),0)}function Uo(t){return t.reduce(((t,e,n)=>(t[n+1]=t[n]+e.length,t)),new Uint32Array(t.length+1))}function jo(t,e,n,r){const i=[];for(let s=-1,o=t.length;++s<o;){const o=t[s],a=e[s],{length:u}=o;if(a>=r)break;if(n>=a+u)continue;if(a>=n&&a+u<=r){i.push(o);continue}const c=Math.max(0,n-a),l=Math.min(r-a,u);i.push(o.slice(c,l-c))}return 0===i.length&&i.push(t[0].slice(0,0)),i}function zo(t,e,n,r){let i=0,s=0,o=e.length-1;do{if(i>=o-1)return n<e[o]?r(t,i,n-e[i]):null;s=i+Math.trunc(.5*(o-i)),n<e[s]?o=s:i=s}while(i<o)}function Vo(t,e){return t.getValid(e)}function Ro(t){function e(e,n,r){return t(e[n],r)}return function(t){return zo(this.data,this._offsets,t,e)}}function Po(t){let e;function n(n,r,i){return t(n[r],i,e)}return function(t,r){const i=this.data;e=r;const s=zo(i,this._offsets,t,n);return e=void 0,s}}function $o(t){let e;function n(n,r,i){let s=i,o=0,a=0;for(let u=r-1,c=n.length;++u<c;){const r=n[u];if(~(o=t(r,e,s)))return a+o;s=0,a+=r.length}return-1}return function(t,r){e=t;const i=this.data,s="number"!=typeof r?n(i,0,0):zo(i,this._offsets,r,n);return e=void 0,s}}class Wo extends hs{}function Yo(t,e,n){if(void 0===e)return-1;if(null===e)return function(t,e){const{nullBitmap:n}=t;if(!n||t.nullCount<=0)return-1;let r=0;for(const i of new Bo(n,t.offset+(e||0),t.length,n,To)){if(!i)return r;++r}return-1}(t,n);const r=po.getVisitFn(t),i=Ao(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(i(r(t,s)))return s;return-1}function Ho(t,e,n){const r=po.getVisitFn(t),i=Ao(e);for(let s=(n||0)-1,o=t.length;++s<o;)if(i(r(t,s)))return s;return-1}Wo.prototype.visitNull=function(t,e){return null===e&&t.length>0?0:-1},Wo.prototype.visitBool=Yo,Wo.prototype.visitInt=Yo,Wo.prototype.visitInt8=Yo,Wo.prototype.visitInt16=Yo,Wo.prototype.visitInt32=Yo,Wo.prototype.visitInt64=Yo,Wo.prototype.visitUint8=Yo,Wo.prototype.visitUint16=Yo,Wo.prototype.visitUint32=Yo,Wo.prototype.visitUint64=Yo,Wo.prototype.visitFloat=Yo,Wo.prototype.visitFloat16=Yo,Wo.prototype.visitFloat32=Yo,Wo.prototype.visitFloat64=Yo,Wo.prototype.visitUtf8=Yo,Wo.prototype.visitBinary=Yo,Wo.prototype.visitFixedSizeBinary=Yo,Wo.prototype.visitDate=Yo,Wo.prototype.visitDateDay=Yo,Wo.prototype.visitDateMillisecond=Yo,Wo.prototype.visitTimestamp=Yo,Wo.prototype.visitTimestampSecond=Yo,Wo.prototype.visitTimestampMillisecond=Yo,Wo.prototype.visitTimestampMicrosecond=Yo,Wo.prototype.visitTimestampNanosecond=Yo,Wo.prototype.visitTime=Yo,Wo.prototype.visitTimeSecond=Yo,Wo.prototype.visitTimeMillisecond=Yo,Wo.prototype.visitTimeMicrosecond=Yo,Wo.prototype.visitTimeNanosecond=Yo,Wo.prototype.visitDecimal=Yo,Wo.prototype.visitList=Yo,Wo.prototype.visitStruct=Yo,Wo.prototype.visitUnion=Yo,Wo.prototype.visitDenseUnion=Ho,Wo.prototype.visitSparseUnion=Ho,Wo.prototype.visitDictionary=Yo,Wo.prototype.visitInterval=Yo,Wo.prototype.visitIntervalDayTime=Yo,Wo.prototype.visitIntervalYearMonth=Yo,Wo.prototype.visitFixedSizeList=Yo,Wo.prototype.visitMap=Yo;const qo=new Wo;class Go extends hs{}function Ko(t){const{type:e}=t;if(0===t.nullCount&&1===t.stride&&(e.typeId===ci.Timestamp||e instanceof Hi&&64!==e.bitWidth||e instanceof ts&&64!==e.bitWidth||e instanceof Gi&&e.precision!==Zr.HALF))return new Co(t.data.length,(e=>{const n=t.data[e];return n.values.subarray(0,n.length)[Symbol.iterator]()}));let n=0;return new Co(t.data.length,(e=>{const r=t.data[e].length,i=t.slice(n,n+r);return n+=r,new Qo(i)}))}class Qo{constructor(t){this.vector=t,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}Go.prototype.visitNull=Ko,Go.prototype.visitBool=Ko,Go.prototype.visitInt=Ko,Go.prototype.visitInt8=Ko,Go.prototype.visitInt16=Ko,Go.prototype.visitInt32=Ko,Go.prototype.visitInt64=Ko,Go.prototype.visitUint8=Ko,Go.prototype.visitUint16=Ko,Go.prototype.visitUint32=Ko,Go.prototype.visitUint64=Ko,Go.prototype.visitFloat=Ko,Go.prototype.visitFloat16=Ko,Go.prototype.visitFloat32=Ko,Go.prototype.visitFloat64=Ko,Go.prototype.visitUtf8=Ko,Go.prototype.visitBinary=Ko,Go.prototype.visitFixedSizeBinary=Ko,Go.prototype.visitDate=Ko,Go.prototype.visitDateDay=Ko,Go.prototype.visitDateMillisecond=Ko,Go.prototype.visitTimestamp=Ko,Go.prototype.visitTimestampSecond=Ko,Go.prototype.visitTimestampMillisecond=Ko,Go.prototype.visitTimestampMicrosecond=Ko,Go.prototype.visitTimestampNanosecond=Ko,Go.prototype.visitTime=Ko,Go.prototype.visitTimeSecond=Ko,Go.prototype.visitTimeMillisecond=Ko,Go.prototype.visitTimeMicrosecond=Ko,Go.prototype.visitTimeNanosecond=Ko,Go.prototype.visitDecimal=Ko,Go.prototype.visitList=Ko,Go.prototype.visitStruct=Ko,Go.prototype.visitUnion=Ko,Go.prototype.visitDenseUnion=Ko,Go.prototype.visitSparseUnion=Ko,Go.prototype.visitDictionary=Ko,Go.prototype.visitInterval=Ko,Go.prototype.visitIntervalDayTime=Ko,Go.prototype.visitIntervalYearMonth=Ko,Go.prototype.visitFixedSizeList=Ko,Go.prototype.visitMap=Ko;const Jo=new Go,Xo=(t,e)=>t+e;class Zo extends hs{visitNull(t,e){return 0}visitInt(t,e){return t.type.bitWidth/8}visitFloat(t,e){return t.type.ArrayType.BYTES_PER_ELEMENT}visitBool(t,e){return 1/8}visitDecimal(t,e){return 16}visitDate(t,e){return 4*(t.type.unit+1)}visitTime(t,e){return t.type.bitWidth/8}visitTimestamp(t,e){return t.type.unit===ri.SECOND?4:8}visitInterval(t,e){return 4*(t.type.unit+1)}visitStruct(t,e){return this.visitMany(t.children,t.children.map((()=>e))).reduce(Xo,0)}visitFixedSizeBinary(t,e){return t.type.byteWidth}visitMap(t,e){return this.visitMany(t.children,t.children.map((()=>e))).reduce(Xo,0)}visitDictionary(t,e){var n;return t.type.indices.bitWidth/8+((null===(n=t.dictionary)||void 0===n?void 0:n.getByteLength(t.values[e]))||0)}}const ta=({type:t,children:e,typeIds:n,valueOffsets:r},i)=>{const s=t.typeIdToChildIndex[n[i]];return 8+na.visit(e[s],r[i])},ea=({children:t},e)=>4+na.visitMany(t,t.map((()=>e))).reduce(Xo,0);Zo.prototype.visitUtf8=({valueOffsets:t},e)=>t[e+1]-t[e]+8,Zo.prototype.visitBinary=({valueOffsets:t},e)=>t[e+1]-t[e]+8,Zo.prototype.visitList=({valueOffsets:t,stride:e,children:n},r)=>{const i=n[0],{[r*e]:s}=t,{[r*e+1]:o}=t,a=na.getVisitFn(i.type),u=i.slice(s,o-s);let c=8;for(let l=-1,f=o-s;++l<f;)c+=a(u,l);return c},Zo.prototype.visitFixedSizeList=({stride:t,children:e},n)=>{const r=e[0],i=r.slice(n*t,t),s=na.getVisitFn(r.type);let o=0;for(let a=-1,u=i.length;++a<u;)o+=s(i,a);return o},Zo.prototype.visitUnion=(t,e)=>t.type.mode===Jr.Dense?ta(t,e):ea(t,e),Zo.prototype.visitDenseUnion=ta,Zo.prototype.visitSparseUnion=ea;const na=new Zo;var ra;const ia={},sa={};class oa{constructor(t){var e,n,r;const i=t[0]instanceof oa?t.flatMap((t=>t.data)):t;if(i.some((t=>!(t instanceof Fo))))throw new TypeError("Vector constructor expects an Array of Data instances.");const s=null===(e=i[0])||void 0===e?void 0:e.type;switch(i.length){case 0:this._offsets=[0];break;case 1:{const{get:t,set:e,indexOf:n,byteLength:r}=ia[s.typeId],o=i[0];this.isValid=t=>Vo(o,t),this.get=e=>t(o,e),this.set=(t,n)=>e(o,t,n),this.indexOf=t=>n(o,t),this.getByteLength=t=>r(o,t),this._offsets=[0,o.length];break}default:Object.setPrototypeOf(this,sa[s.typeId]),this._offsets=Uo(i)}this.data=i,this.type=s,this.stride=ds(s),this.numChildren=null!==(r=null===(n=s.children)||void 0===n?void 0:n.length)&&void 0!==r?r:0,this.length=this._offsets[this._offsets.length-1]}get byteLength(){return-1===this._byteLength&&(this._byteLength=this.data.reduce(((t,e)=>t+e.byteLength),0)),this._byteLength}get nullCount(){return-1===this._nullCount&&(this._nullCount=Lo(this.data)),this._nullCount}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${ci[this.type.typeId]}Vector`}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}includes(t,e){return this.indexOf(t,e)>0}getByteLength(t){return 0}[Symbol.iterator](){return Jo.visit(this)}concat(...t){return new oa(this.data.concat(t.flatMap((t=>t.data)).flat(Number.POSITIVE_INFINITY)))}slice(t,e){return new oa(_o(this,t,e,(({data:t,_offsets:e},n,r)=>jo(t,e,n,r))))}toJSON(){return[...this]}toArray(){const{type:t,data:e,length:n,stride:r,ArrayType:i}=this;switch(t.typeId){case ci.Int:case ci.Float:case ci.Decimal:case ci.Time:case ci.Timestamp:switch(e.length){case 0:return new i;case 1:return e[0].values.subarray(0,n*r);default:return e.reduce(((t,{values:e})=>(t.array.set(e,t.offset),t.offset+=e.length,t)),{array:new i(n*r),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(t){var e;return this.getChildAt(null===(e=this.type.children)||void 0===e?void 0:e.findIndex((e=>e.name===t)))}getChildAt(t){return t>-1&&t<this.numChildren?new oa(this.data.map((({children:e})=>e[t]))):null}get isMemoized(){return!!Wi.isDictionary(this.type)&&this.data[0].dictionary.isMemoized}memoize(){if(Wi.isDictionary(this.type)){const t=new aa(this.data[0].dictionary),e=this.data.map((e=>{const n=e.clone();return n.dictionary=t,n}));return new oa(e)}return new aa(this)}unmemoize(){if(Wi.isDictionary(this.type)&&this.isMemoized){const t=this.data[0].dictionary.unmemoize(),e=this.data.map((e=>{const n=e.clone();return n.dictionary=t,n}));return new oa(e)}return this}}ra=Symbol.toStringTag,oa[ra]=(t=>{t.type=Wi.prototype,t.data=[],t.length=0,t.stride=1,t.numChildren=0,t._nullCount=-1,t._byteLength=-1,t._offsets=new Uint32Array([0]),t[Symbol.isConcatSpreadable]=!0;const e=Object.keys(ci).map((t=>ci[t])).filter((t=>"number"==typeof t&&t!==ci.NONE));for(const n of e){const e=po.getVisitFnByTypeId(n),r=Vs.getVisitFnByTypeId(n),i=qo.getVisitFnByTypeId(n),s=na.getVisitFnByTypeId(n);ia[n]={get:e,set:r,indexOf:i,byteLength:s},sa[n]=Object.create(t,{isValid:{value:Ro(Vo)},get:{value:Ro(po.getVisitFnByTypeId(n))},set:{value:Po(Vs.getVisitFnByTypeId(n))},indexOf:{value:$o(qo.getVisitFnByTypeId(n))},getByteLength:{value:Ro(na.getVisitFnByTypeId(n))}})}return"Vector"})(oa.prototype);class aa extends oa{constructor(t){super(t.data);const e=this.get,n=this.set,r=this.slice,i=new Array(this.length);Object.defineProperty(this,"get",{value(t){const n=i[t];if(void 0!==n)return n;const r=e.call(this,t);return i[t]=r,r}}),Object.defineProperty(this,"set",{value(t,e){n.call(this,t,e),i[t]=e}}),Object.defineProperty(this,"slice",{value:(t,e)=>new aa(r.call(this,t,e))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new oa(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class ua{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(t,e,n,r){return t.prep(8,24),t.writeInt64(r),t.pad(4),t.writeInt32(n),t.writeInt64(e),t.offset()}}const ca=new Int32Array(2),la=new Float32Array(ca.buffer),fa=new Float64Array(ca.buffer),da=1===new Uint16Array(new Uint8Array([1,0]).buffer)[0];class ha{constructor(t,e){this.low=0|t,this.high=0|e}static create(t,e){return 0==t&&0==e?ha.ZERO:new ha(t,e)}toFloat64(){return(this.low>>>0)+4294967296*this.high}equals(t){return this.low==t.low&&this.high==t.high}}var pa,ma,ya,ba,ga,va,wa,_a,xa,Aa,Sa,Ia,Ta;ha.ZERO=new ha(0,0),(ma=pa||(pa={}))[ma.UTF8_BYTES=1]="UTF8_BYTES",ma[ma.UTF16_STRING=2]="UTF16_STRING";class Oa{constructor(t){this.bytes_=t,this.position_=0}static allocate(t){return new Oa(new Uint8Array(t))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(t){this.position_=t}capacity(){return this.bytes_.length}readInt8(t){return this.readUint8(t)<<24>>24}readUint8(t){return this.bytes_[t]}readInt16(t){return this.readUint16(t)<<16>>16}readUint16(t){return this.bytes_[t]|this.bytes_[t+1]<<8}readInt32(t){return this.bytes_[t]|this.bytes_[t+1]<<8|this.bytes_[t+2]<<16|this.bytes_[t+3]<<24}readUint32(t){return this.readInt32(t)>>>0}readInt64(t){return new ha(this.readInt32(t),this.readInt32(t+4))}readUint64(t){return new ha(this.readUint32(t),this.readUint32(t+4))}readFloat32(t){return ca[0]=this.readInt32(t),la[0]}readFloat64(t){return ca[da?0:1]=this.readInt32(t),ca[da?1:0]=this.readInt32(t+4),fa[0]}writeInt8(t,e){this.bytes_[t]=e}writeUint8(t,e){this.bytes_[t]=e}writeInt16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeUint16(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8}writeInt32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeUint32(t,e){this.bytes_[t]=e,this.bytes_[t+1]=e>>8,this.bytes_[t+2]=e>>16,this.bytes_[t+3]=e>>24}writeInt64(t,e){this.writeInt32(t,e.low),this.writeInt32(t+4,e.high)}writeUint64(t,e){this.writeUint32(t,e.low),this.writeUint32(t+4,e.high)}writeFloat32(t,e){la[0]=e,this.writeInt32(t,ca[0])}writeFloat64(t,e){fa[0]=e,this.writeInt32(t,ca[da?0:1]),this.writeInt32(t+4,ca[da?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+4+4)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let t="";for(let e=0;e<4;e++)t+=String.fromCharCode(this.readInt8(this.position_+4+e));return t}__offset(t,e){const n=t-this.readInt32(t);return e<this.readInt16(n)?this.readInt16(n+e):0}__union(t,e){return t.bb_pos=e+this.readInt32(e),t.bb=this,t}__string(t,e){t+=this.readInt32(t);const n=this.readInt32(t);let r="",i=0;if(t+=4,e===pa.UTF8_BYTES)return this.bytes_.subarray(t,t+n);for(;i<n;){let e;const n=this.readUint8(t+i++);if(n<192)e=n;else{const r=this.readUint8(t+i++);if(n<224)e=(31&n)<<6|63&r;else{const s=this.readUint8(t+i++);if(n<240)e=(15&n)<<12|(63&r)<<6|63&s;else{e=(7&n)<<18|(63&r)<<12|(63&s)<<6|63&this.readUint8(t+i++)}}}e<65536?r+=String.fromCharCode(e):(e-=65536,r+=String.fromCharCode(55296+(e>>10),56320+(1023&e)))}return r}__union_with_string(t,e){return"string"==typeof t?this.__string(e):this.__union(t,e)}__indirect(t){return t+this.readInt32(t)}__vector(t){return t+this.readInt32(t)+4}__vector_len(t){return this.readInt32(t+this.readInt32(t))}__has_identifier(t){if(4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=0;e<4;e++)if(t.charCodeAt(e)!=this.readInt8(this.position()+4+e))return!1;return!0}createLong(t,e){return ha.create(t,e)}createScalarList(t,e){const n=[];for(let r=0;r<e;++r)null!==t(r)&&n.push(t(r));return n}createObjList(t,e){const n=[];for(let r=0;r<e;++r){const e=t(r);null!==e&&n.push(e.unpack())}return n}}class Ma{constructor(t){let e;this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,e=t||1024,this.bb=Oa.allocate(e),this.space=e}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(t){this.force_defaults=t}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(t,e){t>this.minalign&&(this.minalign=t);const n=1+~(this.bb.capacity()-this.space+e)&t-1;for(;this.space<n+t+e;){const t=this.bb.capacity();this.bb=Ma.growByteBuffer(this.bb),this.space+=this.bb.capacity()-t}this.pad(n)}pad(t){for(let e=0;e<t;e++)this.bb.writeInt8(--this.space,0)}writeInt8(t){this.bb.writeInt8(this.space-=1,t)}writeInt16(t){this.bb.writeInt16(this.space-=2,t)}writeInt32(t){this.bb.writeInt32(this.space-=4,t)}writeInt64(t){this.bb.writeInt64(this.space-=8,t)}writeFloat32(t){this.bb.writeFloat32(this.space-=4,t)}writeFloat64(t){this.bb.writeFloat64(this.space-=8,t)}addInt8(t){this.prep(1,0),this.writeInt8(t)}addInt16(t){this.prep(2,0),this.writeInt16(t)}addInt32(t){this.prep(4,0),this.writeInt32(t)}addInt64(t){this.prep(8,0),this.writeInt64(t)}addFloat32(t){this.prep(4,0),this.writeFloat32(t)}addFloat64(t){this.prep(8,0),this.writeFloat64(t)}addFieldInt8(t,e,n){(this.force_defaults||e!=n)&&(this.addInt8(e),this.slot(t))}addFieldInt16(t,e,n){(this.force_defaults||e!=n)&&(this.addInt16(e),this.slot(t))}addFieldInt32(t,e,n){(this.force_defaults||e!=n)&&(this.addInt32(e),this.slot(t))}addFieldInt64(t,e,n){!this.force_defaults&&e.equals(n)||(this.addInt64(e),this.slot(t))}addFieldFloat32(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat32(e),this.slot(t))}addFieldFloat64(t,e,n){(this.force_defaults||e!=n)&&(this.addFloat64(e),this.slot(t))}addFieldOffset(t,e,n){(this.force_defaults||e!=n)&&(this.addOffset(e),this.slot(t))}addFieldStruct(t,e,n){e!=n&&(this.nested(e),this.slot(t))}nested(t){if(t!=this.offset())throw new Error("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new Error("FlatBuffers: object serialization must not be nested.")}slot(t){null!==this.vtable&&(this.vtable[t]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(t){const e=t.capacity();if(3221225472&e)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const n=e<<1,r=Oa.allocate(n);return r.setPosition(n-e),r.bytes().set(t.bytes(),n-e),r}addOffset(t){this.prep(4,0),this.writeInt32(this.offset()-t+4)}startObject(t){this.notNested(),null==this.vtable&&(this.vtable=[]),this.vtable_in_use=t;for(let e=0;e<t;e++)this.vtable[e]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(null==this.vtable||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const t=this.offset();let e=this.vtable_in_use-1;for(;e>=0&&0==this.vtable[e];e--);const n=e+1;for(;e>=0;e--)this.addInt16(0!=this.vtable[e]?t-this.vtable[e]:0);this.addInt16(t-this.object_start);const r=2*(n+2);this.addInt16(r);let i=0;const s=this.space;t:for(e=0;e<this.vtables.length;e++){const t=this.bb.capacity()-this.vtables[e];if(r==this.bb.readInt16(t)){for(let e=2;e<r;e+=2)if(this.bb.readInt16(s+e)!=this.bb.readInt16(t+e))continue t;i=this.vtables[e];break}}return i?(this.space=this.bb.capacity()-t,this.bb.writeInt32(this.space,i-t)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-t,this.offset()-t)),this.isNested=!1,t}finish(t,e,n){const r=n?4:0;if(e){const t=e;if(this.prep(this.minalign,8+r),4!=t.length)throw new Error("FlatBuffers: file identifier must be length 4");for(let e=3;e>=0;e--)this.writeInt8(t.charCodeAt(e))}this.prep(this.minalign,4+r),this.addOffset(t),r&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(t,e){this.finish(t,e,!0)}requiredField(t,e){const n=this.bb.capacity()-t,r=n-this.bb.readInt32(n);if(!(0!=this.bb.readInt16(r+e)))throw new Error("FlatBuffers: field "+e+" must be set")}startVector(t,e,n){this.notNested(),this.vector_num_elems=e,this.prep(4,t*e),this.prep(n,t*e)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(t){if(!t)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(t))return this.string_maps.get(t);const e=this.createString(t);return this.string_maps.set(t,e),e}createString(t){if(!t)return 0;let e;if(t instanceof Uint8Array)e=t;else{e=[];let n=0;for(;n<t.length;){let r;const i=t.charCodeAt(n++);if(i<55296||i>=56320)r=i;else{r=(i<<10)+t.charCodeAt(n++)+-56613888}r<128?e.push(r):(r<2048?e.push(r>>6&31|192):(r<65536?e.push(r>>12&15|224):e.push(r>>18&7|240,r>>12&63|128),e.push(r>>6&63|128)),e.push(63&r|128))}}this.addInt8(0),this.startVector(1,e.length,1),this.bb.setPosition(this.space-=e.length);for(let n=0,r=this.space,i=this.bb.bytes();n<e.length;n++)i[r++]=e[n];return this.endVector()}createLong(t,e){return ha.create(t,e)}createObjectOffset(t){return null===t?0:"string"==typeof t?this.createString(t):t.pack(this)}createObjectOffsetList(t){const e=[];for(let n=0;n<t.length;++n){const r=t[n];if(null===r)throw new Error("FlatBuffers: Argument for createObjectOffsetList cannot contain null.");e.push(this.createObjectOffset(r))}return e}createStructOffsetList(t,e){return e(this,t.length),this.createObjectOffsetList(t),this.endVector()}}class Ba{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsKeyValue(t,e){return(e||new Ba).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsKeyValue(t,e){return t.setPosition(t.position()+4),(e||new Ba).__init(t.readInt32(t.position())+t.position(),t)}key(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}value(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startKeyValue(t){t.startObject(2)}static addKey(t,e){t.addFieldOffset(0,e,0)}static addValue(t,e){t.addFieldOffset(1,e,0)}static endKeyValue(t){return t.endObject()}static createKeyValue(t,e,n){return Ba.startKeyValue(t),Ba.addKey(t,e),Ba.addValue(t,n),Ba.endKeyValue(t)}}!function(t){t[t.V1=0]="V1",t[t.V2=1]="V2",t[t.V3=2]="V3",t[t.V4=3]="V4",t[t.V5=4]="V5"}(ya||(ya={})),(ga=ba||(ba={}))[ga.Little=0]="Little",ga[ga.Big=1]="Big",(wa=va||(va={}))[wa.DenseArray=0]="DenseArray";class Da{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInt(t,e){return(e||new Da).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInt(t,e){return t.setPosition(t.position()+4),(e||new Da).__init(t.readInt32(t.position())+t.position(),t)}bitWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}isSigned(){const t=this.bb.__offset(this.bb_pos,6);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startInt(t){t.startObject(2)}static addBitWidth(t,e){t.addFieldInt32(0,e,0)}static addIsSigned(t,e){t.addFieldInt8(1,+e,0)}static endInt(t){return t.endObject()}static createInt(t,e,n){return Da.startInt(t),Da.addBitWidth(t,e),Da.addIsSigned(t,n),Da.endInt(t)}}class Ea{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryEncoding(t,e){return(e||new Ea).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryEncoding(t,e){return t.setPosition(t.position()+4),(e||new Ea).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}indexType(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Da).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isOrdered(){const t=this.bb.__offset(this.bb_pos,8);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}dictionaryKind(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt16(this.bb_pos+t):va.DenseArray}static startDictionaryEncoding(t){t.startObject(4)}static addId(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addIndexType(t,e){t.addFieldOffset(1,e,0)}static addIsOrdered(t,e){t.addFieldInt8(2,+e,0)}static addDictionaryKind(t,e){t.addFieldInt16(3,e,va.DenseArray)}static endDictionaryEncoding(t){return t.endObject()}}class Fa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBinary(t,e){return(e||new Fa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBinary(t,e){return t.setPosition(t.position()+4),(e||new Fa).__init(t.readInt32(t.position())+t.position(),t)}static startBinary(t){t.startObject(0)}static endBinary(t){return t.endObject()}static createBinary(t){return Fa.startBinary(t),Fa.endBinary(t)}}class ka{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBool(t,e){return(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBool(t,e){return t.setPosition(t.position()+4),(e||new ka).__init(t.readInt32(t.position())+t.position(),t)}static startBool(t){t.startObject(0)}static endBool(t){return t.endObject()}static createBool(t){return ka.startBool(t),ka.endBool(t)}}!function(t){t[t.DAY=0]="DAY",t[t.MILLISECOND=1]="MILLISECOND"}(_a||(_a={}));class Na{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDate(t,e){return(e||new Na).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDate(t,e){return t.setPosition(t.position()+4),(e||new Na).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):_a.MILLISECOND}static startDate(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,_a.MILLISECOND)}static endDate(t){return t.endObject()}static createDate(t,e){return Na.startDate(t),Na.addUnit(t,e),Na.endDate(t)}}class Ca{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDecimal(t,e){return(e||new Ca).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDecimal(t,e){return t.setPosition(t.position()+4),(e||new Ca).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}scale(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):0}bitWidth(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readInt32(this.bb_pos+t):128}static startDecimal(t){t.startObject(3)}static addPrecision(t,e){t.addFieldInt32(0,e,0)}static addScale(t,e){t.addFieldInt32(1,e,0)}static addBitWidth(t,e){t.addFieldInt32(2,e,128)}static endDecimal(t){return t.endObject()}static createDecimal(t,e,n,r){return Ca.startDecimal(t),Ca.addPrecision(t,e),Ca.addScale(t,n),Ca.addBitWidth(t,r),Ca.endDecimal(t)}}!function(t){t[t.SECOND=0]="SECOND",t[t.MILLISECOND=1]="MILLISECOND",t[t.MICROSECOND=2]="MICROSECOND",t[t.NANOSECOND=3]="NANOSECOND"}(xa||(xa={}));class La{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeBinary(t,e){return(e||new La).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeBinary(t,e){return t.setPosition(t.position()+4),(e||new La).__init(t.readInt32(t.position())+t.position(),t)}byteWidth(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeBinary(t){t.startObject(1)}static addByteWidth(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeBinary(t){return t.endObject()}static createFixedSizeBinary(t,e){return La.startFixedSizeBinary(t),La.addByteWidth(t,e),La.endFixedSizeBinary(t)}}class Ua{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFixedSizeList(t,e){return(e||new Ua).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFixedSizeList(t,e){return t.setPosition(t.position()+4),(e||new Ua).__init(t.readInt32(t.position())+t.position(),t)}listSize(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt32(this.bb_pos+t):0}static startFixedSizeList(t){t.startObject(1)}static addListSize(t,e){t.addFieldInt32(0,e,0)}static endFixedSizeList(t){return t.endObject()}static createFixedSizeList(t,e){return Ua.startFixedSizeList(t),Ua.addListSize(t,e),Ua.endFixedSizeList(t)}}!function(t){t[t.HALF=0]="HALF",t[t.SINGLE=1]="SINGLE",t[t.DOUBLE=2]="DOUBLE"}(Aa||(Aa={}));class ja{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFloatingPoint(t,e){return(e||new ja).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFloatingPoint(t,e){return t.setPosition(t.position()+4),(e||new ja).__init(t.readInt32(t.position())+t.position(),t)}precision(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Aa.HALF}static startFloatingPoint(t){t.startObject(1)}static addPrecision(t,e){t.addFieldInt16(0,e,Aa.HALF)}static endFloatingPoint(t){return t.endObject()}static createFloatingPoint(t,e){return ja.startFloatingPoint(t),ja.addPrecision(t,e),ja.endFloatingPoint(t)}}!function(t){t[t.YEAR_MONTH=0]="YEAR_MONTH",t[t.DAY_TIME=1]="DAY_TIME",t[t.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"}(Sa||(Sa={}));class za{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsInterval(t,e){return(e||new za).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsInterval(t,e){return t.setPosition(t.position()+4),(e||new za).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Sa.YEAR_MONTH}static startInterval(t){t.startObject(1)}static addUnit(t,e){t.addFieldInt16(0,e,Sa.YEAR_MONTH)}static endInterval(t){return t.endObject()}static createInterval(t,e){return za.startInterval(t),za.addUnit(t,e),za.endInterval(t)}}class Va{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsList(t,e){return(e||new Va).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsList(t,e){return t.setPosition(t.position()+4),(e||new Va).__init(t.readInt32(t.position())+t.position(),t)}static startList(t){t.startObject(0)}static endList(t){return t.endObject()}static createList(t){return Va.startList(t),Va.endList(t)}}class Ra{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMap(t,e){return(e||new Ra).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMap(t,e){return t.setPosition(t.position()+4),(e||new Ra).__init(t.readInt32(t.position())+t.position(),t)}keysSorted(){const t=this.bb.__offset(this.bb_pos,4);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startMap(t){t.startObject(1)}static addKeysSorted(t,e){t.addFieldInt8(0,+e,0)}static endMap(t){return t.endObject()}static createMap(t,e){return Ra.startMap(t),Ra.addKeysSorted(t,e),Ra.endMap(t)}}class Pa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsNull(t,e){return(e||new Pa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsNull(t,e){return t.setPosition(t.position()+4),(e||new Pa).__init(t.readInt32(t.position())+t.position(),t)}static startNull(t){t.startObject(0)}static endNull(t){return t.endObject()}static createNull(t){return Pa.startNull(t),Pa.endNull(t)}}class $a{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsStruct_(t,e){return(e||new $a).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsStruct_(t,e){return t.setPosition(t.position()+4),(e||new $a).__init(t.readInt32(t.position())+t.position(),t)}static startStruct_(t){t.startObject(0)}static endStruct_(t){return t.endObject()}static createStruct_(t){return $a.startStruct_(t),$a.endStruct_(t)}}class Wa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTime(t,e){return(e||new Wa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTime(t,e){return t.setPosition(t.position()+4),(e||new Wa).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):xa.MILLISECOND}bitWidth(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb_pos+t):32}static startTime(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,xa.MILLISECOND)}static addBitWidth(t,e){t.addFieldInt32(1,e,32)}static endTime(t){return t.endObject()}static createTime(t,e,n){return Wa.startTime(t),Wa.addUnit(t,e),Wa.addBitWidth(t,n),Wa.endTime(t)}}class Ya{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsTimestamp(t,e){return(e||new Ya).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsTimestamp(t,e){return t.setPosition(t.position()+4),(e||new Ya).__init(t.readInt32(t.position())+t.position(),t)}unit(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):xa.SECOND}timezone(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__string(this.bb_pos+e,t):null}static startTimestamp(t){t.startObject(2)}static addUnit(t,e){t.addFieldInt16(0,e,xa.SECOND)}static addTimezone(t,e){t.addFieldOffset(1,e,0)}static endTimestamp(t){return t.endObject()}static createTimestamp(t,e,n){return Ya.startTimestamp(t),Ya.addUnit(t,e),Ya.addTimezone(t,n),Ya.endTimestamp(t)}}!function(t){t[t.Sparse=0]="Sparse",t[t.Dense=1]="Dense"}(Ia||(Ia={}));class Ha{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUnion(t,e){return(e||new Ha).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUnion(t,e){return t.setPosition(t.position()+4),(e||new Ha).__init(t.readInt32(t.position())+t.position(),t)}mode(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):Ia.Sparse}typeIds(t){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb.__vector(this.bb_pos+e)+4*t):0}typeIdsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}typeIdsArray(){const t=this.bb.__offset(this.bb_pos,6);return t?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+t),this.bb.__vector_len(this.bb_pos+t)):null}static startUnion(t){t.startObject(2)}static addMode(t,e){t.addFieldInt16(0,e,Ia.Sparse)}static addTypeIds(t,e){t.addFieldOffset(1,e,0)}static createTypeIdsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addInt32(e[n]);return t.endVector()}static startTypeIdsVector(t,e){t.startVector(4,e,4)}static endUnion(t){return t.endObject()}static createUnion(t,e,n){return Ha.startUnion(t),Ha.addMode(t,e),Ha.addTypeIds(t,n),Ha.endUnion(t)}}class qa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsUtf8(t,e){return(e||new qa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsUtf8(t,e){return t.setPosition(t.position()+4),(e||new qa).__init(t.readInt32(t.position())+t.position(),t)}static startUtf8(t){t.startObject(0)}static endUtf8(t){return t.endObject()}static createUtf8(t){return qa.startUtf8(t),qa.endUtf8(t)}}!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.FloatingPoint=3]="FloatingPoint",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct_=13]="Struct_",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Duration=18]="Duration",t[t.LargeBinary=19]="LargeBinary",t[t.LargeUtf8=20]="LargeUtf8",t[t.LargeList=21]="LargeList"}(Ta||(Ta={}));class Ga{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsField(t,e){return(e||new Ga).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsField(t,e){return t.setPosition(t.position()+4),(e||new Ga).__init(t.readInt32(t.position())+t.position(),t)}name(t){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__string(this.bb_pos+e,t):null}nullable(){const t=this.bb.__offset(this.bb_pos,6);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}typeType(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readUint8(this.bb_pos+t):Ta.NONE}type(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__union(t,this.bb_pos+e):null}dictionary(t){const e=this.bb.__offset(this.bb_pos,12);return e?(t||new Ea).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}children(t,e){const n=this.bb.__offset(this.bb_pos,14);return n?(e||new Ga).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}childrenLength(){const t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,16);return n?(e||new Ba).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,16);return t?this.bb.__vector_len(this.bb_pos+t):0}static startField(t){t.startObject(7)}static addName(t,e){t.addFieldOffset(0,e,0)}static addNullable(t,e){t.addFieldInt8(1,+e,0)}static addTypeType(t,e){t.addFieldInt8(2,e,Ta.NONE)}static addType(t,e){t.addFieldOffset(3,e,0)}static addDictionary(t,e){t.addFieldOffset(4,e,0)}static addChildren(t,e){t.addFieldOffset(5,e,0)}static createChildrenVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startChildrenVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(6,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endField(t){return t.endObject()}}class Ka{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsSchema(t,e){return(e||new Ka).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsSchema(t,e){return t.setPosition(t.position()+4),(e||new Ka).__init(t.readInt32(t.position())+t.position(),t)}endianness(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ba.Little}fields(t,e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new Ga).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}fieldsLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Ba).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}features(t){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb.__vector(this.bb_pos+e)+8*t):this.bb.createLong(0,0)}featuresLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}static startSchema(t){t.startObject(4)}static addEndianness(t,e){t.addFieldInt16(0,e,ba.Little)}static addFields(t,e){t.addFieldOffset(1,e,0)}static createFieldsVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startFieldsVector(t,e){t.startVector(4,e,4)}static addCustomMetadata(t,e){t.addFieldOffset(2,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static addFeatures(t,e){t.addFieldOffset(3,e,0)}static createFeaturesVector(t,e){t.startVector(8,e.length,8);for(let n=e.length-1;n>=0;n--)t.addInt64(e[n]);return t.endVector()}static startFeaturesVector(t,e){t.startVector(8,e,8)}static endSchema(t){return t.endObject()}static finishSchemaBuffer(t,e){t.finish(e)}static finishSizePrefixedSchemaBuffer(t,e){t.finish(e,void 0,!0)}static createSchema(t,e,n,r,i){return Ka.startSchema(t),Ka.addEndianness(t,e),Ka.addFields(t,n),Ka.addCustomMetadata(t,r),Ka.addFeatures(t,i),Ka.endSchema(t)}}class Qa{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsFooter(t,e){return(e||new Qa).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsFooter(t,e){return t.setPosition(t.position()+4),(e||new Qa).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ya.V1}schema(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new Ka).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}dictionaries(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new ua).__init(this.bb.__vector(this.bb_pos+n)+24*t,this.bb):null}dictionariesLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}recordBatches(t,e){const n=this.bb.__offset(this.bb_pos,10);return n?(e||new ua).__init(this.bb.__vector(this.bb_pos+n)+24*t,this.bb):null}recordBatchesLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__vector_len(this.bb_pos+t):0}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new Ba).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startFooter(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,ya.V1)}static addSchema(t,e){t.addFieldOffset(1,e,0)}static addDictionaries(t,e){t.addFieldOffset(2,e,0)}static startDictionariesVector(t,e){t.startVector(24,e,8)}static addRecordBatches(t,e){t.addFieldOffset(3,e,0)}static startRecordBatchesVector(t,e){t.startVector(24,e,8)}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endFooter(t){return t.endObject()}static finishFooterBuffer(t,e){t.finish(e)}static finishSizePrefixedFooterBuffer(t,e){t.finish(e,void 0,!0)}}class Ja{constructor(t=[],e,n){this.fields=t||[],this.metadata=e||new Map,n||(n=tu(t)),this.dictionaries=n}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map((t=>t.name))}toString(){return`Schema<{ ${this.fields.map(((t,e)=>`${e}: ${t}`)).join(", ")} }>`}select(t){const e=new Set(t),n=this.fields.filter((t=>e.has(t.name)));return new Ja(n,this.metadata)}selectAt(t){const e=t.map((t=>this.fields[t])).filter(Boolean);return new Ja(e,this.metadata)}assign(...t){const e=t[0]instanceof Ja?t[0]:Array.isArray(t[0])?new Ja(t[0]):new Ja(t),n=[...this.fields],r=Za(Za(new Map,this.metadata),e.metadata),i=e.fields.filter((t=>{const e=n.findIndex((e=>e.name===t.name));return!~e||(n[e]=t.clone({metadata:Za(Za(new Map,n[e].metadata),t.metadata)}))&&!1})),s=tu(i,new Map);return new Ja([...n,...i],r,new Map([...this.dictionaries,...s]))}}Ja.prototype.fields=null,Ja.prototype.metadata=null,Ja.prototype.dictionaries=null;class Xa{constructor(t,e,n=!1,r){this.name=t,this.type=e,this.nullable=n,this.metadata=r||new Map}static new(...t){let[e,n,r,i]=t;return t[0]&&"object"==typeof t[0]&&(({name:e}=t[0]),void 0===n&&(n=t[0].type),void 0===r&&(r=t[0].nullable),void 0===i&&(i=t[0].metadata)),new Xa(`${e}`,n,r,i)}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...t){let[e,n,r,i]=t;return t[0]&&"object"==typeof t[0]?({name:e=this.name,type:n=this.type,nullable:r=this.nullable,metadata:i=this.metadata}=t[0]):[e=this.name,n=this.type,r=this.nullable,i=this.metadata]=t,Xa.new(e,n,r,i)}}function Za(t,e){return new Map([...t||new Map,...e||new Map])}function tu(t,e=new Map){for(let n=-1,r=t.length;++n<r;){const r=t[n].type;if(Wi.isDictionary(r))if(e.has(r.id)){if(e.get(r.id)!==r.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else e.set(r.id,r.dictionary);r.children&&r.children.length>0&&tu(r.children,e)}return e}Xa.prototype.type=null,Xa.prototype.name=null,Xa.prototype.nullable=null,Xa.prototype.metadata=null;var eu=ha,nu=Ma,ru=Oa;class iu{constructor(t,e=Kr.V4,n,r){this.schema=t,this.version=e,n&&(this._recordBatches=n),r&&(this._dictionaryBatches=r)}static decode(t){t=new ru(Vr(t));const e=Qa.getRootAsFooter(t),n=Ja.decode(e.schema());return new su(n,e)}static encode(t){const e=new nu,n=Ja.encode(e,t.schema);Qa.startRecordBatchesVector(e,t.numRecordBatches);for(const s of[...t.recordBatches()].slice().reverse())ou.encode(e,s);const r=e.endVector();Qa.startDictionariesVector(e,t.numDictionaries);for(const s of[...t.dictionaryBatches()].slice().reverse())ou.encode(e,s);const i=e.endVector();return Qa.startFooter(e),Qa.addSchema(e,n),Qa.addVersion(e,Kr.V4),Qa.addRecordBatches(e,r),Qa.addDictionaries(e,i),Qa.finishFooterBuffer(e,Qa.endFooter(e)),e.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}*recordBatches(){for(let t,e=-1,n=this.numRecordBatches;++e<n;)(t=this.getRecordBatch(e))&&(yield t)}*dictionaryBatches(){for(let t,e=-1,n=this.numDictionaries;++e<n;)(t=this.getDictionaryBatch(e))&&(yield t)}getRecordBatch(t){return t>=0&&t<this.numRecordBatches&&this._recordBatches[t]||null}getDictionaryBatch(t){return t>=0&&t<this.numDictionaries&&this._dictionaryBatches[t]||null}}class su extends iu{constructor(t,e){super(t,e.version()),this._footer=e}get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}getRecordBatch(t){if(t>=0&&t<this.numRecordBatches){const e=this._footer.recordBatches(t);if(e)return ou.decode(e)}return null}getDictionaryBatch(t){if(t>=0&&t<this.numDictionaries){const e=this._footer.dictionaries(t);if(e)return ou.decode(e)}return null}}class ou{constructor(t,e,n){this.metaDataLength=t,this.offset="number"==typeof n?n:n.low,this.bodyLength="number"==typeof e?e:e.low}static decode(t){return new ou(t.metaDataLength(),t.bodyLength(),t.offset())}static encode(t,e){const{metaDataLength:n}=e,r=new eu(e.offset,0),i=new eu(e.bodyLength,0);return ua.createBlock(t,r,n,i)}}const au=Object.freeze({done:!0,value:void 0});class uu{constructor(t){this._json=t}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class cu{tee(){return this._getDOMStream().tee()}pipe(t,e){return this._getNodeStream().pipe(t,e)}pipeTo(t,e){return this._getDOMStream().pipeTo(t,e)}pipeThrough(t,e){return this._getDOMStream().pipeThrough(t,e)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class lu extends cu{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise((t=>this._closedPromiseResolve=t))}get closed(){return this._closedPromise}cancel(t){return ar(this,void 0,void 0,(function*(){yield this.return(t)}))}write(t){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(t):this.resolvers.shift().resolve({done:!1,value:t}))}abort(t){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:t}:this.resolvers.shift().reject({done:!0,value:t}))}close(){if(this._closedPromiseResolve){const{resolvers:t}=this;for(;t.length>0;)t.shift().resolve(au);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(t){return Yr.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,t)}toNodeStream(t){return Yr.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,t)}throw(t){return ar(this,void 0,void 0,(function*(){return yield this.abort(t),au}))}return(t){return ar(this,void 0,void 0,(function*(){return yield this.close(),au}))}read(t){return ar(this,void 0,void 0,(function*(){return(yield this.next(t,"read")).value}))}peek(t){return ar(this,void 0,void 0,(function*(){return(yield this.next(t,"peek")).value}))}next(...t){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise(((t,e)=>{this.resolvers.push({resolve:t,reject:e})})):Promise.resolve(au)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class fu extends lu{write(t){if((t=Vr(t)).byteLength>0)return super.write(t)}toString(t=!1){return t?pr(this.toUint8Array(!0)):this.toUint8Array(!1).then(pr)}toUint8Array(t=!1){return t?Ur(this._values)[0]:(()=>ar(this,void 0,void 0,(function*(){var t,e;const n=[];let r=0;try{for(var i,s=dr(this);!(i=yield s.next()).done;){const t=i.value;n.push(t),r+=t.byteLength}}catch(o){t={error:o}}finally{try{i&&!i.done&&(e=s.return)&&(yield e.call(s))}finally{if(t)throw t.error}}return Ur(n,r)[0]})))()}}class du{constructor(t){t&&(this.source=new pu(Yr.fromIterable(t)))}[Symbol.iterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class hu{constructor(t){t instanceof hu?this.source=t.source:t instanceof fu?this.source=new mu(Yr.fromAsyncIterable(t)):Nr(t)?this.source=new mu(Yr.fromNodeStream(t)):kr(t)?this.source=new mu(Yr.fromDOMStream(t)):Er(t)?this.source=new mu(Yr.fromDOMStream(t.body)):Tr(t)?this.source=new mu(Yr.fromIterable(t)):(Ir(t)||Or(t))&&(this.source=new mu(Yr.fromAsyncIterable(t)))}[Symbol.asyncIterator](){return this}next(t){return this.source.next(t)}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}get closed(){return this.source.closed}cancel(t){return this.source.cancel(t)}peek(t){return this.source.peek(t)}read(t){return this.source.read(t)}}class pu{constructor(t){this.source=t}cancel(t){this.return(t)}peek(t){return this.next(t,"peek").value}read(t){return this.next(t,"read").value}next(t,e="read"){return this.source.next({cmd:e,size:t})}throw(t){return Object.create(this.source.throw&&this.source.throw(t)||au)}return(t){return Object.create(this.source.return&&this.source.return(t)||au)}}class mu{constructor(t){this.source=t,this._closedPromise=new Promise((t=>this._closedPromiseResolve=t))}cancel(t){return ar(this,void 0,void 0,(function*(){yield this.return(t)}))}get closed(){return this._closedPromise}read(t){return ar(this,void 0,void 0,(function*(){return(yield this.next(t,"read")).value}))}peek(t){return ar(this,void 0,void 0,(function*(){return(yield this.next(t,"peek")).value}))}next(t,e="read"){return ar(this,void 0,void 0,(function*(){return yield this.source.next({cmd:e,size:t})}))}throw(t){return ar(this,void 0,void 0,(function*(){const e=this.source.throw&&(yield this.source.throw(t))||au;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)}))}return(t){return ar(this,void 0,void 0,(function*(){const e=this.source.return&&(yield this.source.return(t))||au;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(e)}))}}class yu extends du{constructor(t,e){super(),this.position=0,this.buffer=Vr(t),this.size=void 0===e?this.buffer.byteLength:e}readInt32(t){const{buffer:e,byteOffset:n}=this.readAt(t,4);return new DataView(e,n).getInt32(0,!0)}seek(t){return this.position=Math.min(t,this.size),t<this.size}read(t){const{buffer:e,size:n,position:r}=this;return e&&r<n?("number"!=typeof t&&(t=Number.POSITIVE_INFINITY),this.position=Math.min(n,r+Math.min(n-r,t)),e.subarray(r,this.position)):null}readAt(t,e){const n=this.buffer,r=Math.min(this.size,t+e);return n?n.subarray(t,r):new Uint8Array(e)}close(){this.buffer&&(this.buffer=null)}throw(t){return this.close(),{done:!0,value:t}}return(t){return this.close(),{done:!0,value:t}}}class bu extends hu{constructor(t,e){super(),this.position=0,this._handle=t,"number"==typeof e?this.size=e:this._pending=(()=>ar(this,void 0,void 0,(function*(){this.size=(yield t.stat()).size,delete this._pending})))()}readInt32(t){return ar(this,void 0,void 0,(function*(){const{buffer:e,byteOffset:n}=yield this.readAt(t,4);return new DataView(e,n).getInt32(0,!0)}))}seek(t){return ar(this,void 0,void 0,(function*(){return this._pending&&(yield this._pending),this.position=Math.min(t,this.size),t<this.size}))}read(t){return ar(this,void 0,void 0,(function*(){this._pending&&(yield this._pending);const{_handle:e,size:n,position:r}=this;if(e&&r<n){"number"!=typeof t&&(t=Number.POSITIVE_INFINITY);let i=r,s=0,o=0;const a=Math.min(n,i+Math.min(n-i,t)),u=new Uint8Array(Math.max(0,(this.position=a)-i));for(;(i+=o)<a&&(s+=o)<u.byteLength;)({bytesRead:o}=yield e.read(u,s,u.byteLength-s,i));return u}return null}))}readAt(t,e){return ar(this,void 0,void 0,(function*(){this._pending&&(yield this._pending);const{_handle:n,size:r}=this;if(n&&t+e<r){const i=Math.min(r,t+e),s=new Uint8Array(i-t);return(yield n.read(s,0,e,t)).buffer}return new Uint8Array(e)}))}close(){return ar(this,void 0,void 0,(function*(){const t=this._handle;this._handle=null,t&&(yield t.close())}))}throw(t){return ar(this,void 0,void 0,(function*(){return yield this.close(),{done:!0,value:t}}))}return(t){return ar(this,void 0,void 0,(function*(){return yield this.close(),{done:!0,value:t}}))}}function gu(t){return t<0&&(t=4294967295+t+1),`0x${t.toString(16)}`}const vu=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class wu{constructor(t){this.buffer=t}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(t){const e=new Uint32Array([this.buffer[1]>>>16,65535&this.buffer[1],this.buffer[0]>>>16,65535&this.buffer[0]]),n=new Uint32Array([t.buffer[1]>>>16,65535&t.buffer[1],t.buffer[0]>>>16,65535&t.buffer[0]]);let r=e[3]*n[3];this.buffer[0]=65535&r;let i=r>>>16;return r=e[2]*n[3],i+=r,r=e[3]*n[2]>>>0,i+=r,this.buffer[0]+=i<<16,this.buffer[1]=i>>>0<r?65536:0,this.buffer[1]+=i>>>16,this.buffer[1]+=e[1]*n[3]+e[2]*n[2]+e[3]*n[1],this.buffer[1]+=e[0]*n[3]+e[1]*n[2]+e[2]*n[1]+e[3]*n[0]<<16,this}_plus(t){const e=this.buffer[0]+t.buffer[0]>>>0;this.buffer[1]+=t.buffer[1],e<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=e}lessThan(t){return this.buffer[1]<t.buffer[1]||this.buffer[1]===t.buffer[1]&&this.buffer[0]<t.buffer[0]}equals(t){return this.buffer[1]===t.buffer[1]&&this.buffer[0]==t.buffer[0]}greaterThan(t){return t.lessThan(this)}hex(){return`${gu(this.buffer[1])} ${gu(this.buffer[0])}`}}class _u extends wu{times(t){return this._times(t),this}plus(t){return this._plus(t),this}static from(t,e=new Uint32Array(2)){return _u.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return _u.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const n=t.length,r=new _u(e);for(let i=0;i<n;){const e=8<n-i?8:n-i,s=new _u(new Uint32Array([Number.parseInt(t.slice(i,i+e),10),0])),o=new _u(new Uint32Array([vu[e],0]));r.times(o),r.plus(s),i+=e}return r}static convertArray(t){const e=new Uint32Array(2*t.length);for(let n=-1,r=t.length;++n<r;)_u.from(t[n],new Uint32Array(e.buffer,e.byteOffset+2*n*4,2));return e}static multiply(t,e){return new _u(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new _u(new Uint32Array(t.buffer)).plus(e)}}class xu extends wu{negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],0==this.buffer[0]&&++this.buffer[1],this}times(t){return this._times(t),this}plus(t){return this._plus(t),this}lessThan(t){const e=this.buffer[1]<<0,n=t.buffer[1]<<0;return e<n||e===n&&this.buffer[0]<t.buffer[0]}static from(t,e=new Uint32Array(2)){return xu.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(2)){return xu.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(2)){const n=t.startsWith("-"),r=t.length,i=new xu(e);for(let s=n?1:0;s<r;){const e=8<r-s?8:r-s,n=new xu(new Uint32Array([Number.parseInt(t.slice(s,s+e),10),0])),o=new xu(new Uint32Array([vu[e],0]));i.times(o),i.plus(n),s+=e}return n?i.negate():i}static convertArray(t){const e=new Uint32Array(2*t.length);for(let n=-1,r=t.length;++n<r;)xu.from(t[n],new Uint32Array(e.buffer,e.byteOffset+2*n*4,2));return e}static multiply(t,e){return new xu(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new xu(new Uint32Array(t.buffer)).plus(e)}}class Au{constructor(t){this.buffer=t}high(){return new xu(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new xu(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=1+~this.buffer[0],this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],0==this.buffer[0]&&++this.buffer[1],0==this.buffer[1]&&++this.buffer[2],0==this.buffer[2]&&++this.buffer[3],this}times(t){const e=new _u(new Uint32Array([this.buffer[3],0])),n=new _u(new Uint32Array([this.buffer[2],0])),r=new _u(new Uint32Array([this.buffer[1],0])),i=new _u(new Uint32Array([this.buffer[0],0])),s=new _u(new Uint32Array([t.buffer[3],0])),o=new _u(new Uint32Array([t.buffer[2],0])),a=new _u(new Uint32Array([t.buffer[1],0])),u=new _u(new Uint32Array([t.buffer[0],0]));let c=_u.multiply(i,u);this.buffer[0]=c.low();const l=new _u(new Uint32Array([c.high(),0]));c=_u.multiply(r,u),l.plus(c),c=_u.multiply(i,a),l.plus(c),this.buffer[1]=l.low(),this.buffer[3]=l.lessThan(c)?1:0,this.buffer[2]=l.high();return new _u(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(_u.multiply(n,u)).plus(_u.multiply(r,a)).plus(_u.multiply(i,o)),this.buffer[3]+=_u.multiply(e,u).plus(_u.multiply(n,a)).plus(_u.multiply(r,o)).plus(_u.multiply(i,s)).low(),this}plus(t){const e=new Uint32Array(4);return e[3]=this.buffer[3]+t.buffer[3]>>>0,e[2]=this.buffer[2]+t.buffer[2]>>>0,e[1]=this.buffer[1]+t.buffer[1]>>>0,e[0]=this.buffer[0]+t.buffer[0]>>>0,e[0]<this.buffer[0]>>>0&&++e[1],e[1]<this.buffer[1]>>>0&&++e[2],e[2]<this.buffer[2]>>>0&&++e[3],this.buffer[3]=e[3],this.buffer[2]=e[2],this.buffer[1]=e[1],this.buffer[0]=e[0],this}hex(){return`${gu(this.buffer[3])} ${gu(this.buffer[2])} ${gu(this.buffer[1])} ${gu(this.buffer[0])}`}static multiply(t,e){return new Au(new Uint32Array(t.buffer)).times(e)}static add(t,e){return new Au(new Uint32Array(t.buffer)).plus(e)}static from(t,e=new Uint32Array(4)){return Au.fromString("string"==typeof t?t:t.toString(),e)}static fromNumber(t,e=new Uint32Array(4)){return Au.fromString(t.toString(),e)}static fromString(t,e=new Uint32Array(4)){const n=t.startsWith("-"),r=t.length,i=new Au(e);for(let s=n?1:0;s<r;){const e=8<r-s?8:r-s,n=new Au(new Uint32Array([Number.parseInt(t.slice(s,s+e),10),0,0,0])),o=new Au(new Uint32Array([vu[e],0,0,0]));i.times(o),i.plus(n),s+=e}return n?i.negate():i}static convertArray(t){const e=new Uint32Array(4*t.length);for(let n=-1,r=t.length;++n<r;)Au.from(t[n],new Uint32Array(e.buffer,e.byteOffset+16*n,4));return e}}class Su extends hs{constructor(t,e,n,r){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=t,this.nodes=e,this.buffers=n,this.dictionaries=r}visit(t){return super.visit(t instanceof Xa?t.type:t)}visitNull(t,{length:e}=this.nextFieldNode()){return No({type:t,length:e})}visitBool(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitInt(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFloat(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitUtf8(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitBinary(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),data:this.readData(t)})}visitFixedSizeBinary(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDate(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTimestamp(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitTime(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitDecimal(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitList(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}visitStruct(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),children:this.visitMany(t.children)})}visitUnion(t){return t.mode===Jr.Sparse?this.visitSparseUnion(t):this.visitDenseUnion(t)}visitDenseUnion(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),typeIds:this.readTypeIds(t),valueOffsets:this.readOffsets(t),children:this.visitMany(t.children)})}visitSparseUnion(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),typeIds:this.readTypeIds(t),children:this.visitMany(t.children)})}visitDictionary(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t.indices),dictionary:this.readDictionary(t)})}visitInterval(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),data:this.readData(t)})}visitFixedSizeList(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),child:this.visit(t.children[0])})}visitMap(t,{length:e,nullCount:n}=this.nextFieldNode()){return No({type:t,length:e,nullCount:n,nullBitmap:this.readNullBitmap(t,n),valueOffsets:this.readOffsets(t),child:this.visit(t.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(t,e,n=this.nextBufferRange()){return e>0&&this.readData(t,n)||new Uint8Array(0)}readOffsets(t,e){return this.readData(t,e)}readTypeIds(t,e){return this.readData(t,e)}readData(t,{length:e,offset:n}=this.nextBufferRange()){return this.bytes.subarray(n,n+e)}readDictionary(t){return this.dictionaries.get(t.id)}}class Iu extends Su{constructor(t,e,n,r){super(new Uint8Array(0),e,n,r),this.sources=t}readNullBitmap(t,e,{offset:n}=this.nextBufferRange()){return e<=0?new Uint8Array(0):Mo(this.sources[n])}readOffsets(t,{offset:e}=this.nextBufferRange()){return jr(Uint8Array,jr(Int32Array,this.sources[e]))}readTypeIds(t,{offset:e}=this.nextBufferRange()){return jr(Uint8Array,jr(t.ArrayType,this.sources[e]))}readData(t,{offset:e}=this.nextBufferRange()){const{sources:n}=this;return Wi.isTimestamp(t)||(Wi.isInt(t)||Wi.isTime(t))&&64===t.bitWidth||Wi.isDate(t)&&t.unit===ei.MILLISECOND?jr(Uint8Array,xu.convertArray(n[e])):Wi.isDecimal(t)?jr(Uint8Array,Au.convertArray(n[e])):Wi.isBinary(t)||Wi.isFixedSizeBinary(t)?function(t){const e=t.join(""),n=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)n[r>>1]=Number.parseInt(e.slice(r,r+2),16);return n}(n[e]):Wi.isBool(t)?Mo(n[e]):Wi.isUtf8(t)?yr(n[e].join("")):jr(Uint8Array,jr(t.ArrayType,n[e].map((t=>+t))))}}class Tu extends hs{compareSchemas(t,e){return t===e||e instanceof t.constructor&&this.compareManyFields(t.fields,e.fields)}compareManyFields(t,e){return t===e||Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every(((t,n)=>this.compareFields(t,e[n])))}compareFields(t,e){return t===e||e instanceof t.constructor&&t.name===e.name&&t.nullable===e.nullable&&this.visit(t.type,e.type)}}function Ou(t,e){return e instanceof t.constructor}function Mu(t,e){return t===e||Ou(t,e)}function Bu(t,e){return t===e||Ou(t,e)&&t.bitWidth===e.bitWidth&&t.isSigned===e.isSigned}function Du(t,e){return t===e||Ou(t,e)&&t.precision===e.precision}function Eu(t,e){return t===e||Ou(t,e)&&t.unit===e.unit}function Fu(t,e){return t===e||Ou(t,e)&&t.unit===e.unit&&t.timezone===e.timezone}function ku(t,e){return t===e||Ou(t,e)&&t.unit===e.unit&&t.bitWidth===e.bitWidth}function Nu(t,e){return t===e||Ou(t,e)&&t.mode===e.mode&&t.typeIds.every(((t,n)=>t===e.typeIds[n]))&&Lu.compareManyFields(t.children,e.children)}function Cu(t,e){return t===e||Ou(t,e)&&t.unit===e.unit}Tu.prototype.visitNull=Mu,Tu.prototype.visitBool=Mu,Tu.prototype.visitInt=Bu,Tu.prototype.visitInt8=Bu,Tu.prototype.visitInt16=Bu,Tu.prototype.visitInt32=Bu,Tu.prototype.visitInt64=Bu,Tu.prototype.visitUint8=Bu,Tu.prototype.visitUint16=Bu,Tu.prototype.visitUint32=Bu,Tu.prototype.visitUint64=Bu,Tu.prototype.visitFloat=Du,Tu.prototype.visitFloat16=Du,Tu.prototype.visitFloat32=Du,Tu.prototype.visitFloat64=Du,Tu.prototype.visitUtf8=Mu,Tu.prototype.visitBinary=Mu,Tu.prototype.visitFixedSizeBinary=function(t,e){return t===e||Ou(t,e)&&t.byteWidth===e.byteWidth},Tu.prototype.visitDate=Eu,Tu.prototype.visitDateDay=Eu,Tu.prototype.visitDateMillisecond=Eu,Tu.prototype.visitTimestamp=Fu,Tu.prototype.visitTimestampSecond=Fu,Tu.prototype.visitTimestampMillisecond=Fu,Tu.prototype.visitTimestampMicrosecond=Fu,Tu.prototype.visitTimestampNanosecond=Fu,Tu.prototype.visitTime=ku,Tu.prototype.visitTimeSecond=ku,Tu.prototype.visitTimeMillisecond=ku,Tu.prototype.visitTimeMicrosecond=ku,Tu.prototype.visitTimeNanosecond=ku,Tu.prototype.visitDecimal=Mu,Tu.prototype.visitList=function(t,e){return t===e||Ou(t,e)&&t.children.length===e.children.length&&Lu.compareManyFields(t.children,e.children)},Tu.prototype.visitStruct=function(t,e){return t===e||Ou(t,e)&&t.children.length===e.children.length&&Lu.compareManyFields(t.children,e.children)},Tu.prototype.visitUnion=Nu,Tu.prototype.visitDenseUnion=Nu,Tu.prototype.visitSparseUnion=Nu,Tu.prototype.visitDictionary=function(t,e){return t===e||Ou(t,e)&&t.id===e.id&&t.isOrdered===e.isOrdered&&Lu.visit(t.indices,e.indices)&&Lu.visit(t.dictionary,e.dictionary)},Tu.prototype.visitInterval=Cu,Tu.prototype.visitIntervalDayTime=Cu,Tu.prototype.visitIntervalYearMonth=Cu,Tu.prototype.visitFixedSizeList=function(t,e){return t===e||Ou(t,e)&&t.listSize===e.listSize&&t.children.length===e.children.length&&Lu.compareManyFields(t.children,e.children)},Tu.prototype.visitMap=function(t,e){return t===e||Ou(t,e)&&t.keysSorted===e.keysSorted&&t.children.length===e.children.length&&Lu.compareManyFields(t.children,e.children)};const Lu=new Tu;function Uu(t,e){return Lu.compareSchemas(t,e)}function ju(t,e){return function(t,e){const n=[...t.fields],r=[],i={numBatches:e.reduce(((t,e)=>Math.max(t,e.length)),0)};let s=0,o=0,a=-1;const u=e.length;let c,l=[];for(;i.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,a=-1;++a<u;)l[a]=c=e[a].shift(),o=Math.min(o,c?c.length:o);Number.isFinite(o)&&(l=zu(n,o,l,e,i),o>0&&(r[s++]=No({type:new is(n),length:o,nullCount:0,children:l.slice()})))}return[t=t.assign(n),r.map((e=>new Gu(t,e)))]}(t,e.map((t=>t.data.concat())))}function zu(t,e,n,r,i){var s;const o=(e+63&-64)>>3;for(let a=-1,u=r.length;++a<u;){const u=n[a],c=null==u?void 0:u.length;if(c>=e)c===e?n[a]=u:(n[a]=u.slice(0,e),i.numBatches=Math.max(i.numBatches,r[a].unshift(u.slice(e,c-e))));else{const r=t[a];t[a]=r.clone({nullable:!0}),n[a]=null!==(s=null==u?void 0:u._changeLengthAndBackfillNullBitmap(e))&&void 0!==s?s:No({type:r.type,length:e,nullCount:e,nullBitmap:new Uint8Array(o)})}}return n}var Vu,Ru,Pu,$u,Wu,Yu,Hu;class qu{constructor(...t){var e,n;if(0===t.length)return this.batches=[],this.schema=new Ja([]),this._offsets=[0],this;let r,i;t[0]instanceof Ja&&(r=t.shift()),t[t.length-1]instanceof Uint32Array&&(i=t.pop());const s=t=>{if(t){if(t instanceof Gu)return[t];if(t instanceof qu)return t.batches;if(t instanceof Fo){if(t.type instanceof is)return[new Gu(new Ja(t.type.children),t)]}else{if(Array.isArray(t))return t.flatMap((t=>s(t)));if("function"==typeof t[Symbol.iterator])return[...t].flatMap((t=>s(t)));if("object"==typeof t){const e=Object.keys(t),n=e.map((e=>new oa([t[e]]))),r=new Ja(e.map(((t,e)=>new Xa(String(t),n[e].type)))),[,i]=ju(r,n);return 0===i.length?[new Gu(t)]:i}}}return[]},o=t.flatMap((t=>s(t)));if(r=null!==(n=null!=r?r:null===(e=o[0])||void 0===e?void 0:e.schema)&&void 0!==n?n:new Ja([]),!(r instanceof Ja))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const a of o){if(!(a instanceof Gu))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!Uu(r,a.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=r,this.batches=o,this._offsets=null!=i?i:Uo(this.data)}get data(){return this.batches.map((({data:t})=>t))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce(((t,e)=>t+e.length),0)}get nullCount(){return-1===this._nullCount&&(this._nullCount=Lo(this.data)),this._nullCount}isValid(t){return!1}get(t){return null}set(t,e){}indexOf(t,e){return-1}getByteLength(t){return 0}[Symbol.iterator](){return Jo.visit(new oa(this.data))}toArray(){return[...this]}toString(){return`[\n  ${this.toArray().join(",\n  ")}\n]`}concat(...t){const e=this.schema,n=this.data.concat(t.flatMap((({data:t})=>t)));return new qu(e,n.map((t=>new Gu(e,t))))}slice(t,e){const n=this.schema;[t,e]=_o({length:this.numRows},t,e);const r=jo(this.data,this._offsets,t,e);return new qu(n,r.map((t=>new Gu(n,t))))}getChild(t){return this.getChildAt(this.schema.fields.findIndex((e=>e.name===t)))}getChildAt(t){if(t>-1&&t<this.schema.fields.length){const e=this.data.map((e=>e.children[t]));if(0===e.length){const{type:n}=this.schema.fields[t],r=No({type:n,length:0,nullCount:0});e.push(r._changeLengthAndBackfillNullBitmap(this.numRows))}return new oa(e)}return null}setChild(t,e){var n;return this.setChildAt(null===(n=this.schema.fields)||void 0===n?void 0:n.findIndex((e=>e.name===t)),e)}setChildAt(t,e){let n=this.schema,r=[...this.batches];if(t>-1&&t<this.numCols){e||(e=new oa([No({type:new Yi,length:this.numRows})]));const i=n.fields.slice(),s=i[t].clone({type:e.type}),o=this.schema.fields.map(((t,e)=>this.getChildAt(e)));[i[t],o[t]]=[s,e],[n,r]=ju(n,o)}return new qu(n,r)}select(t){const e=this.schema.fields.reduce(((t,e,n)=>t.set(e.name,n)),new Map);return this.selectAt(t.map((t=>e.get(t))).filter((t=>t>-1)))}selectAt(t){const e=this.schema.selectAt(t),n=this.batches.map((e=>e.selectAt(t)));return new qu(e,n)}assign(t){const e=this.schema.fields,[n,r]=t.schema.fields.reduce(((t,n,r)=>{const[i,s]=t,o=e.findIndex((t=>t.name===n.name));return~o?s[o]=r:i.push(r),t}),[[],[]]),i=this.schema.assign(t.schema),s=[...e.map(((t,e)=>[e,r[e]])).map((([e,n])=>void 0===n?this.getChildAt(e):t.getChildAt(n))),...n.map((e=>t.getChildAt(e)))].filter(Boolean);return new qu(...ju(i,s))}}Vu=Symbol.toStringTag,qu[Vu]=(t=>(t.schema=null,t.batches=[],t._offsets=new Uint32Array([0]),t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,t.isValid=Ro(Vo),t.get=Ro(po.getVisitFn(ci.Struct)),t.set=Po(Vs.getVisitFn(ci.Struct)),t.indexOf=$o(qo.getVisitFn(ci.Struct)),t.getByteLength=Ro(na.getVisitFn(ci.Struct)),"Table"))(qu.prototype);class Gu{constructor(...t){switch(t.length){case 2:if([this.schema]=t,!(this.schema instanceof Ja))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=No({nullCount:0,type:new is(this.schema.fields),children:this.schema.fields.map((t=>No({type:t.type,nullCount:0})))})]=t,!(this.data instanceof Fo))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=Ku(this.schema,this.data.children);break;case 1:{const[e]=t,{fields:n,children:r,length:i}=Object.keys(e).reduce(((t,n,r)=>(t.children[r]=e[n],t.length=Math.max(t.length,e[n].length),t.fields[r]=Xa.new({name:n,type:e[n].type,nullable:!0}),t)),{length:0,fields:new Array,children:new Array}),s=new Ja(n),o=No({type:new is(n),length:i,children:r,nullCount:0});[this.schema,this.data]=Ku(s,o.children,i);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=Qu(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(t){return this.data.getValid(t)}get(t){return po.visit(this.data,t)}set(t,e){return Vs.visit(this.data,t,e)}indexOf(t,e){return qo.visit(this.data,t,e)}getByteLength(t){return na.visit(this.data,t)}[Symbol.iterator](){return Jo.visit(new oa([this.data]))}toArray(){return[...this]}concat(...t){return new qu(this.schema,[this,...t])}slice(t,e){const[n]=new oa([this.data]).slice(t,e).data;return new Gu(this.schema,n)}getChild(t){var e;return this.getChildAt(null===(e=this.schema.fields)||void 0===e?void 0:e.findIndex((e=>e.name===t)))}getChildAt(t){return t>-1&&t<this.schema.fields.length?new oa([this.data.children[t]]):null}setChild(t,e){var n;return this.setChildAt(null===(n=this.schema.fields)||void 0===n?void 0:n.findIndex((e=>e.name===t)),e)}setChildAt(t,e){let n=this.schema,r=this.data;if(t>-1&&t<this.numCols){e||(e=new oa([No({type:new Yi,length:this.numRows})]));const i=n.fields.slice(),s=r.children.slice(),o=i[t].clone({type:e.type});[i[t],s[t]]=[o,e.data[0]],n=new Ja(i,new Map(this.schema.metadata)),r=No({type:new is(i),children:s})}return new Gu(n,r)}select(t){const e=this.schema.select(t),n=new is(e.fields),r=[];for(const i of t){const t=this.schema.fields.findIndex((t=>t.name===i));~t&&(r[t]=this.data.children[t])}return new Gu(e,No({type:n,length:this.numRows,children:r}))}selectAt(t){const e=this.schema.selectAt(t),n=t.map((t=>this.data.children[t])).filter(Boolean),r=No({type:new is(e.fields),length:this.numRows,children:n});return new Gu(e,r)}}function Ku(t,e,n=e.reduce(((t,e)=>Math.max(t,e.length)),0)){var r;const i=[...t.fields],s=[...e],o=(n+63&-64)>>3;for(const[a,u]of t.fields.entries()){const t=e[a];t&&t.length===n||(i[a]=u.clone({nullable:!0}),s[a]=null!==(r=null==t?void 0:t._changeLengthAndBackfillNullBitmap(n))&&void 0!==r?r:No({type:u.type,length:n,nullCount:n,nullBitmap:new Uint8Array(o)}))}return[t.assign(i),No({type:new is(i),length:n,children:s})]}function Qu(t,e,n=new Map){for(let r=-1,i=t.length;++r<i;){const i=t[r].type,s=e[r];if(Wi.isDictionary(i))if(n.has(i.id)){if(n.get(i.id)!==s.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}else s.dictionary&&n.set(i.id,s.dictionary);i.children&&i.children.length>0&&Qu(i.children,s.children,n)}return n}Ru=Symbol.toStringTag,Gu[Ru]=(t=>(t._nullCount=-1,t[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(Gu.prototype);class Ju extends Gu{constructor(t){const e=t.fields.map((t=>No({type:t.type})));super(t,No({type:new is(t.fields),nullCount:0,children:e}))}}($u=Pu||(Pu={}))[$u.BUFFER=0]="BUFFER",(Yu=Wu||(Wu={}))[Yu.LZ4_FRAME=0]="LZ4_FRAME",Yu[Yu.ZSTD=1]="ZSTD";class Xu{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsBodyCompression(t,e){return(e||new Xu).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsBodyCompression(t,e){return t.setPosition(t.position()+4),(e||new Xu).__init(t.readInt32(t.position())+t.position(),t)}codec(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt8(this.bb_pos+t):Wu.LZ4_FRAME}method(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt8(this.bb_pos+t):Pu.BUFFER}static startBodyCompression(t){t.startObject(2)}static addCodec(t,e){t.addFieldInt8(0,e,Wu.LZ4_FRAME)}static addMethod(t,e){t.addFieldInt8(1,e,Pu.BUFFER)}static endBodyCompression(t){return t.endObject()}static createBodyCompression(t,e,n){return Xu.startBodyCompression(t),Xu.addCodec(t,e),Xu.addMethod(t,n),Xu.endBodyCompression(t)}}class Zu{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(t,e,n){return t.prep(8,16),t.writeInt64(n),t.writeInt64(e),t.offset()}}class tc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(t,e,n){return t.prep(8,16),t.writeInt64(n),t.writeInt64(e),t.offset()}}class ec{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsRecordBatch(t,e){return(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsRecordBatch(t,e){return t.setPosition(t.position()+4),(e||new ec).__init(t.readInt32(t.position())+t.position(),t)}length(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}nodes(t,e){const n=this.bb.__offset(this.bb_pos,6);return n?(e||new tc).__init(this.bb.__vector(this.bb_pos+n)+16*t,this.bb):null}nodesLength(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__vector_len(this.bb_pos+t):0}buffers(t,e){const n=this.bb.__offset(this.bb_pos,8);return n?(e||new Zu).__init(this.bb.__vector(this.bb_pos+n)+16*t,this.bb):null}buffersLength(){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__vector_len(this.bb_pos+t):0}compression(t){const e=this.bb.__offset(this.bb_pos,10);return e?(t||new Xu).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}static startRecordBatch(t){t.startObject(4)}static addLength(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addNodes(t,e){t.addFieldOffset(1,e,0)}static startNodesVector(t,e){t.startVector(16,e,8)}static addBuffers(t,e){t.addFieldOffset(2,e,0)}static startBuffersVector(t,e){t.startVector(16,e,8)}static addCompression(t,e){t.addFieldOffset(3,e,0)}static endRecordBatch(t){return t.endObject()}}class nc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsDictionaryBatch(t,e){return(e||new nc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsDictionaryBatch(t,e){return t.setPosition(t.position()+4),(e||new nc).__init(t.readInt32(t.position())+t.position(),t)}id(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}data(t){const e=this.bb.__offset(this.bb_pos,6);return e?(t||new ec).__init(this.bb.__indirect(this.bb_pos+e),this.bb):null}isDelta(){const t=this.bb.__offset(this.bb_pos,8);return!!t&&!!this.bb.readInt8(this.bb_pos+t)}static startDictionaryBatch(t){t.startObject(3)}static addId(t,e){t.addFieldInt64(0,e,t.createLong(0,0))}static addData(t,e){t.addFieldOffset(1,e,0)}static addIsDelta(t,e){t.addFieldInt8(2,+e,0)}static endDictionaryBatch(t){return t.endObject()}}!function(t){t[t.NONE=0]="NONE",t[t.Schema=1]="Schema",t[t.DictionaryBatch=2]="DictionaryBatch",t[t.RecordBatch=3]="RecordBatch",t[t.Tensor=4]="Tensor",t[t.SparseTensor=5]="SparseTensor"}(Hu||(Hu={}));class rc{constructor(){this.bb=null,this.bb_pos=0}__init(t,e){return this.bb_pos=t,this.bb=e,this}static getRootAsMessage(t,e){return(e||new rc).__init(t.readInt32(t.position())+t.position(),t)}static getSizePrefixedRootAsMessage(t,e){return t.setPosition(t.position()+4),(e||new rc).__init(t.readInt32(t.position())+t.position(),t)}version(){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readInt16(this.bb_pos+t):ya.V1}headerType(){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb_pos+t):Hu.NONE}header(t){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__union(t,this.bb_pos+e):null}bodyLength(){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb_pos+t):this.bb.createLong(0,0)}customMetadata(t,e){const n=this.bb.__offset(this.bb_pos,12);return n?(e||new Ba).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*t),this.bb):null}customMetadataLength(){const t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__vector_len(this.bb_pos+t):0}static startMessage(t){t.startObject(5)}static addVersion(t,e){t.addFieldInt16(0,e,ya.V1)}static addHeaderType(t,e){t.addFieldInt8(1,e,Hu.NONE)}static addHeader(t,e){t.addFieldOffset(2,e,0)}static addBodyLength(t,e){t.addFieldInt64(3,e,t.createLong(0,0))}static addCustomMetadata(t,e){t.addFieldOffset(4,e,0)}static createCustomMetadataVector(t,e){t.startVector(4,e.length,4);for(let n=e.length-1;n>=0;n--)t.addOffset(e[n]);return t.endVector()}static startCustomMetadataVector(t,e){t.startVector(4,e,4)}static endMessage(t){return t.endObject()}static finishMessageBuffer(t,e){t.finish(e)}static finishSizePrefixedMessageBuffer(t,e){t.finish(e,void 0,!0)}static createMessage(t,e,n,r,i,s){return rc.startMessage(t),rc.addVersion(t,e),rc.addHeaderType(t,n),rc.addHeader(t,r),rc.addBodyLength(t,i),rc.addCustomMetadata(t,s),rc.endMessage(t)}}var ic=ha;const sc=new class extends hs{visit(t,e){return null==t||null==e?void 0:super.visit(t,e)}visitNull(t,e){return Pa.startNull(e),Pa.endNull(e)}visitInt(t,e){return Da.startInt(e),Da.addBitWidth(e,t.bitWidth),Da.addIsSigned(e,t.isSigned),Da.endInt(e)}visitFloat(t,e){return ja.startFloatingPoint(e),ja.addPrecision(e,t.precision),ja.endFloatingPoint(e)}visitBinary(t,e){return Fa.startBinary(e),Fa.endBinary(e)}visitBool(t,e){return ka.startBool(e),ka.endBool(e)}visitUtf8(t,e){return qa.startUtf8(e),qa.endUtf8(e)}visitDecimal(t,e){return Ca.startDecimal(e),Ca.addScale(e,t.scale),Ca.addPrecision(e,t.precision),Ca.addBitWidth(e,t.bitWidth),Ca.endDecimal(e)}visitDate(t,e){return Na.startDate(e),Na.addUnit(e,t.unit),Na.endDate(e)}visitTime(t,e){return Wa.startTime(e),Wa.addUnit(e,t.unit),Wa.addBitWidth(e,t.bitWidth),Wa.endTime(e)}visitTimestamp(t,e){const n=t.timezone&&e.createString(t.timezone)||void 0;return Ya.startTimestamp(e),Ya.addUnit(e,t.unit),void 0!==n&&Ya.addTimezone(e,n),Ya.endTimestamp(e)}visitInterval(t,e){return za.startInterval(e),za.addUnit(e,t.unit),za.endInterval(e)}visitList(t,e){return Va.startList(e),Va.endList(e)}visitStruct(t,e){return $a.startStruct_(e),$a.endStruct_(e)}visitUnion(t,e){Ha.startTypeIdsVector(e,t.typeIds.length);const n=Ha.createTypeIdsVector(e,t.typeIds);return Ha.startUnion(e),Ha.addMode(e,t.mode),Ha.addTypeIds(e,n),Ha.endUnion(e)}visitDictionary(t,e){const n=this.visit(t.indices,e);return Ea.startDictionaryEncoding(e),Ea.addId(e,new ic(t.id,0)),Ea.addIsOrdered(e,t.isOrdered),void 0!==n&&Ea.addIndexType(e,n),Ea.endDictionaryEncoding(e)}visitFixedSizeBinary(t,e){return La.startFixedSizeBinary(e),La.addByteWidth(e,t.byteWidth),La.endFixedSizeBinary(e)}visitFixedSizeList(t,e){return Ua.startFixedSizeList(e),Ua.addListSize(e,t.listSize),Ua.endFixedSizeList(e)}visitMap(t,e){return Ra.startMap(e),Ra.addKeysSorted(e,t.keysSorted),Ra.endMap(e)}};function oc(t){return new bc(t.count,uc(t.columns),cc(t.columns))}function ac(t,e){return(t.children||[]).filter(Boolean).map((t=>Xa.fromJSON(t,e)))}function uc(t){return(t||[]).reduce(((t,e)=>{return[...t,new wc(e.count,(n=e.VALIDITY,(n||[]).reduce(((t,e)=>t+ +(0===e)),0))),...uc(e.children)];var n}),[])}function cc(t,e=[]){for(let n=-1,r=(t||[]).length;++n<r;){const r=t[n];r.VALIDITY&&e.push(new vc(e.length,r.VALIDITY.length)),r.TYPE&&e.push(new vc(e.length,r.TYPE.length)),r.OFFSET&&e.push(new vc(e.length,r.OFFSET.length)),r.DATA&&e.push(new vc(e.length,r.DATA.length)),e=cc(r.children,e)}return e}function lc(t){return new Map(Object.entries(t||{}))}function fc(t){return new Hi(t.isSigned,t.bitWidth)}function dc(t,e){const n=t.type.name;switch(n){case"NONE":case"null":return new Yi;case"binary":return new Ki;case"utf8":return new Qi;case"bool":return new Ji;case"list":return new rs((e||[])[0]);case"struct":case"struct_":return new is(e||[])}switch(n){case"int":{const e=t.type;return new Hi(e.isSigned,e.bitWidth)}case"floatingpoint":{const e=t.type;return new Gi(Zr[e.precision])}case"decimal":{const e=t.type;return new Xi(e.scale,e.precision,e.bitWidth)}case"date":{const e=t.type;return new Zi(ei[e.unit])}case"time":{const e=t.type;return new ts(ri[e.unit],e.bitWidth)}case"timestamp":{const e=t.type;return new es(ri[e.unit],e.timezone)}case"interval":{const e=t.type;return new ns(si[e.unit])}case"union":{const n=t.type;return new ss(Jr[n.mode],n.typeIds||[],e||[])}case"fixedsizebinary":{const e=t.type;return new os(e.byteWidth)}case"fixedsizelist":{const n=t.type;return new as(n.listSize,(e||[])[0])}case"map":{const n=t.type;return new us((e||[])[0],n.keysSorted)}}throw new Error(`Unrecognized type: "${n}"`)}var hc=ha,pc=Ma,mc=Oa;class yc{constructor(t,e,n,r){this._version=e,this._headerType=n,this.body=new Uint8Array(0),r&&(this._createHeader=()=>r),this._bodyLength="number"==typeof t?t:t.low}static fromJSON(t,e){const n=new yc(0,Kr.V4,e);return n._createHeader=function(t,e){return()=>{switch(e){case ai.Schema:return Ja.fromJSON(t);case ai.RecordBatch:return bc.fromJSON(t);case ai.DictionaryBatch:return gc.fromJSON(t)}throw new Error(`Unrecognized Message type: { name: ${ai[e]}, type: ${e} }`)}}(t,e),n}static decode(t){t=new mc(Vr(t));const e=rc.getRootAsMessage(t),n=e.bodyLength(),r=e.version(),i=e.headerType(),s=new yc(n,r,i);return s._createHeader=function(t,e){return()=>{switch(e){case ai.Schema:return Ja.decode(t.header(new Ka));case ai.RecordBatch:return bc.decode(t.header(new ec),t.version());case ai.DictionaryBatch:return gc.decode(t.header(new nc),t.version())}throw new Error(`Unrecognized Message type: { name: ${ai[e]}, type: ${e} }`)}}(e,i),s}static encode(t){const e=new pc;let n=-1;return t.isSchema()?n=Ja.encode(e,t.header()):t.isRecordBatch()?n=bc.encode(e,t.header()):t.isDictionaryBatch()&&(n=gc.encode(e,t.header())),rc.startMessage(e),rc.addVersion(e,Kr.V4),rc.addHeader(e,n),rc.addHeaderType(e,t.headerType),rc.addBodyLength(e,new hc(t.bodyLength,0)),rc.finishMessageBuffer(e,rc.endMessage(e)),e.asUint8Array()}static from(t,e=0){if(t instanceof Ja)return new yc(0,Kr.V4,ai.Schema,t);if(t instanceof bc)return new yc(e,Kr.V4,ai.RecordBatch,t);if(t instanceof gc)return new yc(e,Kr.V4,ai.DictionaryBatch,t);throw new Error(`Unrecognized Message header: ${t}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===ai.Schema}isRecordBatch(){return this.headerType===ai.RecordBatch}isDictionaryBatch(){return this.headerType===ai.DictionaryBatch}}class bc{constructor(t,e,n){this._nodes=e,this._buffers=n,this._length="number"==typeof t?t:t.low}get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}}class gc{constructor(t,e,n=!1){this._data=t,this._isDelta=n,this._id="number"==typeof e?e:e.low}get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}}class vc{constructor(t,e){this.offset="number"==typeof t?t:t.low,this.length="number"==typeof e?e:e.low}}class wc{constructor(t,e){this.length="number"==typeof t?t:t.low,this.nullCount="number"==typeof e?e:e.low}}function _c(t,e){const n=[];for(let r,i=-1,s=-1,o=t.childrenLength();++i<o;)(r=t.children(i))&&(n[++s]=Xa.decode(r,e));return n}function xc(t){const e=new Map;if(t)for(let n,r,i=-1,s=Math.trunc(t.customMetadataLength());++i<s;)(n=t.customMetadata(i))&&null!=(r=n.key())&&e.set(r,n.value());return e}function Ac(t){return new Hi(t.isSigned(),t.bitWidth())}function Sc(t,e){const n=t.typeType();switch(n){case Ta.NONE:case Ta.Null:return new Yi;case Ta.Binary:return new Ki;case Ta.Utf8:return new Qi;case Ta.Bool:return new Ji;case Ta.List:return new rs((e||[])[0]);case Ta.Struct_:return new is(e||[])}switch(n){case Ta.Int:{const e=t.type(new Da);return new Hi(e.isSigned(),e.bitWidth())}case Ta.FloatingPoint:{const e=t.type(new ja);return new Gi(e.precision())}case Ta.Decimal:{const e=t.type(new Ca);return new Xi(e.scale(),e.precision(),e.bitWidth())}case Ta.Date:{const e=t.type(new Na);return new Zi(e.unit())}case Ta.Time:{const e=t.type(new Wa);return new ts(e.unit(),e.bitWidth())}case Ta.Timestamp:{const e=t.type(new Ya);return new es(e.unit(),e.timezone())}case Ta.Interval:{const e=t.type(new za);return new ns(e.unit())}case Ta.Union:{const n=t.type(new Ha);return new ss(n.mode(),n.typeIdsArray()||[],e||[])}case Ta.FixedSizeBinary:{const e=t.type(new La);return new os(e.byteWidth())}case Ta.FixedSizeList:{const n=t.type(new Ua);return new as(n.listSize(),(e||[])[0])}case Ta.Map:{const n=t.type(new Ra);return new us((e||[])[0],n.keysSorted())}}throw new Error(`Unrecognized type: "${Ta[n]}" (${n})`)}Xa.encode=function(t,e){let n=-1,r=-1,i=-1;const s=e.type;let o=e.typeId;Wi.isDictionary(s)?(o=s.dictionary.typeId,i=sc.visit(s,t),r=sc.visit(s.dictionary,t)):r=sc.visit(s,t);const a=(s.children||[]).map((e=>Xa.encode(t,e))),u=Ga.createChildrenVector(t,a),c=e.metadata&&e.metadata.size>0?Ga.createCustomMetadataVector(t,[...e.metadata].map((([e,n])=>{const r=t.createString(`${e}`),i=t.createString(`${n}`);return Ba.startKeyValue(t),Ba.addKey(t,r),Ba.addValue(t,i),Ba.endKeyValue(t)}))):-1;e.name&&(n=t.createString(e.name));Ga.startField(t),Ga.addType(t,r),Ga.addTypeType(t,o),Ga.addChildren(t,u),Ga.addNullable(t,!!e.nullable),-1!==n&&Ga.addName(t,n);-1!==i&&Ga.addDictionary(t,i);-1!==c&&Ga.addCustomMetadata(t,c);return Ga.endField(t)},Xa.decode=function(t,e){let n,r,i,s,o,a;e&&(a=t.dictionary())?e.has(n=a.id().low)?(s=(s=a.indexType())?Ac(s):new qi,o=new fs(e.get(n),s,n,a.isOrdered()),r=new Xa(t.name(),o,t.nullable(),xc(t))):(s=(s=a.indexType())?Ac(s):new qi,e.set(n,i=Sc(t,_c(t,e))),o=new fs(i,s,n,a.isOrdered()),r=new Xa(t.name(),o,t.nullable(),xc(t))):(i=Sc(t,_c(t,e)),r=new Xa(t.name(),i,t.nullable(),xc(t)));return r||null},Xa.fromJSON=function(t,e){let n,r,i,s,o,a;return e&&(s=t.dictionary)?e.has(n=s.id)?(r=(r=s.indexType)?fc(r):new qi,a=new fs(e.get(n),r,n,s.isOrdered),i=new Xa(t.name,a,t.nullable,lc(t.customMetadata))):(r=(r=s.indexType)?fc(r):new qi,e.set(n,o=dc(t,ac(t,e))),a=new fs(o,r,n,s.isOrdered),i=new Xa(t.name,a,t.nullable,lc(t.customMetadata))):(o=dc(t,ac(t,e)),i=new Xa(t.name,o,t.nullable,lc(t.customMetadata))),i||null},Ja.encode=function(t,e){const n=e.fields.map((e=>Xa.encode(t,e)));Ka.startFieldsVector(t,n.length);const r=Ka.createFieldsVector(t,n),i=e.metadata&&e.metadata.size>0?Ka.createCustomMetadataVector(t,[...e.metadata].map((([e,n])=>{const r=t.createString(`${e}`),i=t.createString(`${n}`);return Ba.startKeyValue(t),Ba.addKey(t,r),Ba.addValue(t,i),Ba.endKeyValue(t)}))):-1;Ka.startSchema(t),Ka.addFields(t,r),Ka.addEndianness(t,Ic?ba.Little:ba.Big),-1!==i&&Ka.addCustomMetadata(t,i);return Ka.endSchema(t)},Ja.decode=function(t,e=new Map){const n=function(t,e){const n=[];for(let r,i=-1,s=-1,o=t.fieldsLength();++i<o;)(r=t.fields(i))&&(n[++s]=Xa.decode(r,e));return n}(t,e);return new Ja(n,xc(t),e)},Ja.fromJSON=function(t,e=new Map){return new Ja(function(t,e){return(t.fields||[]).filter(Boolean).map((t=>Xa.fromJSON(t,e)))}(t,e),lc(t.customMetadata),e)},bc.encode=function(t,e){const n=e.nodes||[],r=e.buffers||[];ec.startNodesVector(t,n.length);for(const o of n.slice().reverse())wc.encode(t,o);const i=t.endVector();ec.startBuffersVector(t,r.length);for(const o of r.slice().reverse())vc.encode(t,o);const s=t.endVector();return ec.startRecordBatch(t),ec.addLength(t,new hc(e.length,0)),ec.addNodes(t,i),ec.addBuffers(t,s),ec.endRecordBatch(t)},bc.decode=function(t,e=Kr.V4){return new bc(t.length(),function(t){const e=[];for(let n,r=-1,i=-1,s=t.nodesLength();++r<s;)(n=t.nodes(r))&&(e[++i]=wc.decode(n));return e}(t),function(t,e){const n=[];for(let r,i=-1,s=-1,o=t.buffersLength();++i<o;)(r=t.buffers(i))&&(e<Kr.V4&&(r.bb_pos+=8*(i+1)),n[++s]=vc.decode(r));return n}(t,e))},bc.fromJSON=oc,gc.encode=function(t,e){const n=bc.encode(t,e.data);return nc.startDictionaryBatch(t),nc.addId(t,new hc(e.id,0)),nc.addIsDelta(t,e.isDelta),nc.addData(t,n),nc.endDictionaryBatch(t)},gc.decode=function(t,e=Kr.V4){return new gc(bc.decode(t.data(),e),t.id(),t.isDelta())},gc.fromJSON=function(t){return new gc(oc(t.data),t.id,t.isDelta)},wc.encode=function(t,e){return tc.createFieldNode(t,new hc(e.length,0),new hc(e.nullCount,0))},wc.decode=function(t){return new wc(t.length(),t.nullCount())},vc.encode=function(t,e){return Zu.createBuffer(t,new hc(e.offset,0),new hc(e.length,0))},vc.decode=function(t){return new vc(t.offset(),t.length())};const Ic=(()=>{const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]})(),Tc=t=>`Expected ${ai[t]} Message in stream, but was null or length 0.`,Oc=t=>`Header pointer of flatbuffer-encoded ${ai[t]} Message is null or length 0.`,Mc=(t,e)=>`Expected to read ${t} metadata bytes, but only read ${e}.`,Bc=(t,e)=>`Expected to read ${t} bytes for message body, but only read ${e}.`;class Dc{constructor(t){this.source=t instanceof du?t:new du(t)}[Symbol.iterator](){return this}next(){let t;return(t=this.readMetadataLength()).done||-1===t.value&&(t=this.readMetadataLength()).done||(t=this.readMetadata(t.value)).done?au:t}throw(t){return this.source.throw(t)}return(t){return this.source.return(t)}readMessage(t){let e;if((e=this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(Tc(t));return e.value}readMessageBody(t){if(t<=0)return new Uint8Array(0);const e=Vr(this.source.read(t));if(e.byteLength<t)throw new Error(Bc(t,e.byteLength));return e.byteOffset%8==0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}readSchema(t=!1){const e=ai.Schema,n=this.readMessage(e),r=null==n?void 0:n.header();if(t&&!r)throw new Error(Oc(e));return r}readMetadataLength(){const t=this.source.read(kc),e=t&&new Oa(t),n=(null==e?void 0:e.readInt32(0))||0;return{done:0===n,value:n}}readMetadata(t){const e=this.source.read(t);if(!e)return au;if(e.byteLength<t)throw new Error(Mc(t,e.byteLength));return{done:!1,value:yc.decode(e)}}}class Ec{constructor(t,e){this.source=t instanceof hu?t:Dr(t)?new bu(t,e):new hu(t)}[Symbol.asyncIterator](){return this}next(){return ar(this,void 0,void 0,(function*(){let t;return(t=yield this.readMetadataLength()).done||-1===t.value&&(t=yield this.readMetadataLength()).done||(t=yield this.readMetadata(t.value)).done?au:t}))}throw(t){return ar(this,void 0,void 0,(function*(){return yield this.source.throw(t)}))}return(t){return ar(this,void 0,void 0,(function*(){return yield this.source.return(t)}))}readMessage(t){return ar(this,void 0,void 0,(function*(){let e;if((e=yield this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(Tc(t));return e.value}))}readMessageBody(t){return ar(this,void 0,void 0,(function*(){if(t<=0)return new Uint8Array(0);const e=Vr(yield this.source.read(t));if(e.byteLength<t)throw new Error(Bc(t,e.byteLength));return e.byteOffset%8==0&&e.byteOffset+e.byteLength<=e.buffer.byteLength?e:e.slice()}))}readSchema(t=!1){return ar(this,void 0,void 0,(function*(){const e=ai.Schema,n=yield this.readMessage(e),r=null==n?void 0:n.header();if(t&&!r)throw new Error(Oc(e));return r}))}readMetadataLength(){return ar(this,void 0,void 0,(function*(){const t=yield this.source.read(kc),e=t&&new Oa(t),n=(null==e?void 0:e.readInt32(0))||0;return{done:0===n,value:n}}))}readMetadata(t){return ar(this,void 0,void 0,(function*(){const e=yield this.source.read(t);if(!e)return au;if(e.byteLength<t)throw new Error(Mc(t,e.byteLength));return{done:!1,value:yc.decode(e)}}))}}class Fc extends Dc{constructor(t){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=t instanceof uu?t:new uu(t)}next(){const{_json:t}=this;if(!this._schema){this._schema=!0;return{done:!1,value:yc.fromJSON(t.schema,ai.Schema)}}if(this._dictionaryIndex<t.dictionaries.length){const e=t.dictionaries[this._dictionaryIndex++];this._body=e.data.columns;return{done:!1,value:yc.fromJSON(e,ai.DictionaryBatch)}}if(this._batchIndex<t.batches.length){const e=t.batches[this._batchIndex++];this._body=e.columns;return{done:!1,value:yc.fromJSON(e,ai.RecordBatch)}}return this._body=[],au}readMessageBody(t){return function t(e){return(e||[]).reduce(((e,n)=>[...e,...n.VALIDITY&&[n.VALIDITY]||[],...n.TYPE&&[n.TYPE]||[],...n.OFFSET&&[n.OFFSET]||[],...n.DATA&&[n.DATA]||[],...t(n.children)]),[])}(this._body)}readMessage(t){let e;if((e=this.next()).done)return null;if(null!=t&&e.value.headerType!==t)throw new Error(Tc(t));return e.value}readSchema(){const t=ai.Schema,e=this.readMessage(t),n=null==e?void 0:e.header();if(!e||!n)throw new Error(Oc(t));return n}}const kc=4,Nc=new Uint8Array("ARROW1".length);for(let tl=0;tl<"ARROW1".length;tl+=1)Nc[tl]="ARROW1".codePointAt(tl);function Cc(t,e=0){for(let n=-1,r=Nc.length;++n<r;)if(Nc[n]!==t[e+n])return!1;return!0}const Lc=Nc.length,Uc=Lc+kc,jc=2*Lc+kc;class zc extends cu{constructor(t){super(),this._impl=t}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(t){return this._impl.throw(t)}return(t){return this._impl.return(t)}cancel(){return this._impl.cancel()}reset(t){return this._impl.reset(t),this._DOMStream=void 0,this._nodeStream=void 0,this}open(t){const e=this._impl.open(t);return Ir(e)?e.then((()=>this)):this}readRecordBatch(t){return this._impl.isFile()?this._impl.readRecordBatch(t):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Yr.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Yr.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(t){throw new Error('"throughNode" not available in this environment')}static throughDOM(t,e){throw new Error('"throughDOM" not available in this environment')}static from(t){return t instanceof zc?t:Mr(t)?function(t){return new Vc(new Kc(t))}(t):Dr(t)?function(t){return ar(this,void 0,void 0,(function*(){const{size:e}=yield t.stat(),n=new bu(t,e);return e>=jc&&Cc(yield n.readAt(0,Lc+7&-8))?new $c(new Gc(n)):new Rc(new Hc(n))}))}(t):Ir(t)?(()=>ar(this,void 0,void 0,(function*(){return yield zc.from(yield t)})))():Er(t)||kr(t)||Nr(t)||Or(t)?function(t){return ar(this,void 0,void 0,(function*(){const e=yield t.peek(Lc+7&-8);return e&&e.byteLength>=4?Cc(e)?new Pc(new qc(yield t.read())):new Rc(new Hc(t)):new Rc(new Hc(function(){return lr(this,arguments,(function*(){}))}()))}))}(new hu(t)):function(t){const e=t.peek(Lc+7&-8);return e&&e.byteLength>=4?Cc(e)?new Pc(new qc(t.read())):new Vc(new Yc(t)):new Vc(new Yc(function*(){}()))}(new du(t))}static readAll(t){return t instanceof zc?t.isSync()?Jc(t):Xc(t):Mr(t)||ArrayBuffer.isView(t)||Tr(t)||Br(t)?Jc(t):Xc(t)}}class Vc extends zc{constructor(t){super(t),this._impl=t}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return lr(this,arguments,(function*(){yield cr(yield*fr(dr(this[Symbol.iterator]())))}))}}class Rc extends zc{constructor(t){super(t),this._impl=t}readAll(){var t,e;return ar(this,void 0,void 0,(function*(){const n=new Array;try{for(var r,i=dr(this);!(r=yield i.next()).done;){const t=r.value;n.push(t)}}catch(s){t={error:s}}finally{try{r&&!r.done&&(e=i.return)&&(yield e.call(i))}finally{if(t)throw t.error}}return n}))}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class Pc extends Vc{constructor(t){super(t),this._impl=t}}class $c extends Rc{constructor(t){super(t),this._impl=t}}class Wc{constructor(t=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=t}get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(t){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=t,this.dictionaries=new Map,this}_loadRecordBatch(t,e){const n=this._loadVectors(t,e,this.schema.fields),r=No({type:new is(this.schema.fields),length:t.length,children:n});return new Gu(this.schema,r)}_loadDictionaryBatch(t,e){const{id:n,isDelta:r}=t,{dictionaries:i,schema:s}=this,o=i.get(n);if(r||!o){const i=s.dictionaries.get(n),a=this._loadVectors(t.data,e,[i]);return(o&&r?o.concat(new oa(a)):new oa(a)).memoize()}return o.memoize()}_loadVectors(t,e,n){return new Su(e,t.nodes,t.buffers,this.dictionaries).visitMany(n)}}class Yc extends Wc{constructor(t,e){super(e),this._reader=Mr(t)?new Fc(this._handle=t):new Dc(this._handle=t)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(t){return this.closed||(this.autoDestroy=Qc(this,t),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(t):au}return(t){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(t):au}next(){if(this.closed)return au;let t;const{_reader:e}=this;for(;t=this._readNextMessageAndValidate();)if(t.isSchema())this.reset(t.header());else{if(t.isRecordBatch()){this._recordBatchIndex++;const n=t.header(),r=e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}if(t.isDictionaryBatch()){this._dictionaryIndex++;const n=t.header(),r=e.readMessageBody(t.bodyLength),i=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,i)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new Ju(this.schema)}):this.return()}_readNextMessageAndValidate(t){return this._reader.readMessage(t)}}class Hc extends Wc{constructor(t,e){super(e),this._reader=new Ec(this._handle=t)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return ar(this,void 0,void 0,(function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}))}open(t){return ar(this,void 0,void 0,(function*(){return this.closed||(this.autoDestroy=Qc(this,t),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this}))}throw(t){return ar(this,void 0,void 0,(function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(t):au}))}return(t){return ar(this,void 0,void 0,(function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(t):au}))}next(){return ar(this,void 0,void 0,(function*(){if(this.closed)return au;let t;const{_reader:e}=this;for(;t=yield this._readNextMessageAndValidate();)if(t.isSchema())yield this.reset(t.header());else{if(t.isRecordBatch()){this._recordBatchIndex++;const n=t.header(),r=yield e.readMessageBody(t.bodyLength);return{done:!1,value:this._loadRecordBatch(n,r)}}if(t.isDictionaryBatch()){this._dictionaryIndex++;const n=t.header(),r=yield e.readMessageBody(t.bodyLength),i=this._loadDictionaryBatch(n,r);this.dictionaries.set(n.id,i)}}return this.schema&&0===this._recordBatchIndex?(this._recordBatchIndex++,{done:!1,value:new Ju(this.schema)}):yield this.return()}))}_readNextMessageAndValidate(t){return ar(this,void 0,void 0,(function*(){return yield this._reader.readMessage(t)}))}}class qc extends Yc{constructor(t,e){super(t instanceof yu?t:new yu(t),e)}get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}isSync(){return!0}isFile(){return!0}open(t){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(t)}readRecordBatch(t){var e;if(this.closed)return null;this._footer||this.open();const n=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(t);if(n&&this._handle.seek(n.offset)){const t=this._reader.readMessage(ai.RecordBatch);if(null==t?void 0:t.isRecordBatch()){const e=t.header(),n=this._reader.readMessageBody(t.bodyLength);return this._loadRecordBatch(e,n)}}return null}_readDictionaryBatch(t){var e;const n=null===(e=this._footer)||void 0===e?void 0:e.getDictionaryBatch(t);if(n&&this._handle.seek(n.offset)){const t=this._reader.readMessage(ai.DictionaryBatch);if(null==t?void 0:t.isDictionaryBatch()){const e=t.header(),n=this._reader.readMessageBody(t.bodyLength),r=this._loadDictionaryBatch(e,n);this.dictionaries.set(e.id,r)}}}_readFooter(){const{_handle:t}=this,e=t.size-Uc,n=t.readInt32(e),r=t.readAt(e-n,n);return iu.decode(r)}_readNextMessageAndValidate(t){var e;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const n=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(this._recordBatchIndex);if(n&&this._handle.seek(n.offset))return this._reader.readMessage(t)}return null}}class Gc extends Hc{constructor(t,...e){const n="number"!=typeof e[0]?e.shift():void 0,r=e[0]instanceof Map?e.shift():void 0;super(t instanceof bu?t:new bu(t,n),r)}get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}isFile(){return!0}isAsync(){return!0}open(t){const e=Object.create(null,{open:{get:()=>super.open}});return ar(this,void 0,void 0,(function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield e.open.call(this,t)}))}readRecordBatch(t){var e;return ar(this,void 0,void 0,(function*(){if(this.closed)return null;this._footer||(yield this.open());const n=null===(e=this._footer)||void 0===e?void 0:e.getRecordBatch(t);if(n&&(yield this._handle.seek(n.offset))){const t=yield this._reader.readMessage(ai.RecordBatch);if(null==t?void 0:t.isRecordBatch()){const e=t.header(),n=yield this._reader.readMessageBody(t.bodyLength);return this._loadRecordBatch(e,n)}}return null}))}_readDictionaryBatch(t){var e;return ar(this,void 0,void 0,(function*(){const n=null===(e=this._footer)||void 0===e?void 0:e.getDictionaryBatch(t);if(n&&(yield this._handle.seek(n.offset))){const t=yield this._reader.readMessage(ai.DictionaryBatch);if(null==t?void 0:t.isDictionaryBatch()){const e=t.header(),n=yield this._reader.readMessageBody(t.bodyLength),r=this._loadDictionaryBatch(e,n);this.dictionaries.set(e.id,r)}}}))}_readFooter(){return ar(this,void 0,void 0,(function*(){const{_handle:t}=this;t._pending&&(yield t._pending);const e=t.size-Uc,n=yield t.readInt32(e),r=yield t.readAt(e-n,n);return iu.decode(r)}))}_readNextMessageAndValidate(t){return ar(this,void 0,void 0,(function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const e=this._footer.getRecordBatch(this._recordBatchIndex);if(e&&(yield this._handle.seek(e.offset)))return yield this._reader.readMessage(t)}return null}))}}class Kc extends Yc{constructor(t,e){super(t,e)}_loadVectors(t,e,n){return new Iu(e,t.nodes,t.buffers,this.dictionaries).visitMany(n)}}function Qc(t,e){return e&&"boolean"==typeof e.autoDestroy?e.autoDestroy:t.autoDestroy}function*Jc(t){const e=zc.from(t);try{if(!e.open({autoDestroy:!1}).closed)do{yield e}while(!e.reset().open().closed)}finally{e.cancel()}}function Xc(t){return lr(this,arguments,(function*(){const e=yield cr(zc.from(t));try{if(!(yield cr(e.open({autoDestroy:!1}))).closed)do{yield yield cr(e)}while(!(yield cr(e.reset().open())).closed)}finally{yield cr(e.cancel())}}))}function Zc(t){const e=zc.from(t);return Ir(e)?(()=>ar(this,void 0,void 0,(function*(){return new qu(yield(yield e).readAll())})))():new qu(e.readAll())}export{r as A,L as B,je as C,sr as D,dt as E,ft as F,He as G,or as H,Zc as I,w as K,U as a,z as b,j as c,P as d,$ as e,rt as f,q as g,Q as h,W as i,et as j,J as k,V as l,X as m,Z as n,M as o,G as p,R as q,i as r,s,tt as t,H as u,u as v,K as w,a as x,Y as y,d as z};
